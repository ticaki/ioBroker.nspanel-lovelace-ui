{
  "version": 3,
  "sources": ["../../../src/lib/controller/states-controller.ts"],
  "sourcesContent": ["// BaseClass extends\n\nimport type { IClientPublishOptions } from 'mqtt';\nimport type { PageInterface } from '../classes/Page';\nimport { Dataitem } from '../classes/data-item';\nimport { BaseClass } from '../classes/library';\nimport type { PageItem } from '../pages/pageItem';\nimport type { PageItemDataItemsOptions } from '../types/type-pageItem';\nimport type { DataItemsOptions, nsPanelState, nsPanelStateVal } from '../types/types';\nimport type { Controller } from './controller';\nimport type { Panel } from './panel';\nimport type { PanelSend } from './panel-message';\nimport { genericStateObjects } from '../const/definition';\nimport { getRegExp } from '../const/tools';\nimport type { NspanelLovelaceUi } from '../types/NspanelLovelaceUi';\n\nexport interface BaseClassTriggerdInterface {\n    name: string;\n    adapter: NspanelLovelaceUi;\n    panelSend: PanelSend;\n    alwaysOn?: 'none' | 'always' | 'action';\n    panel: Panel;\n    dpInit?: string | RegExp;\n}\n\n/**\n * Basisklasse f\u00FCr alles das auf Statestriggern soll - also jede card / popup\n * \u00FCbernimmt auch die Sichtbarkeitssteuerung das triggern wird pausiert wenn nicht sichtbar\n * mit async onStateTrigger(): Promise<void> {} k\u00F6nnen abgeleitete Klassen auf Triggerereignisse reagieren\n */\nexport class BaseClassTriggerd extends BaseClass {\n    private updateTimeout: ioBroker.Timeout | undefined;\n    private waitForTimeout: ioBroker.Timeout | undefined;\n    private doUpdate: boolean = true;\n    protected minUpdateInterval: number;\n    protected visibility: boolean = false;\n    protected controller: Controller;\n    readonly panelSend: PanelSend;\n    public alwaysOn: 'none' | 'always' | 'action';\n    private alwaysOnState: ioBroker.Timeout | undefined;\n    private lastMessage: string = '';\n    public panel: Panel;\n    neverDeactivateTrigger: boolean = false;\n    sleep: boolean = true;\n    parent: BaseClassTriggerd | undefined = undefined;\n    triggerParent: boolean = false;\n    dpInit: string | RegExp = '';\n    protected enums: string | string[] = '';\n    protected device: string = '';\n    protected sendToPanel: (payload: string, opt?: IClientPublishOptions) => void = (\n        payload: string,\n        opt?: IClientPublishOptions,\n    ) => {\n        if (payload == this.lastMessage) {\n            return;\n        }\n        this.lastMessage = payload;\n\n        this.sendToPanelClass(payload, opt);\n    };\n    resetLastMessage(): void {\n        this.lastMessage = '';\n    }\n    private sendToPanelClass: (payload: string, opt?: IClientPublishOptions) => void = () => {};\n\n    constructor(card: BaseClassTriggerdInterface) {\n        super(card.adapter, card.name);\n        this.minUpdateInterval = 500;\n        if (!this.adapter.controller) {\n            throw new Error('No controller! bye bye');\n        }\n        this.controller = this.adapter.controller;\n        this.panelSend = card.panelSend;\n        this.alwaysOn = card.alwaysOn ?? 'none';\n        this.panel = card.panel;\n\n        if (typeof this.panelSend.addMessage === 'function') {\n            this.sendToPanelClass = card.panelSend.addMessage;\n        }\n    }\n\n    async reset(): Promise<void> {}\n\n    readonly onStateTriggerSuperDoNotOverride = async (dp: string, from: BaseClassTriggerd): Promise<boolean> => {\n        if ((!this.visibility && !(this.neverDeactivateTrigger || from.neverDeactivateTrigger)) || this.unload) {\n            return false;\n        }\n        if (this.sleep && !this.neverDeactivateTrigger) {\n            return false;\n        }\n        if (this.waitForTimeout) {\n            return false;\n        }\n        if (this.updateTimeout) {\n            this.doUpdate = true;\n            return false;\n        }\n        this.waitForTimeout = this.adapter.setTimeout(async () => {\n            this.waitForTimeout = undefined;\n            await this.onStateTrigger(dp, from);\n            if (this.alwaysOnState) {\n                this.adapter.clearTimeout(this.alwaysOnState);\n            }\n            if (this.alwaysOn === 'action') {\n                this.alwaysOnState = this.adapter.setTimeout(\n                    () => {\n                        this.panel.sendScreeensaverTimeout(this.panel.timeout);\n                    },\n                    this.panel.timeout * 1000 || 5000,\n                );\n            }\n        }, 20);\n        this.updateTimeout = this.adapter.setTimeout(async () => {\n            if (this.unload) {\n                return;\n            }\n            this.updateTimeout = undefined;\n            if (this.doUpdate) {\n                this.doUpdate = false;\n                await this.onStateTrigger(dp, from);\n            }\n        }, this.minUpdateInterval);\n        return true;\n    };\n    protected async onStateTrigger(_dp: string, _from: BaseClassTriggerd): Promise<void> {\n        this.adapter.log.warn(\n            `<- instance of [${Object.getPrototypeOf(this)}] is triggert but dont react or call super.onStateTrigger()`,\n        );\n    }\n\n    private async stopTriggerTimeout(): Promise<void> {\n        if (this.updateTimeout) {\n            this.adapter.clearTimeout(this.updateTimeout);\n            this.updateTimeout = undefined;\n        }\n    }\n    async delete(): Promise<void> {\n        await this.setVisibility(false);\n        this.parent = undefined;\n        await super.delete();\n        if (this.waitForTimeout) {\n            this.adapter.clearTimeout(this.waitForTimeout);\n        }\n        if (this.alwaysOnState) {\n            this.adapter.clearTimeout(this.alwaysOnState);\n        }\n        await this.stopTriggerTimeout();\n    }\n    getVisibility = (): boolean => {\n        return this.visibility;\n    };\n    setVisibility = async (v: boolean, force: boolean = false): Promise<void> => {\n        if (v !== this.visibility || force) {\n            this.visibility = v;\n            if (this.visibility) {\n                if (this.unload) {\n                    return;\n                }\n\n                if (this.alwaysOn != 'none') {\n                    if (this.alwaysOn === 'action') {\n                        this.alwaysOnState = this.adapter.setTimeout(\n                            async () => {\n                                this.panel.sendScreeensaverTimeout(this.panel.timeout);\n                            },\n                            this.panel.timeout * 2 * 1000 || 5000,\n                        );\n                    } else {\n                        this.panel.sendScreeensaverTimeout(0);\n                    }\n                } else {\n                    this.panel.sendScreeensaverTimeout(this.panel.timeout);\n                }\n                this.log.debug(`Switch page to visible${force ? ' (forced)' : ''}!`);\n                this.resetLastMessage();\n                this.controller && (await this.controller.statesControler.activateTrigger(this));\n\n                this.panel.info.nspanel.currentPage = this.name;\n                await this.library.writedp(\n                    `panels.${this.panel.name}.info.nspanel.currentPage`,\n                    this.name,\n                    genericStateObjects.panel.panels.info.nspanel.currentPage,\n                );\n            } else {\n                if (this.alwaysOnState) {\n                    this.adapter.clearTimeout(this.alwaysOnState);\n                }\n                this.log.debug(`Switch page to invisible${force ? ' (forced)' : ''}!`);\n                if (!this.neverDeactivateTrigger) {\n                    await this.stopTriggerTimeout();\n                    this.controller && (await this.controller.statesControler.deactivateTrigger(this));\n                }\n            }\n            await this.onVisibilityChange(v);\n        } else {\n            this.visibility = v;\n        }\n    };\n    /**\n     * Event when visibility is on Change.\n     *\n     * @param val true/false\n     */\n    protected async onVisibilityChange(val: boolean): Promise<void> {\n        val;\n        this.adapter.log.warn(\n            `<- instance of [${Object.getPrototypeOf(\n                this,\n            )}] not react on onVisibilityChange(), or call super.onVisibilityChange()`,\n        );\n    }\n}\n\nexport class BaseClassPage extends BaseClassTriggerd {\n    pageItemConfig: (PageItemDataItemsOptions | undefined)[] | undefined;\n    pageItems: (PageItem | undefined)[] | undefined;\n    constructor(card: PageInterface, pageItemsConfig: (PageItemDataItemsOptions | undefined)[] | undefined) {\n        super(card);\n        this.pageItemConfig = pageItemsConfig;\n    }\n}\ntype getInternalFunctionType = (\n    id: string,\n    state: ioBroker.State | nsPanelState | undefined,\n) => Promise<nsPanelStateVal>;\n/**\n * Verwendet um Lesezugriffe auf die States umzusetzten, die im NSPanel ververwendet werden.\n * Adapter eigenen States sind verboten\n * Speichert Zugriff zwischen das kann mit timespan vereinflusst werden.\n */\nexport class StatesControler extends BaseClass {\n    private triggerDB: {\n        [key: string]: {\n            state: nsPanelState;\n            to: BaseClassTriggerd[];\n            ts: number;\n            subscribed: boolean[];\n            common: ioBroker.StateCommon;\n            internal?: boolean;\n            f?: getInternalFunctionType;\n            triggerAllowed: boolean[];\n            change: ('ne' | 'ts')[];\n        };\n    } = {};\n    private deletePageInterval: ioBroker.Interval | undefined;\n\n    private stateDB: { [key: string]: { state: ioBroker.State; ts: number; common: ioBroker.StateCommon } } = {};\n    objectDatabase: Record<string, ioBroker.Object | null> = {};\n    intervalObjectDatabase: ioBroker.Interval | undefined;\n\n    timespan: number;\n\n    constructor(adapter: NspanelLovelaceUi, name: string = '', timespan: number = 15000) {\n        super(adapter, name || 'StatesDB');\n        this.timespan = timespan;\n        this.deletePageInterval = this.adapter.setInterval(this.deletePageLoop, 60000);\n        this.intervalObjectDatabase = this.adapter.setInterval(() => {\n            if (this.unload) {\n                return;\n            }\n            this.intervalObjectDatabase = undefined;\n            this.objectDatabase = {};\n        }, 1800000);\n    }\n    deletePageLoop = (): void => {\n        const removeId = [];\n        for (const id in this.triggerDB) {\n            const entry = this.triggerDB[id];\n            const removeIndex = [];\n            for (const i of entry.to) {\n                if (i.unload) {\n                    //this.log.debug('Unload element:  ' + entry.to[i].name);\n                    removeIndex.push(Number(i));\n                }\n            }\n            for (const i of removeIndex) {\n                for (const key in entry) {\n                    const k = key as keyof typeof entry;\n                    const item = entry[k];\n                    if (Array.isArray(item)) {\n                        item.splice(i, 1);\n                    }\n                }\n            }\n            if (entry.to.length === 0 && !entry.internal) {\n                removeId.push(id);\n            }\n        }\n\n        for (const id of removeId) {\n            delete this.triggerDB[id];\n        }\n    };\n\n    async delete(): Promise<void> {\n        await super.delete();\n        if (StatesControler.tempObjectDBTimeout) {\n            this.adapter.clearTimeout(StatesControler.tempObjectDBTimeout);\n        }\n        if (this.intervalObjectDatabase) {\n            this.adapter.clearInterval(this.intervalObjectDatabase);\n        }\n        if (StatesControler.tempObjectDBTimeout) {\n            this.adapter.clearTimeout(StatesControler.tempObjectDBTimeout);\n        }\n        if (this.deletePageInterval) {\n            this.adapter.clearInterval(this.deletePageInterval);\n        }\n    }\n    /**\n     * Set a subscript to an foreignState and write current state/value to db\n     *\n     * @param id state id\n     * @param from the page that handle the trigger\n     * @param internal if the state is internal\n     * @param trigger if the state should trigger other classes\n     * @param change if the state should trigger other classes\n     */\n    async setTrigger(\n        id: string,\n        from: BaseClassTriggerd,\n        internal: boolean = false,\n        trigger: boolean = true,\n        change?: 'ts',\n    ): Promise<void> {\n        if (id.startsWith(this.adapter.namespace)) {\n            this.log.warn(`Id: ${id} refers to the adapter's own namespace, this is not allowed!`);\n            return;\n            //throw new Error(`Id: ${id} refers to the adapter's own namespace, this is not allowed!`);\n        }\n        if (this.triggerDB[id] !== undefined) {\n            const index = this.triggerDB[id].to.findIndex(a => a == from);\n            if (index === -1) {\n                this.triggerDB[id].to.push(from);\n                this.triggerDB[id].subscribed.push(false);\n                this.triggerDB[id].triggerAllowed.push(trigger);\n                this.triggerDB[id].change.push(change ? change : 'ne');\n                this.log.debug(`Activate trigger from ${from.name} to ${id}`);\n            } else {\n                //nothing\n            }\n        } else if (internal) {\n            this.log.error('setInternal Trigger too early');\n        } else {\n            const state = await this.adapter.getForeignStateAsync(id);\n            if (state) {\n                // erstelle keinen trigger f\u00FCr das gleiche parent doppelt..\n                await this.adapter.subscribeForeignStatesAsync(id);\n                const obj = await this.getObjectAsync(id);\n                if (!obj || !obj.common || obj.type !== 'state') {\n                    throw new Error(`Got invalid object for ${id}`);\n                }\n                this.triggerDB[id] = {\n                    state,\n                    to: [from],\n                    ts: Date.now(),\n                    subscribed: [false],\n                    common: obj.common,\n                    triggerAllowed: [trigger],\n                    change: [change ? change : 'ne'],\n                };\n                if (this.stateDB[id] !== undefined) {\n                    delete this.stateDB[id];\n                }\n            }\n            this.log.debug(`Set a new trigger from ${from.name} to ${id}`);\n        }\n    }\n\n    /**\n     * Activate the triggers of a page. First subscribes to the state.\n     *\n     * @param to Page\n     */\n    async activateTrigger(to: BaseClassTriggerd | undefined): Promise<void> {\n        if (!to) {\n            return;\n        }\n        for (const id in this.triggerDB) {\n            const entry = this.triggerDB[id];\n            const index = entry.to.indexOf(to);\n            if (index === -1) {\n                continue;\n            }\n            if (entry.subscribed[index]) {\n                continue;\n            }\n            if (!entry.triggerAllowed[index]) {\n                continue;\n            }\n            if (!entry.subscribed.some(a => a)) {\n                await this.adapter.subscribeForeignStatesAsync(id);\n                const state = await this.adapter.getForeignStateAsync(id);\n                if (state) {\n                    entry.state = state;\n                }\n            }\n            entry.subscribed[index] = true;\n        }\n    }\n\n    /**\n     * Deactivate the triggers of a page. Last unsubscribes to the state.\n     *\n     * @param to Page\n     */\n    async deactivateTrigger(to: BaseClassTriggerd): Promise<void> {\n        for (const id in this.triggerDB) {\n            if (to.neverDeactivateTrigger) {\n                continue;\n            }\n            const entry = this.triggerDB[id];\n            if (entry.internal) {\n                continue;\n            }\n            const index = entry.to.indexOf(to);\n            if (index === -1) {\n                continue;\n            }\n            if (!entry.subscribed[index]) {\n                continue;\n            }\n            entry.subscribed[index] = false;\n            this.log.debug(`Deactivate trigger from ${to.name} to ${id}`);\n            if (!entry.subscribed.some(a => a)) {\n                await this.adapter.unsubscribeForeignStatesAsync(id);\n            }\n        }\n    }\n\n    async getStateVal(id: string): Promise<nsPanelState['val'] | null> {\n        const state = await this.getState(id, 'now');\n        if (state) {\n            return state.val ?? null;\n        }\n        return null;\n    }\n    /**\n     * Read a state from DB or js-controller\n     *\n     * @param id state id with namespace\n     * @param response now or medium\n     * @param internal if the state is internal\n     * @returns nsPanelState or null\n     */\n    async getState(\n        id: string,\n        response: 'now' | 'medium' = 'medium',\n        internal: boolean = false,\n    ): Promise<nsPanelState | null | undefined> {\n        let timespan = this.timespan;\n        if (response === 'now') {\n            timespan = 10;\n        } else {\n            timespan = 1000;\n        }\n        if (\n            this.triggerDB[id] !== undefined &&\n            (this.triggerDB[id].internal || this.triggerDB[id].subscribed.some(a => a))\n        ) {\n            let state: nsPanelState | null = null;\n            const f = this.triggerDB[id].f;\n            if (f) {\n                state = {\n                    ...this.triggerDB[id].state,\n                    val: await f(id, undefined),\n                };\n            } else {\n                state = this.triggerDB[id].state;\n            }\n            return state;\n        } else if (this.stateDB[id] && timespan) {\n            if (Date.now() - timespan - this.stateDB[id].ts < 0) {\n                return this.stateDB[id].state;\n            }\n        }\n        if (id.includes('/')) {\n            internal = true;\n        }\n        if (!internal) {\n            const state = await this.adapter.getForeignStateAsync(id);\n            if (state) {\n                if (!this.stateDB[id]) {\n                    const obj = await this.getObjectAsync(id);\n                    if (!obj || !obj.common || obj.type !== 'state') {\n                        throw new Error(`Got invalid object for ${id}`);\n                    }\n                    this.stateDB[id] = { state: state, ts: Date.now(), common: obj.common };\n                } else {\n                    this.stateDB[id].state = state;\n                    this.stateDB[id].ts = Date.now();\n                }\n                return state;\n            }\n        }\n        throw new Error(`State id invalid ${id} no data!`);\n    }\n\n    getType(id: string): ioBroker.CommonType | undefined {\n        if (this.triggerDB[id] !== undefined && this.triggerDB[id].common) {\n            return this.triggerDB[id].common.type;\n        }\n        if (this.stateDB[id] !== undefined) {\n            return this.stateDB[id].common.type;\n        }\n        return undefined;\n    }\n\n    async getCommonStates(id: string, force: boolean = false): Promise<Record<string, string> | undefined> {\n        let j: string | string[] | Record<string, string> | undefined = undefined;\n        if (force) {\n            const obj = await this.adapter.getObjectAsync(id);\n            if (obj && obj.common && obj.common.states) {\n                j = obj.common.state;\n            }\n        } else if (this.triggerDB[id] !== undefined && this.triggerDB[id].common) {\n            j = this.triggerDB[id].common.states;\n        } else if (this.stateDB[id] !== undefined && this.stateDB[id].common) {\n            j = this.stateDB[id].common.states;\n        }\n\n        if (!j || typeof j === 'string') {\n            return undefined;\n        }\n        if (Array.isArray(j)) {\n            const a: Record<string, string> = {};\n            j.forEach((e, i) => (a[String(i)] = e));\n            j = a;\n        }\n        return j;\n    }\n\n    /**\n     * Check if the trigger should trigger other classes. dont check if object has a active subscription. this is done in next step with visible & neverDeactiveTrigger\n     *\n     * @param dp internal/external\n     * @param state iobroker state\n     */\n    async onStateChange(dp: string, state: nsPanelState | ioBroker.State | null | undefined): Promise<void> {\n        if (dp && state) {\n            if (this.triggerDB[dp] && this.triggerDB[dp].state) {\n                this.log.debug(`Trigger from ${dp} with state ${JSON.stringify(state)}`);\n                this.triggerDB[dp].ts = Date.now();\n                const oldState = { val: this.triggerDB[dp].state.val, ack: this.triggerDB[dp].state.ack };\n                this.triggerDB[dp].state = state;\n                if (\n                    state.ack ||\n                    this.triggerDB[dp].internal ||\n                    dp.startsWith('0_userdata.0') ||\n                    dp.startsWith('alias.0')\n                ) {\n                    for (let i = 0; i < this.triggerDB[dp].to.length; i++) {\n                        const c = this.triggerDB[dp].to[i];\n                        if (\n                            oldState.val !== state.val ||\n                            oldState.ack !== state.ack ||\n                            this.triggerDB[dp].change[i] === 'ts'\n                        ) {\n                            if (\n                                (!c.neverDeactivateTrigger && !this.triggerDB[dp].subscribed[i]) ||\n                                !this.triggerDB[dp].triggerAllowed[i]\n                            ) {\n                                this.log.debug(`Ignore trigger from state ${dp} not subscribed or not allowed!`);\n                                this.log.debug(\n                                    `!c.neverDeactivateTrigger: ${!c.neverDeactivateTrigger} && !this.triggerDB[dp].subscribed[i]: ${!this.triggerDB[dp].subscribed[i]} || !this.triggerDB[dp].triggerAllowed[i]: ${!this.triggerDB[dp].triggerAllowed[i]}`,\n                                );\n                                return;\n                            }\n                            if (c.parent && c.triggerParent && !c.parent.unload && !c.parent.sleep) {\n                                c.parent.onStateTriggerSuperDoNotOverride &&\n                                    (await c.parent.onStateTriggerSuperDoNotOverride(dp, c));\n                            } else if (!c.unload) {\n                                c.onStateTriggerSuperDoNotOverride && (await c.onStateTriggerSuperDoNotOverride(dp, c));\n                            }\n                        } else {\n                            this.log.debug(`Ignore trigger from state ${dp} no change!`);\n                        }\n                    }\n                } else {\n                    this.log.debug(`Ignore trigger from state ${dp} ack is false!`);\n                }\n            }\n            if (state.val === null || state.val === undefined || typeof state.val !== 'object') {\n                if (dp.startsWith(this.adapter.namespace)) {\n                    const id = dp.replace(`${this.adapter.namespace}.`, '');\n                    const libState = this.library.readdb(id);\n                    if (libState) {\n                        this.library.setdb(id, {\n                            ...libState,\n                            val: state.val,\n                            ts: state.ts,\n                            ack: state.ack,\n                        });\n                    }\n\n                    if (\n                        libState &&\n                        libState.obj &&\n                        libState.obj.common &&\n                        libState.obj.common.write &&\n                        this.adapter.controller\n                    ) {\n                        for (const panel of this.adapter.controller.panels) {\n                            await panel.onStateChange(id, state);\n                        }\n                    }\n                }\n                if (dp.startsWith('system.host')) {\n                    this.adapter.controller &&\n                        (await this.adapter.controller.systemNotification.onStateChange(dp, state as ioBroker.State));\n                }\n            }\n        }\n    }\n    async setStateAsync(item: Dataitem, val: ioBroker.StateValue, writeable: boolean): Promise<void> {\n        if (item.options.type === 'state' || item.options.type === 'triggered') {\n            if (item.options.dp) {\n                const ack = item.options.dp.startsWith(this.adapter.namespace);\n                this.log.debug(`setStateAsync(${item.options.dp}, ${val}, ${ack})`);\n                if (item.trueType() === 'number' && typeof val === 'string') {\n                    val = parseFloat(val);\n                } else if (item.trueType() === 'number' && typeof val === 'boolean') {\n                    val = val ? 1 : 0;\n                } else if (item.trueType() === 'boolean') {\n                    val = !!val;\n                }\n                if (item.trueType() === 'string') {\n                    val = String(val);\n                }\n                if (writeable) {\n                    await this.adapter.setForeignStateAsync(item.options.dp, val, ack);\n                } else {\n                    this.log.error(`Forbidden write attempts on a read-only state! id: ${item.options.dp}`);\n                }\n            }\n        } else if (item.options.type === 'internal' || item.options.type === 'internalState') {\n            if (this.triggerDB[item.options.dp]) {\n                await this.setInternalState(item.options.dp, val, false);\n            }\n        }\n    }\n\n    /**\n     * Set a internal state and trigger\n     *\n     * @param id something like 'cmd/blabla'\n     * @param val Value\n     * @param ack false use value/ true use func\n     * @param common optional for first call\n     * @param func optional for first call\n     * @returns true if set\n     */\n    public async setInternalState(\n        id: string,\n        val: nsPanelStateVal,\n        ack: boolean = false,\n        common: ioBroker.StateCommon | undefined = undefined,\n        func: getInternalFunctionType | undefined = undefined,\n    ): Promise<boolean> {\n        if (this.triggerDB[id] !== undefined) {\n            const f = this.triggerDB[id].f;\n\n            const newState = {\n                ...this.triggerDB[id].state,\n                // if ack and function take value of function otherwise val\n                val: ack && f ? ((await f(id, undefined)) ?? val) : val,\n                ack: ack,\n                ts: Date.now(),\n            };\n\n            // use this to trigger pages\n            await this.onStateChange(id, newState);\n\n            // here we trigger the state command\n            f && (await f(id, this.triggerDB[id].state));\n\n            return true;\n\n            // create the db entry\n        } else if (common) {\n            this.log.debug(`Add internal state ${id} with ${JSON.stringify(common)}`);\n            this.triggerDB[id] = {\n                state: { ts: Date.now(), val: null, ack: ack, from: '', lc: Date.now() },\n                to: [],\n                ts: Date.now(),\n                subscribed: [],\n                common: common,\n                internal: true,\n                f: func,\n                triggerAllowed: [],\n                change: [],\n            };\n        }\n        return false;\n    }\n\n    /**\n     * Create dataitems from a json (deep)\n     *\n     * @param data Json with configuration to create dataitems\n     * @param parent Page etc.\n     * @param target optional target\n     * @returns then json with values dataitem or undefined\n     */\n    async createDataItems(data: any, parent: any, target: any = {}): Promise<any> {\n        for (const i in data) {\n            const d = data[i];\n            if (d === undefined) {\n                continue;\n            }\n            if (typeof d === 'object' && !('type' in d)) {\n                target[i] = await this.createDataItems(d, parent, (target[i] ?? Array.isArray(d)) ? [] : {});\n            } else if (typeof d === 'object' && 'type' in d) {\n                target[i] =\n                    data[i] !== undefined\n                        ? new Dataitem(this.adapter, { ...d, name: `${this.name}.${parent.name}.${i}` }, parent, this)\n                        : undefined;\n                if (target[i] !== undefined && !(await target[i].isValidAndInit())) {\n                    target[i] = undefined;\n                }\n            }\n        }\n        if (Object.keys(target).length === 0) {\n            return undefined;\n        }\n        return target;\n    }\n\n    /**\n     * Tempor\u00E4es Datenobject zum speichern aller Enums und Objecte\n     */\n    static TempObjectDB: {\n        data: Record<string, ioBroker.Object> | undefined;\n        keys: string[];\n        enums: Record<string, ioBroker.EnumObject> | undefined;\n    } = {\n        data: undefined,\n        keys: [],\n        enums: undefined,\n    };\n    static tempObjectDBTimeout: ioBroker.Timeout | undefined;\n    static getTempObjectDB(adapter: NspanelLovelaceUi): typeof StatesControler.TempObjectDB {\n        if (StatesControler.tempObjectDBTimeout) {\n            adapter.clearTimeout(StatesControler.tempObjectDBTimeout);\n        }\n\n        StatesControler.tempObjectDBTimeout = adapter.setTimeout(() => {\n            if (adapter.unload) {\n                return;\n            }\n            StatesControler.tempObjectDBTimeout = undefined;\n            StatesControler.TempObjectDB = { data: undefined, keys: [], enums: undefined };\n        }, 60000);\n\n        return StatesControler.TempObjectDB;\n    }\n    /**\n     * Filterfunktion umso genauer die Filter um so weniger Ressourcen werden verbraucht.\n     *\n     * @param dpInit string RegExp oder '' f\u00FCr aus; string wird mit include verwendet.\n     * @param enums string, string[], RegExp als String \u00FCbergeben oder ein String der mit include verwenden wird.\n     * @returns 2 arrays keys: gefilterte keys und data: alle Objekte...\n     */\n    async getFilteredObjects(dpInit: string | RegExp, enums?: string | string[]): Promise<typeof result> {\n        const tempObjectDB = StatesControler.getTempObjectDB(this.adapter);\n        if (!tempObjectDB.data) {\n            tempObjectDB.data = await this.adapter.getForeignObjectsAsync(`*`);\n            if (!tempObjectDB.data) {\n                throw new Error('getObjects fail. Critical Error!');\n            }\n            tempObjectDB.keys = Object.keys(tempObjectDB.data);\n            const temp = await this.adapter.getEnumsAsync(['rooms', 'functions']);\n            tempObjectDB.enums = Object.assign(temp['enum.rooms'], temp['enum.functions']);\n        }\n        const result: { data: Record<string, ioBroker.Object> | undefined; keys: string[] } = {\n            data: tempObjectDB.data,\n            keys: tempObjectDB.keys,\n        };\n        if (dpInit) {\n            if (typeof dpInit !== 'string') {\n                result.keys = tempObjectDB.keys.filter(a => a.match(dpInit) !== null);\n            } else {\n                result.keys = tempObjectDB.keys.filter(a => a.includes(dpInit));\n            }\n        }\n        if (enums && tempObjectDB.enums) {\n            if (typeof enums === 'string') {\n                enums = [enums];\n            }\n            let r: string[] | undefined;\n            for (const e of enums) {\n                const regexp = getRegExp(e);\n                let t: string[] = [];\n                for (const a in tempObjectDB.enums) {\n                    if ((!regexp && a.includes(e)) || (regexp && a.match(regexp) !== null)) {\n                        if (\n                            tempObjectDB.enums[a] &&\n                            tempObjectDB.enums[a].common &&\n                            tempObjectDB.enums[a].common.members\n                        ) {\n                            t = t.concat(tempObjectDB.enums[a].common.members);\n                        }\n                    }\n                }\n                if (!r) {\n                    r = t;\n                } else {\n                    r = r.filter(a => t.indexOf(a) !== -1);\n                }\n            }\n            result.keys = result.keys.filter(a => r && r.some(b => a.startsWith(b)));\n        }\n        return result;\n    }\n    async getDataItemsFromAuto(\n        dpInit: string | RegExp,\n        data: any,\n        appendix?: string,\n        enums?: string | string[],\n    ): Promise<any> {\n        if (dpInit === '' && enums === undefined) {\n            return data;\n        }\n        const tempObjectDB = await this.getFilteredObjects(dpInit, enums);\n        if (tempObjectDB.data) {\n            for (const i in data) {\n                const t = data[i];\n                if (t === undefined) {\n                    continue;\n                }\n                if (typeof t === 'object' && !('type' in t)) {\n                    data[i] = await this.getDataItemsFromAuto(dpInit, t, appendix, enums);\n                } else if (typeof t === 'object' && 'type' in t) {\n                    const d = t as DataItemsOptions;\n                    let found = false;\n                    if ((d.type !== 'triggered' && d.type !== 'state') || !d.mode || d.mode !== 'auto') {\n                        continue;\n                    }\n\n                    for (const role of Array.isArray(d.role) ? d.role : [d.role]) {\n                        //throw new Error(`${d.dp} has a unkowned role ${d.role}`);\n\n                        if (tempObjectDB.keys.length === 0) {\n                            this.log.warn(`Dont find states for ${dpInit}!`);\n                        }\n\n                        for (const id of tempObjectDB.keys) {\n                            const obj: ioBroker.Object = tempObjectDB.data[id];\n\n                            if (\n                                obj &&\n                                obj.common &&\n                                obj.type === 'state' &&\n                                (d.dp === '' || id.includes(d.dp)) &&\n                                (role === '' || obj.common.role === role) &&\n                                (!d.regexp || id.match(d.regexp) !== null)\n                            ) {\n                                if (found) {\n                                    this.log.warn(\n                                        `Found more as 1 state for role ${role} in ${dpInit} with .dp: ${\n                                            d.dp ? d.dp.toString() : 'empty'\n                                        } and .regexp: ${d.regexp ? d.regexp.toString() : 'empty'}`,\n                                    );\n                                    break;\n                                }\n                                d.dp = id;\n                                d.mode = 'done';\n                                found = true;\n                            }\n                        }\n                        if (found) {\n                            break;\n                        }\n                    }\n                    if (!found) {\n                        d.mode = 'fail';\n                        data[i] = undefined;\n                        console.warn(\n                            `No state found for role ${JSON.stringify(d.role)} in ${dpInit.toString()} with with .dp: ${\n                                d.dp ? d.dp.toString() : 'empty'\n                            } and .regexp: ${d.regexp ? d.regexp.toString() : 'empty'}`,\n                        );\n                    }\n                }\n            }\n        }\n        return data;\n    }\n\n    async getObjectAsync(id: string): Promise<ioBroker.Object | null> {\n        if (this.objectDatabase[id] !== undefined) {\n            return this.objectDatabase[id];\n        } else if (this.triggerDB[id] !== undefined && this.triggerDB[id].internal) {\n            return { _id: '', type: 'state', common: this.triggerDB[id].common, native: {} };\n        }\n        const obj = await this.adapter.getForeignObjectAsync(id);\n        this.objectDatabase[id] = obj ?? null;\n        return obj ?? null;\n    }\n}\n"],
  "mappings": "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",
  "names": []
}
