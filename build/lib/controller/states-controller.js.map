{
  "version": 3,
  "sources": ["../../../src/lib/controller/states-controller.ts"],
  "sourcesContent": ["// BaseClass extends\n\nimport { IClientPublishOptions } from 'mqtt';\nimport { Dataitem } from '../classes/data-item';\nimport { AdapterClassDefinition, BaseClass } from '../classes/library';\nimport { DataItemsOptions } from '../types/types';\nimport { Controller } from './controller';\nimport { PanelSend } from './panel-message';\nimport { isPageRole } from '../types/pages';\nimport { Panel } from './panel';\nimport { PageItemDataItemsOptions } from '../types/type-pageItem';\nimport { PageItem } from '../pages/pageItem';\nimport { PageInterface } from '../classes/Page';\n\nexport interface BaseClassTriggerdInterface {\n    name: string;\n    adapter: AdapterClassDefinition;\n    panelSend: PanelSend;\n    alwaysOn?: 'none' | 'always' | 'action';\n    panel: Panel;\n}\n\n/**\n * Basisklasse f\u00FCr alles das auf Statestriggern soll - also jede card / popup\n * \u00FCbernimmt auch die Sichtbarkeitssteuerung das triggern wird pausiert wenn nicht sichtbar\n * mit async onStateTrigger(): Promise<void> {} k\u00F6nnen abgeleitete Klassen auf Triggerereignisse reagieren\n */\nexport class BaseClassTriggerd extends BaseClass {\n    private updateTimeout: ioBroker.Timeout | undefined;\n    private waitForTimeout: ioBroker.Timeout | undefined;\n    private doUpdate: boolean = true;\n    protected minUpdateInterval: number;\n    protected visibility: boolean = false;\n    protected controller: Controller;\n    readonly panelSend: PanelSend;\n    public alwaysOn: 'none' | 'always' | 'action';\n    private alwaysOnState: ioBroker.Timeout | undefined;\n    private lastMessage: string = '';\n    protected panel: Panel;\n    protected sendToPanel: (payload: string, opt?: IClientPublishOptions) => void = (\n        payload: string,\n        opt?: IClientPublishOptions,\n    ) => {\n        if (payload == this.lastMessage) return;\n        this.lastMessage = payload;\n\n        this.sendToPanelClass(payload, opt);\n    };\n    resetLastMessage(): void {\n        this.lastMessage = '';\n    }\n    private sendToPanelClass: (payload: string, opt?: IClientPublishOptions) => void = () => {};\n\n    constructor(card: BaseClassTriggerdInterface) {\n        super(card.adapter, card.name);\n        this.minUpdateInterval = 3000;\n        if (!this.adapter.controller) throw new Error('No controller! bye bye');\n        this.controller = this.adapter.controller;\n        this.panelSend = card.panelSend;\n        this.alwaysOn = card.alwaysOn ?? 'none';\n        this.panel = card.panel;\n        if (typeof this.panelSend.addMessage === 'function') this.sendToPanelClass = card.panelSend.addMessage;\n    }\n    readonly onStateTriggerSuperDoNotOverride = async (response: 'now' | 'medium' | 'slow'): Promise<boolean> => {\n        if (!this.visibility || this.unload) return false;\n        if (this.waitForTimeout) return false;\n\n        if (this.updateTimeout && response !== 'now') {\n            this.doUpdate = true;\n            return false;\n        } else {\n            this.waitForTimeout = this.adapter.setTimeout(() => {\n                this.waitForTimeout = undefined;\n                this.onStateTrigger();\n                if (this.alwaysOnState) this.adapter.clearTimeout(this.alwaysOnState);\n                if (this.alwaysOn === 'action') {\n                    this.alwaysOnState = this.adapter.setTimeout(\n                        () => {\n                            this.panel.sendScreeensaverTimeout(this.panel.timeout);\n                        },\n                        this.panel.timeout * 1000 || 5000,\n                    );\n                }\n            }, 50);\n            this.updateTimeout = this.adapter.setTimeout(async () => {\n                if (this.unload) return;\n                this.updateTimeout = undefined;\n                if (this.doUpdate) {\n                    this.doUpdate = false;\n                    await this.onStateTrigger();\n                }\n            }, this.minUpdateInterval);\n            return true;\n        }\n    };\n    protected async onStateTrigger(): Promise<void> {\n        this.adapter.log.warn(\n            `<- instance of [${Object.getPrototypeOf(this)}] is triggert but dont react or call super.onStateTrigger()`,\n        );\n    }\n\n    private async stopTriggerTimeout(): Promise<void> {\n        if (this.updateTimeout) {\n            this.adapter.clearTimeout(this.updateTimeout);\n            this.updateTimeout = undefined;\n        }\n    }\n    async delete(): Promise<void> {\n        await this.setVisibility(false);\n        await super.delete();\n        if (this.waitForTimeout) this.adapter.clearTimeout(this.waitForTimeout);\n        if (this.alwaysOnState) this.adapter.clearTimeout(this.alwaysOnState);\n        await this.stopTriggerTimeout();\n    }\n    getVisibility = (): boolean => {\n        return this.visibility;\n    };\n    setVisibility = async (v: boolean, force: boolean = false): Promise<void> => {\n        if (v !== this.visibility || force) {\n            this.visibility = v;\n            if (this.visibility) {\n                if (this.unload) return;\n\n                if (this.alwaysOn != 'none') {\n                    await this.panel.sendScreeensaverTimeout(0);\n\n                    if (this.alwaysOn === 'action') {\n                        this.alwaysOnState = this.adapter.setTimeout(\n                            async () => {\n                                await this.panel.sendScreeensaverTimeout(this.panel.timeout);\n                            },\n                            this.panel.timeout * 2 * 1000 || 5000,\n                        );\n                    }\n                } else this.panel.sendScreeensaverTimeout(this.panel.timeout);\n                this.log.debug(`Switch page to visible${force ? ' (forced)' : ''}!`);\n                this.resetLastMessage();\n                this.controller && (await this.controller.statesControler.activateTrigger(this));\n            } else {\n                if (this.alwaysOnState) this.adapter.clearTimeout(this.alwaysOnState);\n                await this.panel.sendScreeensaverTimeout(this.panel.timeout);\n                this.log.debug(`Switch page to invisible${force ? ' (forced)' : ''}!`);\n                this.stopTriggerTimeout();\n                this.controller && (await this.controller.statesControler.deactivateTrigger(this));\n            }\n            await this.onVisibilityChange(v);\n        } else this.visibility = v;\n    };\n    /**\n     * Event when visibility is on Change.\n     */\n    protected async onVisibilityChange(val: boolean): Promise<void> {\n        val;\n        this.adapter.log.warn(\n            `<- instance of [${Object.getPrototypeOf(\n                this,\n            )}] not react on onVisibilityChange(), or call super.onVisibilityChange()`,\n        );\n    }\n}\n\nexport class BaseClassPage extends BaseClassTriggerd {\n    readonly pageItemConfig: (PageItemDataItemsOptions | undefined)[] | undefined;\n    pageItems: PageItem[] | undefined;\n    constructor(card: PageInterface, pageItemsConfig: (PageItemDataItemsOptions | undefined)[] | undefined) {\n        super(card);\n        this.pageItemConfig = pageItemsConfig;\n    }\n}\n\n/**\n * Verwendet um Lesezugriffe auf die States umzusetzten, die im NSPanel ververwendet werden.\n * Adapter eigenen States sind verboten\n * Speichert Zugriff zwischen das kann mit timespan vereinflusst werden.\n */\nexport class StatesControler extends BaseClass {\n    private triggerDB: {\n        [key: string]: {\n            state: ioBroker.State;\n            to: BaseClassTriggerd[];\n            ts: number;\n            subscribed: boolean[];\n            response: ('now' | 'medium' | 'slow')[];\n            common: ioBroker.StateCommon;\n        };\n    } = {};\n    private deletePageTimeout: ioBroker.Interval | undefined;\n    private stateDB: { [key: string]: { state: ioBroker.State; ts: number; common: ioBroker.StateCommon } } = {};\n    private tempObjectDB: { [key: string]: { [id: string]: ioBroker.Object } } | undefined = undefined;\n    timespan: number;\n    constructor(adapter: AdapterClassDefinition, name: string = '', timespan: number = 15000) {\n        super(adapter, name || 'StatesDBReadOnly');\n        this.timespan = timespan;\n        this.deletePageTimeout = this.adapter.setInterval(this.deletePageLoop, 60000);\n    }\n    private deletePageLoop = (): void => {\n        const removeId = [];\n        for (const id in this.triggerDB) {\n            const entry = this.triggerDB[id];\n            const removeIndex = [];\n            for (const i in entry.to) {\n                if (entry.to[i].unload) removeIndex.push(Number(i));\n            }\n            for (const i of removeIndex) {\n                for (const key in entry) {\n                    const k = key as keyof typeof entry;\n                    const item = entry[k];\n                    if (Array.isArray(item)) {\n                        item.splice(i, 1);\n                    }\n                }\n            }\n            if (entry.to.length === 0) removeId.push(id);\n        }\n\n        for (const id of removeId) {\n            delete this.triggerDB[id];\n        }\n    };\n\n    async delete(): Promise<void> {\n        await super.delete();\n        if (this.deletePageTimeout) this.adapter.clearInterval(this.deletePageTimeout);\n    }\n    /**\n     * Set a subscript to a foreignState and write current state/value to db\n     * @param id state id\n     * @param from the page that handle the trigger\n     */\n    async setTrigger(id: string, from: BaseClassTriggerd, response: 'now' | 'medium' | 'slow' = 'slow'): Promise<void> {\n        if (id.startsWith(this.adapter.namespace)) {\n            this.log.warn(`Id: ${id} refers to the adapter's own namespace, this is not allowed!`);\n            return;\n            //throw new Error(`Id: ${id} refers to the adapter's own namespace, this is not allowed!`);\n        }\n        if (this.triggerDB[id] !== undefined) {\n            const index = this.triggerDB[id].to.findIndex((a) => a == from);\n            if (index === -1) {\n                this.triggerDB[id].to.push(from);\n                this.triggerDB[id].subscribed.push(false);\n                this.triggerDB[id].response.push(response);\n            } else {\n                if (this.triggerDB[id].response[index] !== response) {\n                    if (response === 'now') this.triggerDB[id].response[index] = 'now';\n                }\n            }\n        } else {\n            const state = await this.adapter.getForeignStateAsync(id);\n            if (state) {\n                // erstelle keinen trigger f\u00FCr das gleiche parent doppelt..\n                await this.adapter.subscribeForeignStatesAsync(id);\n                const obj = await this.adapter.getForeignObjectAsync(id);\n                if (!obj || !obj.common || obj.type !== 'state') throw new Error('Got invalid object for ' + id);\n                this.triggerDB[id] = {\n                    state,\n                    to: [from],\n                    ts: Date.now(),\n                    subscribed: [false],\n                    response: [response],\n                    common: obj.common,\n                };\n                if (this.stateDB[id] !== undefined) {\n                    delete this.stateDB[id];\n                }\n            }\n            this.log.debug(`Set a new trigger to ${id}`);\n        }\n    }\n\n    /**\n     * Activate the triggers of a page. First subscribes to the state.\n     * @param to Page\n     */\n    async activateTrigger(to: BaseClassTriggerd): Promise<void> {\n        for (const id in this.triggerDB) {\n            const entry = this.triggerDB[id];\n            const index = entry.to.indexOf(to);\n            if (index === -1) continue;\n            if (entry.subscribed[index]) continue;\n            if (!entry.subscribed.some((a) => a)) {\n                await this.adapter.subscribeForeignStatesAsync(id);\n                const state = await this.adapter.getForeignStateAsync(id);\n                if (state) {\n                    entry.state = state;\n                }\n            }\n            entry.subscribed[index] = true;\n        }\n    }\n\n    /**\n     * Deactivate the triggers of a page. Last unsubscribes to the state.\n     * @param to Page\n     */\n    async deactivateTrigger(to: BaseClassTriggerd): Promise<void> {\n        for (const id in this.triggerDB) {\n            const entry = this.triggerDB[id];\n            const index = entry.to.indexOf(to);\n            if (index === -1) continue;\n            if (!entry.subscribed[index]) continue;\n            entry.subscribed[index] = false;\n            if (!entry.subscribed.some((a) => a)) {\n                await this.adapter.unsubscribeForeignStatesAsync(id);\n            }\n        }\n    }\n    /**\n     * Read a state from DB or js-controller\n     * @param id state id with namespace\n     * @returns\n     */\n    async getState(\n        id: string,\n        response: 'now' | 'medium' | 'slow' = 'slow',\n    ): Promise<ioBroker.State | null | undefined> {\n        let timespan = this.timespan;\n        if (response === 'medium') timespan = 3000;\n        else if (response === 'now') timespan = 0;\n        if (this.triggerDB[id] !== undefined && this.triggerDB[id].subscribed.some((a) => a)) {\n            return this.triggerDB[id].state;\n        } else if (this.stateDB[id] && timespan) {\n            if (Date.now() - timespan - this.stateDB[id].ts < 0) {\n                return this.stateDB[id].state;\n            }\n        }\n        const state = await this.adapter.getForeignStateAsync(id);\n        if (state) {\n            if (!this.stateDB[id]) {\n                const obj = await this.adapter.getForeignObjectAsync(id);\n                if (!obj || !obj.common || obj.type !== 'state') throw new Error('Got invalid object for ' + id);\n                this.stateDB[id] = { state: state, ts: Date.now(), common: obj.common };\n            } else {\n                this.stateDB[id].state = state;\n                this.stateDB[id].ts = Date.now();\n            }\n            return state;\n        }\n        throw new Error(`State id invalid ${id} no data!`);\n    }\n\n    getType(id: string): ioBroker.CommonType | undefined {\n        if (this.triggerDB[id] !== undefined) return this.triggerDB[id].common.type;\n        if (this.stateDB[id] !== undefined) return this.stateDB[id].common.type;\n        return undefined;\n    }\n\n    getCommonStates(id: string): Record<string, string> | undefined {\n        let j: string | string[] | Record<string, string> | undefined = undefined;\n        if (this.triggerDB[id] !== undefined) j = this.triggerDB[id].common.states;\n        else if (this.stateDB[id] !== undefined) j = this.stateDB[id].common.states;\n        if (!j || typeof j === 'string') return undefined;\n        if (Array.isArray(j)) {\n            const a: Record<string, string> = {};\n            j.forEach((e, i) => (a[String(i)] = e));\n            j = a;\n        }\n        return j;\n    }\n\n    async onStateChange(dp: string, state: ioBroker.State | null | undefined): Promise<void> {\n        if (dp && state) {\n            if (this.triggerDB[dp]) {\n                if (this.triggerDB[dp].state) {\n                    this.log.debug(`Trigger from ${dp} with state ${JSON.stringify(state)}`);\n                    this.triggerDB[dp].ts = Date.now();\n                    if (this.triggerDB[dp].state.val !== state.val || this.triggerDB[dp].state.ack !== state.ack) {\n                        this.triggerDB[dp].state = state;\n                        if (state.ack) {\n                            this.triggerDB[dp].to.forEach(\n                                (c, index) =>\n                                    c.onStateTriggerSuperDoNotOverride &&\n                                    c.onStateTriggerSuperDoNotOverride(this.triggerDB[dp].response[index]),\n                            );\n                        }\n                    }\n                }\n            }\n            if (dp.startsWith(this.adapter.namespace)) {\n                const id = dp.replace(this.adapter.namespace + '.', '');\n                const libState = this.library.readdb(id);\n                if (libState) {\n                    this.library.setdb(id, { ...libState, val: state.val, ts: state.ts, ack: state.ack });\n                }\n\n                if (\n                    libState &&\n                    libState.obj &&\n                    libState.obj.common &&\n                    libState.obj.common.write &&\n                    this.adapter.controller\n                ) {\n                    for (const panel of this.adapter.controller.panels) {\n                        await panel.onStateChange(id, state);\n                    }\n                }\n            }\n        }\n    }\n    async setStateAsync(item: Dataitem, val: ioBroker.StateValue, writeable: boolean): Promise<void> {\n        if (item.options.type === 'state' || item.options.type === 'triggered') {\n            if (item.options.dp) {\n                const ack = item.options.dp.startsWith(this.adapter.namespace);\n                this.log.debug(`setStateAsync(${item.options.dp}, ${val}, ${ack})`);\n                if (item.trueType() === 'number' && typeof val === 'string') val = parseFloat(val);\n                else if (item.trueType() === 'number' && typeof val === 'boolean') val = val ? 1 : 0;\n                else if (item.trueType() === 'boolean') val = !!val;\n                if (item.trueType() === 'string') val = String(val);\n                this.updateDBState(item.options.dp, val, ack);\n                if (writeable) await this.adapter.setForeignStateAsync(item.options.dp, val, ack);\n                else this.log.error(`Forbidden write attempts on a read-only state! id: ${item.options.dp}`);\n            }\n        } else if (item.options.type === 'internal') {\n            if (this.triggerDB[item.options.dp]) {\n                if (this.setInternalState(item.options.dp, val))\n                    await this.onStateChange(item.options.dp, this.triggerDB[item.options.dp].state);\n            }\n        }\n    }\n    private setInternalState(id: string, val: ioBroker.StateValue): boolean {\n        if (this.triggerDB[id] !== undefined) {\n            this.triggerDB[id].state = {\n                ...this.triggerDB[id].state,\n                val,\n                ack: true,\n                ts: Date.now(),\n            };\n            return true;\n        }\n        return false;\n    }\n\n    private updateDBState(id: string, val: ioBroker.StateValue, ack: boolean): void {\n        if (this.triggerDB[id] !== undefined) {\n            this.triggerDB[id].state.val = val;\n            this.triggerDB[id].state.ack = ack;\n        } else if (this.stateDB[id] !== undefined) {\n            this.stateDB[id].state.val = val;\n            this.stateDB[id].state.ack = ack;\n        }\n    }\n\n    /**\n     * Create dataitems from a json (deep)\n     * @param data Json with configuration to create dataitems\n     * @param parent Page etc.\n     * @returns then json with values dataitem or undefined\n     */\n    async createDataItems(data: any, parent: any, target: any = {}): Promise<any> {\n        for (const i in data) {\n            const d = data[i];\n            if (d === undefined) continue;\n            if (typeof d === 'object' && !('type' in d)) {\n                target[i] = await this.createDataItems(d, parent, target[i] ?? Array.isArray(d) ? [] : {});\n            } else if (typeof d === 'object' && 'type' in d) {\n                target[i] =\n                    data[i] !== undefined\n                        ? new Dataitem(this.adapter, { ...d, name: `${this.name}.${parent.name}.${i}` }, parent, this)\n                        : undefined;\n                if (target[i] !== undefined && !(await target[i].isValidAndInit())) {\n                    target[i] = undefined;\n                }\n            }\n        }\n        return target;\n    }\n\n    async getDataItemsFromAuto(dpInit: string, data: any): Promise<any> {\n        if (dpInit === '') return data;\n        if (this.tempObjectDB === undefined) {\n            this.tempObjectDB = {};\n            this.adapter.setTimeout(() => {\n                this.tempObjectDB = undefined;\n            }, 300000);\n        }\n        for (const i in data) {\n            const t = data[i];\n            if (t === undefined) continue;\n            if (typeof t === 'object' && !('type' in t)) {\n                data[i] = await this.getDataItemsFromAuto(dpInit, t);\n            } else if (typeof t === 'object' && 'type' in t) {\n                const d = t as DataItemsOptions;\n                let found = false;\n                if ((d.type !== 'triggered' && d.type !== 'state') || !d.mode || d.mode !== 'auto') continue;\n                for (const role of Array.isArray(d.role) ? d.role : [d.role]) {\n                    if (!isPageRole(role)) {\n                        throw new Error(`${d.dp} has a unkowned role ${d.role}`);\n                    }\n                    if (!this.tempObjectDB[dpInit]) {\n                        this.tempObjectDB[dpInit] = await this.adapter.getForeignObjectsAsync(`${dpInit}.*`);\n                    }\n                    if (!this.tempObjectDB[dpInit]) {\n                        this.log.warn(`Dont find states for ${dpInit}!`);\n                    }\n\n                    for (const id in this.tempObjectDB[dpInit]) {\n                        const obj: ioBroker.Object = this.tempObjectDB[dpInit][id];\n                        if (obj && obj.common && obj.type === 'state' && (d.dp === '' || id.includes(d.dp))) {\n                            if (obj.common.role === role) {\n                                if (found) {\n                                    this.log.warn(`Found more as 1 state for role ${role} in ${dpInit}`);\n                                    break;\n                                }\n                                d.dp = id;\n                                d.mode = 'done';\n                                found = true;\n                            }\n                        }\n                    }\n                    if (found) break;\n                }\n                if (!found) {\n                    data[i] = undefined;\n                    this.log.warn(`No state found for role ${JSON.stringify(d.role)} in ${dpInit}`);\n                }\n            }\n        }\n        return data;\n    }\n\n    /**\n     * what the name says\n     * @param id\n     * @returns\n     */\n    async existsState(id: string): Promise<boolean> {\n        if (id.startsWith(this.adapter.namespace)) {\n            return this.adapter.library.readdb(id.replace(this.adapter.namespace, '')) !== undefined;\n        } else {\n            return (await this.adapter.getForeignStateAsync(id)) !== undefined;\n        }\n    }\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA,uBAAyB;AACzB,qBAAkD;AAIlD,mBAA2B;AAmBpB,MAAM,0BAA0B,yBAAU;AAAA,EACrC;AAAA,EACA;AAAA,EACA,WAAoB;AAAA,EAClB;AAAA,EACA,aAAsB;AAAA,EACtB;AAAA,EACD;AAAA,EACF;AAAA,EACC;AAAA,EACA,cAAsB;AAAA,EACpB;AAAA,EACA,cAAsE,CAC5E,SACA,QACC;AACD,QAAI,WAAW,KAAK;AAAa;AACjC,SAAK,cAAc;AAEnB,SAAK,iBAAiB,SAAS,GAAG;AAAA,EACtC;AAAA,EACA,mBAAyB;AACrB,SAAK,cAAc;AAAA,EACvB;AAAA,EACQ,mBAA2E,MAAM;AAAA,EAAC;AAAA,EAE1F,YAAY,MAAkC;AArDlD;AAsDQ,UAAM,KAAK,SAAS,KAAK,IAAI;AAC7B,SAAK,oBAAoB;AACzB,QAAI,CAAC,KAAK,QAAQ;AAAY,YAAM,IAAI,MAAM,wBAAwB;AACtE,SAAK,aAAa,KAAK,QAAQ;AAC/B,SAAK,YAAY,KAAK;AACtB,SAAK,YAAW,UAAK,aAAL,YAAiB;AACjC,SAAK,QAAQ,KAAK;AAClB,QAAI,OAAO,KAAK,UAAU,eAAe;AAAY,WAAK,mBAAmB,KAAK,UAAU;AAAA,EAChG;AAAA,EACS,mCAAmC,OAAO,aAA0D;AACzG,QAAI,CAAC,KAAK,cAAc,KAAK;AAAQ,aAAO;AAC5C,QAAI,KAAK;AAAgB,aAAO;AAEhC,QAAI,KAAK,iBAAiB,aAAa,OAAO;AAC1C,WAAK,WAAW;AAChB,aAAO;AAAA,IACX,OAAO;AACH,WAAK,iBAAiB,KAAK,QAAQ,WAAW,MAAM;AAChD,aAAK,iBAAiB;AACtB,aAAK,eAAe;AACpB,YAAI,KAAK;AAAe,eAAK,QAAQ,aAAa,KAAK,aAAa;AACpE,YAAI,KAAK,aAAa,UAAU;AAC5B,eAAK,gBAAgB,KAAK,QAAQ;AAAA,YAC9B,MAAM;AACF,mBAAK,MAAM,wBAAwB,KAAK,MAAM,OAAO;AAAA,YACzD;AAAA,YACA,KAAK,MAAM,UAAU,OAAQ;AAAA,UACjC;AAAA,QACJ;AAAA,MACJ,GAAG,EAAE;AACL,WAAK,gBAAgB,KAAK,QAAQ,WAAW,YAAY;AACrD,YAAI,KAAK;AAAQ;AACjB,aAAK,gBAAgB;AACrB,YAAI,KAAK,UAAU;AACf,eAAK,WAAW;AAChB,gBAAM,KAAK,eAAe;AAAA,QAC9B;AAAA,MACJ,GAAG,KAAK,iBAAiB;AACzB,aAAO;AAAA,IACX;AAAA,EACJ;AAAA,EACA,MAAgB,iBAAgC;AAC5C,SAAK,QAAQ,IAAI;AAAA,MACb,mBAAmB,OAAO,eAAe,IAAI;AAAA,IACjD;AAAA,EACJ;AAAA,EAEA,MAAc,qBAAoC;AAC9C,QAAI,KAAK,eAAe;AACpB,WAAK,QAAQ,aAAa,KAAK,aAAa;AAC5C,WAAK,gBAAgB;AAAA,IACzB;AAAA,EACJ;AAAA,EACA,MAAM,SAAwB;AAC1B,UAAM,KAAK,cAAc,KAAK;AAC9B,UAAM,MAAM,OAAO;AACnB,QAAI,KAAK;AAAgB,WAAK,QAAQ,aAAa,KAAK,cAAc;AACtE,QAAI,KAAK;AAAe,WAAK,QAAQ,aAAa,KAAK,aAAa;AACpE,UAAM,KAAK,mBAAmB;AAAA,EAClC;AAAA,EACA,gBAAgB,MAAe;AAC3B,WAAO,KAAK;AAAA,EAChB;AAAA,EACA,gBAAgB,OAAO,GAAY,QAAiB,UAAyB;AACzE,QAAI,MAAM,KAAK,cAAc,OAAO;AAChC,WAAK,aAAa;AAClB,UAAI,KAAK,YAAY;AACjB,YAAI,KAAK;AAAQ;AAEjB,YAAI,KAAK,YAAY,QAAQ;AACzB,gBAAM,KAAK,MAAM,wBAAwB,CAAC;AAE1C,cAAI,KAAK,aAAa,UAAU;AAC5B,iBAAK,gBAAgB,KAAK,QAAQ;AAAA,cAC9B,YAAY;AACR,sBAAM,KAAK,MAAM,wBAAwB,KAAK,MAAM,OAAO;AAAA,cAC/D;AAAA,cACA,KAAK,MAAM,UAAU,IAAI,OAAQ;AAAA,YACrC;AAAA,UACJ;AAAA,QACJ;AAAO,eAAK,MAAM,wBAAwB,KAAK,MAAM,OAAO;AAC5D,aAAK,IAAI,MAAM,yBAAyB,QAAQ,cAAc,KAAK;AACnE,aAAK,iBAAiB;AACtB,aAAK,cAAe,MAAM,KAAK,WAAW,gBAAgB,gBAAgB,IAAI;AAAA,MAClF,OAAO;AACH,YAAI,KAAK;AAAe,eAAK,QAAQ,aAAa,KAAK,aAAa;AACpE,cAAM,KAAK,MAAM,wBAAwB,KAAK,MAAM,OAAO;AAC3D,aAAK,IAAI,MAAM,2BAA2B,QAAQ,cAAc,KAAK;AACrE,aAAK,mBAAmB;AACxB,aAAK,cAAe,MAAM,KAAK,WAAW,gBAAgB,kBAAkB,IAAI;AAAA,MACpF;AACA,YAAM,KAAK,mBAAmB,CAAC;AAAA,IACnC;AAAO,WAAK,aAAa;AAAA,EAC7B;AAAA,EAIA,MAAgB,mBAAmB,KAA6B;AAC5D;AACA,SAAK,QAAQ,IAAI;AAAA,MACb,mBAAmB,OAAO;AAAA,QACtB;AAAA,MACJ;AAAA,IACJ;AAAA,EACJ;AACJ;AAEO,MAAM,sBAAsB,kBAAkB;AAAA,EACxC;AAAA,EACT;AAAA,EACA,YAAY,MAAqB,iBAAuE;AACpG,UAAM,IAAI;AACV,SAAK,iBAAiB;AAAA,EAC1B;AACJ;AAOO,MAAM,wBAAwB,yBAAU;AAAA,EACnC,YASJ,CAAC;AAAA,EACG;AAAA,EACA,UAAkG,CAAC;AAAA,EACnG,eAAiF;AAAA,EACzF;AAAA,EACA,YAAY,SAAiC,OAAe,IAAI,WAAmB,MAAO;AACtF,UAAM,SAAS,QAAQ,kBAAkB;AACzC,SAAK,WAAW;AAChB,SAAK,oBAAoB,KAAK,QAAQ,YAAY,KAAK,gBAAgB,GAAK;AAAA,EAChF;AAAA,EACQ,iBAAiB,MAAY;AACjC,UAAM,WAAW,CAAC;AAClB,eAAW,MAAM,KAAK,WAAW;AAC7B,YAAM,QAAQ,KAAK,UAAU;AAC7B,YAAM,cAAc,CAAC;AACrB,iBAAW,KAAK,MAAM,IAAI;AACtB,YAAI,MAAM,GAAG,GAAG;AAAQ,sBAAY,KAAK,OAAO,CAAC,CAAC;AAAA,MACtD;AACA,iBAAW,KAAK,aAAa;AACzB,mBAAW,OAAO,OAAO;AACrB,gBAAM,IAAI;AACV,gBAAM,OAAO,MAAM;AACnB,cAAI,MAAM,QAAQ,IAAI,GAAG;AACrB,iBAAK,OAAO,GAAG,CAAC;AAAA,UACpB;AAAA,QACJ;AAAA,MACJ;AACA,UAAI,MAAM,GAAG,WAAW;AAAG,iBAAS,KAAK,EAAE;AAAA,IAC/C;AAEA,eAAW,MAAM,UAAU;AACvB,aAAO,KAAK,UAAU;AAAA,IAC1B;AAAA,EACJ;AAAA,EAEA,MAAM,SAAwB;AAC1B,UAAM,MAAM,OAAO;AACnB,QAAI,KAAK;AAAmB,WAAK,QAAQ,cAAc,KAAK,iBAAiB;AAAA,EACjF;AAAA,EAMA,MAAM,WAAW,IAAY,MAAyB,WAAsC,QAAuB;AAC/G,QAAI,GAAG,WAAW,KAAK,QAAQ,SAAS,GAAG;AACvC,WAAK,IAAI,KAAK,OAAO,gEAAgE;AACrF;AAAA,IAEJ;AACA,QAAI,KAAK,UAAU,QAAQ,QAAW;AAClC,YAAM,QAAQ,KAAK,UAAU,IAAI,GAAG,UAAU,CAAC,MAAM,KAAK,IAAI;AAC9D,UAAI,UAAU,IAAI;AACd,aAAK,UAAU,IAAI,GAAG,KAAK,IAAI;AAC/B,aAAK,UAAU,IAAI,WAAW,KAAK,KAAK;AACxC,aAAK,UAAU,IAAI,SAAS,KAAK,QAAQ;AAAA,MAC7C,OAAO;AACH,YAAI,KAAK,UAAU,IAAI,SAAS,WAAW,UAAU;AACjD,cAAI,aAAa;AAAO,iBAAK,UAAU,IAAI,SAAS,SAAS;AAAA,QACjE;AAAA,MACJ;AAAA,IACJ,OAAO;AACH,YAAM,QAAQ,MAAM,KAAK,QAAQ,qBAAqB,EAAE;AACxD,UAAI,OAAO;AAEP,cAAM,KAAK,QAAQ,4BAA4B,EAAE;AACjD,cAAM,MAAM,MAAM,KAAK,QAAQ,sBAAsB,EAAE;AACvD,YAAI,CAAC,OAAO,CAAC,IAAI,UAAU,IAAI,SAAS;AAAS,gBAAM,IAAI,MAAM,4BAA4B,EAAE;AAC/F,aAAK,UAAU,MAAM;AAAA,UACjB;AAAA,UACA,IAAI,CAAC,IAAI;AAAA,UACT,IAAI,KAAK,IAAI;AAAA,UACb,YAAY,CAAC,KAAK;AAAA,UAClB,UAAU,CAAC,QAAQ;AAAA,UACnB,QAAQ,IAAI;AAAA,QAChB;AACA,YAAI,KAAK,QAAQ,QAAQ,QAAW;AAChC,iBAAO,KAAK,QAAQ;AAAA,QACxB;AAAA,MACJ;AACA,WAAK,IAAI,MAAM,wBAAwB,IAAI;AAAA,IAC/C;AAAA,EACJ;AAAA,EAMA,MAAM,gBAAgB,IAAsC;AACxD,eAAW,MAAM,KAAK,WAAW;AAC7B,YAAM,QAAQ,KAAK,UAAU;AAC7B,YAAM,QAAQ,MAAM,GAAG,QAAQ,EAAE;AACjC,UAAI,UAAU;AAAI;AAClB,UAAI,MAAM,WAAW;AAAQ;AAC7B,UAAI,CAAC,MAAM,WAAW,KAAK,CAAC,MAAM,CAAC,GAAG;AAClC,cAAM,KAAK,QAAQ,4BAA4B,EAAE;AACjD,cAAM,QAAQ,MAAM,KAAK,QAAQ,qBAAqB,EAAE;AACxD,YAAI,OAAO;AACP,gBAAM,QAAQ;AAAA,QAClB;AAAA,MACJ;AACA,YAAM,WAAW,SAAS;AAAA,IAC9B;AAAA,EACJ;AAAA,EAMA,MAAM,kBAAkB,IAAsC;AAC1D,eAAW,MAAM,KAAK,WAAW;AAC7B,YAAM,QAAQ,KAAK,UAAU;AAC7B,YAAM,QAAQ,MAAM,GAAG,QAAQ,EAAE;AACjC,UAAI,UAAU;AAAI;AAClB,UAAI,CAAC,MAAM,WAAW;AAAQ;AAC9B,YAAM,WAAW,SAAS;AAC1B,UAAI,CAAC,MAAM,WAAW,KAAK,CAAC,MAAM,CAAC,GAAG;AAClC,cAAM,KAAK,QAAQ,8BAA8B,EAAE;AAAA,MACvD;AAAA,IACJ;AAAA,EACJ;AAAA,EAMA,MAAM,SACF,IACA,WAAsC,QACI;AAC1C,QAAI,WAAW,KAAK;AACpB,QAAI,aAAa;AAAU,iBAAW;AAAA,aAC7B,aAAa;AAAO,iBAAW;AACxC,QAAI,KAAK,UAAU,QAAQ,UAAa,KAAK,UAAU,IAAI,WAAW,KAAK,CAAC,MAAM,CAAC,GAAG;AAClF,aAAO,KAAK,UAAU,IAAI;AAAA,IAC9B,WAAW,KAAK,QAAQ,OAAO,UAAU;AACrC,UAAI,KAAK,IAAI,IAAI,WAAW,KAAK,QAAQ,IAAI,KAAK,GAAG;AACjD,eAAO,KAAK,QAAQ,IAAI;AAAA,MAC5B;AAAA,IACJ;AACA,UAAM,QAAQ,MAAM,KAAK,QAAQ,qBAAqB,EAAE;AACxD,QAAI,OAAO;AACP,UAAI,CAAC,KAAK,QAAQ,KAAK;AACnB,cAAM,MAAM,MAAM,KAAK,QAAQ,sBAAsB,EAAE;AACvD,YAAI,CAAC,OAAO,CAAC,IAAI,UAAU,IAAI,SAAS;AAAS,gBAAM,IAAI,MAAM,4BAA4B,EAAE;AAC/F,aAAK,QAAQ,MAAM,EAAE,OAAc,IAAI,KAAK,IAAI,GAAG,QAAQ,IAAI,OAAO;AAAA,MAC1E,OAAO;AACH,aAAK,QAAQ,IAAI,QAAQ;AACzB,aAAK,QAAQ,IAAI,KAAK,KAAK,IAAI;AAAA,MACnC;AACA,aAAO;AAAA,IACX;AACA,UAAM,IAAI,MAAM,oBAAoB,aAAa;AAAA,EACrD;AAAA,EAEA,QAAQ,IAA6C;AACjD,QAAI,KAAK,UAAU,QAAQ;AAAW,aAAO,KAAK,UAAU,IAAI,OAAO;AACvE,QAAI,KAAK,QAAQ,QAAQ;AAAW,aAAO,KAAK,QAAQ,IAAI,OAAO;AACnE,WAAO;AAAA,EACX;AAAA,EAEA,gBAAgB,IAAgD;AAC5D,QAAI,IAA4D;AAChE,QAAI,KAAK,UAAU,QAAQ;AAAW,UAAI,KAAK,UAAU,IAAI,OAAO;AAAA,aAC3D,KAAK,QAAQ,QAAQ;AAAW,UAAI,KAAK,QAAQ,IAAI,OAAO;AACrE,QAAI,CAAC,KAAK,OAAO,MAAM;AAAU,aAAO;AACxC,QAAI,MAAM,QAAQ,CAAC,GAAG;AAClB,YAAM,IAA4B,CAAC;AACnC,QAAE,QAAQ,CAAC,GAAG,MAAO,EAAE,OAAO,CAAC,KAAK,CAAE;AACtC,UAAI;AAAA,IACR;AACA,WAAO;AAAA,EACX;AAAA,EAEA,MAAM,cAAc,IAAY,OAAyD;AACrF,QAAI,MAAM,OAAO;AACb,UAAI,KAAK,UAAU,KAAK;AACpB,YAAI,KAAK,UAAU,IAAI,OAAO;AAC1B,eAAK,IAAI,MAAM,gBAAgB,iBAAiB,KAAK,UAAU,KAAK,GAAG;AACvE,eAAK,UAAU,IAAI,KAAK,KAAK,IAAI;AACjC,cAAI,KAAK,UAAU,IAAI,MAAM,QAAQ,MAAM,OAAO,KAAK,UAAU,IAAI,MAAM,QAAQ,MAAM,KAAK;AAC1F,iBAAK,UAAU,IAAI,QAAQ;AAC3B,gBAAI,MAAM,KAAK;AACX,mBAAK,UAAU,IAAI,GAAG;AAAA,gBAClB,CAAC,GAAG,UACA,EAAE,oCACF,EAAE,iCAAiC,KAAK,UAAU,IAAI,SAAS,MAAM;AAAA,cAC7E;AAAA,YACJ;AAAA,UACJ;AAAA,QACJ;AAAA,MACJ;AACA,UAAI,GAAG,WAAW,KAAK,QAAQ,SAAS,GAAG;AACvC,cAAM,KAAK,GAAG,QAAQ,KAAK,QAAQ,YAAY,KAAK,EAAE;AACtD,cAAM,WAAW,KAAK,QAAQ,OAAO,EAAE;AACvC,YAAI,UAAU;AACV,eAAK,QAAQ,MAAM,IAAI,EAAE,GAAG,UAAU,KAAK,MAAM,KAAK,IAAI,MAAM,IAAI,KAAK,MAAM,IAAI,CAAC;AAAA,QACxF;AAEA,YACI,YACA,SAAS,OACT,SAAS,IAAI,UACb,SAAS,IAAI,OAAO,SACpB,KAAK,QAAQ,YACf;AACE,qBAAW,SAAS,KAAK,QAAQ,WAAW,QAAQ;AAChD,kBAAM,MAAM,cAAc,IAAI,KAAK;AAAA,UACvC;AAAA,QACJ;AAAA,MACJ;AAAA,IACJ;AAAA,EACJ;AAAA,EACA,MAAM,cAAc,MAAgB,KAA0B,WAAmC;AAC7F,QAAI,KAAK,QAAQ,SAAS,WAAW,KAAK,QAAQ,SAAS,aAAa;AACpE,UAAI,KAAK,QAAQ,IAAI;AACjB,cAAM,MAAM,KAAK,QAAQ,GAAG,WAAW,KAAK,QAAQ,SAAS;AAC7D,aAAK,IAAI,MAAM,iBAAiB,KAAK,QAAQ,OAAO,QAAQ,MAAM;AAClE,YAAI,KAAK,SAAS,MAAM,YAAY,OAAO,QAAQ;AAAU,gBAAM,WAAW,GAAG;AAAA,iBACxE,KAAK,SAAS,MAAM,YAAY,OAAO,QAAQ;AAAW,gBAAM,MAAM,IAAI;AAAA,iBAC1E,KAAK,SAAS,MAAM;AAAW,gBAAM,CAAC,CAAC;AAChD,YAAI,KAAK,SAAS,MAAM;AAAU,gBAAM,OAAO,GAAG;AAClD,aAAK,cAAc,KAAK,QAAQ,IAAI,KAAK,GAAG;AAC5C,YAAI;AAAW,gBAAM,KAAK,QAAQ,qBAAqB,KAAK,QAAQ,IAAI,KAAK,GAAG;AAAA;AAC3E,eAAK,IAAI,MAAM,sDAAsD,KAAK,QAAQ,IAAI;AAAA,MAC/F;AAAA,IACJ,WAAW,KAAK,QAAQ,SAAS,YAAY;AACzC,UAAI,KAAK,UAAU,KAAK,QAAQ,KAAK;AACjC,YAAI,KAAK,iBAAiB,KAAK,QAAQ,IAAI,GAAG;AAC1C,gBAAM,KAAK,cAAc,KAAK,QAAQ,IAAI,KAAK,UAAU,KAAK,QAAQ,IAAI,KAAK;AAAA,MACvF;AAAA,IACJ;AAAA,EACJ;AAAA,EACQ,iBAAiB,IAAY,KAAmC;AACpE,QAAI,KAAK,UAAU,QAAQ,QAAW;AAClC,WAAK,UAAU,IAAI,QAAQ;AAAA,QACvB,GAAG,KAAK,UAAU,IAAI;AAAA,QACtB;AAAA,QACA,KAAK;AAAA,QACL,IAAI,KAAK,IAAI;AAAA,MACjB;AACA,aAAO;AAAA,IACX;AACA,WAAO;AAAA,EACX;AAAA,EAEQ,cAAc,IAAY,KAA0B,KAAoB;AAC5E,QAAI,KAAK,UAAU,QAAQ,QAAW;AAClC,WAAK,UAAU,IAAI,MAAM,MAAM;AAC/B,WAAK,UAAU,IAAI,MAAM,MAAM;AAAA,IACnC,WAAW,KAAK,QAAQ,QAAQ,QAAW;AACvC,WAAK,QAAQ,IAAI,MAAM,MAAM;AAC7B,WAAK,QAAQ,IAAI,MAAM,MAAM;AAAA,IACjC;AAAA,EACJ;AAAA,EAQA,MAAM,gBAAgB,MAAW,QAAa,SAAc,CAAC,GAAiB;AA/blF;AAgcQ,eAAW,KAAK,MAAM;AAClB,YAAM,IAAI,KAAK;AACf,UAAI,MAAM;AAAW;AACrB,UAAI,OAAO,MAAM,YAAY,EAAE,UAAU,IAAI;AACzC,eAAO,KAAK,MAAM,KAAK,gBAAgB,GAAG,UAAQ,YAAO,OAAP,YAAa,MAAM,QAAQ,CAAC,KAAI,CAAC,IAAI,CAAC,CAAC;AAAA,MAC7F,WAAW,OAAO,MAAM,YAAY,UAAU,GAAG;AAC7C,eAAO,KACH,KAAK,OAAO,SACN,IAAI,0BAAS,KAAK,SAAS,EAAE,GAAG,GAAG,MAAM,GAAG,KAAK,QAAQ,OAAO,QAAQ,IAAI,GAAG,QAAQ,IAAI,IAC3F;AACV,YAAI,OAAO,OAAO,UAAa,CAAE,MAAM,OAAO,GAAG,eAAe,GAAI;AAChE,iBAAO,KAAK;AAAA,QAChB;AAAA,MACJ;AAAA,IACJ;AACA,WAAO;AAAA,EACX;AAAA,EAEA,MAAM,qBAAqB,QAAgB,MAAyB;AAChE,QAAI,WAAW;AAAI,aAAO;AAC1B,QAAI,KAAK,iBAAiB,QAAW;AACjC,WAAK,eAAe,CAAC;AACrB,WAAK,QAAQ,WAAW,MAAM;AAC1B,aAAK,eAAe;AAAA,MACxB,GAAG,GAAM;AAAA,IACb;AACA,eAAW,KAAK,MAAM;AAClB,YAAM,IAAI,KAAK;AACf,UAAI,MAAM;AAAW;AACrB,UAAI,OAAO,MAAM,YAAY,EAAE,UAAU,IAAI;AACzC,aAAK,KAAK,MAAM,KAAK,qBAAqB,QAAQ,CAAC;AAAA,MACvD,WAAW,OAAO,MAAM,YAAY,UAAU,GAAG;AAC7C,cAAM,IAAI;AACV,YAAI,QAAQ;AACZ,YAAK,EAAE,SAAS,eAAe,EAAE,SAAS,WAAY,CAAC,EAAE,QAAQ,EAAE,SAAS;AAAQ;AACpF,mBAAW,QAAQ,MAAM,QAAQ,EAAE,IAAI,IAAI,EAAE,OAAO,CAAC,EAAE,IAAI,GAAG;AAC1D,cAAI,KAAC,yBAAW,IAAI,GAAG;AACnB,kBAAM,IAAI,MAAM,GAAG,EAAE,0BAA0B,EAAE,MAAM;AAAA,UAC3D;AACA,cAAI,CAAC,KAAK,aAAa,SAAS;AAC5B,iBAAK,aAAa,UAAU,MAAM,KAAK,QAAQ,uBAAuB,GAAG,UAAU;AAAA,UACvF;AACA,cAAI,CAAC,KAAK,aAAa,SAAS;AAC5B,iBAAK,IAAI,KAAK,wBAAwB,SAAS;AAAA,UACnD;AAEA,qBAAW,MAAM,KAAK,aAAa,SAAS;AACxC,kBAAM,MAAuB,KAAK,aAAa,QAAQ;AACvD,gBAAI,OAAO,IAAI,UAAU,IAAI,SAAS,YAAY,EAAE,OAAO,MAAM,GAAG,SAAS,EAAE,EAAE,IAAI;AACjF,kBAAI,IAAI,OAAO,SAAS,MAAM;AAC1B,oBAAI,OAAO;AACP,uBAAK,IAAI,KAAK,kCAAkC,WAAW,QAAQ;AACnE;AAAA,gBACJ;AACA,kBAAE,KAAK;AACP,kBAAE,OAAO;AACT,wBAAQ;AAAA,cACZ;AAAA,YACJ;AAAA,UACJ;AACA,cAAI;AAAO;AAAA,QACf;AACA,YAAI,CAAC,OAAO;AACR,eAAK,KAAK;AACV,eAAK,IAAI,KAAK,2BAA2B,KAAK,UAAU,EAAE,IAAI,QAAQ,QAAQ;AAAA,QAClF;AAAA,MACJ;AAAA,IACJ;AACA,WAAO;AAAA,EACX;AAAA,EAOA,MAAM,YAAY,IAA8B;AAC5C,QAAI,GAAG,WAAW,KAAK,QAAQ,SAAS,GAAG;AACvC,aAAO,KAAK,QAAQ,QAAQ,OAAO,GAAG,QAAQ,KAAK,QAAQ,WAAW,EAAE,CAAC,MAAM;AAAA,IACnF,OAAO;AACH,aAAQ,MAAM,KAAK,QAAQ,qBAAqB,EAAE,MAAO;AAAA,IAC7D;AAAA,EACJ;AACJ;",
  "names": []
}
