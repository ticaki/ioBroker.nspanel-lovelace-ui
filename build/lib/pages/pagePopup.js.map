{
  "version": 3,
  "sources": ["../../../src/lib/pages/pagePopup.ts"],
  "sourcesContent": ["import { Page } from '../classes/Page';\nimport { type PageInterface } from '../classes/PageInterface';\nimport type { RGB } from '../const/Color';\nimport { Color } from '../const/Color';\nimport { Icons } from '../const/icon_mapping';\nimport { getPayloadRemoveTilde, setTriggeredToState } from '../const/tools';\nimport type * as pages from '../types/pages';\nimport type { IncomingEvent } from '../types/types';\nimport type { PageItem } from './pageItem';\n\n// siehe typ PopupNotificationValue in src/lib/types/types.ts\nexport class PagePopup extends Page {\n    config: pages.PageBase['config'];\n    private lastpage: Page[] = [];\n    private step: number = 0;\n    private rotationTimeout: ioBroker.Timeout | undefined;\n    private detailsArray: pages.PagePopupDataDetails[] = [];\n    private reminderTimeout: ioBroker.Timeout | undefined;\n    private debouceUpdateTimeout: ioBroker.Timeout | undefined;\n    tempItem: PageItem | undefined;\n    items: pages.cardPopupDataItems | undefined;\n\n    constructor(config: PageInterface, options: pages.PageBase) {\n        super(config, options);\n        this.config = options.config;\n        if (options.items && isCardPopupDataItems(options.items)) {\n            this.items = options.items;\n        }\n        this.minUpdateInterval = 0;\n        this.neverDeactivateTrigger = true;\n    }\n\n    async init(): Promise<void> {\n        const config = structuredClone(this.config);\n        // search states for mode auto\n        const tempConfig: Partial<pages.cardNotifyDataItemOptions> =\n            this.enums || this.dpInit\n                ? await this.basePanel.statesControler.getDataItemsFromAuto(this.dpInit, config, undefined, this.enums)\n                : config;\n        setTriggeredToState(tempConfig, ['entity1', 'optionalValue']);\n        // create Dataitems\n\n        const tempItem: Partial<pages.cardPopupDataItems> = await this.basePanel.statesControler.createDataItems(\n            tempConfig,\n            this,\n        );\n        this.items = tempItem as any;\n        if (!this.items?.data) {\n            throw new Error(`PopupNotification page ${this.name} has no data items configured`);\n        }\n        // set card because we lose it\n        this.items.card = this.card as any;\n        await super.init();\n        await this.basePanel.statesControler.activateTrigger(this);\n    }\n\n    setLastPage(p: Page | undefined): void {\n        if (p !== this) {\n            if (p !== undefined) {\n                this.lastpage.push(p);\n            } else {\n                this.lastpage = [];\n            }\n        }\n    }\n    removeLastPage(_p: Page | undefined): void {\n        this.lastpage = this.lastpage.filter(a => a !== _p);\n        this.lastpage.forEach(a => a.removeLastPage(_p));\n    }\n\n    /**\n     *\n     * @returns Build the view for nspanel.\n     */\n    public async update(): Promise<void> {\n        const message: Partial<pages.PageNotifyMessage> = {};\n        const items = this.items;\n        if (!items || !this.visibility) {\n            return;\n        }\n        const details = this.detailsArray[0];\n        if (!details) {\n            this.detailsArray = [];\n            const page = this.getLastPage();\n            if (page) {\n                await this.basePanel.setActivePage(page);\n                this.removeLastPage(page);\n            }\n            return;\n        }\n        if (details.buzzer) {\n            if (this.basePanel.isBuzzerAllowed) {\n                this.basePanel.sendToTasmota(\n                    `${this.basePanel.topic}/cmnd/Buzzer`,\n                    details.buzzer === true ? '1,2,3,0xF54' : details.buzzer,\n                );\n            }\n            details.buzzer = false;\n        }\n\n        const convertToDec = (rgb: RGB | undefined | null, def: RGB): string => {\n            return String(rgb ? Color.rgb_dec565(rgb) : def ? Color.rgb_dec565(def) : '');\n        };\n        this.log.debug('update notification page!');\n\n        message.headline = details.headline;\n        message.hColor = convertToDec(details.colorHeadline, Color.Yellow);\n        const blText = details.buttonLeft || (this.detailsArray.length > 1 ? 'Next' : '');\n        message.blText = this.library.getTranslation(blText);\n        message.blColor = blText ? convertToDec(details.colorButtonLeft, Color.Yellow) : '';\n\n        message.bmText = this.library.getTranslation(details.buttonMid);\n        message.bmColor = details.buttonMid ? convertToDec(details.colorButtonMid, Color.Red) : '';\n\n        message.brText = this.library.getTranslation(details.buttonRight);\n        message.brColor = details.buttonRight ? convertToDec(details.colorButtonRight, Color.Green) : '';\n\n        message.text = details.text;\n        message.textColor = convertToDec(details.colorText, Color.White);\n        message.timeout = details.alwaysOn ? 0 : this.basePanel.timeout;\n\n        if (message.text) {\n            message.text = message.text.replaceAll('\\n', '\\r\\n').replaceAll('/r/n', '\\r\\n');\n        }\n        // 0 -> 7\n        // 1 -> 5\n        // 2 -> 5\n        // 3 -> 4\n        // 4 -> 2\n        // 5 -> 1\n        let maxLineCount = 7;\n        switch (details.textSize) {\n            case '0':\n                maxLineCount = 7;\n                break;\n            case '1':\n                maxLineCount = 5;\n                break;\n            case '2':\n                maxLineCount = 5;\n                break;\n            case '3':\n                maxLineCount = 4;\n                break;\n            case '4':\n                maxLineCount = 2;\n                break;\n            case '5':\n                maxLineCount = 1;\n                break;\n            default:\n                maxLineCount = 7;\n                break;\n        }\n        let lines = 0;\n        if (message.text && (lines = message.text.split('\\r\\n').length) > maxLineCount) {\n            let test = 0;\n            let counter = 0;\n            let pos = 0;\n            this.step = this.step % (lines + 1);\n\n            const currentPos = this.step;\n            const text = `${message.text}\\r\\n` + `${message.text}`;\n            message.text = '';\n            while (test++ < 100) {\n                const pos2 = text.indexOf('\\r\\n', pos) + 2;\n                if (pos2 == -1) {\n                    message.text += text.slice(pos);\n                    break;\n                }\n                if (counter >= currentPos) {\n                    message.text = message.text + text.slice(pos, pos2);\n                }\n                counter++;\n                if (counter >= currentPos + maxLineCount) {\n                    break;\n                }\n                pos = pos2;\n            }\n            if (!this.rotationTimeout) {\n                if (this.unload || this.adapter.unload) {\n                    return;\n                }\n                this.rotationTimeout = this.adapter.setTimeout(this.rotation, 3000);\n            }\n        }\n        message.fontSet = details.textSize ?? '';\n        if (!Icons.GetIcon(this.detailsArray[0].icon || '')) {\n            this.sendToPanel(this.getMessage(message), false);\n            return;\n        }\n        message.icon = Icons.GetIcon(details.icon || '');\n        message.iconColor = convertToDec(details.iconColor, Color.White);\n        this.sendToPanel(this.getMessage(message), false);\n    }\n    private getMessage(message: Partial<pages.PageNotifyMessage>): string {\n        return getPayloadRemoveTilde(\n            'entityUpdateDetail',\n            this.id,\n            message.headline ?? '',\n            message.hColor ?? '',\n            message.blText ?? '',\n            message.blColor ?? '',\n            message.bmText ?? '',\n            message.bmColor ?? '',\n            message.brText ?? '',\n            message.brColor ?? '',\n            message.text ?? '',\n            message.textColor ?? '',\n            String(message.timeout ?? 0),\n            message.fontSet ?? '0',\n            message.icon ?? '',\n            message.iconColor ?? '',\n        );\n    }\n    private getMessage2(message: Partial<pages.PageNotifyMessage>): string {\n        return getPayloadRemoveTilde(\n            'entityUpdateDetail',\n            this.id,\n            message.headline ?? '',\n            message.hColor ?? '',\n            message.blText ?? '',\n            message.blColor ?? '',\n            message.bmText ?? '',\n            message.bmColor ?? '',\n            message.brText ?? '',\n            message.brColor ?? '',\n            message.text ?? '',\n            message.textColor ?? '',\n            String(message.timeout ?? 0),\n            message.fontSet ?? '0',\n            message.icon ?? '',\n            message.iconColor ?? '',\n        );\n    }\n\n    /**\n     * Rotate text in view\n     *\n     * @returns void\n     */\n    private rotation = async (): Promise<void> => {\n        if (!this.visibility) {\n            this.rotationTimeout = undefined;\n            return;\n        }\n        this.step++;\n        await this.update();\n        if (this.unload || this.adapter.unload) {\n            return;\n        }\n        this.rotationTimeout = this.adapter.setTimeout(this.rotation, 1500);\n    };\n\n    async delete(): Promise<void> {\n        await super.delete();\n        if (this.rotationTimeout) {\n            this.adapter.clearTimeout(this.rotationTimeout);\n        }\n        this.rotationTimeout = undefined;\n        if (this.reminderTimeout) {\n            this.adapter.clearTimeout(this.reminderTimeout);\n        }\n        this.reminderTimeout = undefined;\n        if (this.debouceUpdateTimeout) {\n            this.adapter.clearTimeout(this.debouceUpdateTimeout);\n        }\n        this.debouceUpdateTimeout = undefined;\n    }\n\n    protected async onStateTrigger(_dp: string): Promise<void> {\n        if (!this.items?.data.details?.options.dp || !_dp.endsWith(this.items.data.details.options.dp)) {\n            return;\n        }\n        this.step = 0;\n        if (this.rotationTimeout) {\n            this.adapter.clearTimeout(this.rotationTimeout);\n        }\n        this.rotationTimeout = undefined;\n        this.log.debug(`state triggerd ${_dp}`);\n        const detailsArr: pages.PagePopupDataDetails | pages.PagePopupDataDetails[] | null | undefined =\n            (await this.items?.data.details?.getObject()) as any;\n        if (detailsArr && Array.isArray(detailsArr)) {\n            this.detailsArray = [];\n        }\n        for (const details of Array.isArray(detailsArr) ? detailsArr : detailsArr ? [detailsArr] : []) {\n            if (details) {\n                const index = this.detailsArray.findIndex(d => d.id === details.id);\n                // wenn priority 0 oder undefined dann entfernen\n                if (details.id && (details.priority == undefined || details.priority <= 0)) {\n                    const id = details.id;\n                    if (id && details.priority != undefined && details.priority <= -100) {\n                        this.detailsArray = this.detailsArray.filter(d => !d.id?.startsWith(id));\n                        this.log.debug(`remove notification id start with ${details.id}`);\n                    } else {\n                        this.detailsArray = this.detailsArray.filter(d => d.id !== details.id);\n                        this.log.debug(`remove notification id ${details.id}`);\n                    }\n\n                    // wenn Eintrag aktiv ist dann neues anzeigen\n                    if (this.detailsArray.length > 0) {\n                        if (!this.reminderTimeout) {\n                            this.debouceUpdate();\n                        }\n                        return;\n                    }\n                    // sonst gehe in den alles l\u00F6schen zweig und letzte Seite anzeigen\n                    details.id = '';\n                }\n                // wenn keine id dann alles l\u00F6schen und letzte Seite anzeigen\n                if (!details.id) {\n                    this.log.debug('clear all notifications');\n                    if (this.reminderTimeout) {\n                        this.adapter.clearTimeout(this.reminderTimeout);\n                    }\n                    this.reminderTimeout = undefined;\n                    this.detailsArray = [];\n                    if (this.visibility) {\n                        this.debouceUpdate();\n                    }\n                    return;\n                }\n                if (details.type === 'acknowledge') {\n                    details.buttonRight = details.buttonRight || 'ok';\n                }\n                if (index !== -1) {\n                    this.log.debug(`update notification id ${details.id}`);\n                    this.detailsArray[index] = { ...details, priority: details.priority || 50 };\n                } else {\n                    this.log.debug(`add notification id ${details.id}`);\n                    this.detailsArray.unshift({ ...details, priority: details.priority || 50 });\n                }\n                this.detailsArray.sort((a, b) => a.priority - b.priority);\n                this.detailsArray.splice(10);\n                const index2 = this.detailsArray.findIndex(d => d.id === details.id);\n                // wenn neu dann anzeigen, ansonsten sollte ein timeout laufen\n                if (index2 == 0) {\n                    this.log.debug(`notification id ${details.id} is first in queue, updating view`);\n                    if (this.reminderTimeout) {\n                        this.adapter.clearTimeout(this.reminderTimeout);\n                    }\n                    this.reminderTimeout = undefined;\n                    this.debouceUpdate();\n                } else {\n                    this.log.debug(`notification id ${details.id} not first in queue (${index2}), not updating view`);\n                }\n            }\n        }\n        /*if (_dp.includes('popupNotification'))*/\n    }\n\n    showPopup(): boolean {\n        if (this.detailsArray.length > 0) {\n            if (this.reminderTimeout) {\n                this.adapter.clearTimeout(this.reminderTimeout);\n            }\n            this.reminderTimeout = undefined;\n            this.debouceUpdate();\n            return true;\n        }\n        return false;\n    }\n\n    debouceUpdate(goLastPage?: boolean): void {\n        if (this.debouceUpdateTimeout) {\n            this.adapter.clearTimeout(this.debouceUpdateTimeout);\n        }\n        if (this.unload || this.adapter.unload) {\n            return;\n        }\n\n        if (goLastPage || this.detailsArray.length === 0) {\n            let page = this.getLastPage();\n            if (!page) {\n                page = this.basePanel.navigation.getCurrentMainPage();\n            }\n            void this.basePanel.setActivePage(page);\n            this.removeLastPage(page);\n\n            return;\n        }\n        this.debouceUpdateTimeout = this.adapter.setTimeout(async () => {\n            try {\n                // this.basePanel.getActivePage() can be undefined if the panel is not ready yet\n                // in this case we get an error here, so we catch it and do nothing\n                if (this.basePanel.getActivePage() !== this) {\n                    //await this.basePanel.setActivePage(this.basePanel.navigation.getCurrentMainPage());\n                    await this.basePanel.setActivePage(this);\n                } else {\n                    await this.update();\n                }\n            } catch {\n                // do nothing\n            }\n        }, 200);\n    }\n\n    /**\n     * Handle button events for the notify popup.\n     *\n     * Behavior:\n     * - Only processes events when this page is a `popupNotify`.\n     * - Reacts to `action === \"notifyAction\"`.\n     *   - If `setValue2` exists: writes `true` to `setValue1` on \"yes\", otherwise to `setValue2`.\n     *   - Else: writes boolean to `setValue1` based on `opt === \"yes\"`.\n     * - Evaluates optional `closingBehaviour`:\n     *   - \"none\"  \u2192 keep popup open\n     *   - \"both\"  \u2192 close always\n     *   - \"yes\" / \"no\" \u2192 close only if it matches `opt`\n     * - When closing, returns to the last page (stack) or the current navigation page.\n     *\n     * Side effects:\n     * - May write states via Dataitem setters.\n     * - May change the active page on the panel.\n     *\n     * @param _event Incoming event from the panel (must contain `action`, may contain `opt`).\n     * @returns Promise that resolves when the event has been handled.\n     */\n    async onButtonEvent(_event: IncomingEvent): Promise<void> {\n        this.log.debug(`Popup notify button event: ${JSON.stringify(_event)}`);\n        if (_event.action !== 'notifyAction') {\n            return;\n        }\n        this.step = 0;\n        if (this.rotationTimeout) {\n            this.adapter.clearTimeout(this.rotationTimeout);\n        }\n        this.rotationTimeout = undefined;\n        switch (_event.opt) {\n            case 'button3':\n                {\n                    const entry = this.detailsArray.shift();\n                    if (this.items?.data.setStateID && entry?.id != null) {\n                        await this.items.data.setStateID.setState(entry.id);\n                        if (entry?.global && this.items?.data.setGlobalID) {\n                            await this.items.data.setGlobalID.setState(`${this.basePanel.name}.${entry.id}`);\n                        }\n                    }\n                    if (this.items?.data.setStateYes && entry?.id != null) {\n                        await this.items.data.setStateYes.setState(entry.id);\n                        if (entry?.global && this.items?.data.setGlobalYes) {\n                            await this.items.data.setGlobalYes.setState(`${entry.id}`);\n                        }\n                    }\n                    if (entry?.global) {\n                        const panels = this.basePanel.controller.panels;\n                        for (const panel of panels) {\n                            if (panel === this.basePanel || panel.unload) {\n                                continue;\n                            }\n                            await this.basePanel.statesControler.setInternalState(\n                                `${panel.name}/cmd/popupNotificationCustom`,\n                                JSON.stringify({ id: entry.id, priority: -1 }),\n                                false,\n                            );\n                        }\n                    }\n                    this.log.debug(\n                        `Popup notify '${this.name}' yes pressed, remaining entries: ${this.detailsArray.length}`,\n                    );\n                    this.debouceUpdate();\n                }\n                break;\n            case 'button2':\n                {\n                    const entry = this.detailsArray.shift();\n                    if (this.items?.data.setStateID && entry?.id != null) {\n                        await this.items.data.setStateID.setState(entry.id);\n                        if (entry?.global && this.items?.data.setGlobalID) {\n                            await this.items.data.setGlobalID.setState(`${this.basePanel.name}.${entry.id}`);\n                        }\n                    }\n                    if (this.items?.data.setStateMid && entry?.id != null) {\n                        await this.items.data.setStateMid.setState(entry.id);\n                        if (entry?.global && this.items?.data.setGlobalMid) {\n                            await this.items.data.setGlobalMid.setState(`${entry.id}`);\n                        }\n                    }\n\n                    this.log.debug(\n                        `Popup notify '${this.name}' yes pressed, remaining entries: ${this.detailsArray.length}`,\n                    );\n                    this.debouceUpdate(true);\n                }\n                break;\n            case 'button1':\n                {\n                    // aktuell ein weiterschalten im array\n                    const entry = this.detailsArray.shift();\n                    if (entry && entry.type !== 'information') {\n                        this.detailsArray.push(entry);\n                    } else if (entry) {\n                        await this.removeGlobalNotifications(entry);\n                    }\n                    if (this.items?.data.setStateID && entry?.id != null) {\n                        await this.items.data.setStateID.setState(entry.id);\n                        if (entry?.global) {\n                            await this.items.data.setStateID.setState(`${this.basePanel.name}.${entry.id}`);\n                        }\n                    }\n                    if (this.items?.data.setStateNo && entry?.id != null) {\n                        await this.items.data.setStateNo.setState(entry.id);\n                        if (entry?.global && this.items?.data.setGlobalNo) {\n                            await this.items.data.setGlobalNo.setState(`${entry.id}`);\n                        }\n                    }\n                    this.log.debug(\n                        `Popup notify '${this.name}' no pressed, remaining entries: ${this.detailsArray.length}`,\n                    );\n                    this.debouceUpdate();\n                }\n                break;\n        }\n    }\n\n    async removeGlobalNotifications(entry: pages.PagePopupDataDetails): Promise<void> {\n        if (entry?.global) {\n            const panels = this.basePanel.controller.panels;\n            for (const panel of panels) {\n                if (panel === this.basePanel || panel.unload) {\n                    continue;\n                }\n                await this.basePanel.statesControler.setInternalState(\n                    `${panel.name}/cmd/popupNotificationCustom`,\n                    JSON.stringify({ id: entry.id, priority: -1 }),\n                    false,\n                );\n            }\n        }\n    }\n\n    public startReminder(): void {\n        if (this.reminderTimeout) {\n            this.adapter.clearTimeout(this.reminderTimeout);\n        }\n        if (this.detailsArray?.[0]?.type === 'information') {\n            this.detailsArray.shift();\n            if (this.detailsArray.length === 0) {\n                return;\n            }\n        }\n        const remind = this.detailsArray[0]?.alwaysOn && this.detailsArray[0]?.type === 'acknowledge';\n\n        if (remind) {\n            this.reminderTimeout = this.adapter.setTimeout(() => {\n                this.debouceUpdate();\n            }, 300_000);\n        }\n    }\n\n    protected async onVisibilityChange(val: boolean): Promise<void> {\n        if (val) {\n            if (!this.pageItems || this.pageItems.length === 0) {\n                this.pageItems = await this.createPageItems(this.pageItemConfig);\n            }\n            this.sendType();\n            await this.update();\n        }\n    }\n\n    getLastPage(): Page | undefined {\n        return this.lastpage.length > 0 ? this.lastpage[this.lastpage.length - 1] : undefined;\n    }\n}\n\nexport function isCardPopupDataItems(obj: any): obj is pages.cardPopupDataItems {\n    return obj && obj.card === 'popupNotify';\n}\n"],
  "mappings": "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",
  "names": ["_a"]
}
