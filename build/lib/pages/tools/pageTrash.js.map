{
  "version": 3,
  "sources": ["../../../../src/lib/pages/tools/pageTrash.ts"],
  "sourcesContent": ["import { Color } from '../../const/Color';\n//import * as fs from 'node:fs';\nimport type { CalendarComponent } from 'node-ical';\nimport iCal from 'node-ical';\nimport { type AdapterClassDefinition } from '../../controller/library';\n\ninterface ItemObject {\n    icon: string;\n    color: { r: number; g: number; b: number };\n    text: string;\n    text1: string;\n}\n\ntype TrashEntry = {\n    trashFile: string;\n    countItems?: number;\n    items: TrashItem[];\n};\n\ntype TrashItem = {\n    textTrash: string;\n    customTrash: string;\n    iconColor: string;\n    icon: string;\n};\n\nexport async function getTrashDataFromState(\n    trashJSON: any,\n    entry: TrashEntry,\n): Promise<{ messages: ItemObject[]; error?: any }> {\n    const items: ItemObject[] = [];\n    const countItems = entry.countItems ?? 6;\n\n    try {\n        // Parse trashJSON wenn es ein String ist\n        let trashData: any[];\n        if (typeof trashJSON === 'string') {\n            trashData = JSON.parse(trashJSON);\n        } else if (Array.isArray(trashJSON)) {\n            trashData = trashJSON;\n        } else {\n            return { messages: items, error: new Error('trashJSON must be a string or array ') };\n        }\n\n        // Pr\u00FCfen ob trashData ein Array ist\n        if (!Array.isArray(trashData)) {\n            return { messages: items, error: new Error('trashData is not an  array') };\n        }\n\n        for (const trashObject of trashData) {\n            if (new Date(trashObject._date).setHours(0, 0, 0, 0) < new Date().setHours(0, 0, 0, 0)) {\n                continue;\n            }\n            const result = getTrashItem(\n                { start: trashObject._date, summary: trashObject.event },\n                countItems,\n                entry.items,\n            );\n\n            if (result) {\n                items.push(result);\n            }\n\n            if (items.length >= 6) {\n                break;\n            }\n        }\n\n        return { messages: items };\n    } catch (error) {\n        return { messages: items, error };\n    }\n}\n\nexport async function getTrashDataFromFile(\n    entry: TrashEntry,\n    adapter: AdapterClassDefinition,\n): Promise<{ messages: ItemObject[]; error?: any }> {\n    const items: ItemObject[] = [];\n    const trashFile = entry.trashFile;\n    const countItems = entry.countItems ?? 6;\n\n    try {\n        // Pr\u00FCfe ob Datei existiert\n        if (!(await adapter.fileExistsAsync(adapter.namespace, trashFile))) {\n            return { messages: items, error: `File ${trashFile} does not exist in ioBroker files` };\n        }\n\n        // Lese Datei\n        let fileData: any;\n        try {\n            fileData = (await adapter.readFileAsync(adapter.namespace, trashFile)).file.toString('utf-8');\n        } catch (readError) {\n            console.error(`Error reading ${trashFile} from ioBroker files:`, readError);\n            return { messages: items, error: readError };\n        }\n\n        // Parse ICS-Daten (synchron mit parseICS statt parseFile)\n        const data = iCal.parseICS(fileData);\n\n        // Filter und sortiere Events nach Startdatum\n        const arrayData: CalendarComponent[] = Object.values(data).filter(\n            entry =>\n                entry &&\n                typeof entry === 'object' &&\n                entry.type === 'VEVENT' &&\n                new Date(entry.start).setHours(0, 0, 0, 0) >= new Date().setHours(0, 0, 0, 0),\n        );\n\n        arrayData.sort((a: any, b: any) => {\n            const dateA = new Date(a.start).getTime();\n            const dateB = new Date(b.start).getTime();\n            return dateA - dateB;\n        });\n\n        // Iteriere \u00FCber Events\n        for (const event of arrayData) {\n            if (event.type === 'VEVENT') {\n                const result = getTrashItem(event, countItems, entry.items);\n                if (result) {\n                    items.push(result);\n                }\n\n                if (items.length >= 6) {\n                    break;\n                }\n            }\n        }\n\n        return { messages: items };\n    } catch (error) {\n        console.error('Error in getTrashDataFromFile:', error);\n        return { messages: items, error };\n    }\n}\n\nfunction getTrashItem(event: Partial<iCal.VEvent>, countItems: number, items: TrashItem[]): ItemObject | null {\n    const eventName = event.summary;\n\n    // Pr\u00FCfen ob event existiert\n    if (!eventName || eventName.trim() === '') {\n        return null;\n    }\n    let trashIndex = -1;\n    for (let i = 0; i < items.length; i++) {\n        if (items[i].textTrash && items[i].textTrash.trim() !== '' && eventName.includes(items[i].textTrash)) {\n            trashIndex = i;\n            break;\n        }\n    }\n    if (trashIndex === -1) {\n        return null;\n    }\n    const item = items[trashIndex];\n    const trashType = item.textTrash || '';\n    const customTrash = item.customTrash || '';\n    const iconColor = item.iconColor || '';\n    const icon = item.icon || 'trash-can';\n    const eventStartdatum = new Date(event.start || 1);\n    let eventDatum = '';\n    const tempDate = new Date(eventStartdatum).setHours(0, 0, 0, 0);\n    if (tempDate == new Date().setHours(0, 0, 0, 0)) {\n        eventDatum = 'today';\n    } else if (tempDate === new Date(new Date().setDate(new Date().getDate() + 1)).setHours(0, 0, 0, 0)) {\n        eventDatum = 'tomorrow';\n    } else if (\n        tempDate > new Date(new Date().setDate(new Date().getDate() + 1)).setHours(0, 0, 0, 0) &&\n        tempDate < new Date(new Date().setDate(new Date().getDate() + 8)).setHours(0, 0, 0, 0)\n    ) {\n        eventDatum =\n            countItems < 6\n                ? eventStartdatum.toLocaleString('de-DE', { weekday: 'long' })\n                : eventStartdatum.toLocaleString('de-DE', { weekday: 'short' });\n    } else {\n        eventDatum =\n            (countItems < 6\n                ? eventStartdatum.toLocaleString('de-DE', {\n                      year: '2-digit',\n                      month: '2-digit',\n                      day: '2-digit',\n                  })\n                : eventStartdatum.toLocaleString('de-DE', {\n                      year: 'numeric',\n                      month: '2-digit',\n                      day: '2-digit',\n                  })) || '';\n    }\n\n    return {\n        icon: icon,\n        color: Color.ConvertHexToRgb(iconColor),\n        text: customTrash && customTrash !== '' ? customTrash : trashType,\n        text1: eventDatum,\n    };\n}\n"],
  "mappings": "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",
  "names": ["iCal", "entry"]
}
