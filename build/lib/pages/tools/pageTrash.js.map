{
  "version": 3,
  "sources": ["../../../../src/lib/pages/tools/pageTrash.ts"],
  "sourcesContent": ["import { Color } from '../../const/Color';\n//import * as fs from 'node:fs';\nimport iCal from 'node-ical';\nimport { type AdapterClassDefinition } from '../../controller/library';\n\ninterface ItemObject {\n    icon: string;\n    color: { r: number; g: number; b: number };\n    text: string;\n    text1: string;\n}\n\nexport async function getTrashDataFromState(\n    trashJSON: any,\n    entry: any,\n    trashTypes: string[] = [],\n    customTrash: string[] = [],\n    iconColors: string[] = [],\n): Promise<{ messages: ItemObject[]; error?: any }> {\n    const items: ItemObject[] = [];\n    const countItems = entry.countItems ?? 6;\n\n    try {\n        // Parse trashJSON wenn es ein String ist\n        let trashData: any[];\n        if (typeof trashJSON === 'string') {\n            trashData = JSON.parse(trashJSON);\n        } else if (Array.isArray(trashJSON)) {\n            trashData = trashJSON;\n        } else {\n            return { messages: items, error: new Error('trashJSON must be a string or array ') };\n        }\n\n        // Pr\u00FCfen ob trashData ein Array ist\n        if (!Array.isArray(trashData)) {\n            return { messages: items, error: new Error('trashData is not an  array') };\n        }\n\n        let entryCount = 0;\n\n        for (const trashObject of trashData) {\n            const eventName = trashObject.event;\n\n            // Pr\u00FCfen ob event existiert\n            if (!eventName || eventName.trim() === '') {\n                continue;\n            }\n\n            const eventStartdatum = new Date(trashObject._date);\n            const tempDate = new Date(eventStartdatum).setHours(0, 0, 0, 0);\n            // Nur zuk\u00FCnftige Events\n            if (new Date().setHours(0, 0, 0, 0) > tempDate) {\n                continue;\n            }\n\n            let eventDatum = '';\n\n            if (tempDate === new Date().setHours(0, 0, 0, 0)) {\n                eventDatum = 'today';\n            } else if (tempDate === new Date(Date.now() + 24 * 60 * 60 * 1000).setHours(0, 0, 0, 0)) {\n                eventDatum = 'tomorrow';\n            } else {\n                eventDatum = trashObject.date?.trim() || '';\n            }\n\n            /*const day = String(eventStartdatum.getDate()).padStart(2, '0');\n            const month = String(eventStartdatum.getMonth() + 1).padStart(2, '0');\n            const year = String(eventStartdatum.getFullYear()).slice(-2);\n            const eventDatumFormatted = `${day}.${month}.${year}`;*/\n\n            // Finde passenden Trash-Type (case-insensitive)\n            let trashIndex = -1;\n            for (let i = 0; i < trashTypes.length; i++) {\n                if (trashTypes[i] && trashTypes[i].trim() !== '' && eventName.includes(trashTypes[i])) {\n                    trashIndex = i;\n                    break;\n                }\n            }\n\n            if (trashIndex !== -1) {\n                items.push({\n                    icon: 'trash-can',\n                    color: Color.ConvertHexToRgb(iconColors[trashIndex]),\n                    text:\n                        customTrash[trashIndex] && customTrash[trashIndex] !== ''\n                            ? customTrash[trashIndex]\n                            : trashTypes[trashIndex],\n                    text1:\n                        countItems < 6\n                            ? eventDatum\n                            : eventStartdatum.toLocaleString('de-DE', {\n                                  year: '2-digit',\n                                  month: '2-digit',\n                                  day: '2-digit',\n                              }),\n                });\n\n                // Maximal 6 Eintr\u00E4ge\n                entryCount++;\n                if (entryCount >= 6) {\n                    break;\n                }\n            }\n        }\n\n        return { messages: items };\n    } catch (error) {\n        return { messages: items, error };\n    }\n}\n\nexport async function getTrashDataFromFile(\n    entry: any,\n    trashTypes: string[] = [],\n    customTrash: string[] = [],\n    iconColors: string[] = [],\n    adapter: AdapterClassDefinition,\n): Promise<{ messages: ItemObject[]; error?: any }> {\n    const items: ItemObject[] = [];\n    const trashFile = entry.trashFile;\n    const countItems = entry.countItems ?? 6;\n\n    try {\n        // Pr\u00FCfe ob Datei existiert\n        if (!(await adapter.fileExistsAsync(adapter.namespace, trashFile))) {\n            return { messages: items, error: `File ${trashFile} does not exist in ioBroker files` };\n        }\n\n        // Lese Datei\n        let fileData: any;\n        try {\n            fileData = (await adapter.readFileAsync(adapter.namespace, trashFile)).file.toString('utf-8');\n        } catch (readError) {\n            console.error(`Error reading ${trashFile} from ioBroker files:`, readError);\n            return { messages: items, error: readError };\n        }\n\n        // Parse ICS-Daten (synchron mit parseICS statt parseFile)\n        const data = iCal.parseICS(fileData);\n\n        // Filter und sortiere Events nach Startdatum\n        const arrayData = Object.values(data).filter(\n            entry =>\n                entry &&\n                typeof entry === 'object' &&\n                entry.type === 'VEVENT' &&\n                new Date(entry.start).setHours(0, 0, 0, 0) >= new Date().setHours(0, 0, 0, 0),\n        );\n\n        arrayData.sort((a: any, b: any) => {\n            const dateA = new Date(a.start).getTime();\n            const dateB = new Date(b.start).getTime();\n            return dateA - dateB;\n        });\n\n        let entryCount = 0; // HIER: Au\u00DFerhalb der Schleife deklarieren\n\n        // Iteriere \u00FCber Events\n        for (const event of arrayData) {\n            if (event.type === 'VEVENT') {\n                const eventName = event.summary;\n\n                // Pr\u00FCfen ob event existiert\n                if (!eventName || eventName.trim() === '') {\n                    continue;\n                }\n\n                const eventStartdatum = new Date(event.start);\n                let eventDatum = '';\n                const tempDate = new Date(eventStartdatum).setHours(0, 0, 0, 0);\n                if (tempDate === new Date().setHours(0, 0, 0, 0)) {\n                    eventDatum = 'today';\n                } else if (tempDate === new Date(Date.now() + 24 * 60 * 60 * 1000).setHours(0, 0, 0, 0)) {\n                    eventDatum = 'tomorrow';\n                } else {\n                    eventDatum =\n                        (countItems < 6\n                            ? eventStartdatum.toLocaleString('de-DE', {\n                                  year: '2-digit',\n                                  month: '2-digit',\n                                  day: '2-digit',\n                              })\n                            : eventStartdatum.toLocaleString('de-DE', {\n                                  year: 'numeric',\n                                  month: '2-digit',\n                                  day: '2-digit',\n                              })) || '';\n                }\n\n                // Finde passenden Trash-Type\n                let trashIndex = -1;\n                for (let i = 0; i < trashTypes.length; i++) {\n                    if (trashTypes[i] && trashTypes[i].trim() !== '' && eventName.includes(trashTypes[i])) {\n                        trashIndex = i;\n                        break;\n                    }\n                }\n\n                if (trashIndex !== -1) {\n                    items.push({\n                        icon: 'trash-can',\n                        color: Color.ConvertHexToRgb(iconColors[trashIndex]),\n                        text:\n                            customTrash[trashIndex] && customTrash[trashIndex] !== ''\n                                ? customTrash[trashIndex]\n                                : trashTypes[trashIndex],\n                        text1: eventDatum,\n                    });\n\n                    entryCount++;\n                    if (entryCount >= 6) {\n                        break;\n                    }\n                }\n            }\n        }\n\n        return { messages: items };\n    } catch (error) {\n        console.error('Error in getTrashDataFromFile:', error);\n        return { messages: items, error };\n    }\n}\n"],
  "mappings": "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",
  "names": ["iCal", "entry"]
}
