import{ar as e}from"./react-vendor-BDxB2YBA.js";import{i as D}from"./icons-json-BzA_bZGL.js";import{au as $,a as d,A as w,at as j,av as W,aw as H,ax as F,ay as G,az as X,aA as N,aB as I,aC as U}from"./vendor-ChQEDjaA.js";import{N as Y}from"./mui-core-BKQsWbb8.js";import{Clear as q}from"./mui-icons-CGAZsFRT.js";import"./reactflow-lib-gBxkk_3Q.js";import{u as K}from"./mui-material-Ghzm1UhE.js";import{h as J,t as Q}from"./d3-lib-D1aNn2Bp.js";class Z extends $.ConfigGeneric{constructor(a){super(a);const n=$.ConfigGeneric.getValue(a.data,a.attr),i=Array.isArray(D)?D:[],r=typeof n=="string"?n:"";this.state={...this.state,test:"",iconValue:typeof n=="string"?n:null,icons:i,inputValue:r,filteredIcons:this.filterIcons(i,r)}}filterIcons(a,n){const i=(n||"").toLowerCase();return i?a.filter(r=>r.name.toLowerCase().includes(i)).slice(0,200):a.slice(0,200)}renderItem(a,n,i){const r=this.state.icons,t=this.props.theme,o=this.state.filteredIcons;return e.jsx(d.Grid,{container:!0,spacing:2,children:e.jsx(d.Grid,{item:!0,xs:12,children:e.jsx(d.Autocomplete,{options:o,filterOptions:s=>s,getOptionLabel:s=>typeof s=="string"?s:s.name,value:r.find(s=>s.name===this.state.iconValue)||null,inputValue:this.state.inputValue,onInputChange:(s,c)=>{const h=this.filterIcons(this.state.icons,c);this.setState({inputValue:c,filteredIcons:h})},onChange:(s,c)=>{const h=c?typeof c=="string"?c:c.name:"",y=this.filterIcons(this.state.icons,h);this.setState({iconValue:c?typeof c=="string"?c:c.name:null,inputValue:h,filteredIcons:y}),this.onChange(this.props.attr,h)},renderOption:(s,c)=>{var h,y;return e.jsxs(d.Box,{component:"li",...s,children:[e.jsx("span",{style:{display:"inline-flex",width:24,height:24,marginRight:8,color:((y=(h=t==null?void 0:t.palette)==null?void 0:h.secondary)==null?void 0:y.main)||"#09f23fc1"},dangerouslySetInnerHTML:{__html:atob(c.base64.replace(/^data:image\/svg\+xml;base64,/,"")).replace(/<svg([^>]*)>/,'<svg$1 fill="currentColor">')}}),e.jsx(d.Typography,{children:c.name})]})},renderInput:s=>{var h,y;const c=r.find(p=>p.name===this.state.iconValue);return e.jsx(d.TextField,{...s,label:this.getText(this.props.schema.label||this.props.attr||"Symbol auswählen"),InputProps:{...s.InputProps,startAdornment:c?e.jsx("span",{style:{display:"inline-flex",width:24,height:24,marginRight:8,color:((y=(h=t==null?void 0:t.palette)==null?void 0:h.secondary)==null?void 0:y.main)||"#09f23fc1"},dangerouslySetInnerHTML:{__html:atob(c.base64.replace(/^data:image\/svg\+xml;base64,/,"")).replace(/<svg([^>]*)>/,'<svg$1 fill="currentColor">')}}):null},style:{width:"100%"}})},isOptionEqualToValue:(s,c)=>{const h=typeof c=="string"?c:c==null?void 0:c.name;return s.name===h},clearOnBlur:!1,freeSolo:!1,disableClearable:!1,style:{width:"100%"}})})})}}const ue=Y(Z),R=D,me=()=>{const g=d.useTheme(),[a,n]=w.useState(""),[i,r]=w.useState(!1),t=w.useRef(null),[o,s]=w.useState({open:!1,label:""});w.useEffect(()=>{const h=y=>{(y.metaKey||y.ctrlKey)&&y.key==="f"&&(y.preventDefault(),r(!0),setTimeout(()=>{var p;return(p=t.current)==null?void 0:p.focus()},0))};return window.addEventListener("keydown",h),()=>window.removeEventListener("keydown",h)},[]);const c=a?R.filter(h=>h.name.toLowerCase().includes(a.toLowerCase())):R;return e.jsxs(d.Box,{sx:{width:"100%",overflowX:"auto",p:2},children:[(i||a)&&e.jsx(d.TextField,{inputRef:t,value:a,onChange:h=>n(h.target.value),label:"Icons filtern",variant:"outlined",size:"small",sx:{mb:2,width:300},InputProps:{endAdornment:a?e.jsx(d.InputAdornment,{position:"end",children:e.jsx(d.IconButton,{size:"small",onClick:()=>{n(""),r(!1)},children:e.jsx(q,{})})}):null}}),e.jsx(d.Grid,{container:!0,spacing:2,children:c.map(h=>e.jsx(d.Grid,{item:!0,xs:4,sm:3,md:2,lg:1,xl:1,sx:{minWidth:80,maxWidth:120,flexBasis:0},children:e.jsxs(d.Box,{display:"flex",flexDirection:"column",alignItems:"center",sx:{cursor:"pointer"},onClick:()=>{navigator.clipboard.writeText(h.name),s({open:!0,label:h.name})},title:`Klicken zum Kopieren: ${h.name}`,children:[e.jsx("span",{style:{display:"inline-flex",width:40,height:40,color:g.palette.text.primary,marginBottom:4},dangerouslySetInnerHTML:{__html:atob(h.base64.replace(/^data:image\/svg\+xml;base64,/,"")).replace(/<svg([^>]*)>/,'<svg$1 fill="currentColor">')}}),e.jsx(d.Typography,{variant:"caption",align:"center",sx:{maxWidth:104,maxHeight:36,overflow:"hidden",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",whiteSpace:"normal"},children:h.name})]})},h.name))}),e.jsx(d.Snackbar,{open:o.open,autoHideDuration:1500,onClose:()=>s({open:!1,label:""}),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsxs(d.Alert,{severity:"success",sx:{width:"100%"},onClose:()=>s({open:!1,label:""}),children:[o.label," copied"]})})]})},ye="///ALL_PANELS_SPECIAL",ee="getPanelNavigation",te="savePanelNavigation",xe="getPagesForPanel",ve="getAllPages",be="nspanel-lovelace-ui";function ae({open:g,data:a,title:n,sx:i}){return e.jsxs(d.Paper,{elevation:6,role:"dialog","aria-label":n||j.I18n.t("Page Info"),sx:{position:"absolute",top:64,right:0,width:320,p:1,zIndex:4e3,maxHeight:420,overflow:"auto",transform:g?"translateX(0)":"translateX(100%)",transition:"transform 220ms ease",borderTopLeftRadius:6,borderBottomLeftRadius:6,boxShadow:"rgba(0,0,0,0.2) -4px 0px 8px",pointerEvents:"none",...i},children:[e.jsx(d.Box,{sx:{display:"flex",alignItems:"center"},children:e.jsx(d.Typography,{variant:"subtitle2",children:n??j.I18n.t("Page Info")})}),e.jsx(d.Box,{sx:{mt:1},children:a&&Object.keys(a).length?Object.entries(a).map(([t,o])=>e.jsx(d.Box,{sx:{mb:.5},children:e.jsxs(d.Typography,{component:"div",variant:"body2",children:[e.jsx("strong",{children:j.I18n.t(t)}),": ",String(o)]})},t)):e.jsx(d.Typography,{variant:"body2",color:"text.secondary",children:j.I18n.t("No data")})})]})}function ne({open:g,onClose:a,onConfirm:n,title:i,description:r,cancelText:t,confirmText:o,ariaTitleId:s="confirm-dialog-title",ariaDescId:c="confirm-dialog-description"}){return e.jsxs(d.Dialog,{open:g,onClose:a,"aria-labelledby":s,"aria-describedby":c,maxWidth:"sm",fullWidth:!0,children:[e.jsx(d.DialogTitle,{id:s,children:i}),e.jsx(d.DialogContent,{children:e.jsx(d.DialogContentText,{id:c,children:r})}),e.jsxs(d.DialogActions,{sx:{display:"flex",flexDirection:"column",gap:1,p:2},children:[e.jsx(d.Button,{variant:"contained",color:"success",fullWidth:!0,onClick:a,children:t}),e.jsx(d.Button,{variant:"contained",color:"error",fullWidth:!0,onClick:n,children:o})]})]})}const P="nspanel-lovelace-ui";function oe(g){var h,y,p,k,x,T;const[a]=U(g),n=String(((h=g.data)==null?void 0:h.navType)??""),i=!!((y=g.data)!=null&&y.isTarget),r=n||(i?"target":"default"),t=`${((p=g.data)==null?void 0:p.navType)??""}: ${g.source} → ${g.target}`,o=((k=g.style)==null?void 0:k.stroke)??"var(--edge-color, #1976d2)",s=(x=g.style)==null?void 0:x.strokeDasharray,c=S=>{if(S.touches.length===1){const v=document.createElement("div");v.className="edge-tooltip-mobile",v.textContent=t;const L=S.touches[0];v.style.left=`${L.clientX-50}px`,v.style.top=`${L.clientY-30}px`,document.body.appendChild(v),setTimeout(()=>{v.parentNode&&v.parentNode.removeChild(v)},1500)}};return e.jsxs(e.Fragment,{children:[e.jsx("path",{id:g.id,d:a,strokeWidth:((T=g.style)==null?void 0:T.strokeWidth)??2,fill:"none",strokeDasharray:s,markerEnd:`url(#arrow-${r})`,className:"react-flow__edge-path custom-edge-path",style:{stroke:o},onTouchStart:c}),e.jsx("title",{children:t})]})}function B(g){const a={prev:"var(--edge-prev, var(--edge-color, #1976d2))",next:"var(--edge-next, var(--edge-color, #1976d2))",home:"var(--edge-home, #fbc02d)",parent:"var(--edge-parent, #d32f2f)",target:"var(--edge-target, #43a047)"},n=g.map((t,o)=>{let s;return t.position&&typeof t.position.x=="number"&&typeof t.position.y=="number"?s=t.position:s={x:100*o,y:100*(o%3)},{id:t.page,data:{label:t.label||t.page,entry:t},position:s,type:"custom",draggable:!0}}),i=[],r=new Set(g.map(t=>t.page));for(const t of g)if(t.next&&typeof t.next=="string"&&r.has(t.next)&&i.push({id:`nav-${t.page}-${t.next}-next`,source:t.page,target:t.next,sourceHandle:"next",targetHandle:"prev",label:"",style:{strokeWidth:2,stroke:a.next},data:{isTarget:!1,navType:"next"},className:"edge-next"}),t.prev&&typeof t.prev=="string"&&r.has(t.prev)&&i.push({id:`nav-${t.page}-${t.prev}-prev`,source:t.page,target:t.prev,sourceHandle:"prev",targetHandle:"next",label:"",style:{strokeWidth:2,stroke:a.prev},data:{isTarget:!1,navType:"prev"},className:"edge-prev"}),t.home&&typeof t.home=="string"&&r.has(t.home)&&i.push({id:`nav-${t.page}-${t.home}-home`,source:t.page,target:t.home,sourceHandle:"homeTopLeft",targetHandle:"homeTopRight",label:"",style:{strokeWidth:2,strokeDasharray:"8 8",stroke:a.home},data:{isTarget:!1,navType:"home"},className:"edge-home"}),t.parent&&typeof t.parent=="string"&&r.has(t.parent)&&i.push({id:`nav-${t.page}-${t.parent}-parent`,source:t.page,target:t.parent,sourceHandle:"parentBottomLeft",targetHandle:"parentBottomRight",label:"",style:{strokeWidth:2,stroke:a.parent},data:{isTarget:!1,navType:"parent"},className:"edge-parent"}),Array.isArray(t.targetPages))for(const o of t.targetPages)o&&typeof o=="string"&&r.has(o)&&i.push({id:`target-${t.page}-${o}`,source:t.page,target:o,sourceHandle:"targetRight",targetHandle:"targetLeft",label:"",style:{strokeWidth:2,strokeDasharray:"4 4",stroke:a.target},data:{isTarget:!0,navType:"target"},className:"edge-target"});return{nodes:n,edges:i}}function z(g){const a=new Map;for(const l of g)a.set(l.page,l);const n=g.find(l=>l.page==="main")||g[0],i=[];if(n){let l=n.page;for(;l;){i.unshift(l);const f=a.get(l),u=f&&typeof f.prev=="string"?f.prev:void 0;if(u&&!i.includes(u))l=u;else break}for(l=n.page;l;){const f=a.get(l),u=f&&typeof f.next=="string"?f.next:void 0;if(u&&!i.includes(u))i.push(u),l=u;else break}}const r={id:"__root",children:[]},t={};for(const l of g)t[l.page]={id:l.page,children:[]};for(const l of i){const f=t[l];f&&r.children.push(f)}const o=l=>{const f=new Set,u=[l];for(;u.length;){const b=u.shift();if(i.includes(b))return b;if(f.has(b))continue;f.add(b);const m=a.get(b);m&&(m.prev&&typeof m.prev=="string"&&u.push(m.prev),m.next&&typeof m.next=="string"&&u.push(m.next))}return i[0]||l},s=new Set;for(const l of i)s.add(l);const c=l=>{let f=l;const u=new Set;for(;!u.has(f);){u.add(f);const _=a.get(f),C=_&&typeof _.prev=="string"?_.prev:void 0;if(!C||C===f)break;f=C}const b=[];let m=f;for(u.clear();m&&!u.has(m);){u.add(m),b.push(m);const _=a.get(m),C=_&&typeof _.next=="string"?_.next:void 0;if(!C||C===m)break;m=C}return b},h=[...i];for(;h.length;){const l=h.shift();if(!l)continue;const f=a.get(l);if(f&&Array.isArray(f.targetPages)&&f.targetPages.length)for(const u of f.targetPages){if(!u||s.has(u))continue;const b=c(u);let m=l;for(const _ of b){if(s.has(_)){m=_;continue}const C=t[m],E=t[_];!C||!E||(C.children.includes(E)||C.children.push(E),s.add(_),h.push(_),m=_)}}}for(const l of g)if(!s.has(l.page)&&!l.prev&&!l.next&&(!l.targetPages||!l.targetPages.length)&&l.parent){const f=l.parent,u=t[f],b=t[l.page];u&&b&&!u.children.includes(b)&&(u.children.push(b),s.add(l.page),h.push(l.page))}for(const l of g){if(s.has(l.page))continue;const f=o(l.page);if(!t[f])continue;const u=c(l.page);let b=f;for(const m of u){if(s.has(m)){b=m;continue}const _=t[b],C=t[m];if(!_||!C){b=m,s.add(m);continue}_.children.includes(C)||_.children.push(C),s.add(m),h.push(m),b=m}}const y=J(r),p=8,k=40;let x=1;for(const l of g){const f=l.label||l.page||"";x=Math.max(x,String(f).length)}const T=Math.round(x*p+k),L=Math.min(400,Math.max(140,T));Q().nodeSize([70,L])(y);const M={},O=y.descendants().map(l=>l.x??0),V=O.length?Math.max(...O):0;return y.descendants().forEach(l=>{const f=l.data.id;!f||f==="__root"||(M[f]={x:Math.round(l.y??0),y:Math.round(V-(l.x??0))})}),M}class se extends $.ConfigGeneric{autosaveInterval;saveNavigationBeacon=()=>{const{selectedPanel:a,nodes:n,dirty:i,alive:r}=this.state;if(!a||!n.length||!i||!r)return;const t={panelName:a,pages:n.map(o=>({name:o.id,position:o.position}))};try{const o=`${window.location.origin}/adapter/${P}/autosave`,s=new Blob([JSON.stringify(t)],{type:"application/json"});typeof navigator.sendBeacon=="function"&&navigator.sendBeacon(o,s)}catch{}};handleBeforeUnload=a=>{this.saveNavigationBeacon(),this.state.dirty&&(a.preventDefault(),a.returnValue="")};handleVisibilityChange=()=>{document.visibilityState==="hidden"&&this.state.dirty&&this.saveNavigation()};async saveNavigation(){const{selectedPanel:a,nodes:n,dirty:i,alive:r}=this.state;if(!a||!n.length||!i||!r)return;const t={panelName:a,pages:n.map(o=>({name:o.id,position:o.position}))};try{const o=this.props.oContext.instance??"0";await this.props.oContext.socket.sendTo(`${P}.${o}`,te,t),this.setState({dirty:!1})}catch(o){console.error("Fehler beim Speichern der Navigation:",o)}}aliveTimeout;constructor(a){super(a),this.state={...this.state,alive:!1,loading:!1,panelList:[],selectedPanel:"",navigationMap:null,nodes:[],edges:[],dirty:!1,infoPanelOpen:!1,infoData:null,infoNodeId:void 0},this.checkAlive=this.checkAlive.bind(this),this.fetchNavigation=this.fetchNavigation.bind(this),this.handlePanelChange=this.handlePanelChange.bind(this),this.onNodesChange=this.onNodesChange.bind(this),this.onEdgesChange=this.onEdgesChange.bind(this),this.onNodeClick=this.onNodeClick.bind(this),this.onPaneClick=this.onPaneClick.bind(this),this.saveNavigation=this.saveNavigation.bind(this),this.openConfirmAutoLayout=this.openConfirmAutoLayout.bind(this),this.closeConfirmAutoLayout=this.closeConfirmAutoLayout.bind(this),this.confirmAutoLayout=this.confirmAutoLayout.bind(this)}openConfirmAutoLayout(){this.setState({confirmAutoLayoutOpen:!0})}closeConfirmAutoLayout(){this.setState({confirmAutoLayoutOpen:!1})}confirmAutoLayout(){const a=this.state.navigationMap;if(!a){this.setState({confirmAutoLayoutOpen:!1});return}const n=a.map(o=>({...o,position:void 0})),i=z(n),r=n.map(o=>({id:o.page,data:{label:o.label||o.page,entry:o},position:i[o.page]??{x:0,y:0},type:"custom",draggable:!0})),t=B(n);this.setState({nodes:r,edges:t.edges,dirty:!0,confirmAutoLayoutOpen:!1})}onNodeClick(a,n){var r,t;const i=((t=(r=n==null?void 0:n.data)==null?void 0:r.entry)==null?void 0:t.pageInfo)??null;this.setState({infoPanelOpen:!0,infoData:i,infoNodeId:n.id})}onPaneClick(){this.setState({infoPanelOpen:!1,infoData:null,infoNodeId:void 0})}componentDidMount(){this.checkAlive(),this.fetchNavigation(),this.autosaveInterval=setInterval(()=>{this.state.dirty&&this.saveNavigation()},1e4),window.addEventListener("beforeunload",this.handleBeforeUnload),document.addEventListener("visibilitychange",this.handleVisibilityChange);try{const a=typeof window<"u"&&("ontouchstart"in window||navigator.maxTouchPoints&&navigator.maxTouchPoints>0);this.setState({isTouchDevice:!!a})}catch{}}componentWillUnmount(){this.aliveTimeout&&clearTimeout(this.aliveTimeout),this.autosaveInterval&&clearInterval(this.autosaveInterval),window.removeEventListener("beforeunload",this.handleBeforeUnload),document.removeEventListener("visibilitychange",this.handleVisibilityChange),this.state.dirty&&this.saveNavigation()}checkAlive(){const a=this.props.oContext.instance??"0",n=this.props.oContext.socket;n&&typeof n.getState=="function"?n.getState(`system.adapter.${P}.${a}.alive`).then(i=>{this.setState({alive:!!(i!=null&&i.val)}),this.aliveTimeout=setTimeout(this.checkAlive,5e3)}):this.aliveTimeout=setTimeout(this.checkAlive,5e3)}fetchNavigation(){this.setState({loading:!0,noData:!1});const a=this.props.oContext.instance??"0";let n=!1;const i=setTimeout(()=>{n||this.setState({loading:!1,panelList:[],selectedPanel:"",navigationMap:null,nodes:[],edges:[],noData:!0})},3e3);this.props.oContext.socket.sendTo(`${P}.${a}`,ee,null).then(r=>{var t,o;if(n=!0,clearTimeout(i),this.setState({loading:!1}),r&&Array.isArray(r.result)){const s=((t=r.result[0])==null?void 0:t.panelName)||"",c=((o=r.result[0])==null?void 0:o.navigationMap)||null;let h=[],y=[];if(c){const k=B(c);h=k.nodes,y=k.edges}const p=r.result.map(k=>({panelName:k.panelName,friendlyName:k.friendlyName||k.panelName,navigationMap:k.navigationMap}));this.setState({panelList:p,selectedPanel:s,navigationMap:c,nodes:h,edges:y,noData:!1,dirty:!1})}else this.setState({panelList:[],selectedPanel:"",navigationMap:null,nodes:[],edges:[],noData:!0})})}handlePanelChange(a,n){this.state.dirty&&this.saveNavigation();const i=a.target.value,r=this.state.panelList.find(s=>s.panelName===i);let t=[],o=[];if(r&&r.navigationMap){const s=B(r.navigationMap);t=s.nodes,o=s.edges}this.setState({selectedPanel:i,navigationMap:r?r.navigationMap:null,nodes:t,edges:o,dirty:!1})}onNodesChange(a){if(a.some(n=>n.type==="position")){const n=a.find(r=>r.type==="position"),i=n==null?void 0:n.id;this.setState(r=>{var c,h;const t=W(a,r.nodes),o=t.find(y=>y.id===i),s=((h=(c=o==null?void 0:o.data)==null?void 0:c.entry)==null?void 0:h.pageInfo)??null;return{nodes:t,dirty:!0,infoPanelOpen:!0,infoData:s,infoNodeId:i}})}else this.setState(n=>({nodes:W(a,n.nodes)}))}onEdgesChange(a){a.some(n=>n.type==="position")?this.setState(n=>({edges:H(a,n.edges),dirty:!0})):this.setState(n=>({edges:H(a,n.edges)}))}render(){const{alive:a,loading:n,panelList:i,selectedPanel:r,nodes:t,edges:o,noData:s}=this.state,c=new Set(t.map(p=>p.id)),h=(o||[]).filter(p=>c.has(p.source)&&c.has(p.target)),y=[{label:"prev",color:"#1976d2",dash:!1},{label:"next",color:"#1976d2",dash:!1},{label:"home",color:"#fbc02d",dash:!0},{label:"parent",color:"#d32f2f",dash:!1},{label:"target",color:"#43a047",dash:!0}];return e.jsxs(d.Box,{sx:{width:"100%",p:2,position:"relative"},children:[e.jsxs(d.Box,{sx:{display:"flex",alignItems:"center",mb:2,gap:2},children:[e.jsx(d.Typography,{variant:"h6",children:j.I18n.t("Panel_Navigation")}),e.jsx(d.Box,{sx:{flex:1}}),e.jsx(d.Button,{variant:"outlined",onClick:this.fetchNavigation,disabled:n,children:j.I18n.t("refresh")}),e.jsx(d.Button,{variant:"outlined",onClick:this.openConfirmAutoLayout,disabled:n||!this.state.navigationMap,children:j.I18n.t("auto_layout")}),e.jsx(d.Typography,{variant:"body2",color:a?"success.main":"error.main",sx:{ml:2},children:a?j.I18n.t("Adapter_online"):j.I18n.t("Adapter_offline")})]}),e.jsx(d.Box,{sx:{display:"flex",gap:2,mb:2},children:y.map(p=>e.jsxs(d.Box,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx("span",{className:"legend-span",style:{background:p.dash?"transparent":p.color,backgroundColor:p.dash?"transparent":p.color,backgroundImage:p.dash?`repeating-linear-gradient(90deg, ${p.color} 0 ${p.label==="home"?8:4}px, transparent ${p.label==="home"?8:4}px ${p.label==="home"?16:8}px)`:void 0,borderBottom:p.dash?`2px dashed ${p.color}`:void 0}}),e.jsx(d.Typography,{variant:"body2",children:p.label})]},p.label))}),n?e.jsx(d.Box,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:200},children:e.jsx(d.CircularProgress,{})}):s?e.jsx(d.Box,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:200},children:e.jsx(d.Typography,{variant:"body1",color:"text.secondary",children:j.I18n.t("No_data")})}):e.jsxs(e.Fragment,{children:[e.jsxs(d.Box,{sx:{mb:2,display:"flex",alignItems:"center",gap:2},children:[e.jsx(d.Box,{sx:{minWidth:200,flex:"0 0 240px"},children:e.jsx(d.Select,{value:r,onChange:this.handlePanelChange,displayEmpty:!0,fullWidth:!0,size:"small",children:i.map(p=>e.jsx(d.MenuItem,{value:p.panelName,children:p.friendlyName},p.panelName))})}),this.state.isTouchDevice?e.jsx(d.Typography,{variant:"body2",sx:{color:"success.main",whiteSpace:"nowrap"},children:j.I18n.t("touch_hint_buttons")}):null]}),e.jsxs("div",{className:"reactflow-container",children:[e.jsx("svg",{style:{position:"absolute",width:0,height:0,overflow:"visible"},"aria-hidden":"true",children:e.jsxs("defs",{children:[e.jsx("marker",{id:"arrow-default",markerWidth:"8",markerHeight:"8",refX:"8",refY:"4",orient:"auto",markerUnits:"strokeWidth",children:e.jsx("path",{d:"M0,0 L8,4 L0,8 z",fill:"var(--edge-color, #1976d2)"})}),e.jsx("marker",{id:"arrow-target",markerWidth:"10",markerHeight:"10",refX:"10",refY:"5",orient:"auto",markerUnits:"strokeWidth",children:e.jsx("path",{d:"M0,0 L10,5 L0,10 z",fill:"var(--edge-target, #43a047)"})}),e.jsx("marker",{id:"arrow-next",markerWidth:"8",markerHeight:"8",refX:"8",refY:"4",orient:"auto",markerUnits:"strokeWidth",children:e.jsx("path",{d:"M0,0 L8,4 L0,8 z",fill:"var(--edge-next, #1976d2)"})}),e.jsx("marker",{id:"arrow-prev",markerWidth:"8",markerHeight:"8",refX:"8",refY:"4",orient:"auto",markerUnits:"strokeWidth",children:e.jsx("path",{d:"M0,0 L8,4 L0,8 z",fill:"var(--edge-prev, #1976d2)"})}),e.jsx("marker",{id:"arrow-home",markerWidth:"8",markerHeight:"8",refX:"8",refY:"4",orient:"auto",markerUnits:"strokeWidth",children:e.jsx("path",{d:"M0,0 L8,4 L0,8 z",fill:"var(--edge-home, #fbc02d)"})}),e.jsx("marker",{id:"arrow-parent",markerWidth:"8",markerHeight:"8",refX:"8",refY:"4",orient:"auto",markerUnits:"strokeWidth",children:e.jsx("path",{d:"M0,0 L8,4 L0,8 z",fill:"var(--edge-parent, #d32f2f)"})})]})}),e.jsx(ne,{open:!!this.state.confirmAutoLayoutOpen,onClose:this.closeConfirmAutoLayout,onConfirm:this.confirmAutoLayout,title:j.I18n.t("auto_layout_confirm_title"),description:j.I18n.t("auto_layout_confirm_text"),cancelText:j.I18n.t("auto_layout_confirm_cancel"),confirmText:j.I18n.t("auto_layout_confirm_reorder"),ariaTitleId:"auto-layout-confirm-title",ariaDescId:"auto-layout-confirm-description"}),e.jsxs(F,{nodes:t,fitView:!0,nodesDraggable:!0,onNodesChange:this.onNodesChange,onNodeClick:this.onNodeClick,onPaneClick:this.onPaneClick,onEdgesChange:this.onEdgesChange,edgeTypes:{custom:oe},edges:h.map(p=>({...p,type:"custom"})),nodeTypes:{custom:({id:p,data:k})=>{var S;const x={prev:!1,next:!1,homeTopLeft:!1,homeTopRight:!1,parentBottomLeft:!1,parentBottomRight:!1,targetRight:!1,targetLeft:!1};for(const v of o)v.source===p&&v.sourceHandle&&(x[v.sourceHandle]=!0),v.target===p&&v.targetHandle&&(x[v.targetHandle]=!0);const T=(S=k.entry)==null?void 0:S.pageInfo;if(T&&typeof T=="object"){const v=Object.entries(T).filter(([L,A])=>typeof A=="string"||typeof A=="number");v.length&&v.map(([L,A])=>`${j.I18n.t(L)}: ${typeof A=="string"?j.I18n.t(A):String(A)}`).join(`
`)}return e.jsxs(d.Box,{className:"node-box",children:[x.prev&&e.jsx(N,{type:"target",position:I.Top,id:"prev",style:{background:"#1976d2"}}),x.prev&&e.jsx(N,{type:"source",position:I.Top,id:"prev",style:{background:"#1976d2"}}),x.next&&e.jsx(N,{type:"target",position:I.Bottom,id:"next",style:{background:"#388e3c"}}),x.next&&e.jsx(N,{type:"source",position:I.Bottom,id:"next",style:{background:"#388e3c"}}),x.homeTopLeft&&e.jsx(N,{type:"source",position:I.Left,id:"homeTopLeft",className:"homeTopLeft",style:{background:"#fbc02d"}}),x.homeTopRight&&e.jsx(N,{type:"target",position:I.Right,id:"homeTopRight",className:"homeTopRight",style:{background:"#fbc02d"}}),x.parentBottomLeft&&e.jsx(N,{type:"source",position:I.Left,id:"parentBottomLeft",className:"parentBottomLeft",style:{background:"#d32f2f"}}),x.parentBottomRight&&e.jsx(N,{type:"target",position:I.Right,id:"parentBottomRight",className:"parentBottomRight",style:{background:"#d32f2f"}}),x.targetRight&&e.jsx(N,{type:"source",position:I.Right,id:"targetRight",style:{background:"#888",top:"50%"}}),x.targetLeft&&e.jsx(N,{type:"target",position:I.Left,id:"targetLeft",style:{background:"#888",top:"50%"}}),e.jsx(d.Typography,{variant:"body2",color:"text.primary",className:"node-label",sx:{position:"relative",zIndex:2,cursor:"move"},children:k.label})]})}},children:[e.jsx(G,{}),e.jsx(X,{gap:16})]},r||"navigation-flow"),e.jsx(ae,{open:!!this.state.infoPanelOpen,data:this.state.infoData})]})]})]})}handleAutoLayout(){const a=this.state.navigationMap;if(!a)return;const n=z(a),i={};for(const o of this.state.nodes)i[o.id]=o;const r=a.map(o=>{const s=i[o.page],c=n[o.page]??(s==null?void 0:s.position)??{x:0,y:0};return{id:o.page,data:{label:o.label||o.page,entry:o},position:c,type:(s==null?void 0:s.type)??"custom",draggable:(s==null?void 0:s.draggable)??!0}}),t=B(a);this.setState({nodes:r,edges:t.edges,dirty:!0})}}function ie({children:g}){const a=K();return w.useEffect(()=>{const n=document.documentElement;n.style.setProperty("--node-bg",a.palette.background.paper||"#fff"),n.style.setProperty("--node-text",a.palette.text.primary||"#000"),n.style.setProperty("--edge-color",a.palette.primary.main||"#1976d2"),n.style.setProperty("--edge-next","#1976d2"),n.style.setProperty("--edge-prev","#1976d2"),n.style.setProperty("--edge-home","#fbc02d"),n.style.setProperty("--edge-parent","#d32f2f"),n.style.setProperty("--edge-target","#43a047")},[a]),e.jsx(e.Fragment,{children:g})}function _e(g){return e.jsx(ie,{children:e.jsx(se,{...g})})}export{be as A,ne as C,ue as I,xe as S,_e as W,me as a,ye as b,ve as c};
