import{A as _,b as C,c as S,S as N,w as k,d as R,C as B,a as q,I as F,W as $}from"./NavigationView-BDzsQ2SK.js";import{j as e}from"./createSvgIcon-BAyG150Y.js";import{A as t}from"./AdminComponentEasyAccessSet__loadShare___mf_0_mui_mf_1_material__loadShare__-DP1_LQ8a.js";import{D as L,V as O,a as M}from"./VisibilityOff-BA5BfaUG.js";import{R as w}from"./AdminComponentEasyAccessSet__loadShare__react__loadShare__-BWvOyvAg.js";import{A as j}from"./AdminComponentEasyAccessSet__loadShare___mf_0_iobroker_mf_1_adapter_mf_2_react_mf_2_v5__loadShare__-ChLGBbzW.js";import{T as P}from"./Tooltip-QmnnkgNQ.js";import{A as I}from"./AdminComponentEasyAccessSet__loadShare___mf_0_mui_mf_1_icons_mf_2_material__loadShare__-CmHE1aSA.js";import"./index-BCpyQc2W.js";import"./_commonjsHelpers-CE1G-McA.js";import"./AdminComponentEasyAccessSet__mf_v__runtimeInit__mf_v__-DmMtQNcK.js";import"./Clear-jM7oAHDI.js";import"./useTheme-Cq43vfiC.js";import"./defaultTheme-BKgYrozm.js";import"./Grow-DxyKUkMA.js";class D extends _.ConfigGeneric{static defaultProps={widthPercent:30};constructor(a){super(a),this.state={...this.state,available:[],selectedTopic:"",added:[],assignments:a.currentAssignments||[],pagesMap:{},alive:!1,isCollapsed:!1,isLoading:{},lastLoadTime:{},focusReceived:{},retryCount:{}}}componentWillUnmount(){if(this.props.oContext&&this.props.oContext.socket){const a=this.props.oContext.instance??"0";this.props.oContext.socket.unsubscribeState(`system.adapter.${C}.${a}.alive`,this.onAliveChanged)}}async componentDidMount(){if(super.componentDidMount(),this.props.oContext&&this.props.oContext.socket){const a=this.props.oContext.instance??"0",l=`system.adapter.${C}.${a}.alive`;try{const r=await this.props.oContext.socket.getState(l),s=!!(r!=null&&r.val);this.setState({alive:s}),await this.props.oContext.socket.subscribeState(l,this.onAliveChanged)}catch(r){console.error("[NavigationAssignmentPanel] Failed to get alive state or subscribe:",r),this.setState({alive:!1})}}await this.loadPanels(!1),await this.applyAssignmentsFromProps(this.props.currentAssignments||[])}onAliveChanged=(a,l)=>{const r=this.state.alive,s=l?!!l.val:!1;r!==s&&(this.setState({alive:s}),!r&&s&&this.state.assignments.length>0&&this.retryLoadingPagesForAssignments())};async applyAssignmentsFromProps(a){var o;const l=(a||[]).map(y=>this.state.available.find(T=>T.panelTopic===y.topic)||{panelTopic:y.topic,friendlyName:y.topic}).sort((y,b)=>y.friendlyName.localeCompare(b.friendlyName));console.log(`[NavigationAssignmentPanel] applyAssignmentsFromProps: available=${JSON.stringify(this.state.available)}, added=${JSON.stringify(l)}`);const r=this.state.selectedAddedTopic,p=l.find(y=>y.panelTopic===r)?r:(o=l[0])==null?void 0:o.panelTopic;this.setState({assignments:a,added:l,selectedAddedTopic:p,selectedTopic:""});const n=l.map(y=>this.loadPagesForPanel(y.panelTopic,!0));await Promise.all(n)}componentDidUpdate(a){if(a.uniqueName!==this.props.uniqueName){const l=this.props.currentAssignments||[];this.props.uniqueName&&this.setState(r=>({focusReceived:{...r.focusReceived,[this.props.uniqueName]:!0}})),this.loadPanels(!1).then(()=>{this.applyAssignmentsFromProps(l)})}else if(a.currentAssignments!==this.props.currentAssignments&&this.props.currentAssignments){const l=this.props.currentAssignments||[];this.applyAssignmentsFromProps(l)}}async loadPanels(a=!0){var l;try{let r=[];this.props.fetchPanels?r=await this.props.fetchPanels():(l=this.props.data)!=null&&l.panels&&(r=(this.props.data.panels||[]).map(s=>({panelTopic:s.topic,friendlyName:s.name||s.topic}))),await new Promise(s=>this.setState({available:r,selectedTopic:""},()=>s()))}catch{this.setState({available:[],selectedTopic:""})}}doAddSelected=()=>{const{selectedTopic:a,available:l,added:r}=this.state;if(!a)return;let s=l.find(o=>o.panelTopic===a);if(!s&&a===S&&(s={panelTopic:S,friendlyName:`(${j.I18n.t("all")||"All"})`}),!s||r.find(o=>o.panelTopic===s.panelTopic))return;const p=[...r,s],n=[...this.state.assignments,{topic:s.panelTopic}];this.setState({added:p,assignments:n,selectedTopic:""}),this.loadPagesForPanel(s.panelTopic),this.props.onAssign&&this.props.uniqueName&&this.props.onAssign(this.props.uniqueName,n)};doRemoveSelected=()=>{const{added:a,selectedAddedTopic:l}=this.state;if(a.length)if(l){const r=a.filter(o=>o.panelTopic!==l),s=this.state.assignments.filter(o=>o.topic!==l),p=a.findIndex(o=>o.panelTopic===l);let n;if(r.length>0){const o=r[p]??r[p-1]??r[0];n=o==null?void 0:o.panelTopic}else n=void 0;this.setState({added:r,assignments:s,selectedAddedTopic:n}),this.props.onAssign&&this.props.uniqueName&&this.props.onAssign(this.props.uniqueName,s)}else{const r=a.slice(0,-1),s=this.state.assignments.slice(0,-1),p=r.length?r[r.length-1].panelTopic:void 0;this.setState({added:r,assignments:s,selectedAddedTopic:p}),this.props.onAssign&&this.props.uniqueName&&this.props.onAssign(this.props.uniqueName,s)}};selectAdded=a=>{this.setState({selectedAddedTopic:a}),this.loadPagesForPanel(a,!0)};retryLoadingPagesForAssignments(){const a=this.state.assignments.map(l=>l.topic);for(const l of a)this.loadPagesForPanel(l,!0)}async loadPagesForPanel(a,l=!1){var y,b;if(!a)return;if(!this.state.alive){console.log(`[NavigationAssignmentPanel] Adapter not alive, skipping pages load for ${a}`);return}const r=Date.now(),s=this.state.lastLoadTime[a]||0,p=this.state.isLoading[a],n=!!this.state.pagesMap[a],o=l||!n||r-s>6e4;if(!(p||!o&&n)){this.setState(T=>({isLoading:{...T.isLoading,[a]:!0},lastLoadTime:{...T.lastLoadTime,[a]:r}}));try{let T=[],h=!1;if((y=this.props.oContext)!=null&&y.socket){const c=this.props.oContext.instance??"0",m=`${C}.${c}`,f={panelTopic:a};try{const i=new Promise((u,g)=>{setTimeout(()=>g(new Error("sendTo timeout after 2 seconds")),2e3)}),d=this.props.oContext.socket.sendTo(m,N,f),v=await Promise.race([d,i]);Array.isArray(v)?(T=v,h=!0):v&&Array.isArray(v.result)&&(T=v.result,h=!0),console.log("[NavigationAssignmentPanel] sendTo successful",{topic:a,pages:T})}catch(i){console.warn("[NavigationAssignmentPanel] sendTo failed or timed out",{target:m,cmd:N,payload:f,error:i})}}if(h&&T.length===0){const c=this.state.retryCount[a]||0,m=3,f=2e3;if(c<m){console.log(`[NavigationAssignmentPanel] Got empty array for ${a}, retrying in ${f}ms (attempt ${c+1}/${m})`),this.setState(i=>({retryCount:{...i.retryCount,[a]:c+1}})),setTimeout(()=>{this.setState(i=>({isLoading:{...i.isLoading,[a]:!1}})),this.loadPagesForPanel(a,!0)},f);return}console.log(`[NavigationAssignmentPanel] Max retries reached for ${a}, accepting empty result`),this.setState(i=>({retryCount:{...i.retryCount,[a]:0}}))}else h&&T.length>0&&this.setState(c=>({retryCount:{...c.retryCount,[a]:0}}));if(!h&&!((b=this.props.oContext)!=null&&b.socket)&&(await new Promise(c=>setTimeout(c,1e3)),this.setState(c=>({isLoading:{...c.isLoading,[a]:!1}})),!this.state.focusReceived[a]))return this.setState(c=>({focusReceived:{...c.focusReceived,[a]:!0}})),this.loadPagesForPanel(a,!0);this.setState(c=>({pagesMap:{...c.pagesMap,[a]:T},isLoading:{...c.isLoading,[a]:!1}}))}catch(T){console.error("[NavigationAssignmentPanel] loadPagesForPanel error",{topic:a,error:T}),this.setState(h=>({isLoading:{...h.isLoading,[a]:!1}}))}}}setNavigationForSelected=a=>{const{selectedAddedTopic:l,assignments:r}=this.state;if(!l)return;const s=r.findIndex(y=>y.topic===l),p=[...r],n=r[s],o={topic:l,navigation:{...n==null?void 0:n.navigation,...a}};s>=0?p[s]=o:p.push(o),this.setState({assignments:p}),this.props.onAssign&&this.props.uniqueName&&this.props.onAssign(this.props.uniqueName,p)};getNavValue=(a,l)=>{var p;if(!a)return"";const r=this.state.assignments.find(n=>n.topic===a);return((p=r==null?void 0:r.navigation)==null?void 0:p[l])||""};togglePanel=()=>{const a=this.state.isCollapsed;this.setState(l=>({isCollapsed:!l.isCollapsed})),a&&this.applyAssignmentsFromProps(this.props.currentAssignments||[])};renderItem(a,l,r){const{widthPercent:s}=this.props,{isCollapsed:p}=this.state,n=this.state.selectedAddedTopic?this.state.pagesMap[this.state.selectedAddedTopic]??[]:[];return e.jsxs(t.Box,{sx:{position:{xs:"static",md:"absolute"},right:{xs:"auto",md:0},top:{xs:"auto",md:0},height:{xs:"auto",md:"100%"},width:{xs:"100%",md:p?"10px":`${s}%`},minHeight:{xs:p?"50px":"auto",md:"auto"},transition:"width 240ms ease, min-height 240ms ease",backgroundColor:"background.default",border:{xs:"2px solid",md:"none"},borderLeft:{xs:"none",md:"2px solid"},borderTop:{xs:"none",md:"2px solid"},borderColor:"secondary.main",borderRadius:{xs:1,md:0},overflow:{xs:"hidden",md:"visible"},display:"flex",flexDirection:"column",zIndex:20,mt:{xs:2,md:0}},children:[e.jsx(t.Box,{sx:{display:{xs:"none",md:"flex"},position:"absolute",left:"-20px",top:"50%",transform:"translateY(-50%)",width:"20px",height:"60px",backgroundColor:"secondary.main",borderRadius:"4px 0 0 4px",alignItems:"center",justifyContent:"center",cursor:"pointer",zIndex:21,"&:hover":{backgroundColor:"secondary.dark"}},onClick:this.togglePanel,children:e.jsx(t.Typography,{sx:{color:"secondary.contrastText",fontSize:"14px",fontWeight:"bold",transform:"rotate(-90deg)",whiteSpace:"nowrap"},children:p?"⏶":"⏷"})}),e.jsx(t.Box,{sx:{display:{xs:"flex",md:"none"},alignItems:"center",justifyContent:"center",p:1,backgroundColor:"secondary.main",color:"secondary.contrastText",borderRadius:"4px 4px 0 0"},children:e.jsx(t.Typography,{variant:"subtitle2",sx:{fontWeight:600},children:j.I18n.t("navigation_panel")})}),e.jsxs(t.Box,{sx:{p:1,height:"100%",display:{xs:"flex",md:p?"none":"flex"},flexDirection:"column",width:{xs:"100%",md:p?"0%":"100%"},overflow:"hidden",transition:{xs:"none",md:"width 240ms ease"}},children:[e.jsx(t.Typography,{variant:"h6",sx:{mb:1,fontWeight:600,color:"primary.main",fontSize:"1rem",display:{xs:"none",md:"block"}},children:j.I18n.t("navigation_panel")}),e.jsxs(t.Box,{sx:{display:"flex",gap:1,alignItems:"center",mb:1},children:[e.jsxs(t.Select,{size:"small",variant:"standard",value:this.state.selectedTopic,onOpen:()=>{this.loadPanels()},onChange:o=>this.setState({selectedTopic:String(o.target.value)}),disabled:!this.state.alive,sx:{flex:1,backgroundColor:"transparent",minHeight:40,"& .MuiSelect-select":{backgroundColor:"transparent",display:"flex",alignItems:"center",height:40}},displayEmpty:!0,children:[e.jsx(t.MenuItem,{value:"",children:e.jsx("em",{children:"—"})}),!this.state.added.some(o=>o.panelTopic===S)&&e.jsx(t.MenuItem,{value:S,children:`(${j.I18n.t("all")||"All"})`}),this.state.available.filter(o=>!this.state.added.some(y=>y.panelTopic===o.panelTopic)).map(o=>e.jsx(t.MenuItem,{value:o.panelTopic,children:o.friendlyName},o.panelTopic))]}),e.jsx(t.Button,{size:"small",variant:"contained",sx:{minWidth:32,padding:"4px 8px"},onClick:this.doAddSelected,disabled:!this.state.selectedTopic||!this.state.alive,children:"+"})]}),e.jsx(t.Box,{children:this.state.added.length===0?e.jsx(t.Typography,{variant:"body2",color:"text.secondary",children:j.I18n.t("No panels added")}):e.jsx("div",{style:{overflow:"auto"},children:e.jsx(t.List,{dense:!0,children:this.state.added.map(o=>{const y=o.panelTopic,b=this.state.pendingDelete===y;return e.jsx(w.Fragment,{children:e.jsx(t.ListItem,{component:"div",disablePadding:!0,sx:{"&:hover .delete-icon":{opacity:1}},secondaryAction:e.jsx(t.IconButton,{className:"delete-icon",edge:"end","aria-label":"delete",size:"small",onClick:T=>{var h;if(T.stopPropagation(),!b)this.setState({pendingDelete:y}),setTimeout(()=>{this.state.pendingDelete===y&&this.setState({pendingDelete:void 0})},3e3);else{const c=this.state.added.filter(i=>i.panelTopic!==y),m=this.state.assignments.filter(i=>i.topic!==y),f=c.length>0?(h=c[0])==null?void 0:h.panelTopic:void 0;this.setState({added:c,assignments:m,selectedAddedTopic:f,pendingDelete:void 0}),this.props.onAssign&&this.props.uniqueName&&this.props.onAssign(this.props.uniqueName,m)}},sx:{color:b?"error.dark":"error.main",opacity:{xs:1,md:0},transition:"opacity 0.2s",backgroundColor:b?"error.main":"transparent","&:hover":{backgroundColor:b?"error.dark":"action.hover"}},children:e.jsx(L,{fontSize:"small"})}),children:e.jsx(t.ListItemButton,{selected:this.state.selectedAddedTopic===y,onClick:()=>{this.selectAdded(y),this.setState({pendingDelete:void 0})},sx:{pr:6},children:e.jsx(t.ListItemText,{primary:y===S?`(${j.I18n.t("all")||"All"})`:o.friendlyName,sx:{flex:1,overflow:"hidden",textOverflow:"ellipsis"}})})})},y)})})})}),e.jsx(t.Divider,{sx:{my:1}}),e.jsxs(t.Box,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:1,mt:1},children:[e.jsxs(t.Box,{children:[e.jsx(t.Box,{sx:{display:"flex",alignItems:"center",mb:.5},children:e.jsx(P,{title:j.I18n.t("nav_prev_tooltip"),children:e.jsx(t.Typography,{variant:"caption",color:"text.secondary",sx:{mr:.5},children:"prev"})})}),e.jsxs(t.Select,{size:"small",displayEmpty:!0,"aria-label":"prev",value:this.getNavValue(this.state.selectedAddedTopic,"prev")||"",onOpen:()=>{this.state.selectedAddedTopic&&this.loadPagesForPanel(this.state.selectedAddedTopic,!0)},onChange:o=>this.setNavigationForSelected({prev:String(o.target.value)||void 0}),sx:{width:"100%"},disabled:!this.state.alive||this.state.selectedAddedTopic&&this.state.isLoading[this.state.selectedAddedTopic]||!1,endAdornment:this.state.selectedAddedTopic&&this.state.isLoading[this.state.selectedAddedTopic]?e.jsx(t.Box,{sx:{display:"flex",alignItems:"center",pr:1},children:e.jsx(t.CircularProgress,{size:16})}):null,children:[e.jsx(t.MenuItem,{value:"",children:this.state.selectedAddedTopic?e.jsx("em",{children:"—"}):e.jsx("em",{children:j.I18n.t("select_panel_first")})}),n.filter(o=>o!==this.props.uniqueName).map(o=>e.jsx(t.MenuItem,{value:o,children:o},`prev-${o}`))]})]}),e.jsxs(t.Box,{children:[e.jsx(t.Box,{sx:{display:"flex",alignItems:"center",mb:.5},children:e.jsx(P,{title:j.I18n.t("nav_next_tooltip"),children:e.jsx(t.Typography,{variant:"caption",color:"text.secondary",sx:{mr:.5},children:"next"})})}),e.jsxs(t.Select,{size:"small",displayEmpty:!0,"aria-label":"next",value:this.getNavValue(this.state.selectedAddedTopic,"next")||"",onOpen:()=>{this.state.selectedAddedTopic&&this.loadPagesForPanel(this.state.selectedAddedTopic,!0)},onChange:o=>this.setNavigationForSelected({next:String(o.target.value)||void 0}),sx:{width:"100%"},disabled:!this.state.alive||this.state.selectedAddedTopic&&this.state.isLoading[this.state.selectedAddedTopic]||!1,endAdornment:this.state.selectedAddedTopic&&this.state.isLoading[this.state.selectedAddedTopic]?e.jsx(t.Box,{sx:{display:"flex",alignItems:"center",pr:1},children:e.jsx(t.CircularProgress,{size:16})}):null,children:[e.jsx(t.MenuItem,{value:"",children:this.state.selectedAddedTopic?e.jsx("em",{children:"—"}):e.jsx("em",{children:j.I18n.t("select_panel_first")})}),n.filter(o=>o!==this.props.uniqueName&&!o.startsWith("///")).map(o=>e.jsx(t.MenuItem,{value:o,children:o},`next-${o}`))]})]}),e.jsxs(t.Box,{children:[e.jsx(t.Typography,{variant:"caption",color:"text.secondary",sx:{mb:.5,display:"block"},children:"home"}),e.jsxs(t.Select,{size:"small",displayEmpty:!0,"aria-label":"home",value:this.getNavValue(this.state.selectedAddedTopic,"home")||"",onOpen:()=>{this.state.selectedAddedTopic&&this.loadPagesForPanel(this.state.selectedAddedTopic,!0)},onChange:o=>this.setNavigationForSelected({home:String(o.target.value)||void 0}),sx:{width:"100%"},disabled:!this.state.alive||this.state.selectedAddedTopic&&this.state.isLoading[this.state.selectedAddedTopic]||!1,endAdornment:this.state.selectedAddedTopic&&this.state.isLoading[this.state.selectedAddedTopic]?e.jsx(t.Box,{sx:{display:"flex",alignItems:"center",pr:1},children:e.jsx(t.CircularProgress,{size:16})}):null,children:[e.jsx(t.MenuItem,{value:"",children:e.jsx("em",{children:"—"})}),n.filter(o=>o!==this.props.uniqueName).map(o=>e.jsx(t.MenuItem,{value:o,children:o},`home-${o}`))]})]}),e.jsxs(t.Box,{children:[e.jsx(t.Typography,{variant:"caption",color:"text.secondary",sx:{mb:.5,display:"block"},children:"parent"}),e.jsxs(t.Select,{size:"small",displayEmpty:!0,"aria-label":"parent",value:this.getNavValue(this.state.selectedAddedTopic,"parent")||"",onOpen:()=>{this.state.selectedAddedTopic&&this.loadPagesForPanel(this.state.selectedAddedTopic,!0)},onChange:o=>this.setNavigationForSelected({parent:String(o.target.value)||void 0}),sx:{width:"100%"},disabled:!this.state.alive||this.state.selectedAddedTopic&&this.state.isLoading[this.state.selectedAddedTopic]||!1,endAdornment:this.state.selectedAddedTopic&&this.state.isLoading[this.state.selectedAddedTopic]?e.jsx(t.Box,{sx:{display:"flex",alignItems:"center",pr:1},children:e.jsx(t.CircularProgress,{size:16})}):null,children:[e.jsx(t.MenuItem,{value:"",children:e.jsx("em",{children:"—"})}),n.filter(o=>o!==this.props.uniqueName).map(o=>e.jsx(t.MenuItem,{value:o,children:o},`parent-${o}`))]})]}),e.jsx(t.Divider,{sx:{my:1}})]}),this.state.added.length>0?this.state.added.map(o=>{const y=o.panelTopic,b=this.state.added.some(u=>u.panelTopic===S),T=this.getNavValue(y,"next"),h=this.getNavValue(y,"prev"),c=this.getNavValue(y,"home"),m=this.getNavValue(y,"parent"),f=!!(T||h||c||m),i=y===S,d=!T&&!h,v=i?"nav_all_requires_prev_next":b?"nav_remove_from_all_notice":"nav_target_only_notice";return e.jsxs(t.Box,{"data-has-all":b,sx:{mt:2,mb:1},children:[e.jsxs(t.Box,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:[e.jsx(t.Box,{sx:{width:10,height:10,borderRadius:"50%",bgcolor:f?"success.main":"error.main"}}),e.jsx(t.Typography,{variant:"subtitle2",sx:{fontWeight:600},children:y===S?`(${j.I18n.t("all")||"All"})`:o.friendlyName||y})]}),e.jsx(t.Box,{sx:{display:"flex",alignItems:"center",gap:1,flexWrap:"wrap"},children:["next","prev","parent","home"].map((u,g)=>{const x=this.getNavValue(y,u);return e.jsxs(w.Fragment,{children:[e.jsxs(t.Box,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(t.Typography,{variant:"caption",color:"text.secondary",children:j.I18n.t(u)||u}),e.jsx(t.Typography,{variant:"body2",children:x||e.jsx("em",{children:"—"})})]}),g<3&&e.jsx(t.Divider,{orientation:"vertical",flexItem:!0,sx:{height:18,mx:1}})]},`${y}-${u}`)})}),d?e.jsx(t.Box,{sx:{mt:1},children:e.jsx(t.Typography,{variant:"caption",color:"text.secondary",sx:{fontStyle:"italic"},children:j.I18n.t(v)})}):null]},`panel-summary-${y}`)}):null]})]})}}class W extends _.ConfigGeneric{_local=null;pagesRetryTimeout;constructor(a){super(a);const l=_.ConfigGeneric.getValue(a.data,a.attr);this.state={...this.state,entries:Array.isArray(l)?l:[],confirmDeleteOpen:!1,confirmDeleteName:null,alive:!1,pagesRetryCount:0}}componentWillUnmount(){this.pagesRetryTimeout&&clearTimeout(this.pagesRetryTimeout);const a=this.props.oContext.instance??"0";this.props.oContext.socket.unsubscribeState(`system.adapter.${C}.${a}.alive`,this.onAliveChanged)}async componentDidMount(){super.componentDidMount();const a=this.props.oContext.instance??"0",l=`system.adapter.${C}.${a}.alive`;try{const r=await this.props.oContext.socket.getState(l),s=!!(r!=null&&r.val);this.setState({alive:s}),await this.props.oContext.socket.subscribeState(l,this.onAliveChanged),s&&await this.loadPagesList()}catch(r){console.error("[UnlockPage] Failed to get alive state or subscribe:",r),this.setState({alive:!1})}}onAliveChanged=(a,l)=>{const r=this.state.alive,s=l?!!l.val:!1;r!==s&&(this.setState({alive:s}),!r&&s&&(!this.state.pagesList||this.state.pagesList.length===0)&&this.loadPagesList(),r&&!s&&this.pagesRetryTimeout&&(clearTimeout(this.pagesRetryTimeout),this.pagesRetryTimeout=void 0))};async loadPagesList(){if(!this.state.alive){console.log("[UnlockPage] Adapter not alive, skipping pages load");return}const a=[];if(this.props.oContext&&this.props.oContext.socket){const l=this.props.oContext.instance??"0",r=`${C}.${l}`;try{const s=await this.props.oContext.socket.sendTo(r,R,null);let p=[];Array.isArray(s)?p=s:s&&Array.isArray(s.result)&&(p=s.result);for(const n of p)a.push(n);if(p.length===0){const n=this.state.pagesRetryCount||0,o=3e3;console.log(`[UnlockPage] Got empty pages array, retrying in ${o}ms (attempt ${n+1})`),this.setState({pagesRetryCount:n+1}),this.pagesRetryTimeout&&clearTimeout(this.pagesRetryTimeout),this.pagesRetryTimeout=setTimeout(()=>{this.state.alive?this.loadPagesList():console.log("[UnlockPage] Adapter went offline, cancelling pages retry")},o);return}else p.length>0&&(console.log(`[UnlockPage] Successfully loaded ${p.length} pages after ${this.state.pagesRetryCount||0} retries`),this.setState({pagesRetryCount:0}),this.pagesRetryTimeout&&(clearTimeout(this.pagesRetryTimeout),this.pagesRetryTimeout=void 0))}catch(s){const p=this.state.pagesRetryCount||0,n=3e3;console.log(`[UnlockPage] Error loading pages, retrying in ${n}ms (attempt ${p+1}): ${String(s)}`),this.setState({pagesRetryCount:p+1}),this.pagesRetryTimeout&&clearTimeout(this.pagesRetryTimeout),this.pagesRetryTimeout=setTimeout(()=>{this.state.alive?this.loadPagesList():console.log("[UnlockPage] Adapter went offline, cancelling pages retry after error")},n);return}}else{console.log("[UnlockPage] No socket available for sendTo");return}this.setState({pagesList:Array.from(new Set(a))})}renderItem(a,l,r){var T;const s=this.state.entries||[],p=Array.from(new Set(s.map(h=>h.uniqueName))).filter(Boolean);this._local||(this._local={newName:"",selected:p[0]||"",showPin:!1});const n=this._local,o=()=>{const h=(n.newName||"").trim();if(!h)return;const c={card:"cardAlarm",uniqueName:h,headline:h,button1:"",button2:"",button3:"",button4:"",button5:"",button6:"",button7:"",button8:"",pin:0},m=[...s,c];this.setState({entries:m}),this.onChange(this.props.attr,m),n.newName="",n.selected=h},y=()=>{this.setState({confirmDeleteOpen:!1,confirmDeleteName:null})},b=()=>{const h=this.state.confirmDeleteName;if(!h){y();return}const c=s.filter(f=>f.uniqueName!==h);this.setState({entries:c,confirmDeleteOpen:!1,confirmDeleteName:null}),this.onChange(this.props.attr,c);const m=Array.from(new Set(c.map(f=>f.uniqueName))).filter(Boolean);n.selected=m[0]||"",this.setState({})};return e.jsxs(t.Box,{sx:{height:"calc(100vh - 64px)",display:"flex",flexDirection:{xs:"column",md:"row"},p:1},children:[e.jsxs(t.Box,{sx:{width:{xs:"100%",md:"20%"},pr:{xs:0,md:1},display:"flex",flexDirection:"column",gap:1},children:[e.jsx(t.Typography,{variant:"h6",sx:{mb:1,fontWeight:600,color:"primary.main",fontSize:"1rem"},children:this.getText("pages")}),e.jsx(t.Paper,{sx:{p:1,backgroundColor:"transparent"},elevation:0,children:e.jsxs(t.Box,{sx:{display:"flex",gap:1},children:[e.jsx(t.TextField,{"aria-label":"new-name",label:this.getText("new_page"),value:n.newName,onChange:h=>{n.newName=h.target.value,this.setState({})},variant:"standard",placeholder:this.getText("New item"),InputProps:{sx:{backgroundColor:"transparent",px:1}},sx:{flex:1,"& .MuiInput-underline:before":{borderBottomColor:"primary.main"},"& .MuiInput-underline:hover:before":{borderBottomColor:"primary.main"},"& .MuiInput-underline:after":{borderBottomColor:"primary.main"},"& .MuiInputLabel-root":{color:"primary.main"},"& .MuiInputLabel-root.Mui-focused":{color:"primary.main"}}}),e.jsx(t.Button,{size:"small",variant:"contained",onClick:o,disabled:(()=>{const h=(n.newName||"").trim();return!h||p.includes(h)})(),children:"+"})]})}),e.jsx(t.Paper,{sx:{overflow:"auto",p:1,backgroundColor:"transparent"},elevation:0,children:p.length===0?e.jsx(t.Typography,{variant:"body2",color:"text.secondary",children:this.getText("No items")}):p.map(h=>e.jsxs(t.Box,{onClick:()=>{n.selected=h,this.setState({})},sx:{p:1,borderRadius:1,cursor:"pointer",backgroundColor:n.selected===h?"action.selected":"transparent",mb:.5,display:"flex",justifyContent:"space-between",alignItems:"center","&:hover .delete-icon":{opacity:1}},children:[e.jsx(t.Typography,{variant:"body2",sx:{flex:1,overflow:"hidden",textOverflow:"ellipsis"},children:h}),e.jsx(t.IconButton,{className:"delete-icon",edge:"end","aria-label":"delete",size:"small",onClick:c=>{c.stopPropagation(),n.selected=h,this.setState({confirmDeleteOpen:!0,confirmDeleteName:h})},sx:{color:"error.main",opacity:{xs:1,md:0},transition:"opacity 0.2s"},children:e.jsx(L,{fontSize:"small"})})]},h))}),e.jsx(t.Divider,{sx:{my:1}}),e.jsx(t.Box,{sx:{mb:2},children:e.jsx("a",{href:"https://github.com/ticaki/ioBroker.nspanel-lovelace-ui/wiki/pageUnlock",target:"_blank",rel:"noopener noreferrer",style:{textDecoration:"none",color:"inherit",fontSize:"0.875rem"},children:e.jsx(t.Typography,{variant:"body2",sx:{color:"primary.main",textDecoration:"underline",cursor:"pointer","&:hover":{opacity:.8}},children:this.getText("documentation")})})})]}),e.jsx(B,{open:!!this.state.confirmDeleteOpen,onClose:y,onConfirm:b,title:this.getText("delete_confirm_title"),description:this.getText("delete_confirm_text")+(this.state.confirmDeleteName?`: ${this.state.confirmDeleteName}`:""),cancelText:this.getText("Cancel"),confirmText:this.getText("Delete"),ariaTitleId:"unlock-delete-confirm-title",ariaDescId:"unlock-delete-confirm-description"}),e.jsxs(t.Box,{sx:{width:{xs:"100%",md:"90%"},pl:{xs:0,md:2},mt:{xs:2,md:0},display:"flex",flexDirection:{xs:"column",md:"row"},gap:1,position:"relative"},children:[e.jsx(t.Box,{sx:{width:{xs:"100%",md:"95%"},borderLeft:{xs:"none",md:"1px solid"},borderColor:"divider"},children:e.jsx(t.Paper,{sx:{height:"100%",p:2},elevation:1,children:n.selected?e.jsx(t.Box,{children:(()=>{const h=n.selected,c=s.find(m=>m.uniqueName===h);return c?e.jsxs(e.Fragment,{children:[e.jsx(t.Box,{sx:{mb:1,p:1,borderRadius:1,backgroundColor:"action.hover"},children:e.jsx(t.TextField,{fullWidth:!0,variant:"standard",type:"text",label:this.getText("unique_label"),value:h,onChange:m=>{const f=m.target.value;if(!f.trim())return;const i=s.map(d=>d.uniqueName===h?{...d,uniqueName:f}:d);this.setState({entries:i}),this.onChange(this.props.attr,i),n.selected=f},InputProps:{sx:{backgroundColor:"transparent",px:1,fontWeight:600,width:"50%"}}})}),e.jsx(t.Box,{sx:{mb:1},children:e.jsxs(t.FormControl,{component:"fieldset",children:[e.jsx(t.Typography,{variant:"subtitle2",sx:{mb:1},children:this.getText("unlock_type")}),e.jsxs(t.RadioGroup,{row:!0,value:(c==null?void 0:c.alarmType)||"",onChange:(m,f)=>{const i=s.map(d=>d.uniqueName===h?{...d,alarmType:f}:d);this.setState({entries:i}),this.onChange(this.props.attr,i)},children:[e.jsx(t.FormControlLabel,{value:"alarm",control:e.jsx(t.Radio,{}),label:this.getText("unlock_alarm")}),e.jsx(t.FormControlLabel,{value:"unlock",control:e.jsx(t.Radio,{}),label:this.getText("unlock_unlock")})]})]})}),e.jsx(t.TextField,{fullWidth:!0,variant:"standard",type:"text",autoComplete:"off",label:this.getText("headline"),value:c.headline??"",onChange:m=>{const f=m.target.value,i=s.map(d=>d.uniqueName===h?{...d,headline:f}:d);this.setState({entries:i}),this.onChange(this.props.attr,i)},InputProps:{sx:{backgroundColor:"transparent",px:1,width:"50%"}},sx:{mb:2}}),e.jsx(t.Box,{sx:{mt:2},children:e.jsx(t.TextField,{variant:"standard",label:this.getText("unlock_pin"),type:n.showPin?"text":"password",value:c.pin!==void 0&&c.pin!==null?String(c.pin):"",onChange:m=>{const i=m.target.value.replace(/[^0-9]/g,""),d=i?parseInt(i,10):0,v=s.map(u=>u.uniqueName===h?{...u,pin:d}:u);this.setState({entries:v}),this.onChange(this.props.attr,v)},InputProps:{sx:{backgroundColor:"transparent",px:1},endAdornment:e.jsx(t.InputAdornment,{position:"end",children:e.jsx(t.IconButton,{"aria-label":n.showPin?"hide-pin":"show-pin",onClick:()=>{n.showPin=!n.showPin,this.setState({})},edge:"end",size:"small",children:n.showPin?e.jsx(O,{fontSize:"small"}):e.jsx(M,{fontSize:"small"})})})}})}),e.jsxs(t.Box,{sx:{mt:2},children:[e.jsx(t.FormControlLabel,{control:e.jsx(t.Checkbox,{checked:!!c.hidden,onChange:(m,f)=>{const i=s.map(d=>d.uniqueName===h?{...d,hidden:f}:d);this.setState({entries:i}),this.onChange(this.props.attr,i)}}),label:this.getText("hidden")}),e.jsx(t.Box,{sx:{mt:2},children:e.jsxs(t.FormControl,{component:"fieldset",children:[e.jsx(t.Typography,{variant:"subtitle2",sx:{mb:1},children:this.getText("alwaysOn")}),e.jsxs(t.RadioGroup,{row:!0,value:(c==null?void 0:c.alwaysOn)||"none",onChange:(m,f)=>{const i=s.map(d=>d.uniqueName===h?{...d,alwaysOn:f}:d);this.setState({entries:i}),this.onChange(this.props.attr,i)},children:[e.jsx(t.FormControlLabel,{value:"none",control:e.jsx(t.Radio,{}),label:this.getText("alwaysOn_none")}),e.jsx(t.FormControlLabel,{value:"always",control:e.jsx(t.Radio,{}),label:this.getText("alwaysOn_always")}),e.jsx(t.FormControlLabel,{value:"ignore",control:e.jsx(t.Radio,{}),label:this.getText("alwaysOn_ignore")})]})]})})]}),c.alarmType==="alarm"&&e.jsxs(t.Box,{sx:{mt:2},children:[e.jsxs(t.Box,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"1fr 1fr"},gap:2},children:[e.jsxs(t.Box,{children:[e.jsx(t.Typography,{variant:"subtitle2",sx:{mb:1},children:this.getText("unlock_armed_header")}),e.jsx(t.Box,{sx:{display:"grid",gap:2},children:[1,2,3,4].map(m=>{const f=`button${m}`,i=(m-1)%4+1;return e.jsxs(t.Box,{children:[e.jsx(t.Typography,{variant:"caption",color:"text.secondary",sx:{mb:.5},children:this.getText(`unlock_button${i}_label`)}),e.jsx(t.TextField,{fullWidth:!0,variant:"standard",placeholder:this.getText(`unlock_button${i}_placeholder`),value:c[f]??"",onChange:d=>{const v=d.target.value,u=s.map(g=>g.uniqueName===h?{...g,[f]:v}:g);this.setState({entries:u}),this.onChange(this.props.attr,u)},InputProps:{disableUnderline:!0,sx:{backgroundColor:"transparent",px:1,"& input::placeholder":{color:"text.disabled"}}}})]},m)})})]}),e.jsxs(t.Box,{children:[e.jsx(t.Typography,{variant:"subtitle2",sx:{mb:1},children:this.getText("unlock_disarmed_header")}),e.jsx(t.Box,{sx:{display:"grid",gap:2},children:[5,6,7,8].map(m=>{const f=`button${m}`,i=(m-1)%4+1;return e.jsxs(t.Box,{children:[e.jsx(t.Typography,{variant:"caption",color:"text.secondary",sx:{mb:.5},children:this.getText(`unlock_button${i}_label`)}),e.jsx(t.TextField,{fullWidth:!0,variant:"standard",placeholder:this.getText(`unlock_button${i}_placeholder`),value:c[f]??"",onChange:d=>{const v=d.target.value,u=s.map(g=>g.uniqueName===h?{...g,[f]:v}:g);this.setState({entries:u}),this.onChange(this.props.attr,u)},InputProps:{disableUnderline:!0,sx:{backgroundColor:"transparent",px:1,"& input::placeholder":{color:"text.disabled"}}}})]},m)})})]})]}),e.jsx(t.Box,{sx:{mt:1},children:e.jsx(t.FormControlLabel,{control:e.jsx(t.Checkbox,{checked:!!c.approved,onChange:(m,f)=>{const i=s.map(d=>d.uniqueName===h?{...d,approved:f}:d);this.setState({entries:i}),this.onChange(this.props.attr,i)}}),label:this.getText("unlock_approved")})})]}),c.alarmType==="unlock"&&e.jsxs(t.Box,{sx:{mt:2},children:[e.jsx(t.Typography,{variant:"caption",color:"text.secondary",sx:{mb:.5},children:this.getText("unlock_setnavi_hint")}),e.jsxs(t.Select,{variant:"standard",displayEmpty:!0,value:c.setNavi??"",onChange:m=>{const f=String(m.target.value),i=s.map(d=>d.uniqueName===h?{...d,setNavi:f}:d);this.setState({entries:i}),this.onChange(this.props.attr,i)},sx:{backgroundColor:"transparent",px:1,width:"60%"},children:[e.jsx(t.MenuItem,{value:"",children:e.jsx("em",{children:this.getText("unlock_setnavi_placeholder")})}),(this.state.pagesList||[]).filter(m=>typeof m=="string"&&!m.startsWith("///")&&m!==h).map(m=>e.jsx(t.MenuItem,{value:m,children:m},m)),c.setNavi&&c.setNavi!==h&&!(this.state.pagesList||[]).includes(c.setNavi)&&e.jsx(t.MenuItem,{value:c.setNavi,children:c.setNavi},`custom-${c.setNavi}`)]})]})]}):null})()}):e.jsxs(t.Box,{children:[e.jsx(t.Typography,{variant:"h6",children:this.getText("select_item")}),e.jsx(t.Box,{sx:{mt:2},children:e.jsx(t.Typography,{variant:"body2",color:"text.secondary",children:this.getText("select_description")})})]})})}),e.jsx(D,{...this.props,widthPercent:30,uniqueName:n.selected,currentAssignments:((T=s.find(h=>h.uniqueName===n.selected))==null?void 0:T.navigationAssignment)||[],oContext:this.props.oContext,onAssign:(h,c)=>{const m=s.map(f=>f.uniqueName===h?{...f,navigationAssignment:c}:f);this.setState({entries:m}),this.onChange(this.props.attr,m)}})]})]})}}const E=k(W);class z extends w.Component{schema;constructor(a){super(a),this.state={selectedObjectId:"",data:{testObjectId:""}};const l={type:"objectId",label:"Select an object",sm:12,md:12,lg:12,...this.props.objectIdConfig};this.schema={type:"panel",label:"Object Selector Test",items:{testObjectId:l}}}handleClose=()=>{this.props.onClose&&this.props.onClose()};handleSelect=()=>{this.props.onSelect&&this.state.data.testObjectId&&this.props.onSelect(this.state.data.testObjectId),this.handleClose()};handleChange=a=>{this.setState({data:a})};render(){const{open:a,socket:l,themeName:r,themeType:s,theme:p,adapterName:n,instance:o}=this.props;return e.jsxs(t.Dialog,{open:a,onClose:this.handleClose,maxWidth:"md",fullWidth:!0,"aria-labelledby":"object-selector-dialog-title",children:[e.jsx(t.DialogTitle,{id:"object-selector-dialog-title",children:j.I18n.t("Object Selector Test")}),e.jsx(t.DialogContent,{children:e.jsxs(t.Box,{sx:{py:2},children:[e.jsx(_.JsonConfigComponent,{socket:l,themeName:r,themeType:s,theme:p,adapterName:n||"nspanel-lovelace-ui",instance:o||0,schema:this.schema,data:this.state.data,onChange:this.handleChange,isFloatComma:!1,dateFormat:"DD.MM.YYYY",onError:()=>{}}),e.jsxs(t.Box,{sx:{mt:2,color:"text.secondary",fontSize:"0.875rem"},children:[j.I18n.t("Selected object"),": ",this.state.data.testObjectId||e.jsx("em",{children:"—"})]})]})}),e.jsxs(t.DialogActions,{children:[e.jsx(t.Button,{onClick:this.handleClose,color:"secondary",children:j.I18n.t("Cancel")}),e.jsx(t.Button,{onClick:this.handleSelect,color:"primary",variant:"contained",disabled:!this.state.data.testObjectId,children:j.I18n.t("Select")})]})]})}}class V extends _.ConfigGeneric{_local=null;pagesRetryTimeout;constructor(a){super(a);const l=_.ConfigGeneric.getValue(a.data,a.attr);this.state={...this.state,entries:Array.isArray(l)?l:[],confirmDeleteOpen:!1,confirmDeleteName:null,alive:!1,pagesRetryCount:0}}handleObjectIdSelectorOpen=()=>{this.setState({objectIdSelectorOpen:!0})};handleObjectIdSelectorClose=()=>{this.setState({objectIdSelectorOpen:!1})};handleObjectIdSelect=a=>{console.log("[QRPage] Selected file:",a)};componentWillUnmount(){this.pagesRetryTimeout&&clearTimeout(this.pagesRetryTimeout);const a=this.props.oContext.instance??"0";this.props.oContext.socket.unsubscribeState(`system.adapter.${C}.${a}.alive`,this.onAliveChanged)}async componentDidMount(){super.componentDidMount();const a=this.props.oContext.instance??"0",l=`system.adapter.${C}.${a}.alive`;try{const r=await this.props.oContext.socket.getState(l),s=!!(r!=null&&r.val);this.setState({alive:s}),await this.props.oContext.socket.subscribeState(l,this.onAliveChanged),s&&await this.loadPagesList()}catch(r){console.error("[QRPage] Failed to get alive state or subscribe:",r),this.setState({alive:!1})}}onAliveChanged=(a,l)=>{const r=this.state.alive,s=l?!!l.val:!1;r!==s&&(this.setState({alive:s}),!r&&s&&(!this.state.pagesList||this.state.pagesList.length===0)&&this.loadPagesList(),r&&!s&&this.pagesRetryTimeout&&(clearTimeout(this.pagesRetryTimeout),this.pagesRetryTimeout=void 0))};async loadPagesList(){if(!this.state.alive){console.log("[QRPage] Adapter not alive, skipping pages load");return}const a=[];if(this.props.oContext&&this.props.oContext.socket){const l=this.props.oContext.instance??"0",r=`${C}.${l}`;try{const s=await this.props.oContext.socket.sendTo(r,R,null);let p=[];Array.isArray(s)?p=s:s&&Array.isArray(s.result)&&(p=s.result);for(const n of p)a.push(n);if(p.length===0){const n=this.state.pagesRetryCount||0,o=3e3;console.log(`[QRPage] Got empty pages array, retrying in ${o}ms (attempt ${n+1})`),this.setState({pagesRetryCount:n+1}),this.pagesRetryTimeout&&clearTimeout(this.pagesRetryTimeout),this.pagesRetryTimeout=setTimeout(()=>{this.state.alive?this.loadPagesList():console.log("[QRPage] Adapter went offline, cancelling pages retry")},o);return}else p.length>0&&(console.log(`[QRPage] Successfully loaded ${p.length} pages after ${this.state.pagesRetryCount||0} retries`),this.setState({pagesRetryCount:0}),this.pagesRetryTimeout&&(clearTimeout(this.pagesRetryTimeout),this.pagesRetryTimeout=void 0))}catch(s){const p=this.state.pagesRetryCount||0,n=3e3;console.log(`[QRPage] Error loading pages, retrying in ${n}ms (attempt ${p+1}): ${String(s)}`),this.setState({pagesRetryCount:p+1}),this.pagesRetryTimeout&&clearTimeout(this.pagesRetryTimeout),this.pagesRetryTimeout=setTimeout(()=>{this.state.alive?this.loadPagesList():console.log("[QRPage] Adapter went offline, cancelling pages retry after error")},n);return}}else{console.log("[QRPage] No socket available for sendTo");return}this.setState({pagesList:Array.from(new Set(a))})}renderItem(a,l,r){var h,c,m,f;const s=this.state.entries||[],p=Array.from(new Set(s.map(i=>i.uniqueName))).filter(Boolean);this._local||(this._local={newName:"",selected:p[0]||"",showPassword:!1});const n=this._local,o=()=>{const i=(n.newName||"").trim();if(!i)return;const d={card:"cardQR",uniqueName:i,headline:i,SSIDURLTEL:"",wlanhidden:!1,pwdhidden:!1,setState:"",selType:0},v=[...s,d];this.setState({entries:v}),this.onChange(this.props.attr,v),n.newName="",n.selected=i},y=()=>{const i=n.selected;i&&this.setState({confirmDeleteOpen:!0,confirmDeleteName:i})},b=()=>{this.setState({confirmDeleteOpen:!1,confirmDeleteName:null})},T=()=>{const i=this.state.confirmDeleteName;if(!i){b();return}const d=s.filter(u=>u.uniqueName!==i);this.setState({entries:d,confirmDeleteOpen:!1,confirmDeleteName:null}),this.onChange(this.props.attr,d);const v=Array.from(new Set(d.map(u=>u.uniqueName))).filter(Boolean);n.selected=v[0]||"",this.setState({})};return e.jsxs(t.Box,{sx:{height:"calc(100vh - 64px)",display:"flex",flexDirection:{xs:"column",md:"row"},p:1},children:[e.jsxs(t.Box,{sx:{width:{xs:"100%",md:"20%"},pr:{xs:0,md:1},display:"flex",flexDirection:"column",gap:1},children:[e.jsx(t.Typography,{variant:"h6",sx:{mb:1,fontWeight:600,color:"primary.main",fontSize:"1rem"},children:this.getText("pages")}),e.jsx(t.Paper,{sx:{p:1,backgroundColor:"transparent"},elevation:0,children:e.jsxs(t.Box,{sx:{display:"flex",gap:1},children:[e.jsx(t.TextField,{"aria-label":"new-name",label:this.getText("new_page"),value:n.newName,onChange:i=>{n.newName=i.target.value,this.setState({})},variant:"standard",placeholder:this.getText("New item"),InputProps:{sx:{backgroundColor:"transparent",px:1}},sx:{flex:1,"& .MuiInput-underline:before":{borderBottomColor:"primary.main"},"& .MuiInput-underline:hover:before":{borderBottomColor:"primary.main"},"& .MuiInput-underline:after":{borderBottomColor:"primary.main"},"& .MuiInputLabel-root":{color:"primary.main"},"& .MuiInputLabel-root.Mui-focused":{color:"primary.main"}}}),e.jsx(t.Button,{size:"small",variant:"contained",onClick:o,disabled:(()=>{const i=(n.newName||"").trim();return!i||p.includes(i)})(),children:"+"})]})}),e.jsx(t.Paper,{sx:{overflow:"auto",p:1,backgroundColor:"transparent"},elevation:0,children:p.length===0?e.jsx(t.Typography,{variant:"body2",color:"text.secondary",children:this.getText("No items")}):p.map(i=>e.jsx(t.Box,{onClick:()=>{n.selected=i,this.setState({})},sx:{p:1,borderRadius:1,cursor:"pointer",backgroundColor:n.selected===i?"action.selected":"transparent",mb:.5},children:e.jsx(t.Typography,{variant:"body2",children:i})},i))}),e.jsx(t.Box,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(t.Button,{size:"small",color:"error",variant:"outlined",onClick:y,disabled:!n.selected,children:"-"})}),e.jsx(t.Divider,{sx:{my:1}}),e.jsx(t.Box,{sx:{mb:2},children:e.jsx("a",{href:"https://github.com/ticaki/ioBroker.nspanel-lovelace-ui/wiki/PageQR",target:"_blank",rel:"noopener noreferrer",style:{textDecoration:"none",color:"inherit",fontSize:"0.875rem"},children:e.jsx(t.Typography,{variant:"body2",sx:{color:"primary.main",textDecoration:"underline",cursor:"pointer","&:hover":{opacity:.8}},children:this.getText("documentation")})})})]}),e.jsx(B,{open:!!this.state.confirmDeleteOpen,onClose:b,onConfirm:T,title:this.getText("delete_confirm_title"),description:this.getText("delete_confirm_text")+(this.state.confirmDeleteName?`: ${this.state.confirmDeleteName}`:""),cancelText:this.getText("Cancel"),confirmText:this.getText("Delete"),ariaTitleId:"qr-delete-confirm-title",ariaDescId:"qr-delete-confirm-description"}),e.jsxs(t.Box,{sx:{width:{xs:"100%",md:"90%"},pl:{xs:0,md:2},mt:{xs:2,md:0},display:"flex",flexDirection:{xs:"column",md:"row"},gap:1,position:"relative"},children:[e.jsx(t.Box,{sx:{width:{xs:"100%",md:"95%"},borderLeft:{xs:"none",md:"1px solid"},borderColor:"divider"},children:e.jsx(t.Paper,{sx:{height:"100%",p:2},elevation:1,children:n.selected?e.jsx(t.Box,{children:(()=>{const i=n.selected,d=s.find(v=>v.uniqueName===i);return d?e.jsxs(e.Fragment,{children:[e.jsx(t.Box,{sx:{mb:1,p:1,borderRadius:1,backgroundColor:"action.hover"},children:e.jsx(t.TextField,{fullWidth:!0,variant:"standard",type:"text",label:this.getText("unique_label"),value:i,onChange:v=>{const u=v.target.value;if(!u.trim())return;const g=s.map(x=>x.uniqueName===i?{...x,uniqueName:u}:x);this.setState({entries:g}),this.onChange(this.props.attr,g),n.selected=u},InputProps:{sx:{backgroundColor:"transparent",px:1,fontWeight:600,width:"50%"}}})}),e.jsx(t.Box,{sx:{mb:2},children:e.jsxs(t.FormControl,{component:"fieldset",children:[e.jsx(t.FormLabel,{component:"legend",children:this.getText("qr_type")}),e.jsxs(t.RadioGroup,{row:!0,value:d.selType??0,onChange:v=>{const u=parseInt(v.target.value,10),g=s.map(x=>x.uniqueName===i?{...x,selType:u}:x);this.setState({entries:g}),this.onChange(this.props.attr,g)},children:[e.jsx(t.FormControlLabel,{value:1,control:e.jsx(t.Radio,{}),label:this.getText("qr_type_wifi")}),e.jsx(t.FormControlLabel,{value:2,control:e.jsx(t.Radio,{}),label:this.getText("qr_type_url")}),e.jsx(t.FormControlLabel,{value:3,control:e.jsx(t.Radio,{}),label:this.getText("qr_type_tel")})]})]})}),e.jsx(t.TextField,{fullWidth:!0,variant:"standard",type:"text",autoComplete:"off",label:this.getText("headline"),value:d.headline??"",onChange:v=>{const u=v.target.value,g=s.map(x=>x.uniqueName===i?{...x,headline:u}:x);this.setState({entries:g}),this.onChange(this.props.attr,g)},InputProps:{sx:{backgroundColor:"transparent",px:1,width:"50%"}},sx:{mb:2}}),e.jsx(t.TextField,{fullWidth:!0,variant:"standard",type:"text",autoComplete:"off",label:(()=>{switch(d.selType){case 1:return this.getText("qr_content_wifi");case 2:return this.getText("qr_content_url");case 3:return this.getText("qr_content_tel");default:return this.getText("qr_content")}})(),value:d.SSIDURLTEL??"",onChange:v=>{const u=v.target.value,g=s.map(x=>x.uniqueName===i?{...x,SSIDURLTEL:u}:x);this.setState({entries:g}),this.onChange(this.props.attr,g)},InputProps:{sx:{backgroundColor:"transparent",px:1}},sx:{mb:2}}),d.selType===1&&e.jsxs(t.Box,{sx:{mb:2},children:[e.jsxs(t.FormControl,{variant:"standard",sx:{mb:2,minWidth:120},children:[e.jsx(t.InputLabel,{children:this.getText("qr_wlan_type")}),e.jsxs(t.Select,{value:d.wlantype??"WPA2",onChange:v=>{const u=v.target.value,g=s.map(x=>x.uniqueName===i?{...x,wlantype:u}:x);this.setState({entries:g}),this.onChange(this.props.attr,g)},children:[e.jsx(t.MenuItem,{value:"nopass",children:"No Password"}),e.jsx(t.MenuItem,{value:"WPA",children:"WPA"}),e.jsx(t.MenuItem,{value:"WPA2",children:"WPA2"}),e.jsx(t.MenuItem,{value:"WPA3",children:"WPA3"}),e.jsx(t.MenuItem,{value:"WEP",children:"WEP"})]})]}),d.wlantype!=="nopass"&&e.jsx(t.TextField,{fullWidth:!0,variant:"standard",type:n.showPassword?"text":"password",label:this.getText("qr_password"),value:d.qrPass??"",onChange:v=>{const u=v.target.value,g=s.map(x=>x.uniqueName===i?{...x,qrPass:u}:x);this.setState({entries:g}),this.onChange(this.props.attr,g)},InputProps:{sx:{backgroundColor:"transparent",px:1},endAdornment:e.jsx(t.InputAdornment,{position:"end",children:e.jsx(t.IconButton,{"aria-label":"toggle password visibility",onClick:()=>{n.showPassword=!n.showPassword,this.setState({})},edge:"end",children:n.showPassword?e.jsx(I.VisibilityOff,{}):e.jsx(I.Visibility,{})})})},sx:{mb:2}}),e.jsxs(t.Box,{sx:{display:"flex",gap:2},children:[e.jsx(t.FormControlLabel,{control:e.jsx(t.Checkbox,{checked:!!d.wlanhidden,onChange:(v,u)=>{const g=s.map(x=>x.uniqueName===i?{...x,wlanhidden:u}:x);this.setState({entries:g}),this.onChange(this.props.attr,g)}}),label:this.getText("qr_wlan_hidden")}),e.jsx(t.FormControlLabel,{control:e.jsx(t.Checkbox,{checked:!!d.pwdhidden,onChange:(v,u)=>{const g=s.map(x=>x.uniqueName===i?{...x,pwdhidden:u}:x);this.setState({entries:g}),this.onChange(this.props.attr,g)}}),label:this.getText("qr_pwd_hidden")})]}),e.jsx(t.TextField,{fullWidth:!0,variant:"standard",type:"text",autoComplete:"off",label:this.getText("qr_set_state"),value:d.setState??"",onChange:v=>{const u=v.target.value,g=s.map(x=>x.uniqueName===i?{...x,setState:u}:x);this.setState({entries:g}),this.onChange(this.props.attr,g)},InputProps:{sx:{backgroundColor:"transparent",px:1}},sx:{mb:2}}),e.jsx(t.Button,{variant:"outlined",color:"primary",size:"small",fullWidth:!0,onClick:this.handleObjectIdSelectorOpen,children:"Test ObjectIdSelector"})]}),e.jsxs(t.Box,{sx:{mt:2},children:[e.jsx(t.FormControlLabel,{control:e.jsx(t.Checkbox,{checked:!!d.hidden,onChange:(v,u)=>{const g=s.map(x=>x.uniqueName===i?{...x,hidden:u}:x);this.setState({entries:g}),this.onChange(this.props.attr,g)}}),label:this.getText("hidden")}),e.jsx(t.Box,{sx:{mt:2},children:e.jsxs(t.FormControl,{component:"fieldset",children:[e.jsx(t.Typography,{variant:"subtitle2",sx:{mb:1},children:this.getText("alwaysOn")}),e.jsxs(t.RadioGroup,{row:!0,value:(d==null?void 0:d.alwaysOn)||"none",onChange:(v,u)=>{const g=s.map(x=>x.uniqueName===i?{...x,alwaysOn:u}:x);this.setState({entries:g}),this.onChange(this.props.attr,g)},children:[e.jsx(t.FormControlLabel,{value:"none",control:e.jsx(t.Radio,{}),label:this.getText("alwaysOn_none")}),e.jsx(t.FormControlLabel,{value:"always",control:e.jsx(t.Radio,{}),label:this.getText("alwaysOn_always")}),e.jsx(t.FormControlLabel,{value:"ignore",control:e.jsx(t.Radio,{}),label:this.getText("alwaysOn_ignore")})]})]})})]})]}):null})()}):e.jsxs(t.Box,{children:[e.jsx(t.Typography,{variant:"h6",children:this.getText("select_item")}),e.jsx(t.Box,{sx:{mt:2},children:e.jsx(t.Typography,{variant:"body2",color:"text.secondary",children:this.getText("select_description")})})]})})}),e.jsx(D,{...this.props,widthPercent:30,uniqueName:n.selected,currentAssignments:((h=s.find(i=>i.uniqueName===n.selected))==null?void 0:h.navigationAssignment)||[],oContext:this.props.oContext,onAssign:(i,d)=>{const v=s.map(u=>u.uniqueName===i?{...u,navigationAssignment:d}:u);this.setState({entries:v}),this.onChange(this.props.attr,v)}})]}),e.jsx(z,{open:!!this.state.objectIdSelectorOpen,onClose:this.handleObjectIdSelectorClose,onSelect:this.handleObjectIdSelect,socket:this.props.oContext.socket,themeName:this.props.themeName,themeType:((m=(c=this.props.theme)==null?void 0:c.palette)==null?void 0:m.mode)||"light",theme:this.props.theme,adapterName:"nspanel-lovelace-ui",instance:((f=this.props.oContext)==null?void 0:f.instance)||0,objectIdConfig:{types:"state",filterFunc:i=>!!((i==null?void 0:i.type)==="state"&&i.common.role&&i.common.role.startsWith("switch"))}})]})}}const U=k(V),re={NavigationView:$,IconSelect:F,IconOverview:q,UnlockPage:E,pageQR:U};export{re as default};
