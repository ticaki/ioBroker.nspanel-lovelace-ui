import{A as M,b as P,c as k,S as G,C as z,w as H,d as Y,a as Z,I as ee,W as te}from"./NavigationView-D17UN1gC.js";import{j as e}from"./createSvgIcon-Debf11BA.js";import{A as t}from"./AdminComponentEasyAccessSet__loadShare___mf_0_mui_mf_1_material__loadShare__-EKOPJIKX.js";import{R as D}from"./AdminComponentEasyAccessSet__loadShare__react__loadShare__-CJmceRyn.js";import{N as se,S as ae,E as ie,D as Q,V as ne,a as oe}from"./VisibilityOff-Dem2oC7P.js";import{g as re}from"./_commonjsHelpers-CE1G-McA.js";import{_ as le,A as E}from"./_baseIsEqual-Bi-xzJRY.js";import{A as v}from"./AdminComponentEasyAccessSet__loadShare___mf_0_iobroker_mf_1_adapter_mf_2_react_mf_2_v5__loadShare__-CmYJ37BE.js";import{T as J}from"./Tooltip-BHlkKxQm.js";import"./index-BTwTI1Tk.js";import"./AdminComponentEasyAccessSet__mf_v__runtimeInit__mf_v__-9o5tLcPN.js";import"./useTheme-zLszLRzm.js";import"./Clear-CZb6d-di.js";import"./useTheme-Y4z6S2UP.js";import"./defaultTheme-B6DpRwGi.js";import"./Grow-DnKMqB40.js";var de=le;function he(N,s){return de(N,s)}var ce=he;const pe=re(ce);class K extends M.ConfigGeneric{static defaultProps={widthPercent:30};constructor(s){super(s),this.state={...this.state,available:[],selectedTopic:"",added:[],assignments:s.currentAssignments||[],pagesMap:{},alive:!1,isCollapsed:!s.uniqueName,isLoading:{},lastLoadTime:{},focusReceived:{},retryCount:{},activeTab:0}}componentWillUnmount(){if(this.props.oContext&&this.props.oContext.socket){const s=this.props.oContext.instance??"0";this.props.oContext.socket.unsubscribeState(`system.adapter.${P}.${s}.alive`,this.onAliveChanged)}}async componentDidMount(){if(super.componentDidMount(),this.props.oContext&&this.props.oContext.socket){const s=this.props.oContext.instance??"0",n=`system.adapter.${P}.${s}.alive`;try{const i=await this.props.oContext.socket.getState(n),a=!!(i!=null&&i.val);this.setState({alive:a}),await this.props.oContext.socket.subscribeState(n,this.onAliveChanged)}catch(i){console.error("[NavigationAssignmentPanel] Failed to get alive state or subscribe:",i),this.setState({alive:!1})}}await this.loadPanels(!1),await this.applyAssignmentsFromProps(this.props.currentAssignments||[])}onAliveChanged=(s,n)=>{const i=this.state.alive,a=n?!!n.val:!1;i!==a&&(this.setState({alive:a}),!i&&a&&this.state.assignments.length>0&&this.retryLoadingPagesForAssignments())};async applyAssignmentsFromProps(s){var c;const n=(s||[]).map(m=>this.state.available.find(d=>d.panelTopic===m.topic)||{panelTopic:m.topic,friendlyName:m.topic}).sort((m,l)=>m.friendlyName.localeCompare(l.friendlyName));console.log(`[NavigationAssignmentPanel] applyAssignmentsFromProps: available=${JSON.stringify(this.state.available)}, added=${JSON.stringify(n)}`);const i=this.state.selectedAddedTopic,o=n.find(m=>m.panelTopic===i)?i:(c=n[0])==null?void 0:c.panelTopic;this.setState({assignments:s,added:n,selectedAddedTopic:o,selectedTopic:""});const r=n.map(m=>this.loadPagesForPanel(m.panelTopic,!0));await Promise.all(r)}componentDidUpdate(s){if(s.uniqueName!==this.props.uniqueName){const n=this.props.currentAssignments||[];this.props.uniqueName?this.setState(i=>({focusReceived:{...i.focusReceived,[this.props.uniqueName]:!0},isCollapsed:!1})):this.setState({isCollapsed:!0}),this.loadPanels(!1).then(()=>{this.applyAssignmentsFromProps(n)})}else if(this.props.currentAssignments&&!pe(s.currentAssignments||{},this.props.currentAssignments||{})){const n=this.props.currentAssignments||[];this.applyAssignmentsFromProps(n)}}async loadPanels(s=!0){var n;try{let i=[];this.props.fetchPanels?i=await this.props.fetchPanels():(n=this.props.data)!=null&&n.panels&&(i=(this.props.data.panels||[]).map(a=>({panelTopic:a.topic,friendlyName:a.name||a.topic}))),await new Promise(a=>this.setState({available:i,selectedTopic:""},()=>a()))}catch{this.setState({available:[],selectedTopic:""})}}doAddSelected=()=>{const{selectedTopic:s,available:n,added:i}=this.state;if(!s)return;let a=n.find(c=>c.panelTopic===s);if(!a&&s===k&&(a={panelTopic:k,friendlyName:`(${v.I18n.t("all")||"All"})`}),!a||i.find(c=>c.panelTopic===a.panelTopic))return;const o=[...i,a],r=[...this.state.assignments,{topic:a.panelTopic}];this.setState({added:o,assignments:r,selectedTopic:""}),this.loadPagesForPanel(a.panelTopic),this.props.onAssign&&this.props.uniqueName&&this.props.onAssign(this.props.uniqueName,r)};doRemoveSelected=()=>{const{added:s,selectedAddedTopic:n}=this.state;if(s.length)if(n){const i=s.filter(c=>c.panelTopic!==n),a=this.state.assignments.filter(c=>c.topic!==n),o=s.findIndex(c=>c.panelTopic===n);let r;if(i.length>0){const c=i[o]??i[o-1]??i[0];r=c==null?void 0:c.panelTopic}else r=void 0;this.setState({added:i,assignments:a,selectedAddedTopic:r}),this.props.onAssign&&this.props.uniqueName&&this.props.onAssign(this.props.uniqueName,a)}else{const i=s.slice(0,-1),a=this.state.assignments.slice(0,-1),o=i.length?i[i.length-1].panelTopic:void 0;this.setState({added:i,assignments:a,selectedAddedTopic:o}),this.props.onAssign&&this.props.uniqueName&&this.props.onAssign(this.props.uniqueName,a)}};selectAdded=s=>{this.setState({selectedAddedTopic:s}),this.loadPagesForPanel(s,!0)};retryLoadingPagesForAssignments(){const s=this.state.assignments.map(n=>n.topic);for(const n of s)this.loadPagesForPanel(n,!0)}async loadPagesForPanel(s,n=!1){var m,l;if(!s)return;if(!this.state.alive){console.log(`[NavigationAssignmentPanel] Adapter not alive, skipping pages load for ${s}`);return}const i=Date.now(),a=this.state.lastLoadTime[s]||0,o=this.state.isLoading[s],r=!!this.state.pagesMap[s],c=n||!r||i-a>6e4;if(!(o||!c&&r)){this.setState(d=>({isLoading:{...d.isLoading,[s]:!0},lastLoadTime:{...d.lastLoadTime,[s]:i}}));try{let d=[],p=!1;if((m=this.props.oContext)!=null&&m.socket){const f=this.props.oContext.instance??"0",g=`${P}.${f}`,S={panelTopic:s};try{const w=new Promise(($,L)=>{setTimeout(()=>L(new Error("sendTo timeout after 2 seconds")),2e3)}),R=this.props.oContext.socket.sendTo(g,G,S),I=await Promise.race([R,w]);Array.isArray(I)?(d=I,p=!0):I&&Array.isArray(I.result)&&(d=I.result,p=!0),console.log("[NavigationAssignmentPanel] sendTo successful",{topic:s,pages:d})}catch(w){console.warn("[NavigationAssignmentPanel] sendTo failed or timed out",{target:g,cmd:G,payload:S,error:w})}}if(p&&d.length===0){const f=this.state.retryCount[s]||0,g=3,S=2e3;if(f<g){console.log(`[NavigationAssignmentPanel] Got empty array for ${s}, retrying in ${S}ms (attempt ${f+1}/${g})`),this.setState(w=>({retryCount:{...w.retryCount,[s]:f+1}})),setTimeout(()=>{this.setState(w=>({isLoading:{...w.isLoading,[s]:!1}})),this.loadPagesForPanel(s,!0)},S);return}console.log(`[NavigationAssignmentPanel] Max retries reached for ${s}, accepting empty result`),this.setState(w=>({retryCount:{...w.retryCount,[s]:0}}))}else p&&d.length>0&&this.setState(f=>({retryCount:{...f.retryCount,[s]:0}}));if(!p&&!((l=this.props.oContext)!=null&&l.socket)&&(await new Promise(f=>setTimeout(f,1e3)),this.setState(f=>({isLoading:{...f.isLoading,[s]:!1}})),!this.state.focusReceived[s]))return this.setState(f=>({focusReceived:{...f.focusReceived,[s]:!0}})),this.loadPagesForPanel(s,!0);const _=this.state.pagesMap?this.state.pagesMap[s]:void 0,T=!!(this.state.isLoading&&this.state.isLoading[s]);(!(Array.isArray(_)&&_.length===d.length&&_.every((f,g)=>f===d[g]))||T!==!1)&&this.setState(f=>({pagesMap:{...f.pagesMap,[s]:d},isLoading:{...f.isLoading,[s]:!1}}))}catch(d){console.error("[NavigationAssignmentPanel] loadPagesForPanel error",{topic:s,error:d}),this.setState(p=>({isLoading:{...p.isLoading,[s]:!1}}))}}}setNavigationForSelected=s=>{const{selectedAddedTopic:n,assignments:i}=this.state;if(!n)return;const a=i.findIndex(m=>m.topic===n),o=[...i],r=i[a],c={topic:n,navigation:{...r==null?void 0:r.navigation,...s}};a>=0?o[a]=c:o.push(c),this.setState({assignments:o}),this.props.onAssign&&this.props.uniqueName&&this.props.onAssign(this.props.uniqueName,o)};getNavValue=(s,n)=>{var o;if(!s)return"";const i=this.state.assignments.find(r=>r.topic===s);return((o=i==null?void 0:i.navigation)==null?void 0:o[n])||""};togglePanel=()=>{const s=this.state.isCollapsed;this.setState(n=>({isCollapsed:!n.isCollapsed})),s&&this.applyAssignmentsFromProps(this.props.currentAssignments||[])};handleTabChange=(s,n)=>{this.setState({activeTab:n})};handleCommonFieldChange(s,n){this.props.onCommonFieldsChange&&this.props.onCommonFieldsChange({[s]:n})}renderCommonFields(){const{commonFields:s}=this.props;return s?e.jsxs(t.Box,{sx:{mt:2,pt:2,borderTop:"1px solid",borderColor:"divider"},children:[e.jsx(t.Box,{sx:{mb:2},children:e.jsx(t.FormControlLabel,{control:e.jsx(t.Checkbox,{checked:!!s.hidden,onChange:(n,i)=>{this.handleCommonFieldChange("hidden",i)}}),label:v.I18n.t("hidden")})}),e.jsx(t.Box,{sx:{mt:2},children:e.jsxs(t.FormControl,{component:"fieldset",children:[e.jsx(t.Typography,{variant:"subtitle2",sx:{mb:1},children:v.I18n.t("alwaysOn")}),e.jsxs(t.RadioGroup,{row:!0,value:s.alwaysOn||"none",onChange:(n,i)=>{this.handleCommonFieldChange("alwaysOn",i)},children:[e.jsx(t.FormControlLabel,{value:"none",control:e.jsx(t.Radio,{}),label:v.I18n.t("alwaysOn_none")}),e.jsx(t.FormControlLabel,{value:"always",control:e.jsx(t.Radio,{}),label:v.I18n.t("alwaysOn_always")}),e.jsx(t.FormControlLabel,{value:"ignore",control:e.jsx(t.Radio,{}),label:v.I18n.t("alwaysOn_ignore")})]})]})})]}):e.jsx(t.Box,{sx:{mt:2},children:e.jsx(t.Typography,{variant:"body2",color:"text.secondary",children:this.getText("select_description")})})}renderItem(s,n,i){const{widthPercent:a}=this.props,{isCollapsed:o,activeTab:r}=this.state,c=this.state.selectedAddedTopic?this.state.pagesMap[this.state.selectedAddedTopic]??[]:[],m=o||!this.props.uniqueName;return e.jsxs(t.Box,{sx:{position:{xs:"static",md:"absolute"},right:{xs:"auto",md:0},top:{xs:"auto",md:0},height:{xs:"auto",md:"100%"},width:{xs:"100%",md:m?"10px":`${a}%`},minHeight:{xs:m?"50px":"auto",md:"auto"},transition:"width 240ms ease, min-height 240ms ease",backgroundColor:"background.default",border:{xs:"2px solid",md:"none"},borderLeft:{xs:"none",md:"2px solid"},borderTop:{xs:"none",md:"2px solid"},borderColor:"secondary.main",borderRadius:{xs:1,md:0},overflow:{xs:"hidden",md:"visible"},display:"flex",flexDirection:"column",zIndex:20,mt:{xs:2,md:0}},children:[e.jsx(t.Box,{sx:{display:{xs:"none",md:"flex"},position:"absolute",left:"-20px",top:"50%",transform:"translateY(-50%)",width:"20px",height:"60px",backgroundColor:"secondary.main",borderRadius:"4px 0 0 4px",alignItems:"center",justifyContent:"center",cursor:this.props.uniqueName?"pointer":"not-allowed",opacity:this.props.uniqueName?1:.5,zIndex:21,"&:hover":{backgroundColor:"secondary.dark"}},onClick:()=>{this.props.uniqueName&&this.togglePanel()},children:e.jsx(t.Typography,{sx:{color:"secondary.contrastText",fontSize:"14px",fontWeight:"bold",transform:"rotate(-90deg)",whiteSpace:"nowrap"},children:m?"â¶":"â·"})}),e.jsx(t.Box,{sx:{display:{xs:"flex",md:"none"},alignItems:"center",justifyContent:"center",p:1,backgroundColor:"secondary.main",color:"secondary.contrastText",borderRadius:"4px 4px 0 0"},children:e.jsx(t.Typography,{variant:"subtitle2",sx:{fontWeight:600},children:v.I18n.t("navigation_panel")})}),e.jsxs(t.Box,{sx:{p:1,height:"100%",display:{xs:"flex",md:m?"none":"flex"},flexDirection:"column",width:{xs:"100%",md:m?"0%":"100%"},overflow:"hidden",transition:{xs:"none",md:"width 240ms ease"}},children:[e.jsx(t.Typography,{variant:"h6",sx:{mb:1,fontWeight:600,color:"primary.main",fontSize:"1rem",display:{xs:"none",md:"block"}},children:v.I18n.t("navigation_panel")}),e.jsxs(t.Tabs,{value:r??0,onChange:this.handleTabChange,variant:"scrollable",scrollButtons:!1,sx:{mb:1,minHeight:{xs:36,md:48},"& .MuiTab-root":{minHeight:{xs:36,md:48},py:{xs:.5,md:1.5},fontSize:{xs:"0.75rem",md:"0.875rem"}}},"aria-label":"Navigation assignment tabs",children:[e.jsx(t.Tab,{icon:e.jsx(se,{sx:{fontSize:{xs:18,md:20}}}),iconPosition:"start",label:e.jsxs(e.Fragment,{children:[e.jsx(t.Box,{component:"span",sx:{display:{xs:"inline",md:"none"}},children:v.I18n.t("nav")||"Nav"}),e.jsx(t.Box,{component:"span",sx:{display:{xs:"none",md:"inline"}},children:v.I18n.t("navigation")||"Navigation"})]}),sx:{minWidth:{xs:"auto",md:90},px:{xs:1,md:2}}}),e.jsx(t.Tab,{icon:e.jsx(ae,{sx:{fontSize:{xs:18,md:20}}}),iconPosition:"start",label:e.jsxs(e.Fragment,{children:[e.jsx(t.Box,{component:"span",sx:{display:{xs:"inline",md:"none"}},children:v.I18n.t("details")||"Details"}),e.jsx(t.Box,{component:"span",sx:{display:{xs:"none",md:"inline"}},children:v.I18n.t("pagedetails")||"Page Details"})]}),sx:{minWidth:{xs:"auto",md:90},px:{xs:1,md:2}}}),e.jsx(t.Tab,{icon:e.jsx(ie,{sx:{fontSize:{xs:18,md:20}}}),iconPosition:"start",label:e.jsxs(e.Fragment,{children:[e.jsx(t.Box,{component:"span",sx:{display:{xs:"inline",md:"none"}},children:v.I18n.t("free")||"Free"}),e.jsx(t.Box,{component:"span",sx:{display:{xs:"none",md:"inline"}},children:v.I18n.t("placeholder")||"Placeholder"})]}),sx:{minWidth:{xs:"auto",md:90},px:{xs:1,md:2}}})]}),r===0&&e.jsxs(e.Fragment,{children:[e.jsxs(t.Box,{sx:{display:"flex",gap:1,alignItems:"center",mb:1},children:[e.jsxs(t.Select,{size:"small",variant:"standard",value:this.state.selectedTopic,onOpen:()=>{this.loadPanels()},onChange:l=>this.setState({selectedTopic:String(l.target.value)}),disabled:!this.state.alive,sx:{flex:1,backgroundColor:"transparent",minHeight:40,"& .MuiSelect-select":{backgroundColor:"transparent",display:"flex",alignItems:"center",height:40}},displayEmpty:!0,children:[e.jsx(t.MenuItem,{value:"",children:e.jsx("em",{children:"â€”"})}),!this.state.added.some(l=>l.panelTopic===k)&&e.jsx(t.MenuItem,{value:k,children:`(${v.I18n.t("all")||"All"})`}),this.state.available.filter(l=>!this.state.added.some(d=>d.panelTopic===l.panelTopic)).map(l=>e.jsx(t.MenuItem,{value:l.panelTopic,children:l.friendlyName},l.panelTopic))]}),e.jsx(t.Button,{size:"small",variant:"contained",sx:{minWidth:32,padding:"4px 8px"},onClick:this.doAddSelected,disabled:!this.state.selectedTopic||!this.state.alive,children:"+"})]}),e.jsx(t.Box,{children:this.state.added.length===0?e.jsx(t.Typography,{variant:"body1",color:"text.secondary",children:v.I18n.t("No panels added")}):e.jsx("div",{style:{overflow:"auto"},children:e.jsx(t.List,{dense:!0,children:this.state.added.map(l=>{const d=l.panelTopic,p=this.state.pendingDelete===d;return e.jsx(D.Fragment,{children:e.jsx(t.ListItem,{component:"div",disablePadding:!0,sx:{"&:hover .delete-icon":{opacity:1}},secondaryAction:e.jsx(t.IconButton,{className:"delete-icon",edge:"end","aria-label":"delete",size:"small",onClick:_=>{var T;if(_.stopPropagation(),!p)this.setState({pendingDelete:d}),setTimeout(()=>{this.state.pendingDelete===d&&this.setState({pendingDelete:void 0})},3e3);else{const F=this.state.added.filter(S=>S.panelTopic!==d),f=this.state.assignments.filter(S=>S.topic!==d),g=F.length>0?(T=F[0])==null?void 0:T.panelTopic:void 0;this.setState({added:F,assignments:f,selectedAddedTopic:g,pendingDelete:void 0}),this.props.onAssign&&this.props.uniqueName&&this.props.onAssign(this.props.uniqueName,f)}},sx:{color:p?"error.dark":"error.main",opacity:{xs:1,md:0},transition:"opacity 0.2s",backgroundColor:p?"error.main":"transparent","&:hover":{backgroundColor:p?"error.dark":"action.hover"}},children:e.jsx(Q,{fontSize:"small"})}),children:e.jsx(t.ListItemButton,{selected:this.state.selectedAddedTopic===d,onClick:()=>{this.selectAdded(d),this.setState({pendingDelete:void 0})},sx:{pr:6},children:e.jsx(t.ListItemText,{primary:d===k?`(${v.I18n.t("all")||"All"})`:l.friendlyName,slotProps:{primary:{sx:{fontSize:"1.05rem",lineHeight:1.2}}},sx:{flex:1,overflow:"hidden",textOverflow:"ellipsis"}})})})},d)})})})}),e.jsx(t.Divider,{sx:{my:1}}),!this.props.hideNavigationFields&&e.jsxs(t.Box,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:1,mt:1},children:[e.jsxs(t.Box,{children:[e.jsx(t.Box,{sx:{display:"flex",alignItems:"center",mb:.5},children:e.jsx(J,{title:v.I18n.t("nav_prev_tooltip"),children:e.jsx(t.Typography,{variant:"caption",color:"text.secondary",sx:{mr:.5},children:"prev"})})}),e.jsxs(t.Select,{size:"small",displayEmpty:!0,"aria-label":"prev",value:this.getNavValue(this.state.selectedAddedTopic,"prev")||"",onOpen:()=>{this.state.selectedAddedTopic&&this.loadPagesForPanel(this.state.selectedAddedTopic,!0)},onChange:l=>this.setNavigationForSelected({prev:String(l.target.value)||void 0}),sx:{width:"100%"},disabled:!this.state.alive||this.state.selectedAddedTopic&&this.state.isLoading[this.state.selectedAddedTopic]||!1,endAdornment:this.state.selectedAddedTopic&&this.state.isLoading[this.state.selectedAddedTopic]?e.jsx(t.Box,{sx:{display:"flex",alignItems:"center",pr:1},children:e.jsx(t.CircularProgress,{size:16})}):null,children:[e.jsx(t.MenuItem,{value:"",children:this.state.selectedAddedTopic?e.jsx("em",{children:"â€”"}):e.jsx("em",{children:v.I18n.t("select_panel_first")})}),c.filter(l=>l!==this.props.uniqueName).map(l=>e.jsx(t.MenuItem,{value:l,children:l},`prev-${l}`))]})]}),e.jsxs(t.Box,{children:[e.jsx(t.Box,{sx:{display:"flex",alignItems:"center",mb:.5},children:e.jsx(J,{title:v.I18n.t("nav_next_tooltip"),children:e.jsx(t.Typography,{variant:"caption",color:"text.secondary",sx:{mr:.5},children:"next"})})}),e.jsxs(t.Select,{size:"small",displayEmpty:!0,"aria-label":"next",value:this.getNavValue(this.state.selectedAddedTopic,"next")||"",onOpen:()=>{this.state.selectedAddedTopic&&this.loadPagesForPanel(this.state.selectedAddedTopic,!0)},onChange:l=>this.setNavigationForSelected({next:String(l.target.value)||void 0}),sx:{width:"100%"},disabled:!this.state.alive||this.state.selectedAddedTopic&&this.state.isLoading[this.state.selectedAddedTopic]||!1,endAdornment:this.state.selectedAddedTopic&&this.state.isLoading[this.state.selectedAddedTopic]?e.jsx(t.Box,{sx:{display:"flex",alignItems:"center",pr:1},children:e.jsx(t.CircularProgress,{size:16})}):null,children:[e.jsx(t.MenuItem,{value:"",children:this.state.selectedAddedTopic?e.jsx("em",{children:"â€”"}):e.jsx("em",{children:v.I18n.t("select_panel_first")})}),c.filter(l=>l!==this.props.uniqueName&&!l.startsWith("///")).map(l=>e.jsx(t.MenuItem,{value:l,children:l},`next-${l}`))]})]}),e.jsxs(t.Box,{children:[e.jsx(t.Typography,{variant:"caption",color:"text.secondary",sx:{mb:.5,display:"block"},children:"home"}),e.jsxs(t.Select,{size:"small",displayEmpty:!0,"aria-label":"home",value:this.getNavValue(this.state.selectedAddedTopic,"home")||"",onOpen:()=>{this.state.selectedAddedTopic&&this.loadPagesForPanel(this.state.selectedAddedTopic,!0)},onChange:l=>this.setNavigationForSelected({home:String(l.target.value)||void 0}),sx:{width:"100%"},disabled:!this.state.alive||this.state.selectedAddedTopic&&this.state.isLoading[this.state.selectedAddedTopic]||!1,endAdornment:this.state.selectedAddedTopic&&this.state.isLoading[this.state.selectedAddedTopic]?e.jsx(t.Box,{sx:{display:"flex",alignItems:"center",pr:1},children:e.jsx(t.CircularProgress,{size:16})}):null,children:[e.jsx(t.MenuItem,{value:"",children:e.jsx("em",{children:"â€”"})}),c.filter(l=>l!==this.props.uniqueName).map(l=>e.jsx(t.MenuItem,{value:l,children:l},`home-${l}`))]})]}),e.jsxs(t.Box,{children:[e.jsx(t.Typography,{variant:"caption",color:"text.secondary",sx:{mb:.5,display:"block"},children:"parent"}),e.jsxs(t.Select,{size:"small",displayEmpty:!0,"aria-label":"parent",value:this.getNavValue(this.state.selectedAddedTopic,"parent")||"",onOpen:()=>{this.state.selectedAddedTopic&&this.loadPagesForPanel(this.state.selectedAddedTopic,!0)},onChange:l=>this.setNavigationForSelected({parent:String(l.target.value)||void 0}),sx:{width:"100%"},disabled:!this.state.alive||this.state.selectedAddedTopic&&this.state.isLoading[this.state.selectedAddedTopic]||!1,endAdornment:this.state.selectedAddedTopic&&this.state.isLoading[this.state.selectedAddedTopic]?e.jsx(t.Box,{sx:{display:"flex",alignItems:"center",pr:1},children:e.jsx(t.CircularProgress,{size:16})}):null,children:[e.jsx(t.MenuItem,{value:"",children:e.jsx("em",{children:"â€”"})}),c.filter(l=>l!==this.props.uniqueName).map(l=>e.jsx(t.MenuItem,{value:l,children:l},`parent-${l}`))]})]}),e.jsx(t.Divider,{sx:{my:1}})]}),this.state.added.length>0?this.state.added.map(l=>{const d=l.panelTopic,p=this.state.added.some(I=>I.panelTopic===k),_=this.getNavValue(d,"next"),T=this.getNavValue(d,"prev"),F=this.getNavValue(d,"home"),f=this.getNavValue(d,"parent"),g=!!(_||T||F||f),S=d===k,w=!_&&!T,R=S?"nav_all_requires_prev_next":p?"nav_remove_from_all_notice":"nav_target_only_notice";return e.jsxs(t.Box,{"data-has-all":p,sx:{mt:2,mb:1},children:[e.jsxs(t.Box,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:[e.jsx(t.Box,{sx:{width:10,height:10,borderRadius:"50%",bgcolor:g?"success.main":"error.main"}}),e.jsx(t.Typography,{variant:"subtitle2",sx:{fontWeight:600},children:d===k?`(${v.I18n.t("all")||"All"})`:l.friendlyName||d})]}),e.jsx(t.Box,{sx:{display:"flex",alignItems:"center",gap:1,flexWrap:"wrap"},children:["next","prev","parent","home"].map((I,$)=>{const L=this.getNavValue(d,I);return e.jsxs(D.Fragment,{children:[e.jsxs(t.Box,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(t.Typography,{variant:"caption",color:"text.secondary",children:v.I18n.t(I)||I}),e.jsx(t.Typography,{variant:"body2",children:L||e.jsx("em",{children:"â€”"})})]}),$<3&&e.jsx(t.Divider,{orientation:"vertical",flexItem:!0,sx:{height:18,mx:1}})]},`${d}-${I}`)})}),w?e.jsx(t.Box,{sx:{mt:1},children:e.jsx(t.Typography,{variant:"caption",color:"text.secondary",sx:{fontStyle:"italic"},children:v.I18n.t(R)})}):null]},`panel-summary-${d}`)}):null]}),r===1&&e.jsx(e.Fragment,{children:this.renderCommonFields()}),r===2&&e.jsx(e.Fragment,{children:e.jsx(t.Typography,{variant:"body1",color:"text.secondary",children:v.I18n.t("Placeholder content for this tab.")})})]})]})}}class me extends D.Component{constructor(s){super(s),this.state={newName:"",confirmDeleteOpen:!1,confirmDeleteName:null}}getText(s){return this.props.getText(s)}handleAdd=()=>{const s=this.state.newName.trim();!s||this.props.selectedCardType==="all"||(this.props.onAdd(s,this.props.selectedCardType),this.setState({newName:""}),this.props.onSelectedChange(s))};handleDeleteClick=s=>{this.setState({confirmDeleteOpen:!0,confirmDeleteName:s})};handleDeleteConfirm=()=>{const s=this.state.confirmDeleteName;if(!s){this.setState({confirmDeleteOpen:!1,confirmDeleteName:null});return}this.props.onDelete(s),this.setState({confirmDeleteOpen:!1,confirmDeleteName:null})};handleDeleteCancel=()=>{this.setState({confirmDeleteOpen:!1,confirmDeleteName:null})};render(){const{entries:s,selected:n,selectedCardType:i,onSelectedChange:a,onCardTypeChange:o,onAssign:r,children:c,oContext:m,navigationPanelProps:l}=this.props,d=Array.from(new Set(s.map(g=>g.uniqueName))).filter(Boolean),p=i==="all"?s:s.filter(g=>g.card===i),_=Array.from(new Set(p.map(g=>g.uniqueName))).filter(Boolean),T=s.find(g=>g.uniqueName===n),F=(T==null?void 0:T.navigationAssignment)||[],f=`https://github.com/ticaki/ioBroker.nspanel-lovelace-ui/wiki/admin/add_page/${encodeURIComponent(i==="all"&&T!=null&&T.card?T.card:"common")}`;return e.jsxs(t.Box,{sx:{height:"calc(100vh - 64px)",display:"flex",flexDirection:{xs:"column",md:"row"},p:1},children:[e.jsxs(t.Box,{sx:{width:{xs:"100%",md:"20%"},pr:{xs:0,md:1},display:"flex",flexDirection:"column",gap:1},children:[e.jsx(t.Paper,{sx:{p:0,mb:1,backgroundColor:"transparent"},elevation:0,children:e.jsxs(t.FormControl,{fullWidth:!0,variant:"standard",children:[e.jsx(t.Typography,{variant:"h6",sx:{mb:1,fontWeight:600,color:"primary.main",fontSize:"1rem"},children:this.getText("page_type")}),e.jsxs(t.Select,{value:i,onChange:g=>{o(g.target.value)},sx:{backgroundColor:"transparent",px:1},children:[e.jsx(t.MenuItem,{value:"all",children:this.getText("page_type_all")}),e.jsx(t.MenuItem,{value:"cardAlarm",children:this.getText("page_type_alarm")}),e.jsx(t.MenuItem,{value:"cardQR",children:this.getText("page_type_qr")}),e.jsx(t.MenuItem,{value:"cardTrash",children:this.getText("page_type_trash")})]})]})}),e.jsx(t.Typography,{variant:"h6",sx:{mt:1,fontWeight:600,color:"primary.main",fontSize:"1rem"},children:this.getText("pages")}),i!=="all"&&e.jsx(t.Paper,{sx:{p:0,backgroundColor:"transparent"},elevation:0,children:e.jsxs(t.Box,{sx:{display:"flex",gap:1},children:[e.jsx(t.TextField,{"aria-label":"new-name",label:this.getText("new_page"),value:this.state.newName,onChange:g=>{this.setState({newName:g.target.value})},variant:"standard",placeholder:this.getText("New item"),InputProps:{sx:{backgroundColor:"transparent",px:1}},sx:{flex:1,"& .MuiInput-underline:before":{borderBottomColor:"primary.main"},"& .MuiInput-underline:hover:before":{borderBottomColor:"primary.main"},"& .MuiInput-underline:after":{borderBottomColor:"primary.main"},"& .MuiInputLabel-root":{color:"primary.main"},"& .MuiInputLabel-root.Mui-focused":{color:"primary.main"}}}),e.jsx(t.Button,{size:"small",variant:"contained",onClick:this.handleAdd,disabled:!this.state.newName.trim()||d.includes(this.state.newName.trim()),children:"+"})]})}),e.jsx(t.Paper,{sx:{overflow:"auto",p:0,backgroundColor:"transparent"},elevation:0,children:_.length===0?e.jsx(t.Typography,{variant:"body2",color:"text.secondary",children:this.getText("No items")}):_.map(g=>e.jsxs(t.Box,{onClick:()=>{a(g)},sx:{p:1,borderRadius:1,cursor:"pointer",backgroundColor:n===g?"action.selected":"transparent",mb:.5,display:"flex",justifyContent:"space-between",alignItems:"center","&:hover .delete-icon":{opacity:1}},children:[e.jsx(t.Typography,{variant:"body2",sx:{flex:1,overflow:"hidden",textOverflow:"ellipsis"},children:g}),e.jsx(t.IconButton,{className:"delete-icon",edge:"end","aria-label":"delete",size:"small",onClick:S=>{S.stopPropagation(),this.handleDeleteClick(g)},sx:{color:"error.main",opacity:{xs:1,md:0},transition:"opacity 0.2s"},children:e.jsx(Q,{fontSize:"small"})})]},g))}),e.jsx(t.Divider,{sx:{my:1}}),f&&e.jsx(t.Box,{sx:{mb:2},children:e.jsx("a",{href:f,target:"_blank",rel:"noopener noreferrer",style:{textDecoration:"none",color:"inherit",fontSize:"0.875rem"},children:e.jsx(t.Typography,{variant:"body2",sx:{color:"primary.main",textDecoration:"underline",cursor:"pointer","&:hover":{opacity:.8}},children:this.getText("documentation")})})})]}),e.jsx(z,{open:this.state.confirmDeleteOpen,onClose:this.handleDeleteCancel,onConfirm:this.handleDeleteConfirm,title:this.getText("delete_confirm_title"),description:this.getText("delete_confirm_text")+(this.state.confirmDeleteName?`: ${this.state.confirmDeleteName}`:""),cancelText:this.getText("Cancel1"),confirmText:this.getText("Delete"),ariaTitleId:"unlock-delete-confirm-title",ariaDescId:"unlock-delete-confirm-description"}),e.jsxs(t.Box,{sx:{width:{xs:"100%",md:"90%"},pl:{xs:0,md:2},mt:{xs:2,md:0},display:"flex",flexDirection:{xs:"column",md:"row"},gap:1,position:"relative"},children:[e.jsx(t.Box,{sx:{width:{xs:"100%",md:"95%"},borderLeft:{xs:"none",md:"1px solid"},borderColor:"divider"},children:e.jsx(t.Paper,{sx:{height:"100%",p:2},elevation:1,children:c})}),e.jsx(K,{...l,widthPercent:30,uniqueName:n,currentAssignments:F,oContext:m,onAssign:r})]})]})}}class xe extends D.Component{constructor(s){super(s),this.state={showPin:!1}}getText(s){return this.props.getText(s)}handleFieldChange(s,n){const i={...this.props.entry,[s]:n};this.props.onEntryChange(i)}render(){const{entry:s,pagesList:n}=this.props;return e.jsxs(t.Box,{children:[e.jsx(t.Box,{sx:{mb:1,p:1,borderRadius:1,backgroundColor:"action.hover"},children:e.jsx(t.TextField,{fullWidth:!0,variant:"standard",type:"text",label:this.getText("unique_label"),value:s.uniqueName,onChange:i=>{const a=i.target.value;a.trim()&&this.props.onUniqueNameChange(s.uniqueName,a)},InputProps:{sx:{backgroundColor:"transparent",px:1,fontWeight:600,width:"50%"}}})}),e.jsx(t.Box,{sx:{mb:1},children:e.jsxs(t.FormControl,{component:"fieldset",children:[e.jsx(t.Typography,{variant:"subtitle2",sx:{mb:1},children:this.getText("unlock_type")}),e.jsxs(t.RadioGroup,{row:!0,value:s.alarmType||"",onChange:(i,a)=>{this.handleFieldChange("alarmType",a)},children:[e.jsx(t.FormControlLabel,{value:"alarm",control:e.jsx(t.Radio,{}),label:this.getText("unlock_alarm")}),e.jsx(t.FormControlLabel,{value:"unlock",control:e.jsx(t.Radio,{}),label:this.getText("unlock_unlock")})]})]})}),e.jsx(t.TextField,{fullWidth:!0,variant:"standard",type:"text",autoComplete:"off",label:this.getText("headline"),value:s.headline??"",onChange:i=>{this.handleFieldChange("headline",i.target.value)},InputProps:{sx:{backgroundColor:"transparent",px:1,width:"50%"}},sx:{mb:2}}),e.jsx(t.Box,{sx:{mt:2},children:e.jsx(t.TextField,{variant:"standard",label:this.getText("unlock_pin"),type:this.state.showPin?"text":"password",value:s.pin!==void 0&&s.pin!==null?String(s.pin):"",onChange:i=>{const o=i.target.value.replace(/[^0-9]/g,""),r=o?parseInt(o,10):0;this.handleFieldChange("pin",r)},InputProps:{sx:{backgroundColor:"transparent",px:1},endAdornment:e.jsx(t.InputAdornment,{position:"end",children:e.jsx(t.IconButton,{"aria-label":this.state.showPin?"hide-pin":"show-pin",onClick:()=>{this.setState({showPin:!this.state.showPin})},edge:"end",size:"small",children:this.state.showPin?e.jsx(ne,{fontSize:"small"}):e.jsx(oe,{fontSize:"small"})})})}})}),s.alarmType==="alarm"&&e.jsxs(t.Box,{sx:{mt:2},children:[e.jsxs(t.Box,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"1fr 1fr"},gap:2},children:[e.jsxs(t.Box,{children:[e.jsx(t.Typography,{variant:"subtitle2",sx:{mb:1},children:this.getText("unlock_armed_header")}),e.jsx(t.Box,{sx:{display:"grid",gap:2},children:[1,2,3,4].map(i=>{const a=`button${i}`,o=(i-1)%4+1;return e.jsxs(t.Box,{children:[e.jsx(t.Typography,{variant:"caption",color:"text.secondary",sx:{mb:.5},children:this.getText(`unlock_button${o}_label`)}),e.jsx(t.TextField,{fullWidth:!0,variant:"standard",placeholder:this.getText(`unlock_button${o}_placeholder`),value:s[a]??"",onChange:r=>{this.handleFieldChange(a,r.target.value)},InputProps:{disableUnderline:!0,sx:{backgroundColor:"transparent",px:1,"& input::placeholder":{color:"text.disabled"}}}})]},i)})})]}),e.jsxs(t.Box,{children:[e.jsx(t.Typography,{variant:"subtitle2",sx:{mb:1},children:this.getText("unlock_disarmed_header")}),e.jsx(t.Box,{sx:{display:"grid",gap:2},children:[5,6,7,8].map(i=>{const a=`button${i}`,o=(i-1)%4+1;return e.jsxs(t.Box,{children:[e.jsx(t.Typography,{variant:"caption",color:"text.secondary",sx:{mb:.5},children:this.getText(`unlock_button${o}_label`)}),e.jsx(t.TextField,{fullWidth:!0,variant:"standard",placeholder:this.getText(`unlock_button${o}_placeholder`),value:s[a]??"",onChange:r=>{this.handleFieldChange(a,r.target.value)},InputProps:{disableUnderline:!0,sx:{backgroundColor:"transparent",px:1,"& input::placeholder":{color:"text.disabled"}}}})]},i)})})]})]}),e.jsx(t.Box,{sx:{mt:1},children:e.jsx(t.FormControlLabel,{control:e.jsx(t.Checkbox,{checked:!!s.approved,onChange:(i,a)=>{this.handleFieldChange("approved",a)}}),label:this.getText("unlock_approved")})}),e.jsx(t.Box,{sx:{mt:1},children:e.jsx(t.FormControlLabel,{control:e.jsx(t.Checkbox,{checked:!!s.global,onChange:(i,a)=>{this.handleFieldChange("global",a)}}),label:this.getText("unlock_global")})})]}),s.alarmType==="unlock"&&e.jsxs(t.Box,{sx:{mt:2},children:[e.jsx(t.Typography,{variant:"caption",color:"text.secondary",sx:{mb:.5},children:this.getText("unlock_setnavi_hint")}),e.jsxs(t.Select,{variant:"standard",displayEmpty:!0,value:s.setNavi??"",onChange:i=>{this.handleFieldChange("setNavi",String(i.target.value))},sx:{backgroundColor:"transparent",px:1,width:"60%"},children:[e.jsx(t.MenuItem,{value:"",children:e.jsx("em",{children:this.getText("unlock_setnavi_placeholder")})}),n.filter(i=>typeof i=="string"&&!i.startsWith("///")&&i!==s.uniqueName).map(i=>e.jsx(t.MenuItem,{value:i,children:i},i)),s.setNavi&&s.setNavi!==s.uniqueName&&!n.includes(s.setNavi)&&e.jsx(t.MenuItem,{value:s.setNavi,children:s.setNavi},`custom-${s.setNavi}`)]})]})]})}}class O extends D.Component{constructor(s){super(s),this.state={showSelectDialog:!1}}render(){const{label:s,value:n,onChange:i,socket:a,theme:o,themeType:r,dialogName:c,filterFunc:m}=this.props,{showSelectDialog:l}=this.state;return e.jsxs(t.Box,{sx:{mb:1},children:[e.jsx(t.Typography,{variant:"body2",sx:{mb:.5,color:"text.secondary",fontSize:"0.875rem"},children:s}),e.jsxs(t.Box,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e.jsx(t.TextField,{fullWidth:!0,variant:"standard",value:n||"",onChange:d=>i(d.target.value)}),e.jsx(t.Button,{variant:"outlined",onClick:()=>this.setState({showSelectDialog:!0}),sx:{minWidth:48},children:"..."}),l&&e.jsx(v.SelectID,{socket:a,selected:n||"",onOk:d=>{const p=Array.isArray(d)?d[0]:d;i(p||""),this.setState({showSelectDialog:!1})},onClose:()=>this.setState({showSelectDialog:!1}),filterFunc:m||(d=>(d==null?void 0:d.type)==="state"),dialogName:c,theme:o,themeType:r})]})]})}}class ue extends D.Component{constructor(s){super(s),this.state={showPassword:!1}}getText(s){return this.props.getText(s)}handleFieldChange(s,n){const i={...this.props.entry,[s]:n};this.props.onEntryChange(i)}render(){var a;const{entry:s,oContext:n,theme:i}=this.props;return e.jsxs(t.Box,{children:[e.jsx(t.Box,{sx:{mb:1,p:1,borderRadius:1,backgroundColor:"action.hover"},children:e.jsx(t.TextField,{fullWidth:!0,variant:"standard",type:"text",label:this.getText("unique_label"),value:s.uniqueName,onChange:o=>{const r=o.target.value;r.trim()&&this.props.onUniqueNameChange(s.uniqueName,r)},InputProps:{sx:{backgroundColor:"transparent",px:1,fontWeight:600,width:"50%"}}})}),e.jsx(t.Box,{sx:{mb:2},children:e.jsxs(t.FormControl,{component:"fieldset",children:[e.jsx(t.FormLabel,{component:"legend",children:this.getText("qr_type")}),e.jsxs(t.RadioGroup,{row:!0,value:s.selType??0,onChange:o=>{const r=parseInt(o.target.value,10);this.handleFieldChange("selType",r)},children:[e.jsx(t.FormControlLabel,{value:0,control:e.jsx(t.Radio,{}),label:this.getText("qr_type_free")}),e.jsx(t.FormControlLabel,{value:1,control:e.jsx(t.Radio,{}),label:this.getText("qr_type_wifi")}),e.jsx(t.FormControlLabel,{value:2,control:e.jsx(t.Radio,{}),label:this.getText("qr_type_url")}),e.jsx(t.FormControlLabel,{value:3,control:e.jsx(t.Radio,{}),label:this.getText("qr_type_tel")})]})]})}),e.jsx(t.TextField,{fullWidth:!0,variant:"standard",type:"text",autoComplete:"off",label:this.getText("headline"),value:s.headline??"",onChange:o=>{this.handleFieldChange("headline",o.target.value)},InputProps:{sx:{backgroundColor:"transparent",px:1,width:"50%"}},sx:{mb:2}}),e.jsx(t.TextField,{fullWidth:!0,variant:"standard",type:"text",autoComplete:"off",label:(()=>{switch(s.selType){case 0:return this.getText("qr_content_free");case 1:return this.getText("qr_content_wifi");case 2:return this.getText("qr_content_url");case 3:return this.getText("qr_content_tel");default:return this.getText("qr_content")}})(),value:s.ssidUrlTel??"",onChange:o=>{this.handleFieldChange("ssidUrlTel",o.target.value)},InputProps:{sx:{backgroundColor:"transparent",px:1}},sx:{mb:2}}),s.selType===1&&e.jsxs(t.Box,{sx:{mb:2},children:[e.jsxs(t.FormControl,{variant:"standard",sx:{mb:2,minWidth:240},children:[e.jsx(t.InputLabel,{children:this.getText("qr_wlan_type")}),e.jsxs(t.Select,{value:s.wlantype??"WPA2",onChange:o=>{const r=o.target.value;this.handleFieldChange("wlantype",r)},children:[e.jsx(t.MenuItem,{value:"nopass",children:"No Password"}),e.jsx(t.MenuItem,{value:"WPA",children:"WPA"}),e.jsx(t.MenuItem,{value:"WPA2",children:"WPA2"}),e.jsx(t.MenuItem,{value:"WPA3",children:"WPA3"}),e.jsx(t.MenuItem,{value:"WEP",children:"WEP"})]})]}),s.wlantype!=="nopass"&&e.jsx(t.TextField,{fullWidth:!0,variant:"standard",type:this.state.showPassword?"text":"password",label:this.getText("qr_password"),value:s.qrPass??"",onChange:o=>{this.handleFieldChange("qrPass",o.target.value)},InputProps:{sx:{backgroundColor:"transparent",px:1},endAdornment:e.jsx(t.InputAdornment,{position:"end",children:e.jsx(t.IconButton,{"aria-label":"toggle password visibility",onClick:()=>{this.setState({showPassword:!this.state.showPassword})},edge:"end",children:this.state.showPassword?e.jsx(E.VisibilityOff,{}):e.jsx(E.Visibility,{})})})},sx:{mb:2}}),e.jsxs(t.Box,{sx:{display:"flex",gap:2},children:[e.jsx(t.FormControlLabel,{control:e.jsx(t.Checkbox,{checked:!!s.wlanhidden,onChange:(o,r)=>{this.handleFieldChange("wlanhidden",r)}}),label:this.getText("qr_wlan_hidden")}),e.jsx(t.FormControlLabel,{control:e.jsx(t.Checkbox,{checked:!!s.pwdhidden,onChange:(o,r)=>{this.handleFieldChange("pwdhidden",r)}}),label:this.getText("qr_pwd_hidden")})]}),e.jsx(t.Box,{sx:{mb:2},children:e.jsx(O,{label:this.getText("qr_set_state"),value:s.setState??void 0,onChange:o=>{this.handleFieldChange("setState",o)},socket:n.socket,theme:i,themeType:((a=i==null?void 0:i.palette)==null?void 0:a.mode)||"light",dialogName:"selectState",filterFunc:o=>!!(o&&o.type==="state"&&o.common&&o.common.type==="boolean"&&o.common.write&&o.common.read)})})]})]})}}class ge extends D.Component{getText(s){return this.props.getText(s)}handleFieldChange(s,n){const i={...this.props.entry,[s]:n};this.props.onEntryChange(i)}render(){var a;const{entry:s,oContext:n,theme:i}=this.props;return e.jsxs(t.Box,{children:[e.jsx(t.Box,{sx:{mb:1,p:1,borderRadius:1,backgroundColor:"action.hover"},children:e.jsx(t.TextField,{fullWidth:!0,variant:"standard",type:"text",label:this.getText("unique_label"),value:s.uniqueName,onChange:o=>{const r=o.target.value;r.trim()&&this.props.onUniqueNameChange(s.uniqueName,r)},InputProps:{sx:{backgroundColor:"transparent",px:1,fontWeight:600,width:"50%"}}})}),e.jsx(t.TextField,{fullWidth:!0,variant:"standard",type:"text",autoComplete:"off",label:this.getText("headline"),value:s.headline??"",onChange:o=>{this.handleFieldChange("headline",o.target.value)},InputProps:{sx:{backgroundColor:"transparent",px:1,width:"50%"}},sx:{mb:2}}),e.jsx(t.Box,{sx:{mb:2},children:e.jsxs(t.FormControl,{component:"fieldset",children:[e.jsx(t.FormLabel,{component:"legend",children:this.getText("trash_import_type")}),e.jsxs(t.RadioGroup,{row:!0,value:s.trashImport,onChange:o=>{const r=o.target.value==="true";this.handleFieldChange("trashImport",r)},children:[e.jsx(t.FormControlLabel,{value:!0,control:e.jsx(t.Radio,{}),label:this.getText("trash_import_state")}),e.jsx(t.FormControlLabel,{value:!1,control:e.jsx(t.Radio,{}),label:this.getText("trash_import_ics_file")})]})]})}),s.trashImport&&e.jsx(t.Box,{sx:{mb:2},children:e.jsx(O,{label:this.getText("trash_state"),value:s.trashState??"",onChange:o=>{this.handleFieldChange("trashState",o)},socket:n.socket,theme:i,themeType:((a=i==null?void 0:i.palette)==null?void 0:a.mode)||"light",dialogName:"selectTrashState",filterFunc:o=>!!(o&&o.type==="state")})}),!s.trashImport&&e.jsx(t.Box,{sx:{mb:2},children:e.jsx(t.TextField,{fullWidth:!0,variant:"standard",type:"text",autoComplete:"off",label:this.getText("trash_ics_file_path"),value:s.trashFile??"",onChange:o=>{this.handleFieldChange("trashFile",o.target.value)},InputProps:{sx:{backgroundColor:"transparent",px:1}}})}),e.jsxs(t.Box,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(t.Box,{sx:{mb:2},children:[1,2,3,4,5,6].map(o=>e.jsx(t.TextField,{fullWidth:!0,variant:"standard",type:"color",label:this.getText(`${o}`),value:s[`iconColor${o}`]??"#FFFFFF",onChange:r=>{this.handleFieldChange(`iconColor${o}`,r.target.value)},InputProps:{sx:{backgroundColor:"transparent",px:1}},sx:{mb:2}},o))}),e.jsx(t.Box,{sx:{mb:2},children:[1,2,3,4,5,6].map(o=>e.jsx(t.TextField,{fullWidth:!0,variant:"standard",type:"text",autoComplete:"off",label:this.getText(`trash_text_field_${o}`),value:s[`textTrash${o}`]??"",onChange:r=>{this.handleFieldChange(`textTrash${o}`,r.target.value)},InputProps:{sx:{backgroundColor:"transparent",px:1}},sx:{mb:2}},o))}),e.jsx(t.Box,{sx:{mb:2},children:[1,2,3,4,5,6].map(o=>e.jsx(t.TextField,{fullWidth:!0,variant:"standard",type:"text",autoComplete:"off",label:this.getText(`trash_custom_text_field_${o}`),value:s[`customTrash${o}`]??"",onChange:r=>{this.handleFieldChange(`customTrash${o}`,r.target.value)},InputProps:{sx:{backgroundColor:"transparent",px:1}},sx:{mb:2}},o))})]})]})}}class fe extends M.ConfigGeneric{pagesRetryTimeout;constructor(s){super(s);const n=M.ConfigGeneric.getValue(s.data,s.attr);this.state={...this.state,entries:Array.isArray(n)?n:[],selected:"",selectedCardType:"all",pagesList:[],alive:!1,pagesRetryCount:0}}componentWillUnmount(){this.pagesRetryTimeout&&clearTimeout(this.pagesRetryTimeout);const s=this.props.oContext.instance??"0";this.props.oContext.socket.unsubscribeState(`system.adapter.${P}.${s}.alive`,this.onAliveChanged)}async componentDidMount(){super.componentDidMount();const s=this.props.oContext.instance??"0",n=`system.adapter.${P}.${s}.alive`;try{const i=await this.props.oContext.socket.getState(n),a=!!(i!=null&&i.val);this.setState({alive:a}),await this.props.oContext.socket.subscribeState(n,this.onAliveChanged),a&&await this.loadPagesList()}catch(i){console.error("[PageConfig] Failed to get alive state or subscribe:",i),this.setState({alive:!1})}}onAliveChanged=(s,n)=>{const i=this.state.alive,a=n?!!n.val:!1;i!==a&&(this.setState({alive:a}),!i&&a&&(!this.state.pagesList||this.state.pagesList.length===0)&&this.loadPagesList(),i&&!a&&this.pagesRetryTimeout&&(clearTimeout(this.pagesRetryTimeout),this.pagesRetryTimeout=void 0))};async loadPagesList(){if(!this.state.alive){console.log("[PageConfig] Adapter not alive, skipping pages load");return}const s=[];if(this.props.oContext&&this.props.oContext.socket){const n=this.props.oContext.instance??"0",i=`${P}.${n}`;try{const a=await this.props.oContext.socket.sendTo(i,Y,null);let o=[];Array.isArray(a)?o=a:a&&Array.isArray(a.result)&&(o=a.result);for(const r of o)s.push(r);if(o.length===0){const r=this.state.pagesRetryCount||0,c=3e3;console.log(`[PageConfig] Got empty pages array, retrying in ${c}ms (attempt ${r+1})`),this.setState({pagesRetryCount:r+1}),this.pagesRetryTimeout&&clearTimeout(this.pagesRetryTimeout),this.pagesRetryTimeout=setTimeout(()=>{this.state.alive?this.loadPagesList():console.log("[PageConfig] Adapter went offline, cancelling pages retry")},c);return}else o.length>0&&(console.log(`[PageConfig] Successfully loaded ${o.length} pages after ${this.state.pagesRetryCount||0} retries`),this.setState({pagesRetryCount:0}),this.pagesRetryTimeout&&(clearTimeout(this.pagesRetryTimeout),this.pagesRetryTimeout=void 0))}catch(a){const o=this.state.pagesRetryCount||0,r=3e3;console.log(`[PageConfig] Error loading pages, retrying in ${r}ms (attempt ${o+1}): ${String(a)}`),this.setState({pagesRetryCount:o+1}),this.pagesRetryTimeout&&clearTimeout(this.pagesRetryTimeout),this.pagesRetryTimeout=setTimeout(()=>{this.state.alive?this.loadPagesList():console.log("[PageConfig] Adapter went offline, cancelling pages retry after error")},r);return}}else{console.log("[PageConfig] No socket available for sendTo");return}this.setState({pagesList:Array.from(new Set(s))})}handleAdd=(s,n)=>{if(n==="all")return;let i;if(n==="cardAlarm")i={card:"cardAlarm",uniqueName:s,headline:s,button1:"",button2:"",button3:"",button4:"",button5:"",button6:"",button7:"",button8:"",pin:0};else if(n==="cardQR")i={card:"cardQR",uniqueName:s,headline:s,ssidUrlTel:"",wlanhidden:!1,pwdhidden:!1,setState:"",selType:0};else if(n==="cardTrash")i={card:"cardTrash",uniqueName:s,headline:s,trashImport:!0,trashState:"",trashFile:"",textTrash1:"",textTrash2:"",textTrash3:"",textTrash4:"",textTrash5:"",textTrash6:"",customTrash1:"",customTrash2:"",customTrash3:"",customTrash4:"",customTrash5:"",customTrash6:"",iconColor1:"",iconColor2:"",iconColor3:"",iconColor4:"",iconColor5:"",iconColor6:""};else return;const a=[...this.state.entries,i];this.setState({entries:a}),this.onChange(this.props.attr,a)};handleDelete=s=>{const n=this.state.entries.filter(a=>a.uniqueName!==s);this.setState({entries:n}),this.onChange(this.props.attr,n);const i=Array.from(new Set(n.map(a=>a.uniqueName))).filter(Boolean);this.setState({selected:i[0]||""})};handleAssign=(s,n)=>{const i=this.state.entries.map(a=>a.uniqueName===s?{...a,navigationAssignment:n}:a);this.setState({entries:i}),this.onChange(this.props.attr,i)};handleEntryChange=s=>{const n=this.state.entries.map(i=>i.uniqueName===s.uniqueName?s:i);this.setState({entries:n}),this.onChange(this.props.attr,n)};handleUniqueNameChange=(s,n)=>{if(!n.trim())return;const i=this.state.entries.map(a=>a.uniqueName===s?{...a,uniqueName:n}:a);this.setState({entries:i,selected:n}),this.onChange(this.props.attr,i)};handleCardTypeChange=s=>{const n=s==="all"?this.state.entries:this.state.entries.filter(a=>a.card===s),i=n.length>0?n[0].uniqueName:"";this.setState({selectedCardType:s,selected:i})};handleCommonFieldsChange=(s,n)=>{const i=this.state.entries.map(a=>a.uniqueName===s?{...a,...n}:a);this.setState({entries:i}),this.onChange(this.props.attr,i)};renderMiddlePanel(){const{selected:s,entries:n,pagesList:i}=this.state;if(!s)return e.jsxs(t.Box,{children:[e.jsx(t.Typography,{variant:"h6",children:this.getText("select_item")}),e.jsx(t.Box,{sx:{mt:2},children:e.jsx(t.Typography,{variant:"body2",color:"text.secondary",children:this.getText("select_description")})})]});const a=n.find(o=>o.uniqueName===s);return a?a.card==="cardAlarm"?e.jsx(xe,{entry:a,pagesList:i,onEntryChange:this.handleEntryChange,onUniqueNameChange:this.handleUniqueNameChange,getText:o=>this.getText(o)}):a.card==="cardQR"?e.jsx(ue,{entry:a,onEntryChange:this.handleEntryChange,onUniqueNameChange:this.handleUniqueNameChange,getText:o=>this.getText(o),oContext:this.props.oContext,theme:this.props.theme}):a.card==="cardTrash"?e.jsx(ge,{entry:a,onEntryChange:this.handleEntryChange,onUniqueNameChange:this.handleUniqueNameChange,getText:o=>this.getText(o),oContext:this.props.oContext,theme:this.props.theme}):e.jsxs(t.Typography,{variant:"body2",children:[a.card," - ",this.getText("coming_soon")]}):e.jsx(t.Typography,{variant:"body2",color:"text.secondary",children:this.getText("Entry not found")})}renderItem(s,n,i){const a=this.state.entries.find(o=>o.uniqueName===this.state.selected);return e.jsx(me,{entries:this.state.entries,selected:this.state.selected,selectedCardType:this.state.selectedCardType,onSelectedChange:o=>this.setState({selected:o}),onCardTypeChange:this.handleCardTypeChange,onAdd:this.handleAdd,onDelete:this.handleDelete,onAssign:this.handleAssign,oContext:this.props.oContext,getText:o=>this.getText(o),navigationPanelProps:{...this.props,data:this.props.data,onChange:this.props.onChange,onError:this.props.onError,commonFields:a?{hidden:a.hidden,alwaysOn:a.alwaysOn,navigationAssignment:a.navigationAssignment}:void 0,onCommonFieldsChange:a?o=>{this.handleCommonFieldsChange(a.uniqueName,o)}:void 0},children:this.renderMiddlePanel()})}}const ve=H(fe),q={left:"â—§",bottom:"â¬œ",indicator:"â—",favorit:"ðŸ’Ž",alternate:"â‡„"};class ye extends D.Component{constructor(s){super(s);const n={type:"button",headline:"",modeScr:"left",data:{text:void 0,text1:void 0,icon:void 0,color:void 0,entity1:void 0,entity2:void 0,entity3:void 0,entity4:void 0,filter:void 0,setValue1:void 0,setValue2:void 0,setNavi:void 0,confirm:void 0,popup:void 0,enabled:void 0,additionalId:void 0,setTrue:!1,setFalse:!1}};this.state={editedItem:s.item?{...s.item}:n,confirmDeleteOpen:!1}}handleFieldChange=(s,n)=>{this.setState(i=>({editedItem:{...i.editedItem,[s]:n}}))};handleDataFieldChange=(s,n)=>{this.setState(i=>({editedItem:{...i.editedItem,data:{...i.editedItem.data,[s]:n||void 0}}}))};handleSave=()=>{this.props.onSave(this.state.editedItem)};handleDeleteClick=()=>{this.setState({confirmDeleteOpen:!0})};handleDeleteConfirm=()=>{this.setState({confirmDeleteOpen:!1}),this.props.onDelete&&this.props.onDelete()};handleDeleteCancel=()=>{this.setState({confirmDeleteOpen:!1})};render(){const{item:s,onBack:n,onDelete:i,getText:a,socket:o,theme:r,themeType:c}=this.props,{editedItem:m}=this.state,l=!s,d=m.modeScr==="indicator";return e.jsxs(t.Box,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[e.jsxs(t.Box,{sx:{display:"flex",alignItems:"center",mb:3,gap:2},children:[e.jsx(t.IconButton,{onClick:n,sx:{color:"primary.main"},children:e.jsx(E.ArrowBack,{})}),e.jsx(t.Typography,{variant:"h6",sx:{flex:1},children:a(l?"pageItem_new":"pageItem_edit")}),!l&&i&&e.jsx(t.IconButton,{onClick:this.handleDeleteClick,sx:{color:"error.main"},children:e.jsx(E.Delete,{})})]}),e.jsx(t.Paper,{sx:{p:3,flex:1,overflow:"auto",display:"flex",flexDirection:"column"},children:e.jsxs(t.Box,{sx:{display:"flex",flexDirection:"column",gap:2,flex:1},children:[d&&e.jsxs(t.FormControl,{fullWidth:!0,children:[e.jsx(t.InputLabel,{children:a("pageItem_type")}),e.jsxs(t.Select,{value:m.type,label:a("pageItem_type"),onChange:p=>this.handleFieldChange("type",p.target.value),children:[e.jsx(t.MenuItem,{value:"button",children:a("pageItem_type_button")}),e.jsx(t.MenuItem,{value:"text",children:a("pageItem_type_text")})]})]}),e.jsx(t.TextField,{fullWidth:!0,label:a("pageItem_headline"),value:m.headline||"",onChange:p=>this.handleFieldChange("headline",p.target.value),helperText:a("pageItem_headline_hint")}),e.jsxs(t.FormControl,{fullWidth:!0,children:[e.jsx(t.InputLabel,{children:a("pageItem_modeScr")}),e.jsxs(t.Select,{value:m.modeScr||"left",label:a("pageItem_modeScr"),onChange:p=>{const _=p.target.value;this.handleFieldChange("modeScr",_),_!=="indicator"&&this.handleFieldChange("type","text")},children:[e.jsx(t.MenuItem,{value:"left",children:e.jsxs(t.Box,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx("span",{style:{fontSize:"1.5rem"},children:q.left}),a("pageItem_modeScr_left")]})}),e.jsx(t.MenuItem,{value:"bottom",children:e.jsxs(t.Box,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx("span",{style:{fontSize:"1.5rem"},children:q.bottom}),a("pageItem_modeScr_bottom")]})}),e.jsx(t.MenuItem,{value:"indicator",children:e.jsxs(t.Box,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx("span",{style:{fontSize:"1.5rem"},children:q.indicator}),a("pageItem_modeScr_indicator")]})}),e.jsx(t.MenuItem,{value:"favorit",children:e.jsxs(t.Box,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx("span",{style:{fontSize:"1.5rem"},children:q.favorit}),a("pageItem_modeScr_favorit")]})}),e.jsx(t.MenuItem,{value:"alternate",children:e.jsxs(t.Box,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx("span",{style:{fontSize:"1.5rem"},children:q.alternate}),a("pageItem_modeScr_alternate")]})})]})]}),e.jsx(t.Divider,{}),e.jsx(t.Typography,{variant:"h6",sx:{mt:1},children:a("pageItem_data")}),!d&&e.jsx(t.TextField,{fullWidth:!0,label:a("pageItem_data_text"),value:m.data.text||"",onChange:p=>this.handleDataFieldChange("text",p.target.value),helperText:a("pageItem_data_text_hint")}),e.jsx(t.TextField,{fullWidth:!0,label:a("pageItem_data_icon"),value:m.data.icon||"",onChange:p=>this.handleDataFieldChange("icon",p.target.value),helperText:a("pageItem_data_icon_hint")}),e.jsx(O,{label:a("pageItem_data_entity1"),value:m.data.entity1,onChange:p=>this.handleDataFieldChange("entity1",p),socket:o,theme:r,themeType:c||"light",dialogName:"nspanel-pageitem-editor-entity1"}),e.jsx(O,{label:a("pageItem_data_entity2"),value:m.data.entity2,onChange:p=>this.handleDataFieldChange("entity2",p),socket:o,theme:r,themeType:c||"light",dialogName:"nspanel-pageitem-editor-entity2"}),e.jsx(t.TextField,{fullWidth:!0,label:a("pageItem_data_setNavi"),value:m.data.setNavi||"",onChange:p=>this.handleDataFieldChange("setNavi",p.target.value),helperText:a("pageItem_data_setNavi_hint")}),e.jsx(t.Box,{sx:{display:"flex",justifyContent:"flex-end",mt:2},children:e.jsx(t.Button,{variant:"contained",color:"primary",onClick:this.handleSave,children:a("save")})})]})}),e.jsx(z,{open:this.state.confirmDeleteOpen,onClose:this.handleDeleteCancel,onConfirm:this.handleDeleteConfirm,title:a("pageItem_delete_confirm_title"),description:a("pageItem_delete_confirm_text"),cancelText:a("Cancel1"),confirmText:a("Delete"),ariaTitleId:"pageitem-delete-confirm-title",ariaDescId:"pageitem-delete-confirm-description"})]})}}class Ce extends M.ConfigGeneric{_local=null;pagesRetryTimeout;dateFormats=[{value:{dateStyle:"short"},label:"dateFormatShort"},{value:{year:"numeric",month:"2-digit",day:"2-digit"},label:"dateFormatYearMonthDay"},{value:{day:"2-digit",month:"short",year:"numeric"},label:"dateFormatDayShortMonthYear"},{value:{day:"2-digit",month:"long",year:"numeric"},label:"dateFormatDayLongMonthYear"},{value:{weekday:"short",day:"2-digit",month:"2-digit",year:"numeric"},label:"dateFormatWeekdayShortDate"},{value:{weekday:"long",day:"2-digit",month:"2-digit",year:"numeric"},label:"dateFormatWeekdayLongDate"},{value:{weekday:"short",day:"2-digit",month:"short",year:"numeric"},label:"dateFormatWeekdayShortDayMonthYear"},{value:{weekday:"long",day:"2-digit",month:"long",year:"numeric"},label:"dateFormatWeekdayLongDayMonthYear"},{value:"custom",label:"Custom"}];timeFormats=[{value:{hour:"2-digit",minute:"2-digit",hour12:!1},label:"timeFormat24"},{value:{hour:"numeric",minute:"2-digit",hour12:!0},label:"timeFormat12"}];constructor(s){super(s);const n=M.ConfigGeneric.getValue(s.data,s.attr);this.state={...this.state,entries:Array.isArray(n)?n:[],confirmDeleteOpen:!1,confirmDeleteName:null,alive:!1,pagesRetryCount:0}}formatDatePreview(s,n){try{return s.toLocaleDateString(void 0,typeof n=="string"?JSON.parse(n):n)}catch{return"Invalid Format"}}formatTimePreview(s,n){try{return s.toLocaleTimeString(void 0,typeof n=="string"?JSON.parse(n):n)}catch{return"Invalid Format"}}componentWillUnmount(){this.pagesRetryTimeout&&clearTimeout(this.pagesRetryTimeout);const s=this.props.oContext.instance??"0";this.props.oContext.socket.unsubscribeState(`system.adapter.${P}.${s}.alive`,this.onAliveChanged)}async componentDidMount(){super.componentDidMount();const s=this.props.oContext.instance??"0",n=`system.adapter.${P}.${s}.alive`;try{const i=await this.props.oContext.socket.getState(n),a=!!(i!=null&&i.val);this.setState({alive:a}),await this.props.oContext.socket.subscribeState(n,this.onAliveChanged),a&&await this.loadPagesList()}catch(i){console.error("[ScreensaverPage] Failed to get alive state or subscribe:",i),this.setState({alive:!1})}}onAliveChanged=(s,n)=>{const i=this.state.alive,a=n?!!n.val:!1;i!==a&&(this.setState({alive:a}),!i&&a&&(!this.state.pagesList||this.state.pagesList.length===0)&&this.loadPagesList(),i&&!a&&this.pagesRetryTimeout&&(clearTimeout(this.pagesRetryTimeout),this.pagesRetryTimeout=void 0))};async loadPagesList(){if(!this.state.alive){console.log("[ScreensaverPage] Adapter not alive, skipping pages load");return}const s=[];if(this.props.oContext&&this.props.oContext.socket){const n=this.props.oContext.instance??"0",i=`${P}.${n}`;try{const a=await this.props.oContext.socket.sendTo(i,Y,null);let o=[];Array.isArray(a)?o=a:a&&Array.isArray(a.result)&&(o=a.result);for(const r of o)s.push(r);if(o.length===0){const r=this.state.pagesRetryCount||0,c=3e3;console.log(`[ScreensaverPage] Got empty pages array, retrying in ${c}ms (attempt ${r+1})`),this.setState({pagesRetryCount:r+1}),this.pagesRetryTimeout&&clearTimeout(this.pagesRetryTimeout),this.pagesRetryTimeout=setTimeout(()=>{this.state.alive?this.loadPagesList():console.log("[ScreensaverPage] Adapter went offline, cancelling pages retry")},c);return}else o.length>0&&(console.log(`[ScreensaverPage] Successfully loaded ${o.length} pages after ${this.state.pagesRetryCount||0} retries`),this.setState({pagesRetryCount:0}),this.pagesRetryTimeout&&(clearTimeout(this.pagesRetryTimeout),this.pagesRetryTimeout=void 0))}catch(a){const o=this.state.pagesRetryCount||0,r=3e3;console.log(`[ScreensaverPage] Error loading pages, retrying in ${r}ms (attempt ${o+1}): ${String(a)}`),this.setState({pagesRetryCount:o+1}),this.pagesRetryTimeout&&clearTimeout(this.pagesRetryTimeout),this.pagesRetryTimeout=setTimeout(()=>{this.state.alive?this.loadPagesList():console.log("[ScreensaverPage] Adapter went offline, cancelling pages retry after error")},r);return}}else{console.log("[ScreensaverPage] No socket available for sendTo");return}this.setState({pagesList:Array.from(new Set(s))})}renderItem(s,n,i){var T,F,f,g,S,w,R,I,$,L,V,U;const a=this.state.entries||[],o=Array.from(new Set(a.map(h=>h.uniqueName))).filter(Boolean);this._local||(this._local={newName:"",selected:o[0]||""});const r=this._local,c=()=>{const h=(r.newName||"").trim();if(!h)return;const x={card:"screensaver",uniqueName:h,pageItems:[]},b=[...a,x];this.setState({entries:b}),this.onChange(this.props.attr,b),r.newName="",r.selected=h},m=()=>{const h=r.selected;h&&this.setState({confirmDeleteOpen:!0,confirmDeleteName:h})},l=()=>{this.setState({confirmDeleteOpen:!1,confirmDeleteName:null})},d=()=>{const h=this.state.confirmDeleteName;if(!h){l();return}const x=a.filter(A=>A.uniqueName!==h);this.setState({entries:x,confirmDeleteOpen:!1,confirmDeleteName:null}),this.onChange(this.props.attr,x);const b=Array.from(new Set(x.map(A=>A.uniqueName))).filter(Boolean);r&&(r.selected=b[0]||""),this.setState({})},p=this.state.editingPageItem!==void 0,_=p?0:30;return e.jsxs(t.Box,{sx:{height:"calc(100vh - 64px)",display:"flex",flexDirection:{xs:"column",md:"row"},p:1,overflow:"hidden"},children:[e.jsxs(t.Box,{sx:{width:{xs:"100%",md:"20%"},pr:{xs:0,md:1},display:"flex",flexDirection:"column",gap:1,minHeight:100,overflow:"auto"},children:[e.jsx(t.Typography,{variant:"h6",sx:{mb:.5,fontWeight:600,color:"primary.main",fontSize:"1rem",flexShrink:0},children:this.getText("screensaver_pages")}),e.jsx(t.Paper,{sx:{p:1,backgroundColor:"transparent",flexShrink:0},elevation:0,children:e.jsxs(t.Box,{sx:{display:"flex",gap:1},children:[e.jsx(t.TextField,{"aria-label":"new-screensaver-name",label:this.getText("new_screensaver"),value:(r==null?void 0:r.newName)||"",onChange:h=>{r&&(r.newName=h.target.value),this.setState({})},variant:"standard",placeholder:this.getText("new_screensaver"),InputProps:{sx:{backgroundColor:"transparent",px:1}},sx:{flex:1,"& .MuiInput-underline:before":{borderBottomColor:"primary.main"},"& .MuiInput-underline:hover:before":{borderBottomColor:"primary.main"},"& .MuiInput-underline:after":{borderBottomColor:"primary.main"},"& .MuiInputLabel-root":{color:"primary.main"},"& .MuiInputLabel-root.Mui-focused":{color:"primary.main"}}}),e.jsx(t.Button,{size:"small",variant:"contained",onClick:c,sx:{minWidth:32,padding:"4px 8px"},disabled:(()=>{const h=((r==null?void 0:r.newName)||"").trim();return!h||o.includes(h)})(),children:"+"})]})}),e.jsx(t.Paper,{sx:{overflow:"auto",p:1,backgroundColor:"transparent",flex:1,minHeight:"50px",maxHeight:"100px"},elevation:1,children:o.length===0?e.jsx(t.Typography,{variant:"body2",color:"text.secondary",children:this.getText("no_screensavers")}):o.map(h=>e.jsx(t.Box,{onClick:()=>{r&&(r.selected=h),this.setState({})},sx:{p:1,borderRadius:1,cursor:"pointer",backgroundColor:(r==null?void 0:r.selected)===h?"action.selected":"transparent",mb:.5},children:e.jsx(t.Typography,{variant:"body2",children:h})},h))}),e.jsx(t.Box,{sx:{display:"flex",justifyContent:"flex-end",flexShrink:0},children:e.jsx(t.Button,{size:"small",color:"error",variant:"outlined",sx:{minWidth:32,padding:"4px 8px"},onClick:m,disabled:!(r!=null&&r.selected),children:"-"})}),e.jsxs(t.Box,{sx:{flex:1,minHeight:0},children:[e.jsx(t.Box,{sx:{marginTop:1,marginBottom:1},children:e.jsxs(t.FormControl,{component:"fieldset",disabled:(r==null?void 0:r.selected)===null,children:[e.jsx(t.FormLabel,{component:"legend",sx:{color:(r==null?void 0:r.selected)===null?((f=(F=(T=this.props.theme)==null?void 0:T.palette)==null?void 0:F.text)==null?void 0:f.disabled)||"#999":(w=(S=(g=this.props.theme)==null?void 0:g.palette)==null?void 0:S.text)==null?void 0:w.primary},children:this.getText("cardType")}),e.jsxs(t.RadioGroup,{value:r!=null&&r.selected&&((R=this.state.entries.find(h=>h.uniqueName===r.selected))==null?void 0:R.card)||"screensaver",onChange:h=>{if(r!=null&&r.selected){const x=h.target.value,b=[...this.state.entries],A=b.findIndex(W=>W.uniqueName===r.selected);A!==-1&&(b[A]={...b[A],card:x},this.setState({entries:b}),this.props.onChange(this.props.attr||"",b))}},sx:{flexDirection:"column","& .MuiRadio-root.Mui-disabled":{color:"#999 !important"},"& .MuiFormControlLabel-label.Mui-disabled":{color:"#999 !important"}},children:[e.jsx(t.FormControlLabel,{value:"screensaver",control:e.jsx(t.Radio,{}),label:this.getText("cardTypeStandard")}),e.jsx(t.FormControlLabel,{value:"screensaver2",control:e.jsx(t.Radio,{}),label:this.getText("cardTypeAdvanced")}),e.jsx(t.FormControlLabel,{value:"screensaver3",control:e.jsx(t.Radio,{}),label:this.getText("cardTypeEasyview")})]})]})}),e.jsx(t.Divider,{sx:{my:1}}),e.jsx(t.Box,{sx:{mb:2},children:e.jsx("a",{href:"https://github.com/ticaki/ioBroker.nspanel-lovelace-ui/wiki/screensaver",target:"_blank",rel:"noopener noreferrer",style:{textDecoration:"none",color:"inherit",fontSize:"0.875rem"},children:e.jsx(t.Typography,{variant:"body2",sx:{color:"primary.main",textDecoration:"underline",cursor:"pointer","&:hover":{opacity:.8}},children:this.getText("documentation")})})}),e.jsxs(t.Box,{sx:{mb:2,display:"flex",gap:1,alignItems:"center"},children:[e.jsx(t.TextField,{fullWidth:!0,label:"Select Object ID (custom)",value:this.state.selectedObjectId||"",onChange:h=>{this.setState({selectedObjectId:h.target.value})},variant:"standard"}),e.jsx(t.Button,{variant:"outlined",onClick:()=>this.setState({showSelectDialog:!0}),sx:{minWidth:48},children:"..."}),this.state.showSelectDialog&&e.jsx(v.SelectID,{socket:this.props.oContext.socket,selected:this.state.selectedObjectId||"",onOk:h=>{const x=Array.isArray(h)?h[0]:h;this.setState({selectedObjectId:x||"",showSelectDialog:!1})},onClose:()=>{this.setState({showSelectDialog:!1})},filterFunc:h=>{var x;return!!((h==null?void 0:h.type)==="state"&&((x=h.common)!=null&&x.role)&&h.common.role.startsWith("switch"))},dialogName:"nspanel-screensaver",theme:this.props.theme,themeType:(($=(I=this.props.theme)==null?void 0:I.palette)==null?void 0:$.mode)||"light"})]}),e.jsxs(t.Box,{sx:{mb:2},children:[e.jsx(t.Typography,{variant:"caption",sx:{display:"flex",mb:1,color:"text.secondary"},children:"Test 2: JsonConfigComponent (filterFunc = string compiled with new Function)"}),e.jsx(M.JsonConfigComponent,{socket:this.props.oContext.socket,themeName:this.props.themeName,themeType:((V=(L=this.props.theme)==null?void 0:L.palette)==null?void 0:V.mode)||"light",theme:this.props.theme,schema:{type:"panel",label:"Object Selector",items:{testObjectId:{type:"objectId",label:"Select Object (JsonConfig)",sm:12,md:12,lg:12,filterFunc:"return !!(obj?.type === 'state' && obj.common?.role && obj.common.role.startsWith('switch'));"}}},data:{testObjectId:this.state.selectedObjectIdJson||""},onChange:h=>{const x=h&&h.testObjectId||"";this.setState({selectedObjectIdJson:x})},isFloatComma:!1,dateFormat:"DD.MM.YYYY",onError:()=>{},adapterName:"nspanel-lovelace-ui",instance:Number(((U=this.props.oContext)==null?void 0:U.instance)||0)})]})]})]}),e.jsx(z,{open:!!this.state.confirmDeleteOpen,onClose:l,onConfirm:d,title:this.getText("screensaver_delete_confirm_title"),description:this.getText("screensaver_delete_confirm_text")+(this.state.confirmDeleteName?`: ${this.state.confirmDeleteName}`:""),cancelText:this.getText("Cancel1"),confirmText:this.getText("Delete"),ariaTitleId:"screensaver-delete-confirm-title",ariaDescId:"screensaver-delete-confirm-description"}),e.jsxs(t.Box,{sx:{width:{xs:"100%",md:"100%"},pl:{xs:0,md:2},mt:{xs:2,md:0},display:"flex",flexDirection:{xs:"column",md:"row"},gap:1,position:"relative",minHeight:0,overflow:"hidden"},children:[e.jsx(t.Box,{sx:{width:{xs:"100%",md:"100%"},borderLeft:{xs:"none",md:"1px solid"},borderColor:"divider",display:"flex",flexDirection:"column",minHeight:0},children:e.jsx(t.Paper,{sx:{height:"100%",p:2,display:"flex",flexDirection:"column",overflow:"auto"},elevation:1,children:r!=null&&r.selected?e.jsx(t.Box,{children:(()=>{var b,A,W;const h=r==null?void 0:r.selected,x=a.find(u=>u.uniqueName===h);return x?e.jsxs(t.Box,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(t.Typography,{variant:"h6",sx:{mb:1},children:[this.getText("screensaver_config"),": ",h]}),this.state.editingPageItem!==void 0?e.jsx(ye,{item:this.state.editingPageItem,onSave:u=>{const j=x.pageItems||[];let y;this.state.editingPageItemIndex!==void 0?y=j.map((B,X)=>X===this.state.editingPageItemIndex?u:B):y=[...j,u];const C=a.map(B=>B.uniqueName===h?{...B,pageItems:y}:B);this.setState({entries:C,editingPageItem:void 0,editingPageItemIndex:void 0}),this.onChange(this.props.attr,C)},onDelete:()=>{if(this.state.editingPageItemIndex!==void 0){const j=(x.pageItems||[]).filter((C,B)=>B!==this.state.editingPageItemIndex),y=a.map(C=>C.uniqueName===h?{...C,pageItems:j}:C);this.setState({entries:y,editingPageItem:void 0,editingPageItemIndex:void 0}),this.onChange(this.props.attr,y)}},onBack:()=>{this.setState({editingPageItem:void 0,editingPageItemIndex:void 0})},getText:u=>this.getText(u),socket:this.props.oContext.socket,theme:this.props.theme,themeName:this.props.themeName,themeType:((A=(b=this.props.theme)==null?void 0:b.palette)==null?void 0:A.mode)||"light",instance:Number(((W=this.props.oContext)==null?void 0:W.instance)||0)}):e.jsxs(e.Fragment,{children:[e.jsxs(t.FormControl,{variant:"outlined",fullWidth:!0,sx:{mt:2},children:[e.jsx(t.InputLabel,{children:this.getText("dateFormat")}),e.jsx(t.Select,{value:x.dateFormat||"dd.MM.yyyy",onChange:u=>{const j=u.target.value,y=a.map(C=>C.uniqueName===h?{...C,dateFormat:j}:C);this.setState({entries:y}),this.onChange(this.props.attr,y)},label:this.getText("dateFormat"),children:this.dateFormats.map(u=>e.jsx(t.MenuItem,{value:JSON.stringify(u.value),children:u.value==="custom"?this.getText("dateFormatCustom"):this.getText(u.label)},u.label))})]}),x.dateFormat==='"custom"'&&e.jsx(t.TextField,{label:this.getText("dateFormatCustom"),value:x.customDateFormat||"",onChange:u=>{const j=u.target.value,y=a.map(C=>C.uniqueName===h?{...C,customDateFormat:j}:C);this.setState({entries:y}),this.onChange(this.props.attr,y)},variant:"outlined",fullWidth:!0,placeholder:'{ "weekday": "long", "day": "2-digit", "month": "2-digit", "year": "numeric" }',sx:{mt:1}}),e.jsxs(t.Typography,{variant:"caption",color:"text.secondary",sx:{mt:.5,display:"block"},children:[this.getText("dateFormatExample"),":"," ",(()=>{const u=new Date,j=x.dateFormat||"dd.MM.yyyy";console.log("Formatting date with format:",x.dateFormat);try{if(j==='"custom"'){const y=x.customDateFormat||"";return y?(console.log("Formatting date with custom:",y),this.formatDatePreview(u,y)):"Enter custom format above"}return this.formatDatePreview(u,j)}catch{return"Invalid format"}})()]}),e.jsxs(t.FormControl,{variant:"outlined",fullWidth:!0,sx:{mt:2},children:[e.jsx(t.InputLabel,{children:this.getText("timeFormat")}),e.jsx(t.Select,{value:x.timeFormat||JSON.stringify({hour:"2-digit",minute:"2-digit",hour12:!1}),onChange:u=>{const j=u.target.value,y=a.map(C=>C.uniqueName===h?{...C,timeFormat:j}:C);this.setState({entries:y}),this.onChange(this.props.attr,y)},label:this.getText("timeFormat"),children:this.timeFormats.map(u=>e.jsx(t.MenuItem,{value:JSON.stringify(u.value),children:this.getText(u.label)},u.label))})]}),e.jsxs(t.Typography,{variant:"caption",color:"text.secondary",sx:{mt:.5,display:"block"},children:[this.getText("timeFormatExample"),":"," ",(()=>{const u=new Date,j=x.timeFormat||JSON.stringify({hour:"2-digit",minute:"2-digit",hour12:!1});try{return this.formatTimePreview(u,j)}catch{return"Invalid format"}})()]}),e.jsx(t.Divider,{sx:{my:3}}),e.jsx(t.Typography,{variant:"h6",sx:{mb:2},children:this.getText("pageItems")}),e.jsxs(t.Box,{sx:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(80px, 1fr))",gap:2,mt:2},children:[e.jsxs(t.Box,{onClick:()=>{this.setState({editingPageItem:null,editingPageItemIndex:void 0})},sx:{display:"flex",flexDirection:"column",alignItems:"center",cursor:"pointer","&:hover":{opacity:.8}},children:[e.jsx(t.Box,{sx:{width:60,height:60,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:1,backgroundColor:"success.main",color:"white",fontSize:"2.5rem",fontWeight:"bold",mb:1},children:"+"}),e.jsx(t.Typography,{variant:"caption",sx:{textAlign:"center",fontSize:"0.75rem"},children:this.getText("add")})]}),(x.pageItems||[]).map((u,j)=>{const y=u.modeScr&&q[u.modeScr]?q[u.modeScr]:"?";return e.jsxs(t.Box,{onClick:()=>{this.setState({editingPageItem:u,editingPageItemIndex:j})},sx:{display:"flex",flexDirection:"column",alignItems:"center",cursor:"pointer","&:hover":{opacity:.8}},children:[e.jsx(t.Box,{sx:{width:60,height:60,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:1,backgroundColor:"action.hover",color:"primary.main",fontSize:"2rem",mb:1},children:y}),e.jsx(t.Typography,{variant:"caption",sx:{textAlign:"center",fontSize:"0.75rem"},children:u.headline||"Item"})]},j)})]})]})]}):e.jsx(t.Typography,{variant:"body2",color:"error",children:this.getText("screensaver_entry_not_found")})})()}):e.jsxs(t.Box,{children:[e.jsx(t.Typography,{variant:"h6",children:this.getText("screensaver_select_item")}),e.jsx(t.Box,{sx:{mt:2},children:e.jsx(t.Typography,{variant:"body2",color:"text.secondary",children:this.getText("screensaver_select_description")})})]})})}),e.jsx(t.Box,{sx:{width:{xs:"100%",md:`${_}%`},transition:"width 300ms ease",overflow:p?"hidden":"visible",display:p?{xs:"none",md:"block"}:"block"},children:e.jsx(K,{...this.props,widthPercent:30,oContext:this.props.oContext,uniqueName:(r==null?void 0:r.selected)||"",currentAssignments:(()=>{const h=r==null?void 0:r.selected;if(!h)return[];const x=a.find(b=>b.uniqueName===h);return(x==null?void 0:x.navigation)||[]})(),onAssign:(h,x)=>{const b=a.map(A=>A.uniqueName===h?{...A,navigation:x}:A);this.setState({entries:b}),this.onChange(this.props.attr,b)},hideNavigationFields:!0})})]})]})}}const Te=H(Ce),Me={NavigationView:te,IconSelect:ee,IconOverview:Z,PageConfigManager:ve,ScreensaverPage:Te};export{Me as default};
