import{A as k,b as N,S as B,c as P,d as R,w as L,e as $,C as q,a as Y,I as W,W as z}from"./NavigationView-D0HyKhIx.js";import{j as e}from"./createSvgIcon-BAyG150Y.js";import{A as t}from"./AdminComponentEasyAccessSet__loadShare___mf_0_mui_mf_1_material__loadShare__-DP1_LQ8a.js";import{V,a as U,I as O}from"./VisibilityOff-Bj1py224.js";import{R as F}from"./AdminComponentEasyAccessSet__loadShare__react__loadShare__-BWvOyvAg.js";import{A as C}from"./AdminComponentEasyAccessSet__loadShare___mf_0_iobroker_mf_1_adapter_mf_2_react_mf_2_v5__loadShare__-ChLGBbzW.js";import{T as M}from"./Tooltip-QmnnkgNQ.js";import"./index-BCpyQc2W.js";import"./_commonjsHelpers-CE1G-McA.js";import"./AdminComponentEasyAccessSet__mf_v__runtimeInit__mf_v__-DmMtQNcK.js";import"./Clear-jM7oAHDI.js";import"./useTheme-Cq43vfiC.js";import"./defaultTheme-BKgYrozm.js";import"./Grow-DxyKUkMA.js";class E extends k.ConfigGeneric{static defaultProps={widthPercent:30};constructor(a){super(a),this.state={...this.state,available:[],selectedTopic:"",added:[],assignments:a.currentAssignments||[],pagesMap:{},alive:!1,isCollapsed:!1,isLoading:{},lastLoadTime:{},focusReceived:{},retryCount:{}}}componentWillUnmount(){if(this.props.oContext&&this.props.oContext.socket){const a=this.props.oContext.instance??"0";this.props.oContext.socket.unsubscribeState(`system.adapter.${N}.${a}.alive`,this.onAliveChanged)}}async componentDidMount(){if(super.componentDidMount(),this.props.oContext&&this.props.oContext.socket){const a=this.props.oContext.instance??"0",o=`system.adapter.${N}.${a}.alive`;try{const r=await this.props.oContext.socket.getState(o),i=!!(r!=null&&r.val);this.setState({alive:i}),await this.props.oContext.socket.subscribeState(o,this.onAliveChanged)}catch(r){console.error("[NavigationAssignmentPanel] Failed to get alive state or subscribe:",r),this.setState({alive:!1})}}await this.loadPanels(!1),await this.applyAssignmentsFromProps(this.props.currentAssignments||[])}onAliveChanged=(a,o)=>{const r=this.state.alive,i=o?!!o.val:!1;r!==i&&(this.setState({alive:i}),!r&&i&&this.state.assignments.length>0&&this.retryLoadingPagesForAssignments())};async applyAssignmentsFromProps(a){var n;const o=(a||[]).map(g=>this.state.available.find(b=>b.panelTopic===g.topic)||{panelTopic:g.topic,friendlyName:g.topic}).sort((g,_)=>g.friendlyName.localeCompare(_.friendlyName)),r=this.state.selectedAddedTopic,l=o.find(g=>g.panelTopic===r)?r:(n=o[0])==null?void 0:n.panelTopic;this.setState({assignments:a,added:o,selectedAddedTopic:l,selectedTopic:""});const s=o.map(g=>this.loadPagesForPanel(g.panelTopic,!0));await Promise.all(s)}componentDidUpdate(a){if(a.uniqueName!==this.props.uniqueName){const o=this.props.currentAssignments||[];this.props.uniqueName&&this.setState(r=>({focusReceived:{...r.focusReceived,[this.props.uniqueName]:!0}})),this.loadPanels(!1).then(()=>{this.applyAssignmentsFromProps(o)})}else if(a.currentAssignments!==this.props.currentAssignments&&this.props.currentAssignments){const o=this.props.currentAssignments||[];this.applyAssignmentsFromProps(o)}}async loadPanels(a=!0){try{let o=[];if(this.props.fetchPanels)o=await this.props.fetchPanels();else if(this.props.oContext&&this.props.oContext.socket){const r=this.props.oContext.instance??"0",i=`${N}.${r}`;try{const l=await this.props.oContext.socket.sendTo(i,B,null);Array.isArray(l)?o=l:l&&Array.isArray(l.result)&&(o=l.result)}catch(l){console.error("[NavigationAssignmentPanel] sendTo failed",{target:i,cmd:B,error:l})}}this.setState({available:o,selectedTopic:""})}catch{this.setState({available:[],selectedTopic:""})}}doAddSelected=()=>{const{selectedTopic:a,available:o,added:r}=this.state;if(!a)return;let i=o.find(n=>n.panelTopic===a);if(!i&&a===P&&(i={panelTopic:P,friendlyName:`(${C.I18n.t("all")||"All"})`}),!i||r.find(n=>n.panelTopic===i.panelTopic))return;const l=[...r,i],s=[...this.state.assignments,{topic:i.panelTopic}];this.setState({added:l,assignments:s,selectedTopic:""}),this.loadPagesForPanel(i.panelTopic),this.props.onAssign&&this.props.uniqueName&&this.props.onAssign(this.props.uniqueName,s)};doRemoveSelected=()=>{const{added:a,selectedAddedTopic:o}=this.state;if(a.length)if(o){const r=a.filter(n=>n.panelTopic!==o),i=this.state.assignments.filter(n=>n.topic!==o),l=a.findIndex(n=>n.panelTopic===o);let s;if(r.length>0){const n=r[l]??r[l-1]??r[0];s=n==null?void 0:n.panelTopic}else s=void 0;this.setState({added:r,assignments:i,selectedAddedTopic:s}),this.props.onAssign&&this.props.uniqueName&&this.props.onAssign(this.props.uniqueName,i)}else{const r=a.slice(0,-1),i=this.state.assignments.slice(0,-1),l=r.length?r[r.length-1].panelTopic:void 0;this.setState({added:r,assignments:i,selectedAddedTopic:l}),this.props.onAssign&&this.props.uniqueName&&this.props.onAssign(this.props.uniqueName,i)}};selectAdded=a=>{this.setState({selectedAddedTopic:a}),this.loadPagesForPanel(a,!0)};retryLoadingPagesForAssignments(){const a=this.state.assignments.map(o=>o.topic);for(const o of a)this.loadPagesForPanel(o,!0)}async loadPagesForPanel(a,o=!1){var g,_;if(!a)return;if(!this.state.alive){console.log(`[NavigationAssignmentPanel] Adapter not alive, skipping pages load for ${a}`);return}const r=Date.now(),i=this.state.lastLoadTime[a]||0,l=this.state.isLoading[a],s=!!this.state.pagesMap[a],n=o||!s||r-i>6e4;if(!(l||!n&&s)){this.setState(b=>({isLoading:{...b.isLoading,[a]:!0},lastLoadTime:{...b.lastLoadTime,[a]:r}}));try{let b=[],S=!1;if((g=this.props.oContext)!=null&&g.socket){const d=this.props.oContext.instance??"0",m=`${N}.${d}`,h={panelTopic:a};try{const u=new Promise((A,w)=>{setTimeout(()=>w(new Error("sendTo timeout after 2 seconds")),2e3)}),v=this.props.oContext.socket.sendTo(m,R,h),x=await Promise.race([v,u]);Array.isArray(x)?(b=x,S=!0):x&&Array.isArray(x.result)&&(b=x.result,S=!0),console.log("[NavigationAssignmentPanel] sendTo successful",{topic:a,pages:b})}catch(u){console.warn("[NavigationAssignmentPanel] sendTo failed or timed out",{target:m,cmd:R,payload:h,error:u})}}if(S&&b.length===0){const d=this.state.retryCount[a]||0,m=3,h=2e3;if(d<m){console.log(`[NavigationAssignmentPanel] Got empty array for ${a}, retrying in ${h}ms (attempt ${d+1}/${m})`),this.setState(u=>({retryCount:{...u.retryCount,[a]:d+1}})),setTimeout(()=>{this.setState(u=>({isLoading:{...u.isLoading,[a]:!1}})),this.loadPagesForPanel(a,!0)},h);return}console.log(`[NavigationAssignmentPanel] Max retries reached for ${a}, accepting empty result`),this.setState(u=>({retryCount:{...u.retryCount,[a]:0}}))}else S&&b.length>0&&this.setState(d=>({retryCount:{...d.retryCount,[a]:0}}));if(!S&&!((_=this.props.oContext)!=null&&_.socket)&&(await new Promise(d=>setTimeout(d,1e3)),this.setState(d=>({isLoading:{...d.isLoading,[a]:!1}})),!this.state.focusReceived[a]))return this.setState(d=>({focusReceived:{...d.focusReceived,[a]:!0}})),this.loadPagesForPanel(a,!0);this.setState(d=>({pagesMap:{...d.pagesMap,[a]:b},isLoading:{...d.isLoading,[a]:!1}}))}catch(b){console.error("[NavigationAssignmentPanel] loadPagesForPanel error",{topic:a,error:b}),this.setState(S=>({isLoading:{...S.isLoading,[a]:!1}}))}}}setNavigationForSelected=a=>{const{selectedAddedTopic:o,assignments:r}=this.state;if(!o)return;const i=r.findIndex(g=>g.topic===o),l=[...r],s=r[i],n={topic:o,navigation:{...s==null?void 0:s.navigation,...a}};i>=0?l[i]=n:l.push(n),this.setState({assignments:l}),this.props.onAssign&&this.props.uniqueName&&this.props.onAssign(this.props.uniqueName,l)};getNavValue=(a,o)=>{var l;if(!a)return"";const r=this.state.assignments.find(s=>s.topic===a);return((l=r==null?void 0:r.navigation)==null?void 0:l[o])||""};togglePanel=()=>{const a=this.state.isCollapsed;this.setState(o=>({isCollapsed:!o.isCollapsed})),a&&this.applyAssignmentsFromProps(this.props.currentAssignments||[])};renderItem(a,o,r){const{widthPercent:i}=this.props,{isCollapsed:l}=this.state,s=this.state.selectedAddedTopic?this.state.pagesMap[this.state.selectedAddedTopic]??[]:[];return e.jsxs(t.Box,{sx:{position:{xs:"static",md:"absolute"},right:{xs:"auto",md:0},top:{xs:"auto",md:0},height:{xs:"auto",md:"100%"},width:{xs:"100%",md:l?"10px":`${i}%`},minHeight:{xs:l?"50px":"auto",md:"auto"},transition:"width 240ms ease, min-height 240ms ease",backgroundColor:"background.default",border:{xs:"2px solid",md:"none"},borderLeft:{xs:"none",md:"2px solid"},borderTop:{xs:"none",md:"2px solid"},borderColor:"secondary.main",borderRadius:{xs:1,md:0},overflow:{xs:"hidden",md:"visible"},display:"flex",flexDirection:"column",zIndex:20,mt:{xs:2,md:0}},children:[e.jsx(t.Box,{sx:{display:{xs:"none",md:"flex"},position:"absolute",left:"-20px",top:"50%",transform:"translateY(-50%)",width:"20px",height:"60px",backgroundColor:"secondary.main",borderRadius:"4px 0 0 4px",alignItems:"center",justifyContent:"center",cursor:"pointer",zIndex:21,"&:hover":{backgroundColor:"secondary.dark"}},onClick:this.togglePanel,children:e.jsx(t.Typography,{sx:{color:"secondary.contrastText",fontSize:"14px",fontWeight:"bold",transform:"rotate(-90deg)",whiteSpace:"nowrap"},children:l?"⏶":"⏷"})}),e.jsx(t.Box,{sx:{display:{xs:"flex",md:"none"},alignItems:"center",justifyContent:"center",p:1,backgroundColor:"secondary.main",color:"secondary.contrastText",borderRadius:"4px 4px 0 0"},children:e.jsx(t.Typography,{variant:"subtitle2",sx:{fontWeight:600},children:C.I18n.t("navigation_panel")})}),e.jsxs(t.Box,{sx:{p:1,height:"100%",display:{xs:"flex",md:l?"none":"flex"},flexDirection:"column",width:{xs:"100%",md:l?"0%":"100%"},overflow:"hidden",transition:{xs:"none",md:"width 240ms ease"}},children:[e.jsx(t.Typography,{variant:"h6",sx:{mb:1,fontWeight:600,color:"primary.main",fontSize:"1rem",display:{xs:"none",md:"block"}},children:C.I18n.t("navigation_panel")}),e.jsxs(t.Box,{sx:{display:"flex",gap:1,alignItems:"center",mb:1},children:[e.jsxs(t.Select,{size:"small",variant:"standard",value:this.state.selectedTopic,onOpen:()=>{this.loadPanels()},onChange:n=>this.setState({selectedTopic:String(n.target.value)}),disabled:!this.state.alive,sx:{flex:1,backgroundColor:"transparent",minHeight:40,"& .MuiSelect-select":{backgroundColor:"transparent",display:"flex",alignItems:"center",height:40}},displayEmpty:!0,children:[e.jsx(t.MenuItem,{value:"",children:e.jsx("em",{children:"—"})}),e.jsx(t.MenuItem,{value:P,children:`(${C.I18n.t("all")||"All"})`}),this.state.available.map(n=>e.jsx(t.MenuItem,{value:n.panelTopic,children:n.friendlyName},n.panelTopic))]}),e.jsx(t.Button,{size:"small",variant:"contained",sx:{minWidth:32,padding:"4px 8px"},onClick:this.doAddSelected,disabled:!this.state.selectedTopic||!this.state.alive,children:"+"})]}),e.jsx(t.Box,{children:this.state.added.length===0?e.jsx(t.Typography,{variant:"body2",color:"text.secondary",children:C.I18n.t("No panels added")}):e.jsx("div",{style:{overflow:"auto"},children:e.jsx(t.List,{dense:!0,children:this.state.added.map(n=>{const g=n.panelTopic;return e.jsx(F.Fragment,{children:e.jsx(t.ListItem,{component:"div",children:e.jsx(t.ListItemButton,{selected:this.state.selectedAddedTopic===g,onClick:()=>this.selectAdded(g),children:e.jsx(t.ListItemText,{primary:g===P?`(${C.I18n.t("all")||"All"})`:n.friendlyName})})})},g)})})})}),e.jsx(t.Box,{sx:{display:"flex",gap:1,justifyContent:"flex-end",mt:1},children:e.jsx(t.Button,{size:"small",color:"error",variant:"contained",onClick:this.doRemoveSelected,disabled:this.state.added.length===0,sx:{minWidth:32,padding:"4px 8px"},children:"-"})}),e.jsx(t.Divider,{sx:{my:1}}),e.jsxs(t.Box,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:1,mt:1},children:[e.jsxs(t.Box,{children:[e.jsx(t.Box,{sx:{display:"flex",alignItems:"center",mb:.5},children:e.jsx(M,{title:C.I18n.t("nav_prev_tooltip"),children:e.jsx(t.Typography,{variant:"caption",color:"text.secondary",sx:{mr:.5},children:"prev"})})}),e.jsxs(t.Select,{size:"small",displayEmpty:!0,"aria-label":"prev",value:this.getNavValue(this.state.selectedAddedTopic,"prev")||"",onOpen:()=>{this.state.selectedAddedTopic&&this.loadPagesForPanel(this.state.selectedAddedTopic,!0)},onChange:n=>this.setNavigationForSelected({prev:String(n.target.value)||void 0}),sx:{width:"100%"},disabled:!this.state.alive||this.state.selectedAddedTopic&&this.state.isLoading[this.state.selectedAddedTopic]||!1,endAdornment:this.state.selectedAddedTopic&&this.state.isLoading[this.state.selectedAddedTopic]?e.jsx(t.Box,{sx:{display:"flex",alignItems:"center",pr:1},children:e.jsx(t.CircularProgress,{size:16})}):null,children:[e.jsx(t.MenuItem,{value:"",children:this.state.selectedAddedTopic?e.jsx("em",{children:"—"}):e.jsx("em",{children:C.I18n.t("select_panel_first")})}),s.filter(n=>n!==this.props.uniqueName).map(n=>e.jsx(t.MenuItem,{value:n,children:n},`prev-${n}`))]})]}),e.jsxs(t.Box,{children:[e.jsx(t.Box,{sx:{display:"flex",alignItems:"center",mb:.5},children:e.jsx(M,{title:C.I18n.t("nav_next_tooltip"),children:e.jsx(t.Typography,{variant:"caption",color:"text.secondary",sx:{mr:.5},children:"next"})})}),e.jsxs(t.Select,{size:"small",displayEmpty:!0,"aria-label":"next",value:this.getNavValue(this.state.selectedAddedTopic,"next")||"",onOpen:()=>{this.state.selectedAddedTopic&&this.loadPagesForPanel(this.state.selectedAddedTopic,!0)},onChange:n=>this.setNavigationForSelected({next:String(n.target.value)||void 0}),sx:{width:"100%"},disabled:!this.state.alive||this.state.selectedAddedTopic&&this.state.isLoading[this.state.selectedAddedTopic]||!1,endAdornment:this.state.selectedAddedTopic&&this.state.isLoading[this.state.selectedAddedTopic]?e.jsx(t.Box,{sx:{display:"flex",alignItems:"center",pr:1},children:e.jsx(t.CircularProgress,{size:16})}):null,children:[e.jsx(t.MenuItem,{value:"",children:this.state.selectedAddedTopic?e.jsx("em",{children:"—"}):e.jsx("em",{children:C.I18n.t("select_panel_first")})}),s.filter(n=>n!==this.props.uniqueName&&!n.startsWith("///")).map(n=>e.jsx(t.MenuItem,{value:n,children:n},`next-${n}`))]})]}),e.jsxs(t.Box,{children:[e.jsx(t.Typography,{variant:"caption",color:"text.secondary",sx:{mb:.5,display:"block"},children:"home"}),e.jsxs(t.Select,{size:"small",displayEmpty:!0,"aria-label":"home",value:this.getNavValue(this.state.selectedAddedTopic,"home")||"",onOpen:()=>{this.state.selectedAddedTopic&&this.loadPagesForPanel(this.state.selectedAddedTopic,!0)},onChange:n=>this.setNavigationForSelected({home:String(n.target.value)||void 0}),sx:{width:"100%"},disabled:!this.state.alive||this.state.selectedAddedTopic&&this.state.isLoading[this.state.selectedAddedTopic]||!1,endAdornment:this.state.selectedAddedTopic&&this.state.isLoading[this.state.selectedAddedTopic]?e.jsx(t.Box,{sx:{display:"flex",alignItems:"center",pr:1},children:e.jsx(t.CircularProgress,{size:16})}):null,children:[e.jsx(t.MenuItem,{value:"",children:e.jsx("em",{children:"—"})}),s.filter(n=>n!==this.props.uniqueName).map(n=>e.jsx(t.MenuItem,{value:n,children:n},`home-${n}`))]})]}),e.jsxs(t.Box,{children:[e.jsx(t.Typography,{variant:"caption",color:"text.secondary",sx:{mb:.5,display:"block"},children:"parent"}),e.jsxs(t.Select,{size:"small",displayEmpty:!0,"aria-label":"parent",value:this.getNavValue(this.state.selectedAddedTopic,"parent")||"",onOpen:()=>{this.state.selectedAddedTopic&&this.loadPagesForPanel(this.state.selectedAddedTopic,!0)},onChange:n=>this.setNavigationForSelected({parent:String(n.target.value)||void 0}),sx:{width:"100%"},disabled:!this.state.alive||this.state.selectedAddedTopic&&this.state.isLoading[this.state.selectedAddedTopic]||!1,endAdornment:this.state.selectedAddedTopic&&this.state.isLoading[this.state.selectedAddedTopic]?e.jsx(t.Box,{sx:{display:"flex",alignItems:"center",pr:1},children:e.jsx(t.CircularProgress,{size:16})}):null,children:[e.jsx(t.MenuItem,{value:"",children:e.jsx("em",{children:"—"})}),s.filter(n=>n!==this.props.uniqueName).map(n=>e.jsx(t.MenuItem,{value:n,children:n},`parent-${n}`))]})]}),e.jsx(t.Divider,{sx:{my:1}})]}),this.state.added.length>0?this.state.added.map(n=>{const g=n.panelTopic,_=this.state.added.some(A=>A.panelTopic===P),b=this.getNavValue(g,"next"),S=this.getNavValue(g,"prev"),d=this.getNavValue(g,"home"),m=this.getNavValue(g,"parent"),h=!!(b||S||d||m),u=g===P,v=!b&&!S,x=u?"nav_all_requires_prev_next":_?"nav_remove_from_all_notice":"nav_target_only_notice";return e.jsxs(t.Box,{"data-has-all":_,sx:{mt:2,mb:1},children:[e.jsxs(t.Box,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:[e.jsx(t.Box,{sx:{width:10,height:10,borderRadius:"50%",bgcolor:h?"success.main":"error.main"}}),e.jsx(t.Typography,{variant:"subtitle2",sx:{fontWeight:600},children:g===P?`(${C.I18n.t("all")||"All"})`:n.friendlyName||g})]}),e.jsx(t.Box,{sx:{display:"flex",alignItems:"center",gap:1,flexWrap:"wrap"},children:["next","prev","parent","home"].map((A,w)=>{const I=this.getNavValue(g,A);return e.jsxs(F.Fragment,{children:[e.jsxs(t.Box,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(t.Typography,{variant:"caption",color:"text.secondary",children:C.I18n.t(A)||A}),e.jsx(t.Typography,{variant:"body2",children:I||e.jsx("em",{children:"—"})})]}),w<3&&e.jsx(t.Divider,{orientation:"vertical",flexItem:!0,sx:{height:18,mx:1}})]},`${g}-${A}`)})}),v?e.jsx(t.Box,{sx:{mt:1},children:e.jsx(t.Typography,{variant:"caption",color:"text.secondary",sx:{fontStyle:"italic"},children:C.I18n.t(x)})}):null]},`panel-summary-${g}`)}):null]})]})}}class H extends k.ConfigGeneric{_local=null;pagesRetryTimeout;constructor(a){super(a);const o=k.ConfigGeneric.getValue(a.data,a.attr);this.state={...this.state,entries:Array.isArray(o)?o:[],confirmDeleteOpen:!1,confirmDeleteName:null,alive:!1,pagesRetryCount:0}}componentWillUnmount(){this.pagesRetryTimeout&&clearTimeout(this.pagesRetryTimeout);const a=this.props.oContext.instance??"0";this.props.oContext.socket.unsubscribeState(`system.adapter.${N}.${a}.alive`,this.onAliveChanged)}async componentDidMount(){super.componentDidMount();const a=this.props.oContext.instance??"0",o=`system.adapter.${N}.${a}.alive`;try{const r=await this.props.oContext.socket.getState(o),i=!!(r!=null&&r.val);this.setState({alive:i}),await this.props.oContext.socket.subscribeState(o,this.onAliveChanged),i&&await this.loadPagesList()}catch(r){console.error("[UnlockPage] Failed to get alive state or subscribe:",r),this.setState({alive:!1})}}onAliveChanged=(a,o)=>{const r=this.state.alive,i=o?!!o.val:!1;r!==i&&(this.setState({alive:i}),!r&&i&&(!this.state.pagesList||this.state.pagesList.length===0)&&this.loadPagesList(),r&&!i&&this.pagesRetryTimeout&&(clearTimeout(this.pagesRetryTimeout),this.pagesRetryTimeout=void 0))};async loadPagesList(){if(!this.state.alive){console.log("[UnlockPage] Adapter not alive, skipping pages load");return}const a=[];if(this.props.oContext&&this.props.oContext.socket){const o=this.props.oContext.instance??"0",r=`${N}.${o}`;try{const i=await this.props.oContext.socket.sendTo(r,$,null);let l=[];Array.isArray(i)?l=i:i&&Array.isArray(i.result)&&(l=i.result);for(const s of l)a.push(s);if(l.length===0){const s=this.state.pagesRetryCount||0,n=3e3;console.log(`[UnlockPage] Got empty pages array, retrying in ${n}ms (attempt ${s+1})`),this.setState({pagesRetryCount:s+1}),this.pagesRetryTimeout&&clearTimeout(this.pagesRetryTimeout),this.pagesRetryTimeout=setTimeout(()=>{this.state.alive?this.loadPagesList():console.log("[UnlockPage] Adapter went offline, cancelling pages retry")},n);return}else l.length>0&&(console.log(`[UnlockPage] Successfully loaded ${l.length} pages after ${this.state.pagesRetryCount||0} retries`),this.setState({pagesRetryCount:0}),this.pagesRetryTimeout&&(clearTimeout(this.pagesRetryTimeout),this.pagesRetryTimeout=void 0))}catch(i){const l=this.state.pagesRetryCount||0,s=3e3;console.log(`[UnlockPage] Error loading pages, retrying in ${s}ms (attempt ${l+1}): ${String(i)}`),this.setState({pagesRetryCount:l+1}),this.pagesRetryTimeout&&clearTimeout(this.pagesRetryTimeout),this.pagesRetryTimeout=setTimeout(()=>{this.state.alive?this.loadPagesList():console.log("[UnlockPage] Adapter went offline, cancelling pages retry after error")},s);return}}else{console.log("[UnlockPage] No socket available for sendTo");return}this.setState({pagesList:Array.from(new Set(a))})}renderItem(a,o,r){var S;const i=this.state.entries||[],l=Array.from(new Set(i.map(d=>d.uniqueName))).filter(Boolean);this._local||(this._local={newName:"",selected:l[0]||"",showPin:!1});const s=this._local,n=()=>{const d=(s.newName||"").trim();if(!d)return;const m={card:"cardAlarm",uniqueName:d,headline:d,button1:"",button2:"",button3:"",button4:"",pin:0},h=[...i,m];this.setState({entries:h}),this.onChange(this.props.attr,h),s.newName="",s.selected=d},g=()=>{const d=s.selected;d&&this.setState({confirmDeleteOpen:!0,confirmDeleteName:d})},_=()=>{this.setState({confirmDeleteOpen:!1,confirmDeleteName:null})},b=()=>{const d=this.state.confirmDeleteName;if(!d){_();return}const m=i.filter(u=>u.uniqueName!==d);this.setState({entries:m,confirmDeleteOpen:!1,confirmDeleteName:null}),this.onChange(this.props.attr,m);const h=Array.from(new Set(m.map(u=>u.uniqueName))).filter(Boolean);s.selected=h[0]||"",this.setState({})};return e.jsxs(t.Box,{sx:{height:"calc(100vh - 64px)",display:"flex",flexDirection:{xs:"column",md:"row"},p:1},children:[e.jsxs(t.Box,{sx:{width:{xs:"100%",md:"20%"},pr:{xs:0,md:1},display:"flex",flexDirection:"column",gap:1},children:[e.jsx(t.Typography,{variant:"h6",sx:{mb:1,fontWeight:600,color:"primary.main",fontSize:"1rem"},children:this.getText("pages")}),e.jsx(t.Paper,{sx:{p:1,backgroundColor:"transparent"},elevation:0,children:e.jsxs(t.Box,{sx:{display:"flex",gap:1},children:[e.jsx(t.TextField,{"aria-label":"new-name",label:this.getText("new_page"),value:s.newName,onChange:d=>{s.newName=d.target.value,this.setState({})},variant:"standard",placeholder:this.getText("New item"),InputProps:{sx:{backgroundColor:"transparent",px:1}},sx:{flex:1,"& .MuiInput-underline:before":{borderBottomColor:"primary.main"},"& .MuiInput-underline:hover:before":{borderBottomColor:"primary.main"},"& .MuiInput-underline:after":{borderBottomColor:"primary.main"},"& .MuiInputLabel-root":{color:"primary.main"},"& .MuiInputLabel-root.Mui-focused":{color:"primary.main"}}}),e.jsx(t.Button,{size:"small",variant:"contained",onClick:n,disabled:(()=>{const d=(s.newName||"").trim();return!d||l.includes(d)})(),children:"+"})]})}),e.jsx(t.Paper,{sx:{overflow:"auto",p:1,backgroundColor:"transparent"},elevation:0,children:l.length===0?e.jsx(t.Typography,{variant:"body2",color:"text.secondary",children:this.getText("No items")}):l.map(d=>e.jsx(t.Box,{onClick:()=>{s.selected=d,this.setState({})},sx:{p:1,borderRadius:1,cursor:"pointer",backgroundColor:s.selected===d?"action.selected":"transparent",mb:.5},children:e.jsx(t.Typography,{variant:"body2",children:d})},d))}),e.jsx(t.Box,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(t.Button,{size:"small",color:"error",variant:"outlined",onClick:g,disabled:!s.selected,children:"-"})}),e.jsx(t.Divider,{sx:{my:1}}),e.jsx(t.Box,{sx:{mb:2},children:e.jsx("a",{href:"https://github.com/ticaki/ioBroker.nspanel-lovelace-ui/wiki/pageUnlock",target:"_blank",rel:"noopener noreferrer",style:{textDecoration:"none",color:"inherit",fontSize:"0.875rem"},children:e.jsx(t.Typography,{variant:"body2",sx:{color:"primary.main",textDecoration:"underline",cursor:"pointer","&:hover":{opacity:.8}},children:this.getText("documentation")})})})]}),e.jsx(q,{open:!!this.state.confirmDeleteOpen,onClose:_,onConfirm:b,title:this.getText("unlock_delete_confirm_title"),description:this.getText("unlock_delete_confirm_text")+(this.state.confirmDeleteName?`: ${this.state.confirmDeleteName}`:""),cancelText:this.getText("Cancel"),confirmText:this.getText("Delete"),ariaTitleId:"unlock-delete-confirm-title",ariaDescId:"unlock-delete-confirm-description"}),e.jsxs(t.Box,{sx:{width:{xs:"100%",md:"90%"},pl:{xs:0,md:2},mt:{xs:2,md:0},display:"flex",flexDirection:{xs:"column",md:"row"},gap:1,position:"relative"},children:[e.jsx(t.Box,{sx:{width:{xs:"100%",md:"95%"},borderLeft:{xs:"none",md:"1px solid"},borderColor:"divider"},children:e.jsx(t.Paper,{sx:{height:"100%",p:2},elevation:1,children:s.selected?e.jsx(t.Box,{children:(()=>{const d=s.selected,m=i.find(h=>h.uniqueName===d);return m?e.jsxs(e.Fragment,{children:[e.jsx(t.Box,{sx:{mb:1,p:1,borderRadius:1,backgroundColor:"action.hover"},children:e.jsx(t.TextField,{fullWidth:!0,variant:"standard",type:"text",label:this.getText("unlock_unique_label"),value:d,onChange:h=>{const u=h.target.value;if(!u.trim())return;const v=i.map(x=>x.uniqueName===d?{...x,uniqueName:u}:x);this.setState({entries:v}),this.onChange(this.props.attr,v),s.selected=u},InputProps:{sx:{backgroundColor:"transparent",px:1,fontWeight:600,width:"50%"}}})}),e.jsx(t.Box,{sx:{mb:1},children:e.jsxs(t.FormControl,{component:"fieldset",children:[e.jsx(t.Typography,{variant:"subtitle2",sx:{mb:1},children:this.getText("unlock_type")}),e.jsxs(t.RadioGroup,{row:!0,value:(m==null?void 0:m.alarmType)||"",onChange:(h,u)=>{const v=i.map(x=>x.uniqueName===d?{...x,alarmType:u}:x);this.setState({entries:v}),this.onChange(this.props.attr,v)},children:[e.jsx(t.FormControlLabel,{value:"alarm",control:e.jsx(t.Radio,{}),label:this.getText("unlock_alarm")}),e.jsx(t.FormControlLabel,{value:"unlock",control:e.jsx(t.Radio,{}),label:this.getText("unlock_unlock")})]})]})}),e.jsx(t.TextField,{fullWidth:!0,variant:"standard",type:"text",autoComplete:"off",label:this.getText("unlock_headline"),value:m.headline??"",onChange:h=>{const u=h.target.value,v=i.map(x=>x.uniqueName===d?{...x,headline:u}:x);this.setState({entries:v}),this.onChange(this.props.attr,v)},InputProps:{sx:{backgroundColor:"transparent",px:1,width:"50%"}},sx:{mb:2}}),e.jsx(t.Box,{sx:{mt:2},children:e.jsx(t.TextField,{variant:"standard",label:this.getText("unlock_pin"),type:s.showPin?"text":"password",value:m.pin!==void 0&&m.pin!==null?String(m.pin):"",onChange:h=>{const v=h.target.value.replace(/[^0-9]/g,""),x=v?parseInt(v,10):0,A=i.map(w=>w.uniqueName===d?{...w,pin:x}:w);this.setState({entries:A}),this.onChange(this.props.attr,A)},InputProps:{sx:{backgroundColor:"transparent",px:1},endAdornment:e.jsx(t.InputAdornment,{position:"end",children:e.jsx(t.IconButton,{"aria-label":s.showPin?"hide-pin":"show-pin",onClick:()=>{s.showPin=!s.showPin,this.setState({})},edge:"end",size:"small",children:s.showPin?e.jsx(V,{fontSize:"small"}):e.jsx(U,{fontSize:"small"})})})}})}),e.jsxs(t.Box,{sx:{mt:2},children:[e.jsx(t.FormControlLabel,{control:e.jsx(t.Checkbox,{checked:!!m.hidden,onChange:(h,u)=>{const v=i.map(x=>x.uniqueName===d?{...x,hidden:u}:x);this.setState({entries:v}),this.onChange(this.props.attr,v)}}),label:this.getText("unlock_hidden")}),e.jsx(t.Box,{sx:{mt:2},children:e.jsxs(t.FormControl,{component:"fieldset",children:[e.jsx(t.Typography,{variant:"subtitle2",sx:{mb:1},children:this.getText("unlock_alwaysOn")}),e.jsxs(t.RadioGroup,{row:!0,value:(m==null?void 0:m.alwaysOn)||"none",onChange:(h,u)=>{const v=i.map(x=>x.uniqueName===d?{...x,alwaysOn:u}:x);this.setState({entries:v}),this.onChange(this.props.attr,v)},children:[e.jsx(t.FormControlLabel,{value:"none",control:e.jsx(t.Radio,{}),label:this.getText("unlock_alwaysOn_none")}),e.jsx(t.FormControlLabel,{value:"always",control:e.jsx(t.Radio,{}),label:this.getText("unlock_alwaysOn_always")}),e.jsx(t.FormControlLabel,{value:"ignore",control:e.jsx(t.Radio,{}),label:this.getText("unlock_alwaysOn_ignore")})]})]})})]}),m.alarmType==="alarm"&&e.jsxs(t.Box,{sx:{mt:2},children:[e.jsx(t.Box,{sx:{display:"grid",gridTemplateColumns:"1fr",gap:2},children:[1,2,3,4].map(h=>{const u=`button${h}`;return e.jsxs(t.Box,{children:[e.jsx(t.Typography,{variant:"caption",color:"text.secondary",sx:{mb:.5},children:this.getText(`unlock_button${h}_label`)}),e.jsx(t.TextField,{fullWidth:!0,variant:"standard",placeholder:this.getText(`unlock_button${h}_placeholder`),value:m[u]??"",onChange:v=>{const x=v.target.value,A=i.map(w=>w.uniqueName===d?{...w,[u]:x}:w);this.setState({entries:A}),this.onChange(this.props.attr,A)},InputProps:{disableUnderline:!0,sx:{backgroundColor:"transparent",px:1,"& input::placeholder":{color:"text.disabled"}}}})]},h)})}),e.jsx(t.Box,{sx:{mt:1},children:e.jsx(t.FormControlLabel,{control:e.jsx(t.Checkbox,{checked:!!m.approved,onChange:(h,u)=>{const v=i.map(x=>x.uniqueName===d?{...x,approved:u}:x);this.setState({entries:v}),this.onChange(this.props.attr,v)}}),label:this.getText("unlock_approved")})})]}),m.alarmType==="unlock"&&e.jsxs(t.Box,{sx:{mt:2},children:[e.jsx(t.Typography,{variant:"caption",color:"text.secondary",sx:{mb:.5},children:this.getText("unlock_setnavi_hint")}),e.jsxs(t.Select,{variant:"standard",displayEmpty:!0,value:m.setNavi??"",onChange:h=>{const u=String(h.target.value),v=i.map(x=>x.uniqueName===d?{...x,setNavi:u}:x);this.setState({entries:v}),this.onChange(this.props.attr,v)},sx:{backgroundColor:"transparent",px:1,width:"60%"},children:[e.jsx(t.MenuItem,{value:"",children:e.jsx("em",{children:this.getText("unlock_setnavi_placeholder")})}),(this.state.pagesList||[]).filter(h=>typeof h=="string"&&!h.startsWith("///")&&h!==d).map(h=>e.jsx(t.MenuItem,{value:h,children:h},h)),m.setNavi&&m.setNavi!==d&&!(this.state.pagesList||[]).includes(m.setNavi)&&e.jsx(t.MenuItem,{value:m.setNavi,children:m.setNavi},`custom-${m.setNavi}`)]})]})]}):null})()}):e.jsxs(t.Box,{children:[e.jsx(t.Typography,{variant:"h6",children:this.getText("unlock_select_item")}),e.jsx(t.Box,{sx:{mt:2},children:e.jsx(t.Typography,{variant:"body2",color:"text.secondary",children:this.getText("unlock_select_description")})})]})})}),e.jsx(E,{...this.props,widthPercent:30,uniqueName:s.selected,currentAssignments:((S=i.find(d=>d.uniqueName===s.selected))==null?void 0:S.navigationAssignment)||[],oContext:this.props.oContext,onAssign:(d,m)=>{const h=i.map(u=>u.uniqueName===d?{...u,navigationAssignment:m}:u);this.setState({entries:h}),this.onChange(this.props.attr,h)}}),e.jsx(t.Paper,{sx:{height:"100%",p:2,backgroundColor:"transparent"},elevation:0,children:e.jsxs(t.Box,{children:[e.jsx(t.Typography,{variant:"subtitle2",sx:{mb:1},children:this.getText("unlock_unique_label")}),e.jsx(t.Typography,{variant:"body1",sx:{fontWeight:600},children:s.selected||this.getText("unlock_select_item")}),e.jsx(O,{fontSize:"small",color:"action",sx:{mt:1}})]})})]})]})}}const G=L(H);class J extends F.Component{schema;constructor(a){super(a),this.state={selectedObjectId:"",data:{testObjectId:""}};const o={type:"objectId",label:"Select an object",sm:12,md:12,lg:12,...this.props.objectIdConfig};this.schema={type:"panel",label:"Object Selector Test",items:{testObjectId:o}}}handleClose=()=>{this.props.onClose&&this.props.onClose()};handleSelect=()=>{this.props.onSelect&&this.state.data.testObjectId&&this.props.onSelect(this.state.data.testObjectId),this.handleClose()};handleChange=a=>{this.setState({data:a})};render(){const{open:a,socket:o,themeName:r,themeType:i,theme:l,adapterName:s,instance:n}=this.props;return e.jsxs(t.Dialog,{open:a,onClose:this.handleClose,maxWidth:"md",fullWidth:!0,"aria-labelledby":"object-selector-dialog-title",children:[e.jsx(t.DialogTitle,{id:"object-selector-dialog-title",children:C.I18n.t("Object Selector Test")}),e.jsx(t.DialogContent,{children:e.jsxs(t.Box,{sx:{py:2},children:[e.jsx(k.JsonConfigComponent,{socket:o,themeName:r,themeType:i,theme:l,adapterName:s||"nspanel-lovelace-ui",instance:n||0,schema:this.schema,data:this.state.data,onChange:this.handleChange,isFloatComma:!1,dateFormat:"DD.MM.YYYY",onError:()=>{}}),e.jsxs(t.Box,{sx:{mt:2,color:"text.secondary",fontSize:"0.875rem"},children:[C.I18n.t("Selected object"),": ",this.state.data.testObjectId||e.jsx("em",{children:"—"})]})]})}),e.jsxs(t.DialogActions,{children:[e.jsx(t.Button,{onClick:this.handleClose,color:"secondary",children:C.I18n.t("Cancel")}),e.jsx(t.Button,{onClick:this.handleSelect,color:"primary",variant:"contained",disabled:!this.state.data.testObjectId,children:C.I18n.t("Select")})]})]})}}class K extends k.ConfigGeneric{_local=null;pagesRetryTimeout;dateFormats=[{value:{dateStyle:"short"},label:"DD.MM.YY"},{value:{dateStyle:"short",locale:"en-US"},label:"MM/DD/YY"},{value:{year:"numeric",month:"2-digit",day:"2-digit"},label:"YYYY-MM-DD"},{value:{day:"2-digit",month:"short",year:"numeric"},label:"DD MMM YYYY"},{value:{day:"2-digit",month:"long",year:"numeric"},label:"DD Month YYYY"},{value:{weekday:"short",day:"2-digit",month:"2-digit",year:"numeric"},label:"EEE, DD.MM.YYYY"},{value:{weekday:"long",day:"2-digit",month:"2-digit",year:"numeric"},label:"EEEE, DD.MM.YYYY"},{value:{weekday:"short",day:"2-digit",month:"short",year:"numeric"},label:"EEE, DD MMM YYYY"},{value:{weekday:"long",day:"2-digit",month:"long",year:"numeric"},label:"EEEE, DD Month YYYY"},{value:"custom",label:"Custom"}];timeFormats=[{value:"HH:mm",label:"timeFormat24"},{value:"h:mm a",label:"timeFormat12"},{value:"HH:mm:ss",label:"timeFormat24Seconds"},{value:"h:mm:ss a",label:"timeFormat12Seconds"},{value:"custom",label:"Custom"}];constructor(a){super(a);const o=k.ConfigGeneric.getValue(a.data,a.attr);this.state={...this.state,entries:Array.isArray(o)?o:[],confirmDeleteOpen:!1,confirmDeleteName:null,alive:!1,pagesRetryCount:0}}formatDatePreview(a,o){try{return a.toLocaleDateString(void 0,typeof o=="string"?JSON.parse(o):o)}catch{return"Invalid Format"}}formatTimePreview(a,o){return o.replace(/HH/g,String(a.getHours()).padStart(2,"0")).replace(/mm/g,String(a.getMinutes()).padStart(2,"0")).replace(/ss/g,String(a.getSeconds()).padStart(2,"0")).replace(/h/g,String(a.getHours()%12||12)).replace(/a/g,a.getHours()>=12?"PM":"AM")}handleObjectIdSelectorOpen=()=>{this.setState({objectIdSelectorOpen:!0})};handleObjectIdSelectorClose=()=>{this.setState({objectIdSelectorOpen:!1})};handleObjectIdSelect=a=>{console.log("[ScreensaverPage] Selected file:",a)};componentWillUnmount(){this.pagesRetryTimeout&&clearTimeout(this.pagesRetryTimeout);const a=this.props.oContext.instance??"0";this.props.oContext.socket.unsubscribeState(`system.adapter.${N}.${a}.alive`,this.onAliveChanged)}async componentDidMount(){super.componentDidMount();const a=this.props.oContext.instance??"0",o=`system.adapter.${N}.${a}.alive`;try{const r=await this.props.oContext.socket.getState(o),i=!!(r!=null&&r.val);this.setState({alive:i}),await this.props.oContext.socket.subscribeState(o,this.onAliveChanged),i&&await this.loadPagesList()}catch(r){console.error("[ScreensaverPage] Failed to get alive state or subscribe:",r),this.setState({alive:!1})}}onAliveChanged=(a,o)=>{const r=this.state.alive,i=o?!!o.val:!1;r!==i&&(this.setState({alive:i}),!r&&i&&(!this.state.pagesList||this.state.pagesList.length===0)&&this.loadPagesList(),r&&!i&&this.pagesRetryTimeout&&(clearTimeout(this.pagesRetryTimeout),this.pagesRetryTimeout=void 0))};async loadPagesList(){if(!this.state.alive){console.log("[ScreensaverPage] Adapter not alive, skipping pages load");return}const a=[];if(this.props.oContext&&this.props.oContext.socket){const o=this.props.oContext.instance??"0",r=`${N}.${o}`;try{const i=await this.props.oContext.socket.sendTo(r,$,null);let l=[];Array.isArray(i)?l=i:i&&Array.isArray(i.result)&&(l=i.result);for(const s of l)a.push(s);if(l.length===0){const s=this.state.pagesRetryCount||0,n=3e3;console.log(`[ScreensaverPage] Got empty pages array, retrying in ${n}ms (attempt ${s+1})`),this.setState({pagesRetryCount:s+1}),this.pagesRetryTimeout&&clearTimeout(this.pagesRetryTimeout),this.pagesRetryTimeout=setTimeout(()=>{this.state.alive?this.loadPagesList():console.log("[ScreensaverPage] Adapter went offline, cancelling pages retry")},n);return}else l.length>0&&(console.log(`[ScreensaverPage] Successfully loaded ${l.length} pages after ${this.state.pagesRetryCount||0} retries`),this.setState({pagesRetryCount:0}),this.pagesRetryTimeout&&(clearTimeout(this.pagesRetryTimeout),this.pagesRetryTimeout=void 0))}catch(i){const l=this.state.pagesRetryCount||0,s=3e3;console.log(`[ScreensaverPage] Error loading pages, retrying in ${s}ms (attempt ${l+1}): ${String(i)}`),this.setState({pagesRetryCount:l+1}),this.pagesRetryTimeout&&clearTimeout(this.pagesRetryTimeout),this.pagesRetryTimeout=setTimeout(()=>{this.state.alive?this.loadPagesList():console.log("[ScreensaverPage] Adapter went offline, cancelling pages retry after error")},s);return}}else{console.log("[ScreensaverPage] No socket available for sendTo");return}this.setState({pagesList:Array.from(new Set(a))})}renderItem(a,o,r){var S,d,m,h,u,v,x,A,w,I;const i=this.state.entries||[],l=Array.from(new Set(i.map(c=>c.uniqueName))).filter(Boolean);this._local||(this._local={newName:"",selected:l[0]||""});const s=this._local,n=()=>{const c=(s.newName||"").trim();if(!c)return;const y={card:"screensaver",uniqueName:c,headline:c,type:"clock",enabled:!0,timeout:60},p=[...i,y];this.setState({entries:p}),this.onChange(this.props.attr,p),s.newName="",s.selected=c},g=()=>{const c=s.selected;c&&this.setState({confirmDeleteOpen:!0,confirmDeleteName:c})},_=()=>{this.setState({confirmDeleteOpen:!1,confirmDeleteName:null})},b=()=>{const c=this.state.confirmDeleteName;if(!c){_();return}const y=i.filter(f=>f.uniqueName!==c);this.setState({entries:y,confirmDeleteOpen:!1,confirmDeleteName:null}),this.onChange(this.props.attr,y);const p=Array.from(new Set(y.map(f=>f.uniqueName))).filter(Boolean);s&&(s.selected=p[0]||""),this.setState({})};return e.jsxs(t.Box,{sx:{height:"calc(100vh - 64px)",display:"flex",flexDirection:{xs:"column",md:"row"},p:1},children:[e.jsxs(t.Box,{sx:{width:{xs:"100%",md:"20%"},pr:{xs:0,md:1},display:"flex",flexDirection:"column",gap:1},children:[e.jsx(t.Typography,{variant:"h6",sx:{mb:1,fontWeight:600,color:"primary.main",fontSize:"1rem"},children:this.getText("screensaver_pages")}),e.jsx(t.Paper,{sx:{p:1,backgroundColor:"transparent"},elevation:0,children:e.jsxs(t.Box,{sx:{display:"flex",gap:1},children:[e.jsx(t.TextField,{"aria-label":"new-screensaver-name",label:this.getText("new_screensaver"),value:(s==null?void 0:s.newName)||"",onChange:c=>{s&&(s.newName=c.target.value),this.setState({})},variant:"standard",placeholder:this.getText("new_screensaver"),InputProps:{sx:{backgroundColor:"transparent",px:1}},sx:{flex:1,"& .MuiInput-underline:before":{borderBottomColor:"primary.main"},"& .MuiInput-underline:hover:before":{borderBottomColor:"primary.main"},"& .MuiInput-underline:after":{borderBottomColor:"primary.main"},"& .MuiInputLabel-root":{color:"primary.main"},"& .MuiInputLabel-root.Mui-focused":{color:"primary.main"}}}),e.jsx(t.Button,{size:"small",variant:"contained",onClick:n,disabled:(()=>{const c=((s==null?void 0:s.newName)||"").trim();return!c||l.includes(c)})(),children:"+"})]})}),e.jsx(t.Paper,{sx:{overflow:"auto",p:1,backgroundColor:"transparent"},elevation:0,children:l.length===0?e.jsx(t.Typography,{variant:"body2",color:"text.secondary",children:this.getText("no_screensavers")}):l.map(c=>e.jsx(t.Box,{onClick:()=>{s&&(s.selected=c),this.setState({})},sx:{p:1,borderRadius:1,cursor:"pointer",backgroundColor:(s==null?void 0:s.selected)===c?"action.selected":"transparent",mb:.5},children:e.jsx(t.Typography,{variant:"body2",children:c})},c))}),e.jsx(t.Box,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(t.Button,{size:"small",color:"error",variant:"outlined",onClick:g,disabled:!(s!=null&&s.selected),children:"-"})}),e.jsx(t.Box,{sx:{marginTop:2,marginBottom:2},children:e.jsxs(t.FormControl,{component:"fieldset",disabled:(s==null?void 0:s.selected)===null,children:[e.jsx(t.FormLabel,{component:"legend",sx:{color:(s==null?void 0:s.selected)===null?((m=(d=(S=this.props.theme)==null?void 0:S.palette)==null?void 0:d.text)==null?void 0:m.disabled)||"#999":(v=(u=(h=this.props.theme)==null?void 0:h.palette)==null?void 0:u.text)==null?void 0:v.primary},children:this.getText("cardType")}),e.jsxs(t.RadioGroup,{value:s!=null&&s.selected&&((x=this.state.entries.find(c=>c.uniqueName===s.selected))==null?void 0:x.card)||"screensaver",onChange:c=>{if(s!=null&&s.selected){const y=c.target.value,p=[...this.state.entries],f=p.findIndex(T=>T.uniqueName===s.selected);f!==-1&&(p[f]={...p[f],card:y},this.setState({entries:p}),this.props.onChange(this.props.attr||"",p))}},sx:{flexDirection:"column","& .MuiRadio-root.Mui-disabled":{color:"#999 !important"},"& .MuiFormControlLabel-label.Mui-disabled":{color:"#999 !important"}},children:[e.jsx(t.FormControlLabel,{value:"screensaver",control:e.jsx(t.Radio,{}),label:this.getText("cardTypeStandard")}),e.jsx(t.FormControlLabel,{value:"screensaver2",control:e.jsx(t.Radio,{}),label:this.getText("cardTypeAdvanced")}),e.jsx(t.FormControlLabel,{value:"screensaver3",control:e.jsx(t.Radio,{}),label:this.getText("cardTypeEasyview")})]})]})}),e.jsx(t.Divider,{sx:{my:1}}),e.jsx(t.Box,{sx:{mb:2},children:e.jsx("a",{href:"https://github.com/ticaki/ioBroker.nspanel-lovelace-ui/wiki/screensaver",target:"_blank",rel:"noopener noreferrer",style:{textDecoration:"none",color:"inherit",fontSize:"0.875rem"},children:e.jsx(t.Typography,{variant:"body2",sx:{color:"primary.main",textDecoration:"underline",cursor:"pointer","&:hover":{opacity:.8}},children:this.getText("documentation")})})}),e.jsx(t.Box,{sx:{mb:2},children:e.jsx(t.Button,{variant:"outlined",color:"primary",size:"small",fullWidth:!0,onClick:this.handleObjectIdSelectorOpen,children:"Test ObjectIdSelector"})})]}),e.jsx(q,{open:!!this.state.confirmDeleteOpen,onClose:_,onConfirm:b,title:this.getText("screensaver_delete_confirm_title"),description:this.getText("screensaver_delete_confirm_text")+(this.state.confirmDeleteName?`: ${this.state.confirmDeleteName}`:""),cancelText:this.getText("Cancel"),confirmText:this.getText("Delete"),ariaTitleId:"screensaver-delete-confirm-title",ariaDescId:"screensaver-delete-confirm-description"}),e.jsxs(t.Box,{sx:{width:{xs:"100%",md:"90%"},pl:{xs:0,md:2},mt:{xs:2,md:0},display:"flex",flexDirection:{xs:"column",md:"row"},gap:1,position:"relative"},children:[e.jsx(t.Box,{sx:{width:{xs:"100%",md:"95%"},borderLeft:{xs:"none",md:"1px solid"},borderColor:"divider"},children:e.jsx(t.Paper,{sx:{height:"100%",p:2},elevation:1,children:s!=null&&s.selected?e.jsx(t.Box,{children:(()=>{const c=s==null?void 0:s.selected,y=i.find(p=>p.uniqueName===c);return y?e.jsxs(t.Box,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(t.Typography,{variant:"h6",sx:{mb:1},children:[this.getText("screensaver_config"),": ",c]}),e.jsx(t.TextField,{label:this.getText("screensaver_headline"),value:y.headline||"",onChange:p=>{const f=i.map(T=>T.uniqueName===c?{...T,headline:p.target.value}:T);this.setState({entries:f}),this.onChange(this.props.attr,f)},variant:"outlined",fullWidth:!0}),e.jsx(t.TextField,{label:this.getText("screensaver_timeout"),value:y.timeout||60,onChange:p=>{const f=parseInt(p.target.value)||60,T=i.map(j=>j.uniqueName===c?{...j,timeout:f}:j);this.setState({entries:T}),this.onChange(this.props.attr,T)},variant:"outlined",type:"number",fullWidth:!0}),e.jsxs(t.FormControl,{variant:"outlined",fullWidth:!0,sx:{mt:2},children:[e.jsx(t.InputLabel,{children:this.getText("dateFormat")}),e.jsx(t.Select,{value:y.dateFormat||"dd.MM.yyyy",onChange:p=>{const f=p.target.value,T=i.map(j=>j.uniqueName===c?{...j,dateFormat:f}:j);this.setState({entries:T}),this.onChange(this.props.attr,T)},label:this.getText("dateFormat"),children:this.dateFormats.map(p=>e.jsx(t.MenuItem,{value:JSON.stringify(p.value),children:p.value==="custom"?this.getText("dateFormatCustom"):p.label},p.label))})]}),y.dateFormat==="custom"&&e.jsx(t.TextField,{label:this.getText("dateFormatCustom"),value:y.customDateFormat||"",onChange:p=>{const f=p.target.value,T=i.map(j=>j.uniqueName===c?{...j,customDateFormat:f}:j);this.setState({entries:T}),this.onChange(this.props.attr,T)},variant:"outlined",fullWidth:!0,placeholder:"dd.MM.yyyy",sx:{mt:1}}),e.jsxs(t.Typography,{variant:"caption",color:"text.secondary",sx:{mt:.5,display:"block"},children:[this.getText("dateFormatExample"),":"," ",(()=>{const p=new Date,f=y.dateFormat||"dd.MM.yyyy";console.log("Formatting date with format:",y.dateFormat);try{if(f==="custom"){const T=y.customDateFormat||"";return T?this.formatDatePreview(p,T):"Enter custom format above"}return this.formatDatePreview(p,f)}catch{return"Invalid format"}})()]}),e.jsxs(t.FormControl,{variant:"outlined",fullWidth:!0,sx:{mt:2},children:[e.jsx(t.InputLabel,{children:this.getText("timeFormat")}),e.jsx(t.Select,{value:y.timeFormat||"HH:mm",onChange:p=>{const f=p.target.value,T=i.map(j=>j.uniqueName===c?{...j,timeFormat:f}:j);this.setState({entries:T}),this.onChange(this.props.attr,T)},label:this.getText("timeFormat"),children:this.timeFormats.map(p=>e.jsx(t.MenuItem,{value:p.value,children:p.value==="custom"?this.getText("timeFormatCustom"):this.getText(p.label)},p.value))})]}),y.timeFormat==="custom"&&e.jsx(t.TextField,{label:this.getText("timeFormatCustom"),value:y.customTimeFormat||"",onChange:p=>{const f=p.target.value,T=i.map(j=>j.uniqueName===c?{...j,customTimeFormat:f}:j);this.setState({entries:T}),this.onChange(this.props.attr,T)},variant:"outlined",fullWidth:!0,placeholder:"HH:mm",sx:{mt:1}}),e.jsxs(t.Typography,{variant:"caption",color:"text.secondary",sx:{mt:.5,display:"block"},children:[this.getText("timeFormatExample"),":"," ",(()=>{const p=new Date,f=y.timeFormat||"HH:mm";try{if(f==="custom"){const T=y.customTimeFormat||"";return T?this.formatTimePreview(p,T):"Enter custom format above"}return this.formatTimePreview(p,f)}catch{return"Invalid format"}})()]})]}):e.jsx(t.Typography,{variant:"body2",color:"error",children:this.getText("screensaver_entry_not_found")})})()}):e.jsxs(t.Box,{children:[e.jsx(t.Typography,{variant:"h6",children:this.getText("screensaver_select_item")}),e.jsx(t.Box,{sx:{mt:2},children:e.jsx(t.Typography,{variant:"body2",color:"text.secondary",children:this.getText("screensaver_select_description")})})]})})}),e.jsx(E,{...this.props,widthPercent:30,oContext:this.props.oContext,uniqueName:(s==null?void 0:s.selected)||"",currentAssignments:(()=>{const c=s==null?void 0:s.selected;if(!c)return[];const y=i.find(p=>p.uniqueName===c);return(y==null?void 0:y.navigation)||[]})(),onAssign:(c,y)=>{const p=i.map(f=>f.uniqueName===c?{...f,navigation:y}:f);this.setState({entries:p}),this.onChange(this.props.attr,p)}}),e.jsx(t.Paper,{sx:{height:"100%",p:2,backgroundColor:"transparent"},elevation:0,children:e.jsxs(t.Box,{children:[e.jsx(t.Typography,{variant:"subtitle2",sx:{mb:1},children:this.getText("screensaver_unique_label")}),e.jsx(t.Typography,{variant:"body1",sx:{fontWeight:600},children:s.selected||this.getText("screensaver_select_item")}),e.jsx(O,{fontSize:"small",color:"action",sx:{mt:1}})]})})]}),e.jsx(J,{open:!!this.state.objectIdSelectorOpen,onClose:this.handleObjectIdSelectorClose,onSelect:this.handleObjectIdSelect,socket:this.props.oContext.socket,themeName:this.props.themeName,themeType:((w=(A=this.props.theme)==null?void 0:A.palette)==null?void 0:w.mode)||"light",theme:this.props.theme,adapterName:"nspanel-lovelace-ui",instance:((I=this.props.oContext)==null?void 0:I.instance)||0,objectIdConfig:{types:"state",filterFunc:c=>!!((c==null?void 0:c.type)==="state"&&c.common.role&&c.common.role.startsWith("switch"))}})]})}}const Q=L(K),pe={NavigationView:z,IconSelect:W,IconOverview:Y,UnlockPage:G,ScreensaverPage:Q};export{pe as default};
