import{A as T,S as y,b as j,w as S,c as b,C as k,a as P,I as B,W as I}from"./NavigationView-CW-srPkT.js";import{j as e}from"./createSvgIcon-BAyG150Y.js";import{A as t}from"./AdminComponentEasyAccessSet__loadShare___mf_0_mui_mf_1_material__loadShare__-DP1_LQ8a.js";import{V as q,a as M,I as D}from"./VisibilityOff-Bj1py224.js";import{R as F}from"./AdminComponentEasyAccessSet__loadShare__react__loadShare__-BWvOyvAg.js";import{A as C}from"./AdminComponentEasyAccessSet__loadShare___mf_0_iobroker_mf_1_adapter_mf_2_react_mf_2_v5__loadShare__-ChLGBbzW.js";import{T as A}from"./Tooltip-QmnnkgNQ.js";import"./index-BCpyQc2W.js";import"./_commonjsHelpers-CE1G-McA.js";import"./AdminComponentEasyAccessSet__mf_v__runtimeInit__mf_v__-DmMtQNcK.js";import"./Clear-jM7oAHDI.js";import"./useTheme-Cq43vfiC.js";import"./defaultTheme-BKgYrozm.js";import"./Grow-DxyKUkMA.js";class R extends F.Component{static defaultProps={widthPercent:30};constructor(i){super(i),this.state={available:[],selectedTopic:"",added:[],assignments:i.currentAssignments||[],pagesMap:{}}}async componentDidMount(){await this.loadPanels(!1),this.applyAssignmentsFromProps(this.props.currentAssignments||[])}applyAssignmentsFromProps(i){var s;const o=(i||[]).map(n=>this.state.available.find(a=>a.panelTopic===n.topic)||{panelTopic:n.topic,friendlyName:n.topic});this.setState({assignments:i,added:o,selectedAddedTopic:(s=o[0])==null?void 0:s.panelTopic,selectedTopic:""});for(const n of o)this.loadPagesForPanel(n.panelTopic,!0)}componentDidUpdate(i){if(i.uniqueName!==this.props.uniqueName){const o=this.props.currentAssignments||[];this.loadPanels(!1).then(()=>{this.applyAssignmentsFromProps(o)})}else if(i.currentAssignments!==this.props.currentAssignments&&this.props.currentAssignments){const o=this.props.currentAssignments||[];this.applyAssignmentsFromProps(o)}}async loadPanels(i=!0){try{let o=[];if(this.props.fetchPanels)o=await this.props.fetchPanels();else if(this.props.oContext&&this.props.oContext.socket){const s=this.props.oContext.instance??"0",n=`${T}.${s}`;try{console.debug("[NavigationAssignmentPanel] sendTo ->",{target:n,cmd:y,payload:null});const c=await this.props.oContext.socket.sendTo(n,y,null);console.debug("[NavigationAssignmentPanel] sendTo raw response ->",c),Array.isArray(c)?o=c:c&&Array.isArray(c.result)&&(o=c.result)}catch(c){console.error("[NavigationAssignmentPanel] sendTo failed",{target:n,cmd:y,error:c})}}this.setState({available:o,selectedTopic:""})}catch{this.setState({available:[],selectedTopic:""})}}doAddSelected=()=>{const{selectedTopic:i,available:o,added:s}=this.state;if(!i)return;const n=o.find(h=>h.panelTopic===i);if(!n||s.find(h=>h.panelTopic===n.panelTopic))return;const c=[...s,n],a=[...this.state.assignments,{topic:n.panelTopic,active:!1}];this.setState({added:c,assignments:a,selectedTopic:""}),this.loadPagesForPanel(n.panelTopic),this.props.onAssign&&this.props.uniqueName&&this.props.onAssign(this.props.uniqueName,a)};doRemoveSelected=()=>{const{added:i}=this.state;if(!i.length)return;const o=i.slice(0,-1),s=this.state.assignments.slice(0,-1);this.setState({added:o,assignments:s}),this.props.onAssign&&this.props.uniqueName&&this.props.onAssign(this.props.uniqueName,s)};selectAdded=i=>{this.setState({selectedAddedTopic:i}),this.loadPagesForPanel(i,!0)};async loadPagesForPanel(i,o=!1){if(i)try{if(!o&&this.state.pagesMap&&this.state.pagesMap[i])return;let s=[];if(this.props.oContext&&this.props.oContext.socket){const c=this.props.oContext.instance??"0",a=`${T}.${c}`,h={panelTopic:i};try{console.debug("[NavigationAssignmentPanel] sendTo ->",{target:a,cmd:j,payload:h});const u=await this.props.oContext.socket.sendTo(a,j,h);console.debug("[NavigationAssignmentPanel] sendTo raw response ->",u),Array.isArray(u)?s=u:u&&Array.isArray(u.result)&&(s=u.result)}catch(u){console.error("[NavigationAssignmentPanel] sendTo failed",{target:a,cmd:j,payload:h,error:u})}}else console.warn("[NavigationAssignmentPanel] no oContext.socket available to sendTo");const n={...this.state.pagesMap||{}};n[i]=s,this.setState({pagesMap:n})}catch{}}setNavigationForSelected=i=>{const{selectedAddedTopic:o,assignments:s}=this.state;if(!o)return;const n=s.findIndex(u=>u.topic===o),c=[...s],a=s[n];let h;a&&a.active?h={...a,active:!0,navigation:{...a.navigation,...i}}:h={topic:o,active:!0,navigation:{...i}},n>=0?c[n]=h:c.push(h),this.setState({assignments:c}),this.props.onAssign&&this.props.uniqueName&&this.props.onAssign(this.props.uniqueName,c)};getNavValue=(i,o)=>{if(!i)return"";const s=this.state.assignments.find(n=>n.topic===i);return!s||!s.navigation?"":s.navigation[o]??""};render(){const{widthPercent:i}=this.props,o=this.state.selectedAddedTopic?this.state.pagesMap[this.state.selectedAddedTopic]??[]:[];return e.jsx(t.Box,{sx:{position:"absolute",right:0,top:0,height:"100%",width:`${i}%`,transition:"width 240ms ease",backgroundColor:"transparent",borderLeft:"2px solid",borderColor:"secondary.main",overflow:"visible",display:"flex",flexDirection:"column",zIndex:20},children:e.jsxs(t.Box,{sx:{p:1,height:"100%",display:"flex",flexDirection:"column",width:"100%",overflow:"hidden",transition:"width 240ms ease"},children:[e.jsxs(t.Box,{sx:{display:"flex",gap:1,alignItems:"center",mb:1},children:[e.jsxs(t.Select,{size:"small",variant:"standard",value:this.state.selectedTopic,onOpen:()=>{this.loadPanels()},onChange:s=>this.setState({selectedTopic:String(s.target.value)}),sx:{flex:1,backgroundColor:"transparent",minHeight:40,"& .MuiSelect-select":{backgroundColor:"transparent",display:"flex",alignItems:"center",height:40}},displayEmpty:!0,children:[e.jsx(t.MenuItem,{value:"",children:e.jsx("em",{children:"—"})}),this.state.available.map(s=>e.jsx(t.MenuItem,{value:s.panelTopic,children:s.friendlyName},s.panelTopic))]}),e.jsx(t.Button,{size:"small",variant:"contained",sx:{minWidth:32,padding:"4px 8px"},onClick:this.doAddSelected,disabled:!this.state.selectedTopic,children:"+"})]}),(()=>{const a=Math.max(1,(this.state.added.length||0)+1)*40;return e.jsx(t.Box,{children:this.state.added.length===0?e.jsxs(t.Typography,{variant:"body2",color:"text.secondary",children:["No panels added",e.jsx("br",{})]}):e.jsx("div",{style:{height:a,overflow:"auto"},children:e.jsx(t.List,{dense:!0,children:this.state.added.map(h=>e.jsx(t.ListItem,{component:"div",children:e.jsx(t.ListItemButton,{selected:this.state.selectedAddedTopic===h.panelTopic,onClick:()=>this.selectAdded(h.panelTopic),children:e.jsx(t.ListItemText,{primary:h.friendlyName})})},h.panelTopic))})})})})(),e.jsx(t.Box,{sx:{display:"flex",gap:1,justifyContent:"flex-end",mt:1},children:e.jsx(t.Button,{size:"small",color:"error",variant:"contained",onClick:this.doRemoveSelected,disabled:this.state.added.length===0,sx:{minWidth:32,padding:"4px 8px"},children:"-"})}),e.jsx(t.Divider,{sx:{my:1}}),e.jsxs(t.Box,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:1,mt:1},children:[e.jsxs(t.Box,{children:[e.jsx(t.Box,{sx:{display:"flex",alignItems:"center",mb:.5},children:e.jsx(A,{title:C.I18n.t("nav_prev_tooltip"),children:e.jsx(t.Typography,{variant:"caption",color:"text.secondary",sx:{mr:.5},children:"prev"})})}),e.jsxs(t.Select,{size:"small",displayEmpty:!0,"aria-label":"prev",value:this.getNavValue(this.state.selectedAddedTopic,"prev"),onChange:s=>this.setNavigationForSelected({prev:String(s.target.value)||void 0}),sx:{width:"100%"},children:[e.jsx(t.MenuItem,{value:"",children:e.jsx("em",{children:"—"})}),o.filter(s=>s!==this.props.uniqueName).map(s=>e.jsx(t.MenuItem,{value:s,children:s},`prev-${s}`))]})]}),e.jsxs(t.Box,{children:[e.jsx(t.Box,{sx:{display:"flex",alignItems:"center",mb:.5},children:e.jsx(A,{title:C.I18n.t("nav_next_tooltip"),children:e.jsx(t.Typography,{variant:"caption",color:"text.secondary",sx:{mr:.5},children:"next"})})}),e.jsxs(t.Select,{size:"small",displayEmpty:!0,"aria-label":"next",value:this.getNavValue(this.state.selectedAddedTopic,"next"),onChange:s=>this.setNavigationForSelected({next:String(s.target.value)||void 0}),sx:{width:"100%"},children:[e.jsx(t.MenuItem,{value:"",children:e.jsx("em",{children:"—"})}),o.filter(s=>s!==this.props.uniqueName&&!s.startsWith("///")).map(s=>e.jsx(t.MenuItem,{value:s,children:s},`next-${s}`))]})]}),e.jsxs(t.Box,{children:[e.jsx(t.Typography,{variant:"caption",color:"text.secondary",sx:{mb:.5,display:"block"},children:"home"}),e.jsxs(t.Select,{size:"small",displayEmpty:!0,"aria-label":"home",value:this.getNavValue(this.state.selectedAddedTopic,"home"),onChange:s=>this.setNavigationForSelected({home:String(s.target.value)||void 0}),sx:{width:"100%"},children:[e.jsx(t.MenuItem,{value:"",children:e.jsx("em",{children:"—"})}),o.filter(s=>s!==this.props.uniqueName).map(s=>e.jsx(t.MenuItem,{value:s,children:s},`home-${s}`))]})]}),e.jsxs(t.Box,{children:[e.jsx(t.Typography,{variant:"caption",color:"text.secondary",sx:{mb:.5,display:"block"},children:"parent"}),e.jsxs(t.Select,{size:"small",displayEmpty:!0,"aria-label":"parent",value:this.getNavValue(this.state.selectedAddedTopic,"parent"),onChange:s=>this.setNavigationForSelected({parent:String(s.target.value)||void 0}),sx:{width:"100%"},children:[e.jsx(t.MenuItem,{value:"",children:e.jsx("em",{children:"—"})}),o.filter(s=>s!==this.props.uniqueName).map(s=>e.jsx(t.MenuItem,{value:s,children:s},`parent-${s}`))]})]})]})]})})}}class E extends b.ConfigGeneric{constructor(i){super(i);const o=b.ConfigGeneric.getValue(i.data,i.attr);this.state={...this.state,entries:Array.isArray(o)?o:[],confirmDeleteOpen:!1,confirmDeleteName:null}}async componentDidMount(){const i=[];if(this.props.oContext&&this.props.oContext.socket){const o=this.props.oContext.instance??"0",s=`${T}.${o}`;try{const n=await this.props.oContext.socket.sendTo(s,"getPanels",null);let c=[];Array.isArray(n)?c=n:n&&Array.isArray(n.result)&&(c=n.result);for(const a of c)try{const h=await this.props.oContext.socket.sendTo(s,"getPagesForPanel",{panelTopic:a.panelTopic});let u=[];Array.isArray(h)?u=h:h&&Array.isArray(h.result)&&(u=h.result);for(const f of u)i.push(f)}catch{}}catch{}}this.setState({pagesList:Array.from(new Set(i))})}renderItem(i,o,s){var _;const n=this.state.entries||[],c=Array.from(new Set(n.map(r=>r.uniqueName))).filter(Boolean);this._local||(this._local={newName:"",selected:c[0]||"",showPin:!1});const a=this._local,h=()=>{const r=(a.newName||"").trim();if(!r)return;const d={uniqueName:r,headline:r,button1:"",button2:"",button3:"",button4:"",pin:0},l=[...n,d];this.setState({entries:l}),this.onChange(this.props.attr,l),a.newName="",a.selected=r},u=()=>{const r=a.selected;r&&this.setState({confirmDeleteOpen:!0,confirmDeleteName:r})},f=()=>{this.setState({confirmDeleteOpen:!1,confirmDeleteName:null})},N=()=>{const r=this.state.confirmDeleteName;if(!r){f();return}const d=n.filter(x=>x.uniqueName!==r);this.setState({entries:d,confirmDeleteOpen:!1,confirmDeleteName:null}),this.onChange(this.props.attr,d);const l=Array.from(new Set(d.map(x=>x.uniqueName))).filter(Boolean);a.selected=l[0]||"",this.setState({})};return e.jsxs(t.Box,{sx:{height:"calc(100vh - 64px)",display:"flex",p:1},children:[e.jsxs(t.Box,{sx:{width:"20%",pr:1,display:"flex",flexDirection:"column",gap:1},children:[e.jsx(t.Paper,{sx:{p:1,backgroundColor:"transparent"},elevation:0,children:e.jsxs(t.Box,{sx:{display:"flex",gap:1},children:[e.jsx(t.TextField,{"aria-label":"new-name",value:a.newName,onChange:r=>{a.newName=r.target.value,this.setState({})},variant:"standard",placeholder:this.getText("New item"),InputProps:{disableUnderline:!0,sx:{backgroundColor:"transparent",px:1}},sx:{flex:1}}),e.jsx(t.Button,{size:"small",variant:"contained",onClick:h,disabled:(()=>{const r=(a.newName||"").trim();return!r||c.includes(r)})(),children:"+"})]})}),(()=>{const l=Math.max(3,c.length||0),x=(typeof window<"u"?window.innerHeight:800)-64,m=Math.floor(x*.8),p=Math.min(l*40,m);return e.jsx(t.Paper,{sx:{height:p,overflow:"auto",p:1,backgroundColor:"transparent"},elevation:0,children:c.length===0?e.jsx(t.Typography,{variant:"body2",color:"text.secondary",children:this.getText("No items")}):c.map(g=>e.jsx(t.Box,{onClick:()=>{a.selected=g,this.setState({})},sx:{p:1,borderRadius:1,cursor:"pointer",backgroundColor:a.selected===g?"action.selected":"transparent",mb:.5},children:e.jsx(t.Typography,{variant:"body2",children:g})},g))})})(),e.jsx(t.Box,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(t.Button,{size:"small",color:"error",variant:"outlined",onClick:u,disabled:!a.selected,children:"-"})})]}),e.jsx(k,{open:!!this.state.confirmDeleteOpen,onClose:f,onConfirm:N,title:this.getText("unlock_delete_confirm_title"),description:this.getText("unlock_delete_confirm_text")+(this.state.confirmDeleteName?`: ${this.state.confirmDeleteName}`:""),cancelText:this.getText("Cancel"),confirmText:this.getText("Delete"),ariaTitleId:"unlock-delete-confirm-title",ariaDescId:"unlock-delete-confirm-description"}),e.jsxs(t.Box,{sx:{width:"80%",pl:2,display:"flex",gap:1,position:"relative"},children:[e.jsx(t.Box,{sx:{width:"70%",borderLeft:"1px solid",borderColor:"divider"},children:e.jsx(t.Paper,{sx:{height:"100%",p:2},elevation:1,children:a.selected?e.jsx(t.Box,{children:(()=>{const r=a.selected,d=n.find(l=>l.uniqueName===r);return d?e.jsxs(e.Fragment,{children:[e.jsxs(t.Box,{sx:{mb:1,p:1,borderRadius:1,backgroundColor:"action.hover"},children:[e.jsx(t.Typography,{variant:"subtitle2",sx:{mb:.5},children:this.getText("unlock_unique_label")}),e.jsx(t.Typography,{variant:"h6",sx:{fontWeight:600},children:r})]}),e.jsx(t.Box,{sx:{mb:1},children:e.jsxs(t.FormControl,{component:"fieldset",children:[e.jsx(t.Typography,{variant:"subtitle2",sx:{mb:1},children:this.getText("unlock_type")}),e.jsxs(t.RadioGroup,{row:!0,value:(d==null?void 0:d.alarmType)||"",onChange:(l,x)=>{const m=n.map(p=>p.uniqueName===r?{...p,alarmType:x}:p);this.setState({entries:m}),this.onChange(this.props.attr,m)},children:[e.jsx(t.FormControlLabel,{value:"alarm",control:e.jsx(t.Radio,{}),label:this.getText("unlock_alarm")}),e.jsx(t.FormControlLabel,{value:"unlock",control:e.jsx(t.Radio,{}),label:this.getText("unlock_unlock")})]})]})}),e.jsx(t.TextField,{fullWidth:!0,variant:"standard",type:"text",autoComplete:"off",label:this.getText("unlock_headline"),value:d.headline??"",onChange:l=>{const x=l.target.value,m=n.map(p=>p.uniqueName===r?{...p,headline:x}:p);this.setState({entries:m}),this.onChange(this.props.attr,m)},InputProps:{disableUnderline:!0,sx:{backgroundColor:"transparent",px:1}},sx:{mb:2}}),e.jsx(t.Box,{sx:{mt:2},children:e.jsx(t.TextField,{variant:"standard",label:this.getText("unlock_pin"),type:a.showPin?"text":"password",value:d.pin!==void 0&&d.pin!==null?String(d.pin):"",onChange:l=>{const m=l.target.value.replace(/[^0-9]/g,""),p=m?parseInt(m,10):0,g=n.map(v=>v.uniqueName===r?{...v,pin:p}:v);this.setState({entries:g}),this.onChange(this.props.attr,g)},InputProps:{disableUnderline:!0,sx:{backgroundColor:"transparent",px:1},endAdornment:e.jsx(t.InputAdornment,{position:"end",children:e.jsx(t.IconButton,{"aria-label":a.showPin?"hide-pin":"show-pin",onClick:()=>{a.showPin=!a.showPin,this.setState({})},edge:"end",size:"small",children:a.showPin?e.jsx(q,{fontSize:"small"}):e.jsx(M,{fontSize:"small"})})})}})}),e.jsxs(t.Box,{sx:{mt:2},children:[e.jsx(t.FormControlLabel,{control:e.jsx(t.Checkbox,{checked:!!d.hidden,onChange:(l,x)=>{const m=n.map(p=>p.uniqueName===r?{...p,hidden:x}:p);this.setState({entries:m}),this.onChange(this.props.attr,m)}}),label:this.getText("unlock_hidden")}),e.jsx(t.Box,{sx:{mt:2},children:e.jsxs(t.FormControl,{component:"fieldset",children:[e.jsx(t.Typography,{variant:"subtitle2",sx:{mb:1},children:this.getText("unlock_alwaysOn")}),e.jsxs(t.RadioGroup,{row:!0,value:(d==null?void 0:d.alwaysOn)||"none",onChange:(l,x)=>{const m=n.map(p=>p.uniqueName===r?{...p,alwaysOn:x}:p);this.setState({entries:m}),this.onChange(this.props.attr,m)},children:[e.jsx(t.FormControlLabel,{value:"none",control:e.jsx(t.Radio,{}),label:this.getText("unlock_alwaysOn_none")}),e.jsx(t.FormControlLabel,{value:"always",control:e.jsx(t.Radio,{}),label:this.getText("unlock_alwaysOn_always")}),e.jsx(t.FormControlLabel,{value:"ignore",control:e.jsx(t.Radio,{}),label:this.getText("unlock_alwaysOn_ignore")})]})]})})]}),d.alarmType==="alarm"&&e.jsxs(t.Box,{sx:{mt:2},children:[e.jsx(t.Box,{sx:{display:"grid",gridTemplateColumns:"1fr",gap:2},children:[1,2,3,4].map(l=>{const x=`button${l}`;return e.jsxs(t.Box,{children:[e.jsx(t.Typography,{variant:"caption",color:"text.secondary",sx:{mb:.5},children:this.getText(`unlock_button${l}_label`)}),e.jsx(t.TextField,{fullWidth:!0,variant:"standard",placeholder:this.getText(`unlock_button${l}_placeholder`),value:d[x]??"",onChange:m=>{const p=m.target.value,g=n.map(v=>v.uniqueName===r?{...v,[x]:p}:v);this.setState({entries:g}),this.onChange(this.props.attr,g)},InputProps:{disableUnderline:!0,sx:{backgroundColor:"transparent",px:1,"& input::placeholder":{color:"text.disabled"}}}})]},l)})}),e.jsx(t.Box,{sx:{mt:1},children:e.jsx(t.FormControlLabel,{control:e.jsx(t.Checkbox,{checked:!!d.approved,onChange:(l,x)=>{const m=n.map(p=>p.uniqueName===r?{...p,approved:x}:p);this.setState({entries:m}),this.onChange(this.props.attr,m)}}),label:this.getText("unlock_approved")})})]}),d.alarmType==="unlock"&&e.jsxs(t.Box,{sx:{mt:2},children:[e.jsx(t.Typography,{variant:"caption",color:"text.secondary",sx:{mb:.5},children:this.getText("unlock_setnavi_hint")}),e.jsxs(t.Select,{fullWidth:!0,variant:"standard",displayEmpty:!0,value:d.setNavi??"",onChange:l=>{const x=String(l.target.value),m=n.map(p=>p.uniqueName===r?{...p,setNavi:x}:p);this.setState({entries:m}),this.onChange(this.props.attr,m)},sx:{backgroundColor:"transparent",px:1},children:[e.jsx(t.MenuItem,{value:"",children:e.jsx("em",{children:this.getText("unlock_setnavi_placeholder")})}),(this.state.pagesList||[]).filter(l=>typeof l=="string"&&!l.startsWith("///")&&l!==r).map(l=>e.jsx(t.MenuItem,{value:l,children:l},l)),d.setNavi&&d.setNavi!==r&&!(this.state.pagesList||[]).includes(d.setNavi)&&e.jsx(t.MenuItem,{value:d.setNavi,children:d.setNavi},`custom-${d.setNavi}`)]})]})]}):null})()}):e.jsxs(t.Box,{children:[e.jsx(t.Typography,{variant:"h6",children:this.getText("unlock_select_item")}),e.jsx(t.Box,{sx:{mt:2},children:e.jsx(t.Typography,{variant:"body2",color:"text.secondary",children:this.getText("unlock_select_description")})})]})})}),e.jsx(R,{widthPercent:30,uniqueName:a.selected,currentAssignments:((_=n.find(r=>r.uniqueName===a.selected))==null?void 0:_.navigationAssignment)||[],oContext:this.props.oContext,onAssign:(r,d)=>{const l=n.map(x=>x.uniqueName===r?{...x,navigationAssignment:d}:x);this.setState({entries:l}),this.onChange(this.props.attr,l)},children:e.jsx(t.Paper,{sx:{height:"100%",p:2,backgroundColor:"transparent"},elevation:0,children:e.jsxs(t.Box,{children:[e.jsx(t.Typography,{variant:"subtitle2",sx:{mb:1},children:this.getText("unlock_unique_label")}),e.jsx(t.Typography,{variant:"body1",sx:{fontWeight:600},children:a.selected||this.getText("unlock_select_item")}),e.jsx(D,{fontSize:"small",color:"action",sx:{mt:1}})]})})})]})]})}}const O=S(E),ee={NavigationView:I,IconSelect:B,IconOverview:P,UnlockPage:O};export{ee as default};
