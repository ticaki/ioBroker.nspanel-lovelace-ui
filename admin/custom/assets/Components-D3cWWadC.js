import{A as k,b as P,c as I,S as O,C as q,w as B,d as L,a as z,I as V,W as G}from"./NavigationView-BDzsQ2SK.js";import{j as e}from"./createSvgIcon-BAyG150Y.js";import{A as t}from"./AdminComponentEasyAccessSet__loadShare___mf_0_mui_mf_1_material__loadShare__-DP1_LQ8a.js";import{R as D}from"./AdminComponentEasyAccessSet__loadShare__react__loadShare__-BWvOyvAg.js";import{D as Y,V as H,a as Q}from"./VisibilityOff-BA5BfaUG.js";import{A}from"./AdminComponentEasyAccessSet__loadShare___mf_0_iobroker_mf_1_adapter_mf_2_react_mf_2_v5__loadShare__-ChLGBbzW.js";import{T as W}from"./Tooltip-QmnnkgNQ.js";import{A as R}from"./AdminComponentEasyAccessSet__loadShare___mf_0_mui_mf_1_icons_mf_2_material__loadShare__-CmHE1aSA.js";import"./index-BCpyQc2W.js";import"./_commonjsHelpers-CE1G-McA.js";import"./AdminComponentEasyAccessSet__mf_v__runtimeInit__mf_v__-DmMtQNcK.js";import"./Clear-jM7oAHDI.js";import"./useTheme-Cq43vfiC.js";import"./defaultTheme-BKgYrozm.js";import"./Grow-DxyKUkMA.js";class M extends k.ConfigGeneric{static defaultProps={widthPercent:30};constructor(s){super(s),this.state={...this.state,available:[],selectedTopic:"",added:[],assignments:s.currentAssignments||[],pagesMap:{},alive:!1,isCollapsed:!1,isLoading:{},lastLoadTime:{},focusReceived:{},retryCount:{}}}componentWillUnmount(){if(this.props.oContext&&this.props.oContext.socket){const s=this.props.oContext.instance??"0";this.props.oContext.socket.unsubscribeState(`system.adapter.${P}.${s}.alive`,this.onAliveChanged)}}async componentDidMount(){if(super.componentDidMount(),this.props.oContext&&this.props.oContext.socket){const s=this.props.oContext.instance??"0",o=`system.adapter.${P}.${s}.alive`;try{const n=await this.props.oContext.socket.getState(o),a=!!(n!=null&&n.val);this.setState({alive:a}),await this.props.oContext.socket.subscribeState(o,this.onAliveChanged)}catch(n){console.error("[NavigationAssignmentPanel] Failed to get alive state or subscribe:",n),this.setState({alive:!1})}}await this.loadPanels(!1),await this.applyAssignmentsFromProps(this.props.currentAssignments||[])}onAliveChanged=(s,o)=>{const n=this.state.alive,a=o?!!o.val:!1;n!==a&&(this.setState({alive:a}),!n&&a&&this.state.assignments.length>0&&this.retryLoadingPagesForAssignments())};async applyAssignmentsFromProps(s){var l;const o=(s||[]).map(u=>this.state.available.find(j=>j.panelTopic===u.topic)||{panelTopic:u.topic,friendlyName:u.topic}).sort((u,w)=>u.friendlyName.localeCompare(w.friendlyName));console.log(`[NavigationAssignmentPanel] applyAssignmentsFromProps: available=${JSON.stringify(this.state.available)}, added=${JSON.stringify(o)}`);const n=this.state.selectedAddedTopic,r=o.find(u=>u.panelTopic===n)?n:(l=o[0])==null?void 0:l.panelTopic;this.setState({assignments:s,added:o,selectedAddedTopic:r,selectedTopic:""});const i=o.map(u=>this.loadPagesForPanel(u.panelTopic,!0));await Promise.all(i)}componentDidUpdate(s){if(s.uniqueName!==this.props.uniqueName){const o=this.props.currentAssignments||[];this.props.uniqueName&&this.setState(n=>({focusReceived:{...n.focusReceived,[this.props.uniqueName]:!0}})),this.loadPanels(!1).then(()=>{this.applyAssignmentsFromProps(o)})}else if(s.currentAssignments!==this.props.currentAssignments&&this.props.currentAssignments){const o=this.props.currentAssignments||[];this.applyAssignmentsFromProps(o)}}async loadPanels(s=!0){var o;try{let n=[];this.props.fetchPanels?n=await this.props.fetchPanels():(o=this.props.data)!=null&&o.panels&&(n=(this.props.data.panels||[]).map(a=>({panelTopic:a.topic,friendlyName:a.name||a.topic}))),await new Promise(a=>this.setState({available:n,selectedTopic:""},()=>a()))}catch{this.setState({available:[],selectedTopic:""})}}doAddSelected=()=>{const{selectedTopic:s,available:o,added:n}=this.state;if(!s)return;let a=o.find(l=>l.panelTopic===s);if(!a&&s===I&&(a={panelTopic:I,friendlyName:`(${A.I18n.t("all")||"All"})`}),!a||n.find(l=>l.panelTopic===a.panelTopic))return;const r=[...n,a],i=[...this.state.assignments,{topic:a.panelTopic}];this.setState({added:r,assignments:i,selectedTopic:""}),this.loadPagesForPanel(a.panelTopic),this.props.onAssign&&this.props.uniqueName&&this.props.onAssign(this.props.uniqueName,i)};doRemoveSelected=()=>{const{added:s,selectedAddedTopic:o}=this.state;if(s.length)if(o){const n=s.filter(l=>l.panelTopic!==o),a=this.state.assignments.filter(l=>l.topic!==o),r=s.findIndex(l=>l.panelTopic===o);let i;if(n.length>0){const l=n[r]??n[r-1]??n[0];i=l==null?void 0:l.panelTopic}else i=void 0;this.setState({added:n,assignments:a,selectedAddedTopic:i}),this.props.onAssign&&this.props.uniqueName&&this.props.onAssign(this.props.uniqueName,a)}else{const n=s.slice(0,-1),a=this.state.assignments.slice(0,-1),r=n.length?n[n.length-1].panelTopic:void 0;this.setState({added:n,assignments:a,selectedAddedTopic:r}),this.props.onAssign&&this.props.uniqueName&&this.props.onAssign(this.props.uniqueName,a)}};selectAdded=s=>{this.setState({selectedAddedTopic:s}),this.loadPagesForPanel(s,!0)};retryLoadingPagesForAssignments(){const s=this.state.assignments.map(o=>o.topic);for(const o of s)this.loadPagesForPanel(o,!0)}async loadPagesForPanel(s,o=!1){var u,w;if(!s)return;if(!this.state.alive){console.log(`[NavigationAssignmentPanel] Adapter not alive, skipping pages load for ${s}`);return}const n=Date.now(),a=this.state.lastLoadTime[s]||0,r=this.state.isLoading[s],i=!!this.state.pagesMap[s],l=o||!i||n-a>6e4;if(!(r||!l&&i)){this.setState(j=>({isLoading:{...j.isLoading,[s]:!0},lastLoadTime:{...j.lastLoadTime,[s]:n}}));try{let j=[],S=!1;if((u=this.props.oContext)!=null&&u.socket){const d=this.props.oContext.instance??"0",x=`${P}.${d}`,T={panelTopic:s};try{const h=new Promise((v,g)=>{setTimeout(()=>g(new Error("sendTo timeout after 2 seconds")),2e3)}),N=this.props.oContext.socket.sendTo(x,O,T),f=await Promise.race([N,h]);Array.isArray(f)?(j=f,S=!0):f&&Array.isArray(f.result)&&(j=f.result,S=!0),console.log("[NavigationAssignmentPanel] sendTo successful",{topic:s,pages:j})}catch(h){console.warn("[NavigationAssignmentPanel] sendTo failed or timed out",{target:x,cmd:O,payload:T,error:h})}}if(S&&j.length===0){const d=this.state.retryCount[s]||0,x=3,T=2e3;if(d<x){console.log(`[NavigationAssignmentPanel] Got empty array for ${s}, retrying in ${T}ms (attempt ${d+1}/${x})`),this.setState(h=>({retryCount:{...h.retryCount,[s]:d+1}})),setTimeout(()=>{this.setState(h=>({isLoading:{...h.isLoading,[s]:!1}})),this.loadPagesForPanel(s,!0)},T);return}console.log(`[NavigationAssignmentPanel] Max retries reached for ${s}, accepting empty result`),this.setState(h=>({retryCount:{...h.retryCount,[s]:0}}))}else S&&j.length>0&&this.setState(d=>({retryCount:{...d.retryCount,[s]:0}}));if(!S&&!((w=this.props.oContext)!=null&&w.socket)&&(await new Promise(d=>setTimeout(d,1e3)),this.setState(d=>({isLoading:{...d.isLoading,[s]:!1}})),!this.state.focusReceived[s]))return this.setState(d=>({focusReceived:{...d.focusReceived,[s]:!0}})),this.loadPagesForPanel(s,!0);this.setState(d=>({pagesMap:{...d.pagesMap,[s]:j},isLoading:{...d.isLoading,[s]:!1}}))}catch(j){console.error("[NavigationAssignmentPanel] loadPagesForPanel error",{topic:s,error:j}),this.setState(S=>({isLoading:{...S.isLoading,[s]:!1}}))}}}setNavigationForSelected=s=>{const{selectedAddedTopic:o,assignments:n}=this.state;if(!o)return;const a=n.findIndex(u=>u.topic===o),r=[...n],i=n[a],l={topic:o,navigation:{...i==null?void 0:i.navigation,...s}};a>=0?r[a]=l:r.push(l),this.setState({assignments:r}),this.props.onAssign&&this.props.uniqueName&&this.props.onAssign(this.props.uniqueName,r)};getNavValue=(s,o)=>{var r;if(!s)return"";const n=this.state.assignments.find(i=>i.topic===s);return((r=n==null?void 0:n.navigation)==null?void 0:r[o])||""};togglePanel=()=>{const s=this.state.isCollapsed;this.setState(o=>({isCollapsed:!o.isCollapsed})),s&&this.applyAssignmentsFromProps(this.props.currentAssignments||[])};renderItem(s,o,n){const{widthPercent:a}=this.props,{isCollapsed:r}=this.state,i=this.state.selectedAddedTopic?this.state.pagesMap[this.state.selectedAddedTopic]??[]:[];return e.jsxs(t.Box,{sx:{position:{xs:"static",md:"absolute"},right:{xs:"auto",md:0},top:{xs:"auto",md:0},height:{xs:"auto",md:"100%"},width:{xs:"100%",md:r?"10px":`${a}%`},minHeight:{xs:r?"50px":"auto",md:"auto"},transition:"width 240ms ease, min-height 240ms ease",backgroundColor:"background.default",border:{xs:"2px solid",md:"none"},borderLeft:{xs:"none",md:"2px solid"},borderTop:{xs:"none",md:"2px solid"},borderColor:"secondary.main",borderRadius:{xs:1,md:0},overflow:{xs:"hidden",md:"visible"},display:"flex",flexDirection:"column",zIndex:20,mt:{xs:2,md:0}},children:[e.jsx(t.Box,{sx:{display:{xs:"none",md:"flex"},position:"absolute",left:"-20px",top:"50%",transform:"translateY(-50%)",width:"20px",height:"60px",backgroundColor:"secondary.main",borderRadius:"4px 0 0 4px",alignItems:"center",justifyContent:"center",cursor:"pointer",zIndex:21,"&:hover":{backgroundColor:"secondary.dark"}},onClick:this.togglePanel,children:e.jsx(t.Typography,{sx:{color:"secondary.contrastText",fontSize:"14px",fontWeight:"bold",transform:"rotate(-90deg)",whiteSpace:"nowrap"},children:r?"⏶":"⏷"})}),e.jsx(t.Box,{sx:{display:{xs:"flex",md:"none"},alignItems:"center",justifyContent:"center",p:1,backgroundColor:"secondary.main",color:"secondary.contrastText",borderRadius:"4px 4px 0 0"},children:e.jsx(t.Typography,{variant:"subtitle2",sx:{fontWeight:600},children:A.I18n.t("navigation_panel")})}),e.jsxs(t.Box,{sx:{p:1,height:"100%",display:{xs:"flex",md:r?"none":"flex"},flexDirection:"column",width:{xs:"100%",md:r?"0%":"100%"},overflow:"hidden",transition:{xs:"none",md:"width 240ms ease"}},children:[e.jsx(t.Typography,{variant:"h6",sx:{mb:1,fontWeight:600,color:"primary.main",fontSize:"1rem",display:{xs:"none",md:"block"}},children:A.I18n.t("navigation_panel")}),e.jsxs(t.Box,{sx:{display:"flex",gap:1,alignItems:"center",mb:1},children:[e.jsxs(t.Select,{size:"small",variant:"standard",value:this.state.selectedTopic,onOpen:()=>{this.loadPanels()},onChange:l=>this.setState({selectedTopic:String(l.target.value)}),disabled:!this.state.alive,sx:{flex:1,backgroundColor:"transparent",minHeight:40,"& .MuiSelect-select":{backgroundColor:"transparent",display:"flex",alignItems:"center",height:40}},displayEmpty:!0,children:[e.jsx(t.MenuItem,{value:"",children:e.jsx("em",{children:"—"})}),!this.state.added.some(l=>l.panelTopic===I)&&e.jsx(t.MenuItem,{value:I,children:`(${A.I18n.t("all")||"All"})`}),this.state.available.filter(l=>!this.state.added.some(u=>u.panelTopic===l.panelTopic)).map(l=>e.jsx(t.MenuItem,{value:l.panelTopic,children:l.friendlyName},l.panelTopic))]}),e.jsx(t.Button,{size:"small",variant:"contained",sx:{minWidth:32,padding:"4px 8px"},onClick:this.doAddSelected,disabled:!this.state.selectedTopic||!this.state.alive,children:"+"})]}),e.jsx(t.Box,{children:this.state.added.length===0?e.jsx(t.Typography,{variant:"body2",color:"text.secondary",children:A.I18n.t("No panels added")}):e.jsx("div",{style:{overflow:"auto"},children:e.jsx(t.List,{dense:!0,children:this.state.added.map(l=>{const u=l.panelTopic,w=this.state.pendingDelete===u;return e.jsx(D.Fragment,{children:e.jsx(t.ListItem,{component:"div",disablePadding:!0,sx:{"&:hover .delete-icon":{opacity:1}},secondaryAction:e.jsx(t.IconButton,{className:"delete-icon",edge:"end","aria-label":"delete",size:"small",onClick:j=>{var S;if(j.stopPropagation(),!w)this.setState({pendingDelete:u}),setTimeout(()=>{this.state.pendingDelete===u&&this.setState({pendingDelete:void 0})},3e3);else{const d=this.state.added.filter(h=>h.panelTopic!==u),x=this.state.assignments.filter(h=>h.topic!==u),T=d.length>0?(S=d[0])==null?void 0:S.panelTopic:void 0;this.setState({added:d,assignments:x,selectedAddedTopic:T,pendingDelete:void 0}),this.props.onAssign&&this.props.uniqueName&&this.props.onAssign(this.props.uniqueName,x)}},sx:{color:w?"error.dark":"error.main",opacity:{xs:1,md:0},transition:"opacity 0.2s",backgroundColor:w?"error.main":"transparent","&:hover":{backgroundColor:w?"error.dark":"action.hover"}},children:e.jsx(Y,{fontSize:"small"})}),children:e.jsx(t.ListItemButton,{selected:this.state.selectedAddedTopic===u,onClick:()=>{this.selectAdded(u),this.setState({pendingDelete:void 0})},sx:{pr:6},children:e.jsx(t.ListItemText,{primary:u===I?`(${A.I18n.t("all")||"All"})`:l.friendlyName,sx:{flex:1,overflow:"hidden",textOverflow:"ellipsis"}})})})},u)})})})}),e.jsx(t.Divider,{sx:{my:1}}),e.jsxs(t.Box,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:1,mt:1},children:[e.jsxs(t.Box,{children:[e.jsx(t.Box,{sx:{display:"flex",alignItems:"center",mb:.5},children:e.jsx(W,{title:A.I18n.t("nav_prev_tooltip"),children:e.jsx(t.Typography,{variant:"caption",color:"text.secondary",sx:{mr:.5},children:"prev"})})}),e.jsxs(t.Select,{size:"small",displayEmpty:!0,"aria-label":"prev",value:this.getNavValue(this.state.selectedAddedTopic,"prev")||"",onOpen:()=>{this.state.selectedAddedTopic&&this.loadPagesForPanel(this.state.selectedAddedTopic,!0)},onChange:l=>this.setNavigationForSelected({prev:String(l.target.value)||void 0}),sx:{width:"100%"},disabled:!this.state.alive||this.state.selectedAddedTopic&&this.state.isLoading[this.state.selectedAddedTopic]||!1,endAdornment:this.state.selectedAddedTopic&&this.state.isLoading[this.state.selectedAddedTopic]?e.jsx(t.Box,{sx:{display:"flex",alignItems:"center",pr:1},children:e.jsx(t.CircularProgress,{size:16})}):null,children:[e.jsx(t.MenuItem,{value:"",children:this.state.selectedAddedTopic?e.jsx("em",{children:"—"}):e.jsx("em",{children:A.I18n.t("select_panel_first")})}),i.filter(l=>l!==this.props.uniqueName).map(l=>e.jsx(t.MenuItem,{value:l,children:l},`prev-${l}`))]})]}),e.jsxs(t.Box,{children:[e.jsx(t.Box,{sx:{display:"flex",alignItems:"center",mb:.5},children:e.jsx(W,{title:A.I18n.t("nav_next_tooltip"),children:e.jsx(t.Typography,{variant:"caption",color:"text.secondary",sx:{mr:.5},children:"next"})})}),e.jsxs(t.Select,{size:"small",displayEmpty:!0,"aria-label":"next",value:this.getNavValue(this.state.selectedAddedTopic,"next")||"",onOpen:()=>{this.state.selectedAddedTopic&&this.loadPagesForPanel(this.state.selectedAddedTopic,!0)},onChange:l=>this.setNavigationForSelected({next:String(l.target.value)||void 0}),sx:{width:"100%"},disabled:!this.state.alive||this.state.selectedAddedTopic&&this.state.isLoading[this.state.selectedAddedTopic]||!1,endAdornment:this.state.selectedAddedTopic&&this.state.isLoading[this.state.selectedAddedTopic]?e.jsx(t.Box,{sx:{display:"flex",alignItems:"center",pr:1},children:e.jsx(t.CircularProgress,{size:16})}):null,children:[e.jsx(t.MenuItem,{value:"",children:this.state.selectedAddedTopic?e.jsx("em",{children:"—"}):e.jsx("em",{children:A.I18n.t("select_panel_first")})}),i.filter(l=>l!==this.props.uniqueName&&!l.startsWith("///")).map(l=>e.jsx(t.MenuItem,{value:l,children:l},`next-${l}`))]})]}),e.jsxs(t.Box,{children:[e.jsx(t.Typography,{variant:"caption",color:"text.secondary",sx:{mb:.5,display:"block"},children:"home"}),e.jsxs(t.Select,{size:"small",displayEmpty:!0,"aria-label":"home",value:this.getNavValue(this.state.selectedAddedTopic,"home")||"",onOpen:()=>{this.state.selectedAddedTopic&&this.loadPagesForPanel(this.state.selectedAddedTopic,!0)},onChange:l=>this.setNavigationForSelected({home:String(l.target.value)||void 0}),sx:{width:"100%"},disabled:!this.state.alive||this.state.selectedAddedTopic&&this.state.isLoading[this.state.selectedAddedTopic]||!1,endAdornment:this.state.selectedAddedTopic&&this.state.isLoading[this.state.selectedAddedTopic]?e.jsx(t.Box,{sx:{display:"flex",alignItems:"center",pr:1},children:e.jsx(t.CircularProgress,{size:16})}):null,children:[e.jsx(t.MenuItem,{value:"",children:e.jsx("em",{children:"—"})}),i.filter(l=>l!==this.props.uniqueName).map(l=>e.jsx(t.MenuItem,{value:l,children:l},`home-${l}`))]})]}),e.jsxs(t.Box,{children:[e.jsx(t.Typography,{variant:"caption",color:"text.secondary",sx:{mb:.5,display:"block"},children:"parent"}),e.jsxs(t.Select,{size:"small",displayEmpty:!0,"aria-label":"parent",value:this.getNavValue(this.state.selectedAddedTopic,"parent")||"",onOpen:()=>{this.state.selectedAddedTopic&&this.loadPagesForPanel(this.state.selectedAddedTopic,!0)},onChange:l=>this.setNavigationForSelected({parent:String(l.target.value)||void 0}),sx:{width:"100%"},disabled:!this.state.alive||this.state.selectedAddedTopic&&this.state.isLoading[this.state.selectedAddedTopic]||!1,endAdornment:this.state.selectedAddedTopic&&this.state.isLoading[this.state.selectedAddedTopic]?e.jsx(t.Box,{sx:{display:"flex",alignItems:"center",pr:1},children:e.jsx(t.CircularProgress,{size:16})}):null,children:[e.jsx(t.MenuItem,{value:"",children:e.jsx("em",{children:"—"})}),i.filter(l=>l!==this.props.uniqueName).map(l=>e.jsx(t.MenuItem,{value:l,children:l},`parent-${l}`))]})]}),e.jsx(t.Divider,{sx:{my:1}})]}),this.state.added.length>0?this.state.added.map(l=>{const u=l.panelTopic,w=this.state.added.some(v=>v.panelTopic===I),j=this.getNavValue(u,"next"),S=this.getNavValue(u,"prev"),d=this.getNavValue(u,"home"),x=this.getNavValue(u,"parent"),T=!!(j||S||d||x),h=u===I,N=!j&&!S,f=h?"nav_all_requires_prev_next":w?"nav_remove_from_all_notice":"nav_target_only_notice";return e.jsxs(t.Box,{"data-has-all":w,sx:{mt:2,mb:1},children:[e.jsxs(t.Box,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:[e.jsx(t.Box,{sx:{width:10,height:10,borderRadius:"50%",bgcolor:T?"success.main":"error.main"}}),e.jsx(t.Typography,{variant:"subtitle2",sx:{fontWeight:600},children:u===I?`(${A.I18n.t("all")||"All"})`:l.friendlyName||u})]}),e.jsx(t.Box,{sx:{display:"flex",alignItems:"center",gap:1,flexWrap:"wrap"},children:["next","prev","parent","home"].map((v,g)=>{const m=this.getNavValue(u,v);return e.jsxs(D.Fragment,{children:[e.jsxs(t.Box,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(t.Typography,{variant:"caption",color:"text.secondary",children:A.I18n.t(v)||v}),e.jsx(t.Typography,{variant:"body2",children:m||e.jsx("em",{children:"—"})})]}),g<3&&e.jsx(t.Divider,{orientation:"vertical",flexItem:!0,sx:{height:18,mx:1}})]},`${u}-${v}`)})}),N?e.jsx(t.Box,{sx:{mt:1},children:e.jsx(t.Typography,{variant:"caption",color:"text.secondary",sx:{fontStyle:"italic"},children:A.I18n.t(f)})}):null]},`panel-summary-${u}`)}):null]})]})}}class J extends D.Component{constructor(s){super(s),this.state={newName:"",confirmDeleteOpen:!1,confirmDeleteName:null}}getText(s){return this.props.getText(s)}handleAdd=()=>{const s=this.state.newName.trim();!s||this.props.selectedCardType==="all"||(this.props.onAdd(s,this.props.selectedCardType),this.setState({newName:""}),this.props.onSelectedChange(s))};handleDeleteClick=s=>{this.setState({confirmDeleteOpen:!0,confirmDeleteName:s})};handleDeleteConfirm=()=>{const s=this.state.confirmDeleteName;if(!s){this.setState({confirmDeleteOpen:!1,confirmDeleteName:null});return}this.props.onDelete(s),this.setState({confirmDeleteOpen:!1,confirmDeleteName:null})};handleDeleteCancel=()=>{this.setState({confirmDeleteOpen:!1,confirmDeleteName:null})};render(){const{entries:s,selected:o,selectedCardType:n,onSelectedChange:a,onCardTypeChange:r,onAssign:i,children:l,oContext:u,navigationPanelProps:w}=this.props,j=Array.from(new Set(s.map(h=>h.uniqueName))).filter(Boolean),S=n==="all"?s:s.filter(h=>h.card===n),d=Array.from(new Set(S.map(h=>h.uniqueName))).filter(Boolean),x=s.find(h=>h.uniqueName===o),T=(x==null?void 0:x.navigationAssignment)||[];return e.jsxs(t.Box,{sx:{height:"calc(100vh - 64px)",display:"flex",flexDirection:{xs:"column",md:"row"},p:1},children:[e.jsxs(t.Box,{sx:{width:{xs:"100%",md:"20%"},pr:{xs:0,md:1},display:"flex",flexDirection:"column",gap:1},children:[e.jsx(t.Paper,{sx:{p:1,mb:1,backgroundColor:"transparent"},elevation:0,children:e.jsxs(t.FormControl,{fullWidth:!0,variant:"standard",children:[e.jsx(t.Typography,{variant:"caption",color:"text.secondary",sx:{mb:.5},children:this.getText("page_type")}),e.jsxs(t.Select,{value:n,onChange:h=>{r(h.target.value)},sx:{backgroundColor:"transparent",px:1},children:[e.jsx(t.MenuItem,{value:"all",children:this.getText("page_type_all")}),e.jsx(t.MenuItem,{value:"cardAlarm",children:this.getText("page_type_alarm")}),e.jsx(t.MenuItem,{value:"cardQR",children:this.getText("page_type_qr")})]})]})}),e.jsx(t.Typography,{variant:"h6",sx:{mb:1,fontWeight:600,color:"primary.main",fontSize:"1rem"},children:this.getText("pages")}),n!=="all"&&e.jsx(t.Paper,{sx:{p:1,backgroundColor:"transparent"},elevation:0,children:e.jsxs(t.Box,{sx:{display:"flex",gap:1},children:[e.jsx(t.TextField,{"aria-label":"new-name",label:this.getText("new_page"),value:this.state.newName,onChange:h=>{this.setState({newName:h.target.value})},variant:"standard",placeholder:this.getText("New item"),InputProps:{sx:{backgroundColor:"transparent",px:1}},sx:{flex:1,"& .MuiInput-underline:before":{borderBottomColor:"primary.main"},"& .MuiInput-underline:hover:before":{borderBottomColor:"primary.main"},"& .MuiInput-underline:after":{borderBottomColor:"primary.main"},"& .MuiInputLabel-root":{color:"primary.main"},"& .MuiInputLabel-root.Mui-focused":{color:"primary.main"}}}),e.jsx(t.Button,{size:"small",variant:"contained",onClick:this.handleAdd,disabled:!this.state.newName.trim()||j.includes(this.state.newName.trim()),children:"+"})]})}),e.jsx(t.Paper,{sx:{overflow:"auto",p:1,backgroundColor:"transparent"},elevation:0,children:d.length===0?e.jsx(t.Typography,{variant:"body2",color:"text.secondary",children:this.getText("No items")}):d.map(h=>e.jsxs(t.Box,{onClick:()=>{a(h)},sx:{p:1,borderRadius:1,cursor:"pointer",backgroundColor:o===h?"action.selected":"transparent",mb:.5,display:"flex",justifyContent:"space-between",alignItems:"center","&:hover .delete-icon":{opacity:1}},children:[e.jsx(t.Typography,{variant:"body2",sx:{flex:1,overflow:"hidden",textOverflow:"ellipsis"},children:h}),e.jsx(t.IconButton,{className:"delete-icon",edge:"end","aria-label":"delete",size:"small",onClick:N=>{N.stopPropagation(),this.handleDeleteClick(h)},sx:{color:"error.main",opacity:{xs:1,md:0},transition:"opacity 0.2s"},children:e.jsx(Y,{fontSize:"small"})})]},h))}),e.jsx(t.Divider,{sx:{my:1}}),e.jsx(t.Box,{sx:{mb:2},children:e.jsx("a",{href:"https://github.com/ticaki/ioBroker.nspanel-lovelace-ui/wiki/pageUnlock",target:"_blank",rel:"noopener noreferrer",style:{textDecoration:"none",color:"inherit",fontSize:"0.875rem"},children:e.jsx(t.Typography,{variant:"body2",sx:{color:"primary.main",textDecoration:"underline",cursor:"pointer","&:hover":{opacity:.8}},children:this.getText("documentation")})})})]}),e.jsx(q,{open:this.state.confirmDeleteOpen,onClose:this.handleDeleteCancel,onConfirm:this.handleDeleteConfirm,title:this.getText("delete_confirm_title"),description:this.getText("delete_confirm_text")+(this.state.confirmDeleteName?`: ${this.state.confirmDeleteName}`:""),cancelText:this.getText("Cancel"),confirmText:this.getText("Delete"),ariaTitleId:"unlock-delete-confirm-title",ariaDescId:"unlock-delete-confirm-description"}),e.jsxs(t.Box,{sx:{width:{xs:"100%",md:"90%"},pl:{xs:0,md:2},mt:{xs:2,md:0},display:"flex",flexDirection:{xs:"column",md:"row"},gap:1,position:"relative"},children:[e.jsx(t.Box,{sx:{width:{xs:"100%",md:"95%"},borderLeft:{xs:"none",md:"1px solid"},borderColor:"divider"},children:e.jsx(t.Paper,{sx:{height:"100%",p:2},elevation:1,children:l})}),e.jsx(M,{...w,widthPercent:30,uniqueName:o,currentAssignments:T,oContext:u,onAssign:i})]})]})}}class K extends D.Component{constructor(s){super(s),this.state={showPin:!1}}getText(s){return this.props.getText(s)}handleFieldChange(s,o){const n={...this.props.entry,[s]:o};this.props.onEntryChange(n)}render(){const{entry:s,pagesList:o}=this.props;return e.jsxs(t.Box,{children:[e.jsx(t.Box,{sx:{mb:1,p:1,borderRadius:1,backgroundColor:"action.hover"},children:e.jsx(t.TextField,{fullWidth:!0,variant:"standard",type:"text",label:this.getText("unique_label"),value:s.uniqueName,onChange:n=>{const a=n.target.value;a.trim()&&this.props.onUniqueNameChange(s.uniqueName,a)},InputProps:{sx:{backgroundColor:"transparent",px:1,fontWeight:600,width:"50%"}}})}),e.jsx(t.Box,{sx:{mb:1},children:e.jsxs(t.FormControl,{component:"fieldset",children:[e.jsx(t.Typography,{variant:"subtitle2",sx:{mb:1},children:this.getText("unlock_type")}),e.jsxs(t.RadioGroup,{row:!0,value:s.alarmType||"",onChange:(n,a)=>{this.handleFieldChange("alarmType",a)},children:[e.jsx(t.FormControlLabel,{value:"alarm",control:e.jsx(t.Radio,{}),label:this.getText("unlock_alarm")}),e.jsx(t.FormControlLabel,{value:"unlock",control:e.jsx(t.Radio,{}),label:this.getText("unlock_unlock")})]})]})}),e.jsx(t.TextField,{fullWidth:!0,variant:"standard",type:"text",autoComplete:"off",label:this.getText("headline"),value:s.headline??"",onChange:n=>{this.handleFieldChange("headline",n.target.value)},InputProps:{sx:{backgroundColor:"transparent",px:1,width:"50%"}},sx:{mb:2}}),e.jsx(t.Box,{sx:{mt:2},children:e.jsx(t.TextField,{variant:"standard",label:this.getText("unlock_pin"),type:this.state.showPin?"text":"password",value:s.pin!==void 0&&s.pin!==null?String(s.pin):"",onChange:n=>{const r=n.target.value.replace(/[^0-9]/g,""),i=r?parseInt(r,10):0;this.handleFieldChange("pin",i)},InputProps:{sx:{backgroundColor:"transparent",px:1},endAdornment:e.jsx(t.InputAdornment,{position:"end",children:e.jsx(t.IconButton,{"aria-label":this.state.showPin?"hide-pin":"show-pin",onClick:()=>{this.setState({showPin:!this.state.showPin})},edge:"end",size:"small",children:this.state.showPin?e.jsx(H,{fontSize:"small"}):e.jsx(Q,{fontSize:"small"})})})}})}),e.jsxs(t.Box,{sx:{mt:2},children:[e.jsx(t.FormControlLabel,{control:e.jsx(t.Checkbox,{checked:!!s.hidden,onChange:(n,a)=>{this.handleFieldChange("hidden",a)}}),label:this.getText("hidden")}),e.jsx(t.Box,{sx:{mt:2},children:e.jsxs(t.FormControl,{component:"fieldset",children:[e.jsx(t.Typography,{variant:"subtitle2",sx:{mb:1},children:this.getText("alwaysOn")}),e.jsxs(t.RadioGroup,{row:!0,value:s.alwaysOn||"none",onChange:(n,a)=>{this.handleFieldChange("alwaysOn",a)},children:[e.jsx(t.FormControlLabel,{value:"none",control:e.jsx(t.Radio,{}),label:this.getText("alwaysOn_none")}),e.jsx(t.FormControlLabel,{value:"always",control:e.jsx(t.Radio,{}),label:this.getText("alwaysOn_always")}),e.jsx(t.FormControlLabel,{value:"ignore",control:e.jsx(t.Radio,{}),label:this.getText("alwaysOn_ignore")})]})]})})]}),s.alarmType==="alarm"&&e.jsxs(t.Box,{sx:{mt:2},children:[e.jsxs(t.Box,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"1fr 1fr"},gap:2},children:[e.jsxs(t.Box,{children:[e.jsx(t.Typography,{variant:"subtitle2",sx:{mb:1},children:this.getText("unlock_armed_header")}),e.jsx(t.Box,{sx:{display:"grid",gap:2},children:[1,2,3,4].map(n=>{const a=`button${n}`,r=(n-1)%4+1;return e.jsxs(t.Box,{children:[e.jsx(t.Typography,{variant:"caption",color:"text.secondary",sx:{mb:.5},children:this.getText(`unlock_button${r}_label`)}),e.jsx(t.TextField,{fullWidth:!0,variant:"standard",placeholder:this.getText(`unlock_button${r}_placeholder`),value:s[a]??"",onChange:i=>{this.handleFieldChange(a,i.target.value)},InputProps:{disableUnderline:!0,sx:{backgroundColor:"transparent",px:1,"& input::placeholder":{color:"text.disabled"}}}})]},n)})})]}),e.jsxs(t.Box,{children:[e.jsx(t.Typography,{variant:"subtitle2",sx:{mb:1},children:this.getText("unlock_disarmed_header")}),e.jsx(t.Box,{sx:{display:"grid",gap:2},children:[5,6,7,8].map(n=>{const a=`button${n}`,r=(n-1)%4+1;return e.jsxs(t.Box,{children:[e.jsx(t.Typography,{variant:"caption",color:"text.secondary",sx:{mb:.5},children:this.getText(`unlock_button${r}_label`)}),e.jsx(t.TextField,{fullWidth:!0,variant:"standard",placeholder:this.getText(`unlock_button${r}_placeholder`),value:s[a]??"",onChange:i=>{this.handleFieldChange(a,i.target.value)},InputProps:{disableUnderline:!0,sx:{backgroundColor:"transparent",px:1,"& input::placeholder":{color:"text.disabled"}}}})]},n)})})]})]}),e.jsx(t.Box,{sx:{mt:1},children:e.jsx(t.FormControlLabel,{control:e.jsx(t.Checkbox,{checked:!!s.approved,onChange:(n,a)=>{this.handleFieldChange("approved",a)}}),label:this.getText("unlock_approved")})}),e.jsx(t.Box,{sx:{mt:1},children:e.jsx(t.FormControlLabel,{control:e.jsx(t.Checkbox,{checked:!!s.global,onChange:(n,a)=>{this.handleFieldChange("global",a)}}),label:this.getText("unlock_global")})})]}),s.alarmType==="unlock"&&e.jsxs(t.Box,{sx:{mt:2},children:[e.jsx(t.Typography,{variant:"caption",color:"text.secondary",sx:{mb:.5},children:this.getText("unlock_setnavi_hint")}),e.jsxs(t.Select,{variant:"standard",displayEmpty:!0,value:s.setNavi??"",onChange:n=>{this.handleFieldChange("setNavi",String(n.target.value))},sx:{backgroundColor:"transparent",px:1,width:"60%"},children:[e.jsx(t.MenuItem,{value:"",children:e.jsx("em",{children:this.getText("unlock_setnavi_placeholder")})}),o.filter(n=>typeof n=="string"&&!n.startsWith("///")&&n!==s.uniqueName).map(n=>e.jsx(t.MenuItem,{value:n,children:n},n)),s.setNavi&&s.setNavi!==s.uniqueName&&!o.includes(s.setNavi)&&e.jsx(t.MenuItem,{value:s.setNavi,children:s.setNavi},`custom-${s.setNavi}`)]})]})]})}}class U extends D.Component{schema;constructor(s){super(s),this.state={data:{objectId:s.value||""}};const o={type:"objectId",label:"Select an object",sm:12,md:12,lg:12,...this.props.objectIdConfig};this.schema={type:"panel",label:"Object Selector",items:{objectId:o}}}componentDidUpdate(s){s.value!==this.props.value&&this.props.value!==this.state.data.objectId&&this.setState({data:{objectId:this.props.value||""}})}handleChange=s=>{this.setState({data:s}),this.props.onChange&&s.objectId!==this.props.value&&this.props.onChange(s.objectId)};render(){const{socket:s,themeName:o,themeType:n,theme:a,adapterName:r,instance:i,showSelected:l}=this.props;return e.jsxs(t.Box,{sx:{width:"100%"},children:[e.jsx(k.JsonConfigComponent,{socket:s,themeName:o,themeType:n,theme:a,adapterName:r||"nspanel-lovelace-ui",instance:i||0,schema:this.schema,data:this.state.data,onChange:this.handleChange,isFloatComma:!1,dateFormat:"DD.MM.YYYY",onError:()=>{}}),l&&e.jsxs(t.Box,{sx:{mt:2,color:"text.secondary",fontSize:"0.875rem"},children:[A.I18n.t("Selected object"),": ",this.state.data.objectId||e.jsx("em",{children:"—"})]})]})}}class X extends D.Component{constructor(s){super(s),this.state={showPassword:!1}}getText(s){return this.props.getText(s)}handleFieldChange(s,o){const n={...this.props.entry,[s]:o};this.props.onEntryChange(n)}render(){var a;const{entry:s,oContext:o,theme:n}=this.props;return e.jsxs(t.Box,{children:[e.jsx(t.Box,{sx:{mb:1,p:1,borderRadius:1,backgroundColor:"action.hover"},children:e.jsx(t.TextField,{fullWidth:!0,variant:"standard",type:"text",label:this.getText("unique_label"),value:s.uniqueName,onChange:r=>{const i=r.target.value;i.trim()&&this.props.onUniqueNameChange(s.uniqueName,i)},InputProps:{sx:{backgroundColor:"transparent",px:1,fontWeight:600,width:"50%"}}})}),e.jsx(t.Box,{sx:{mb:2},children:e.jsxs(t.FormControl,{component:"fieldset",children:[e.jsx(t.FormLabel,{component:"legend",children:this.getText("qr_type")}),e.jsxs(t.RadioGroup,{row:!0,value:s.selType??0,onChange:r=>{const i=parseInt(r.target.value,10);this.handleFieldChange("selType",i)},children:[e.jsx(t.FormControlLabel,{value:1,control:e.jsx(t.Radio,{}),label:this.getText("qr_type_wifi")}),e.jsx(t.FormControlLabel,{value:2,control:e.jsx(t.Radio,{}),label:this.getText("qr_type_url")}),e.jsx(t.FormControlLabel,{value:3,control:e.jsx(t.Radio,{}),label:this.getText("qr_type_tel")})]})]})}),e.jsx(t.TextField,{fullWidth:!0,variant:"standard",type:"text",autoComplete:"off",label:this.getText("headline"),value:s.headline??"",onChange:r=>{this.handleFieldChange("headline",r.target.value)},InputProps:{sx:{backgroundColor:"transparent",px:1,width:"50%"}},sx:{mb:2}}),e.jsx(t.TextField,{fullWidth:!0,variant:"standard",type:"text",autoComplete:"off",label:(()=>{switch(s.selType){case 1:return this.getText("qr_content_wifi");case 2:return this.getText("qr_content_url");case 3:return this.getText("qr_content_tel");default:return this.getText("qr_content")}})(),value:s.SSIDURLTEL??"",onChange:r=>{this.handleFieldChange("SSIDURLTEL",r.target.value)},InputProps:{sx:{backgroundColor:"transparent",px:1}},sx:{mb:2}}),s.selType===1&&e.jsxs(t.Box,{sx:{mb:2},children:[e.jsxs(t.FormControl,{variant:"standard",sx:{mb:2,minWidth:120},children:[e.jsx(t.InputLabel,{children:this.getText("qr_wlan_type")}),e.jsxs(t.Select,{value:s.wlantype??"WPA2",onChange:r=>{const i=r.target.value;this.handleFieldChange("wlantype",i)},children:[e.jsx(t.MenuItem,{value:"nopass",children:"No Password"}),e.jsx(t.MenuItem,{value:"WPA",children:"WPA"}),e.jsx(t.MenuItem,{value:"WPA2",children:"WPA2"}),e.jsx(t.MenuItem,{value:"WPA3",children:"WPA3"}),e.jsx(t.MenuItem,{value:"WEP",children:"WEP"})]})]}),s.wlantype!=="nopass"&&e.jsx(t.TextField,{fullWidth:!0,variant:"standard",type:this.state.showPassword?"text":"password",label:this.getText("qr_password"),value:s.qrPass??"",onChange:r=>{this.handleFieldChange("qrPass",r.target.value)},InputProps:{sx:{backgroundColor:"transparent",px:1},endAdornment:e.jsx(t.InputAdornment,{position:"end",children:e.jsx(t.IconButton,{"aria-label":"toggle password visibility",onClick:()=>{this.setState({showPassword:!this.state.showPassword})},edge:"end",children:this.state.showPassword?e.jsx(R.VisibilityOff,{}):e.jsx(R.Visibility,{})})})},sx:{mb:2}}),e.jsxs(t.Box,{sx:{display:"flex",gap:2},children:[e.jsx(t.FormControlLabel,{control:e.jsx(t.Checkbox,{checked:!!s.wlanhidden,onChange:(r,i)=>{this.handleFieldChange("wlanhidden",i)}}),label:this.getText("qr_wlan_hidden")}),e.jsx(t.FormControlLabel,{control:e.jsx(t.Checkbox,{checked:!!s.pwdhidden,onChange:(r,i)=>{this.handleFieldChange("pwdhidden",i)}}),label:this.getText("qr_pwd_hidden")})]}),e.jsxs(t.Box,{sx:{mb:2},children:[e.jsx(t.Typography,{variant:"body2",sx:{mb:1,color:"text.secondary"},children:this.getText("qr_set_state")}),e.jsx(U,{value:s.setState??"",onChange:r=>{this.handleFieldChange("setState",r)},socket:o.socket,themeName:"blue",themeType:((a=n==null?void 0:n.palette)==null?void 0:a.mode)||"light",theme:n,adapterName:"nspanel-lovelace-ui",instance:(o==null?void 0:o.instance)||0,objectIdConfig:{types:"state",filterFunc:"return !!(obj && obj.type === 'state' && obj.common && obj.common.type === 'boolean' && obj.common.write && obj.common.read);"}})]})]}),e.jsxs(t.Box,{sx:{mt:2},children:[e.jsx(t.FormControlLabel,{control:e.jsx(t.Checkbox,{checked:!!s.hidden,onChange:(r,i)=>{this.handleFieldChange("hidden",i)}}),label:this.getText("hidden")}),e.jsx(t.Box,{sx:{mt:2},children:e.jsxs(t.FormControl,{component:"fieldset",children:[e.jsx(t.Typography,{variant:"subtitle2",sx:{mb:1},children:this.getText("alwaysOn")}),e.jsxs(t.RadioGroup,{row:!0,value:(s==null?void 0:s.alwaysOn)||"none",onChange:(r,i)=>{this.handleFieldChange("alwaysOn",i)},children:[e.jsx(t.FormControlLabel,{value:"none",control:e.jsx(t.Radio,{}),label:this.getText("alwaysOn_none")}),e.jsx(t.FormControlLabel,{value:"always",control:e.jsx(t.Radio,{}),label:this.getText("alwaysOn_always")}),e.jsx(t.FormControlLabel,{value:"ignore",control:e.jsx(t.Radio,{}),label:this.getText("alwaysOn_ignore")})]})]})})]})]})}}class Z extends k.ConfigGeneric{pagesRetryTimeout;constructor(s){super(s);const o=k.ConfigGeneric.getValue(s.data,s.attr);this.state={...this.state,entries:Array.isArray(o)?o:[],selected:"",selectedCardType:"all",pagesList:[],alive:!1,pagesRetryCount:0}}componentWillUnmount(){this.pagesRetryTimeout&&clearTimeout(this.pagesRetryTimeout);const s=this.props.oContext.instance??"0";this.props.oContext.socket.unsubscribeState(`system.adapter.${P}.${s}.alive`,this.onAliveChanged)}async componentDidMount(){super.componentDidMount();const s=this.props.oContext.instance??"0",o=`system.adapter.${P}.${s}.alive`;try{const n=await this.props.oContext.socket.getState(o),a=!!(n!=null&&n.val);this.setState({alive:a}),await this.props.oContext.socket.subscribeState(o,this.onAliveChanged),a&&await this.loadPagesList()}catch(n){console.error("[UnlockPage] Failed to get alive state or subscribe:",n),this.setState({alive:!1})}}onAliveChanged=(s,o)=>{const n=this.state.alive,a=o?!!o.val:!1;n!==a&&(this.setState({alive:a}),!n&&a&&(!this.state.pagesList||this.state.pagesList.length===0)&&this.loadPagesList(),n&&!a&&this.pagesRetryTimeout&&(clearTimeout(this.pagesRetryTimeout),this.pagesRetryTimeout=void 0))};async loadPagesList(){if(!this.state.alive){console.log("[UnlockPage] Adapter not alive, skipping pages load");return}const s=[];if(this.props.oContext&&this.props.oContext.socket){const o=this.props.oContext.instance??"0",n=`${P}.${o}`;try{const a=await this.props.oContext.socket.sendTo(n,L,null);let r=[];Array.isArray(a)?r=a:a&&Array.isArray(a.result)&&(r=a.result);for(const i of r)s.push(i);if(r.length===0){const i=this.state.pagesRetryCount||0,l=3e3;console.log(`[UnlockPage] Got empty pages array, retrying in ${l}ms (attempt ${i+1})`),this.setState({pagesRetryCount:i+1}),this.pagesRetryTimeout&&clearTimeout(this.pagesRetryTimeout),this.pagesRetryTimeout=setTimeout(()=>{this.state.alive?this.loadPagesList():console.log("[UnlockPage] Adapter went offline, cancelling pages retry")},l);return}else r.length>0&&(console.log(`[UnlockPage] Successfully loaded ${r.length} pages after ${this.state.pagesRetryCount||0} retries`),this.setState({pagesRetryCount:0}),this.pagesRetryTimeout&&(clearTimeout(this.pagesRetryTimeout),this.pagesRetryTimeout=void 0))}catch(a){const r=this.state.pagesRetryCount||0,i=3e3;console.log(`[UnlockPage] Error loading pages, retrying in ${i}ms (attempt ${r+1}): ${String(a)}`),this.setState({pagesRetryCount:r+1}),this.pagesRetryTimeout&&clearTimeout(this.pagesRetryTimeout),this.pagesRetryTimeout=setTimeout(()=>{this.state.alive?this.loadPagesList():console.log("[UnlockPage] Adapter went offline, cancelling pages retry after error")},i);return}}else{console.log("[UnlockPage] No socket available for sendTo");return}this.setState({pagesList:Array.from(new Set(s))})}handleAdd=(s,o)=>{if(o==="all")return;let n;if(o==="cardAlarm")n={card:"cardAlarm",uniqueName:s,headline:s,button1:"",button2:"",button3:"",button4:"",button5:"",button6:"",button7:"",button8:"",pin:0};else if(o==="cardQR")n={card:"cardQR",uniqueName:s,headline:s,SSIDURLTEL:"",wlanhidden:!1,pwdhidden:!1,setState:"",selType:0};else return;const a=[...this.state.entries,n];this.setState({entries:a}),this.onChange(this.props.attr,a)};handleDelete=s=>{const o=this.state.entries.filter(a=>a.uniqueName!==s);this.setState({entries:o}),this.onChange(this.props.attr,o);const n=Array.from(new Set(o.map(a=>a.uniqueName))).filter(Boolean);this.setState({selected:n[0]||""})};handleAssign=(s,o)=>{const n=this.state.entries.map(a=>a.uniqueName===s?{...a,navigationAssignment:o}:a);this.setState({entries:n}),this.onChange(this.props.attr,n)};handleEntryChange=s=>{const o=this.state.entries.map(n=>n.uniqueName===s.uniqueName?s:n);this.setState({entries:o}),this.onChange(this.props.attr,o)};handleUniqueNameChange=(s,o)=>{if(!o.trim())return;const n=this.state.entries.map(a=>a.uniqueName===s?{...a,uniqueName:o}:a);this.setState({entries:n,selected:o}),this.onChange(this.props.attr,n)};handleCardTypeChange=s=>{const o=s==="all"?this.state.entries:this.state.entries.filter(a=>a.card===s),n=o.length>0?o[0].uniqueName:"";this.setState({selectedCardType:s,selected:n})};renderMiddlePanel(){const{selected:s,entries:o,pagesList:n}=this.state;if(!s)return e.jsxs(t.Box,{children:[e.jsx(t.Typography,{variant:"h6",children:this.getText("select_item")}),e.jsx(t.Box,{sx:{mt:2},children:e.jsx(t.Typography,{variant:"body2",color:"text.secondary",children:this.getText("select_description")})})]});const a=o.find(r=>r.uniqueName===s);return a?a.card==="cardAlarm"?e.jsx(K,{entry:a,pagesList:n,onEntryChange:this.handleEntryChange,onUniqueNameChange:this.handleUniqueNameChange,getText:r=>this.getText(r)}):a.card==="cardQR"?e.jsx(X,{entry:a,onEntryChange:this.handleEntryChange,onUniqueNameChange:this.handleUniqueNameChange,getText:r=>this.getText(r),oContext:this.props.oContext,theme:this.props.theme}):e.jsxs(t.Typography,{variant:"body2",children:[a.card," - ",this.getText("coming_soon")]}):e.jsx(t.Typography,{variant:"body2",color:"text.secondary",children:this.getText("Entry not found")})}renderItem(s,o,n){return e.jsx(J,{entries:this.state.entries,selected:this.state.selected,selectedCardType:this.state.selectedCardType,onSelectedChange:a=>this.setState({selected:a}),onCardTypeChange:this.handleCardTypeChange,onAdd:this.handleAdd,onDelete:this.handleDelete,onAssign:this.handleAssign,oContext:this.props.oContext,getText:a=>this.getText(a),navigationPanelProps:{...this.props,data:this.props.data,onChange:this.props.onChange,onError:this.props.onError},children:this.renderMiddlePanel()})}}const ee=B(Z);class te extends k.ConfigGeneric{_local=null;pagesRetryTimeout;dateFormats=[{value:{dateStyle:"short"},label:"DD.MM.YY"},{value:{dateStyle:"short",locale:"en-US"},label:"MM/DD/YY"},{value:{year:"numeric",month:"2-digit",day:"2-digit"},label:"YYYY-MM-DD"},{value:{day:"2-digit",month:"short",year:"numeric"},label:"DD MMM YYYY"},{value:{day:"2-digit",month:"long",year:"numeric"},label:"DD Month YYYY"},{value:{weekday:"short",day:"2-digit",month:"2-digit",year:"numeric"},label:"EEE, DD.MM.YYYY"},{value:{weekday:"long",day:"2-digit",month:"2-digit",year:"numeric"},label:"EEEE, DD.MM.YYYY"},{value:{weekday:"short",day:"2-digit",month:"short",year:"numeric"},label:"EEE, DD MMM YYYY"},{value:{weekday:"long",day:"2-digit",month:"long",year:"numeric"},label:"EEEE, DD Month YYYY"},{value:"custom",label:"Custom"}];timeFormats=[{value:"HH:mm",label:"timeFormat24"},{value:"h:mm a",label:"timeFormat12"},{value:"HH:mm:ss",label:"timeFormat24Seconds"},{value:"h:mm:ss a",label:"timeFormat12Seconds"},{value:"custom",label:"Custom"}];constructor(s){super(s);const o=k.ConfigGeneric.getValue(s.data,s.attr);this.state={...this.state,entries:Array.isArray(o)?o:[],confirmDeleteOpen:!1,confirmDeleteName:null,alive:!1,pagesRetryCount:0}}formatDatePreview(s,o){try{return s.toLocaleDateString(void 0,typeof o=="string"?JSON.parse(o):o)}catch{return"Invalid Format"}}formatTimePreview(s,o){return o.replace(/HH/g,String(s.getHours()).padStart(2,"0")).replace(/mm/g,String(s.getMinutes()).padStart(2,"0")).replace(/ss/g,String(s.getSeconds()).padStart(2,"0")).replace(/h/g,String(s.getHours()%12||12)).replace(/a/g,s.getHours()>=12?"PM":"AM")}componentWillUnmount(){this.pagesRetryTimeout&&clearTimeout(this.pagesRetryTimeout);const s=this.props.oContext.instance??"0";this.props.oContext.socket.unsubscribeState(`system.adapter.${P}.${s}.alive`,this.onAliveChanged)}async componentDidMount(){super.componentDidMount();const s=this.props.oContext.instance??"0",o=`system.adapter.${P}.${s}.alive`;try{const n=await this.props.oContext.socket.getState(o),a=!!(n!=null&&n.val);this.setState({alive:a}),await this.props.oContext.socket.subscribeState(o,this.onAliveChanged),a&&await this.loadPagesList()}catch(n){console.error("[ScreensaverPage] Failed to get alive state or subscribe:",n),this.setState({alive:!1})}}onAliveChanged=(s,o)=>{const n=this.state.alive,a=o?!!o.val:!1;n!==a&&(this.setState({alive:a}),!n&&a&&(!this.state.pagesList||this.state.pagesList.length===0)&&this.loadPagesList(),n&&!a&&this.pagesRetryTimeout&&(clearTimeout(this.pagesRetryTimeout),this.pagesRetryTimeout=void 0))};async loadPagesList(){if(!this.state.alive){console.log("[ScreensaverPage] Adapter not alive, skipping pages load");return}const s=[];if(this.props.oContext&&this.props.oContext.socket){const o=this.props.oContext.instance??"0",n=`${P}.${o}`;try{const a=await this.props.oContext.socket.sendTo(n,L,null);let r=[];Array.isArray(a)?r=a:a&&Array.isArray(a.result)&&(r=a.result);for(const i of r)s.push(i);if(r.length===0){const i=this.state.pagesRetryCount||0,l=3e3;console.log(`[ScreensaverPage] Got empty pages array, retrying in ${l}ms (attempt ${i+1})`),this.setState({pagesRetryCount:i+1}),this.pagesRetryTimeout&&clearTimeout(this.pagesRetryTimeout),this.pagesRetryTimeout=setTimeout(()=>{this.state.alive?this.loadPagesList():console.log("[ScreensaverPage] Adapter went offline, cancelling pages retry")},l);return}else r.length>0&&(console.log(`[ScreensaverPage] Successfully loaded ${r.length} pages after ${this.state.pagesRetryCount||0} retries`),this.setState({pagesRetryCount:0}),this.pagesRetryTimeout&&(clearTimeout(this.pagesRetryTimeout),this.pagesRetryTimeout=void 0))}catch(a){const r=this.state.pagesRetryCount||0,i=3e3;console.log(`[ScreensaverPage] Error loading pages, retrying in ${i}ms (attempt ${r+1}): ${String(a)}`),this.setState({pagesRetryCount:r+1}),this.pagesRetryTimeout&&clearTimeout(this.pagesRetryTimeout),this.pagesRetryTimeout=setTimeout(()=>{this.state.alive?this.loadPagesList():console.log("[ScreensaverPage] Adapter went offline, cancelling pages retry after error")},i);return}}else{console.log("[ScreensaverPage] No socket available for sendTo");return}this.setState({pagesList:Array.from(new Set(s))})}renderItem(s,o,n){var S,d,x,T,h,N,f,v,g,m,$,E;const a=this.state.entries||[],r=Array.from(new Set(a.map(c=>c.uniqueName))).filter(Boolean);this._local||(this._local={newName:"",selected:r[0]||""});const i=this._local,l=()=>{const c=(i.newName||"").trim();if(!c)return;const y={card:"screensaver",uniqueName:c,headline:c,type:"clock",enabled:!0,timeout:60},p=[...a,y];this.setState({entries:p}),this.onChange(this.props.attr,p),i.newName="",i.selected=c},u=()=>{const c=i.selected;c&&this.setState({confirmDeleteOpen:!0,confirmDeleteName:c})},w=()=>{this.setState({confirmDeleteOpen:!1,confirmDeleteName:null})},j=()=>{const c=this.state.confirmDeleteName;if(!c){w();return}const y=a.filter(b=>b.uniqueName!==c);this.setState({entries:y,confirmDeleteOpen:!1,confirmDeleteName:null}),this.onChange(this.props.attr,y);const p=Array.from(new Set(y.map(b=>b.uniqueName))).filter(Boolean);i&&(i.selected=p[0]||""),this.setState({})};return e.jsxs(t.Box,{sx:{height:"calc(100vh - 64px)",display:"flex",flexDirection:{xs:"column",md:"row"},p:1},children:[e.jsxs(t.Box,{sx:{width:{xs:"100%",md:"20%"},pr:{xs:0,md:1},display:"flex",flexDirection:"column",gap:1},children:[e.jsx(t.Typography,{variant:"h6",sx:{mb:1,fontWeight:600,color:"primary.main",fontSize:"1rem"},children:this.getText("screensaver_pages")}),e.jsx(t.Paper,{sx:{p:1,backgroundColor:"transparent"},elevation:0,children:e.jsxs(t.Box,{sx:{display:"flex",gap:1},children:[e.jsx(t.TextField,{"aria-label":"new-screensaver-name",label:this.getText("new_screensaver"),value:(i==null?void 0:i.newName)||"",onChange:c=>{i&&(i.newName=c.target.value),this.setState({})},variant:"standard",placeholder:this.getText("new_screensaver"),InputProps:{sx:{backgroundColor:"transparent",px:1}},sx:{flex:1,"& .MuiInput-underline:before":{borderBottomColor:"primary.main"},"& .MuiInput-underline:hover:before":{borderBottomColor:"primary.main"},"& .MuiInput-underline:after":{borderBottomColor:"primary.main"},"& .MuiInputLabel-root":{color:"primary.main"},"& .MuiInputLabel-root.Mui-focused":{color:"primary.main"}}}),e.jsx(t.Button,{size:"small",variant:"contained",onClick:l,sx:{minWidth:32,padding:"4px 8px"},disabled:(()=>{const c=((i==null?void 0:i.newName)||"").trim();return!c||r.includes(c)})(),children:"+"})]})}),e.jsx(t.Paper,{sx:{overflow:"auto",p:1,backgroundColor:"transparent"},elevation:1,children:r.length===0?e.jsx(t.Typography,{variant:"body2",color:"text.secondary",children:this.getText("no_screensavers")}):r.map(c=>e.jsx(t.Box,{onClick:()=>{i&&(i.selected=c),this.setState({})},sx:{p:1,borderRadius:1,cursor:"pointer",backgroundColor:(i==null?void 0:i.selected)===c?"action.selected":"transparent",mb:.5},children:e.jsx(t.Typography,{variant:"body2",children:c})},c))}),e.jsx(t.Box,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(t.Button,{size:"small",color:"error",variant:"outlined",sx:{minWidth:32,padding:"4px 8px"},onClick:u,disabled:!(i!=null&&i.selected),children:"-"})}),e.jsx(t.Box,{sx:{marginTop:2,marginBottom:2},children:e.jsxs(t.FormControl,{component:"fieldset",disabled:(i==null?void 0:i.selected)===null,children:[e.jsx(t.FormLabel,{component:"legend",sx:{color:(i==null?void 0:i.selected)===null?((x=(d=(S=this.props.theme)==null?void 0:S.palette)==null?void 0:d.text)==null?void 0:x.disabled)||"#999":(N=(h=(T=this.props.theme)==null?void 0:T.palette)==null?void 0:h.text)==null?void 0:N.primary},children:this.getText("cardType")}),e.jsxs(t.RadioGroup,{value:i!=null&&i.selected&&((f=this.state.entries.find(c=>c.uniqueName===i.selected))==null?void 0:f.card)||"screensaver",onChange:c=>{if(i!=null&&i.selected){const y=c.target.value,p=[...this.state.entries],b=p.findIndex(C=>C.uniqueName===i.selected);b!==-1&&(p[b]={...p[b],card:y},this.setState({entries:p}),this.props.onChange(this.props.attr||"",p))}},sx:{flexDirection:"column","& .MuiRadio-root.Mui-disabled":{color:"#999 !important"},"& .MuiFormControlLabel-label.Mui-disabled":{color:"#999 !important"}},children:[e.jsx(t.FormControlLabel,{value:"screensaver",control:e.jsx(t.Radio,{}),label:this.getText("cardTypeStandard")}),e.jsx(t.FormControlLabel,{value:"screensaver2",control:e.jsx(t.Radio,{}),label:this.getText("cardTypeAdvanced")}),e.jsx(t.FormControlLabel,{value:"screensaver3",control:e.jsx(t.Radio,{}),label:this.getText("cardTypeEasyview")})]})]})}),e.jsx(t.Divider,{sx:{my:1}}),e.jsx(t.Box,{sx:{mb:2},children:e.jsx("a",{href:"https://github.com/ticaki/ioBroker.nspanel-lovelace-ui/wiki/screensaver",target:"_blank",rel:"noopener noreferrer",style:{textDecoration:"none",color:"inherit",fontSize:"0.875rem"},children:e.jsx(t.Typography,{variant:"body2",sx:{color:"primary.main",textDecoration:"underline",cursor:"pointer","&:hover":{opacity:.8}},children:this.getText("documentation")})})}),e.jsxs(t.Box,{sx:{mb:2},children:[e.jsx(t.Typography,{variant:"caption",sx:{display:"block",mb:1,color:"text.secondary"},children:"Test 1: SelectID Dialog (filterFunc = real function)"}),e.jsx(t.TextField,{fullWidth:!0,label:"Select Object ID (Dialog)",value:this.state.selectedObjectId||"",onClick:()=>{this.setState({showSelectDialog:!0})},InputProps:{readOnly:!0}}),this.state.showSelectDialog&&e.jsx(A.SelectID,{socket:this.props.oContext.socket,selected:this.state.selectedObjectId||"",onOk:c=>{const y=Array.isArray(c)?c[0]:c;this.setState({selectedObjectId:y||"",showSelectDialog:!1})},onClose:()=>{this.setState({showSelectDialog:!1})},filterFunc:c=>{var y;return!!((c==null?void 0:c.type)==="state"&&((y=c.common)!=null&&y.role)&&c.common.role.startsWith("switch"))},dialogName:"nspanel-screensaver",theme:this.props.theme,themeType:((g=(v=this.props.theme)==null?void 0:v.palette)==null?void 0:g.mode)||"light"})]}),e.jsxs(t.Box,{sx:{mb:2},children:[e.jsx(t.Typography,{variant:"caption",sx:{display:"block",mb:1,color:"text.secondary"},children:"Test 2: JsonConfigComponent (filterFunc = string compiled with new Function)"}),e.jsx(k.JsonConfigComponent,{socket:this.props.oContext.socket,themeName:this.props.themeName,themeType:(($=(m=this.props.theme)==null?void 0:m.palette)==null?void 0:$.mode)||"light",theme:this.props.theme,schema:{type:"panel",label:"Object Selector",items:{testObjectId:{type:"objectId",label:"Select Object (JsonConfig)",sm:12,md:12,lg:12,filterFunc:"return !!(obj?.type === 'state' && obj.common?.role && obj.common.role.startsWith('switch'));"}}},data:{testObjectId:this.state.selectedObjectIdJson||""},onChange:c=>{const y=c&&c.testObjectId||"";this.setState({selectedObjectIdJson:y})},isFloatComma:!1,dateFormat:"DD.MM.YYYY",onError:()=>{},adapterName:"nspanel-lovelace-ui",instance:Number(((E=this.props.oContext)==null?void 0:E.instance)||0)})]})]}),e.jsx(q,{open:!!this.state.confirmDeleteOpen,onClose:w,onConfirm:j,title:this.getText("screensaver_delete_confirm_title"),description:this.getText("screensaver_delete_confirm_text")+(this.state.confirmDeleteName?`: ${this.state.confirmDeleteName}`:""),cancelText:this.getText("Cancel"),confirmText:this.getText("Delete"),ariaTitleId:"screensaver-delete-confirm-title",ariaDescId:"screensaver-delete-confirm-description"}),e.jsxs(t.Box,{sx:{width:{xs:"100%",md:"90%"},pl:{xs:0,md:2},mt:{xs:2,md:0},display:"flex",flexDirection:{xs:"column",md:"row"},gap:1,position:"relative"},children:[e.jsx(t.Box,{sx:{width:{xs:"100%",md:"95%"},borderLeft:{xs:"none",md:"1px solid"},borderColor:"divider"},children:e.jsx(t.Paper,{sx:{height:"100%",p:2},elevation:1,children:i!=null&&i.selected?e.jsx(t.Box,{children:(()=>{const c=i==null?void 0:i.selected,y=a.find(p=>p.uniqueName===c);return y?e.jsxs(t.Box,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(t.Typography,{variant:"h6",sx:{mb:1},children:[this.getText("screensaver_config"),": ",c]}),e.jsx(t.TextField,{label:this.getText("screensaver_headline"),value:y.headline||"",onChange:p=>{const b=a.map(C=>C.uniqueName===c?{...C,headline:p.target.value}:C);this.setState({entries:b}),this.onChange(this.props.attr,b)},variant:"outlined",fullWidth:!0}),e.jsx(t.TextField,{label:this.getText("screensaver_timeout"),value:y.timeout||60,onChange:p=>{const b=parseInt(p.target.value)||60,C=a.map(_=>_.uniqueName===c?{..._,timeout:b}:_);this.setState({entries:C}),this.onChange(this.props.attr,C)},variant:"outlined",type:"number",fullWidth:!0}),e.jsxs(t.FormControl,{variant:"outlined",fullWidth:!0,sx:{mt:2},children:[e.jsx(t.InputLabel,{children:this.getText("dateFormat")}),e.jsx(t.Select,{value:y.dateFormat||"dd.MM.yyyy",onChange:p=>{const b=p.target.value,C=a.map(_=>_.uniqueName===c?{..._,dateFormat:b}:_);this.setState({entries:C}),this.onChange(this.props.attr,C)},label:this.getText("dateFormat"),children:this.dateFormats.map(p=>e.jsx(t.MenuItem,{value:JSON.stringify(p.value),children:p.value==="custom"?this.getText("dateFormatCustom"):p.label},p.label))})]}),y.dateFormat==="custom"&&e.jsx(t.TextField,{label:this.getText("dateFormatCustom"),value:y.customDateFormat||"",onChange:p=>{const b=p.target.value,C=a.map(_=>_.uniqueName===c?{..._,customDateFormat:b}:_);this.setState({entries:C}),this.onChange(this.props.attr,C)},variant:"outlined",fullWidth:!0,placeholder:"dd.MM.yyyy",sx:{mt:1}}),e.jsxs(t.Typography,{variant:"caption",color:"text.secondary",sx:{mt:.5,display:"block"},children:[this.getText("dateFormatExample"),":"," ",(()=>{const p=new Date,b=y.dateFormat||"dd.MM.yyyy";console.log("Formatting date with format:",y.dateFormat);try{if(b==="custom"){const C=y.customDateFormat||"";return C?this.formatDatePreview(p,C):"Enter custom format above"}return this.formatDatePreview(p,b)}catch{return"Invalid format"}})()]}),e.jsxs(t.FormControl,{variant:"outlined",fullWidth:!0,sx:{mt:2},children:[e.jsx(t.InputLabel,{children:this.getText("timeFormat")}),e.jsx(t.Select,{value:y.timeFormat||"HH:mm",onChange:p=>{const b=p.target.value,C=a.map(_=>_.uniqueName===c?{..._,timeFormat:b}:_);this.setState({entries:C}),this.onChange(this.props.attr,C)},label:this.getText("timeFormat"),children:this.timeFormats.map(p=>e.jsx(t.MenuItem,{value:p.value,children:p.value==="custom"?this.getText("timeFormatCustom"):this.getText(p.label)},p.value))})]}),y.timeFormat==="custom"&&e.jsx(t.TextField,{label:this.getText("timeFormatCustom"),value:y.customTimeFormat||"",onChange:p=>{const b=p.target.value,C=a.map(_=>_.uniqueName===c?{..._,customTimeFormat:b}:_);this.setState({entries:C}),this.onChange(this.props.attr,C)},variant:"outlined",fullWidth:!0,placeholder:"HH:mm",sx:{mt:1}}),e.jsxs(t.Typography,{variant:"caption",color:"text.secondary",sx:{mt:.5,display:"block"},children:[this.getText("timeFormatExample"),":"," ",(()=>{const p=new Date,b=y.timeFormat||"HH:mm";try{if(b==="custom"){const C=y.customTimeFormat||"";return C?this.formatTimePreview(p,C):"Enter custom format above"}return this.formatTimePreview(p,b)}catch{return"Invalid format"}})()]})]}):e.jsx(t.Typography,{variant:"body2",color:"error",children:this.getText("screensaver_entry_not_found")})})()}):e.jsxs(t.Box,{children:[e.jsx(t.Typography,{variant:"h6",children:this.getText("screensaver_select_item")}),e.jsx(t.Box,{sx:{mt:2},children:e.jsx(t.Typography,{variant:"body2",color:"text.secondary",children:this.getText("screensaver_select_description")})})]})})}),e.jsx(M,{...this.props,widthPercent:30,oContext:this.props.oContext,uniqueName:(i==null?void 0:i.selected)||"",currentAssignments:(()=>{const c=i==null?void 0:i.selected;if(!c)return[];const y=a.find(p=>p.uniqueName===c);return(y==null?void 0:y.navigation)||[]})(),onAssign:(c,y)=>{const p=a.map(b=>b.uniqueName===c?{...b,navigation:y}:b);this.setState({entries:p}),this.onChange(this.props.attr,p)}})]})]})}}const se=B(te);class ae extends k.ConfigGeneric{_local=null;pagesRetryTimeout;constructor(s){super(s);const o=k.ConfigGeneric.getValue(s.data,s.attr);this.state={...this.state,entries:Array.isArray(o)?o:[],confirmDeleteOpen:!1,confirmDeleteName:null,alive:!1,pagesRetryCount:0}}componentWillUnmount(){this.pagesRetryTimeout&&clearTimeout(this.pagesRetryTimeout);const s=this.props.oContext.instance??"0";this.props.oContext.socket.unsubscribeState(`system.adapter.${P}.${s}.alive`,this.onAliveChanged)}async componentDidMount(){super.componentDidMount();const s=this.props.oContext.instance??"0",o=`system.adapter.${P}.${s}.alive`;try{const n=await this.props.oContext.socket.getState(o),a=!!(n!=null&&n.val);this.setState({alive:a}),await this.props.oContext.socket.subscribeState(o,this.onAliveChanged),a&&await this.loadPagesList()}catch(n){console.error("[QRPage] Failed to get alive state or subscribe:",n),this.setState({alive:!1})}}onAliveChanged=(s,o)=>{const n=this.state.alive,a=o?!!o.val:!1;n!==a&&(this.setState({alive:a}),!n&&a&&(!this.state.pagesList||this.state.pagesList.length===0)&&this.loadPagesList(),n&&!a&&this.pagesRetryTimeout&&(clearTimeout(this.pagesRetryTimeout),this.pagesRetryTimeout=void 0))};async loadPagesList(){if(!this.state.alive){console.log("[QRPage] Adapter not alive, skipping pages load");return}const s=[];if(this.props.oContext&&this.props.oContext.socket){const o=this.props.oContext.instance??"0",n=`${P}.${o}`;try{const a=await this.props.oContext.socket.sendTo(n,L,null);let r=[];Array.isArray(a)?r=a:a&&Array.isArray(a.result)&&(r=a.result);for(const i of r)s.push(i);if(r.length===0){const i=this.state.pagesRetryCount||0,l=3e3;console.log(`[QRPage] Got empty pages array, retrying in ${l}ms (attempt ${i+1})`),this.setState({pagesRetryCount:i+1}),this.pagesRetryTimeout&&clearTimeout(this.pagesRetryTimeout),this.pagesRetryTimeout=setTimeout(()=>{this.state.alive?this.loadPagesList():console.log("[QRPage] Adapter went offline, cancelling pages retry")},l);return}else r.length>0&&(console.log(`[QRPage] Successfully loaded ${r.length} pages after ${this.state.pagesRetryCount||0} retries`),this.setState({pagesRetryCount:0}),this.pagesRetryTimeout&&(clearTimeout(this.pagesRetryTimeout),this.pagesRetryTimeout=void 0))}catch(a){const r=this.state.pagesRetryCount||0,i=3e3;console.log(`[QRPage] Error loading pages, retrying in ${i}ms (attempt ${r+1}): ${String(a)}`),this.setState({pagesRetryCount:r+1}),this.pagesRetryTimeout&&clearTimeout(this.pagesRetryTimeout),this.pagesRetryTimeout=setTimeout(()=>{this.state.alive?this.loadPagesList():console.log("[QRPage] Adapter went offline, cancelling pages retry after error")},i);return}}else{console.log("[QRPage] No socket available for sendTo");return}this.setState({pagesList:Array.from(new Set(s))})}renderItem(s,o,n){var S;const a=this.state.entries||[],r=Array.from(new Set(a.map(d=>d.uniqueName))).filter(Boolean);this._local||(this._local={newName:"",selected:r[0]||"",showPassword:!1});const i=this._local,l=()=>{const d=(i.newName||"").trim();if(!d)return;const x={card:"cardQR",uniqueName:d,headline:d,SSIDURLTEL:"",wlanhidden:!1,pwdhidden:!1,setState:"",selType:0},T=[...a,x];this.setState({entries:T}),this.onChange(this.props.attr,T),i.newName="",i.selected=d},u=()=>{const d=i.selected;d&&this.setState({confirmDeleteOpen:!0,confirmDeleteName:d})},w=()=>{this.setState({confirmDeleteOpen:!1,confirmDeleteName:null})},j=()=>{const d=this.state.confirmDeleteName;if(!d){w();return}const x=a.filter(h=>h.uniqueName!==d);this.setState({entries:x,confirmDeleteOpen:!1,confirmDeleteName:null}),this.onChange(this.props.attr,x);const T=Array.from(new Set(x.map(h=>h.uniqueName))).filter(Boolean);i.selected=T[0]||"",this.setState({})};return e.jsxs(t.Box,{sx:{height:"calc(100vh - 64px)",display:"flex",flexDirection:{xs:"column",md:"row"},p:1},children:[e.jsxs(t.Box,{sx:{width:{xs:"100%",md:"20%"},pr:{xs:0,md:1},display:"flex",flexDirection:"column",gap:1},children:[e.jsx(t.Typography,{variant:"h6",sx:{mb:1,fontWeight:600,color:"primary.main",fontSize:"1rem"},children:this.getText("pages")}),e.jsx(t.Paper,{sx:{p:1,backgroundColor:"transparent"},elevation:0,children:e.jsxs(t.Box,{sx:{display:"flex",gap:1},children:[e.jsx(t.TextField,{"aria-label":"new-name",label:this.getText("new_page"),value:i.newName,onChange:d=>{i.newName=d.target.value,this.setState({})},variant:"standard",placeholder:this.getText("New item"),InputProps:{sx:{backgroundColor:"transparent",px:1}},sx:{flex:1,"& .MuiInput-underline:before":{borderBottomColor:"primary.main"},"& .MuiInput-underline:hover:before":{borderBottomColor:"primary.main"},"& .MuiInput-underline:after":{borderBottomColor:"primary.main"},"& .MuiInputLabel-root":{color:"primary.main"},"& .MuiInputLabel-root.Mui-focused":{color:"primary.main"}}}),e.jsx(t.Button,{size:"small",variant:"contained",onClick:l,disabled:(()=>{const d=(i.newName||"").trim();return!d||r.includes(d)})(),children:"+"})]})}),e.jsx(t.Paper,{sx:{overflow:"auto",p:1,backgroundColor:"transparent"},elevation:0,children:r.length===0?e.jsx(t.Typography,{variant:"body2",color:"text.secondary",children:this.getText("No items")}):r.map(d=>e.jsx(t.Box,{onClick:()=>{i.selected=d,this.setState({})},sx:{p:1,borderRadius:1,cursor:"pointer",backgroundColor:i.selected===d?"action.selected":"transparent",mb:.5},children:e.jsx(t.Typography,{variant:"body2",children:d})},d))}),e.jsx(t.Box,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(t.Button,{size:"small",color:"error",variant:"outlined",onClick:u,disabled:!i.selected,children:"-"})}),e.jsx(t.Divider,{sx:{my:1}}),e.jsx(t.Box,{sx:{mb:2},children:e.jsx("a",{href:"https://github.com/ticaki/ioBroker.nspanel-lovelace-ui/wiki/PageQR",target:"_blank",rel:"noopener noreferrer",style:{textDecoration:"none",color:"inherit",fontSize:"0.875rem"},children:e.jsx(t.Typography,{variant:"body2",sx:{color:"primary.main",textDecoration:"underline",cursor:"pointer","&:hover":{opacity:.8}},children:this.getText("documentation")})})})]}),e.jsx(q,{open:!!this.state.confirmDeleteOpen,onClose:w,onConfirm:j,title:this.getText("delete_confirm_title"),description:this.getText("delete_confirm_text")+(this.state.confirmDeleteName?`: ${this.state.confirmDeleteName}`:""),cancelText:this.getText("Cancel"),confirmText:this.getText("Delete"),ariaTitleId:"qr-delete-confirm-title",ariaDescId:"qr-delete-confirm-description"}),e.jsxs(t.Box,{sx:{width:{xs:"100%",md:"90%"},pl:{xs:0,md:2},mt:{xs:2,md:0},display:"flex",flexDirection:{xs:"column",md:"row"},gap:1,position:"relative"},children:[e.jsx(t.Box,{sx:{width:{xs:"100%",md:"95%"},borderLeft:{xs:"none",md:"1px solid"},borderColor:"divider"},children:e.jsx(t.Paper,{sx:{height:"100%",p:2},elevation:1,children:i.selected?e.jsx(t.Box,{children:(()=>{var T,h,N;const d=i.selected,x=a.find(f=>f.uniqueName===d);return x?e.jsxs(e.Fragment,{children:[e.jsx(t.Box,{sx:{mb:1,p:1,borderRadius:1,backgroundColor:"action.hover"},children:e.jsx(t.TextField,{fullWidth:!0,variant:"standard",type:"text",label:this.getText("unique_label"),value:d,onChange:f=>{const v=f.target.value;if(!v.trim())return;const g=a.map(m=>m.uniqueName===d?{...m,uniqueName:v}:m);this.setState({entries:g}),this.onChange(this.props.attr,g),i.selected=v},InputProps:{sx:{backgroundColor:"transparent",px:1,fontWeight:600,width:"50%"}}})}),e.jsx(t.Box,{sx:{mb:2},children:e.jsxs(t.FormControl,{component:"fieldset",children:[e.jsx(t.FormLabel,{component:"legend",children:this.getText("qr_type")}),e.jsxs(t.RadioGroup,{row:!0,value:x.selType??0,onChange:f=>{const v=parseInt(f.target.value,10),g=a.map(m=>m.uniqueName===d?{...m,selType:v}:m);this.setState({entries:g}),this.onChange(this.props.attr,g)},children:[e.jsx(t.FormControlLabel,{value:1,control:e.jsx(t.Radio,{}),label:this.getText("qr_type_wifi")}),e.jsx(t.FormControlLabel,{value:2,control:e.jsx(t.Radio,{}),label:this.getText("qr_type_url")}),e.jsx(t.FormControlLabel,{value:3,control:e.jsx(t.Radio,{}),label:this.getText("qr_type_tel")})]})]})}),e.jsx(t.TextField,{fullWidth:!0,variant:"standard",type:"text",autoComplete:"off",label:this.getText("headline"),value:x.headline??"",onChange:f=>{const v=f.target.value,g=a.map(m=>m.uniqueName===d?{...m,headline:v}:m);this.setState({entries:g}),this.onChange(this.props.attr,g)},InputProps:{sx:{backgroundColor:"transparent",px:1,width:"50%"}},sx:{mb:2}}),e.jsx(t.TextField,{fullWidth:!0,variant:"standard",type:"text",autoComplete:"off",label:(()=>{switch(x.selType){case 1:return this.getText("qr_content_wifi");case 2:return this.getText("qr_content_url");case 3:return this.getText("qr_content_tel");default:return this.getText("qr_content")}})(),value:x.SSIDURLTEL??"",onChange:f=>{const v=f.target.value,g=a.map(m=>m.uniqueName===d?{...m,SSIDURLTEL:v}:m);this.setState({entries:g}),this.onChange(this.props.attr,g)},InputProps:{sx:{backgroundColor:"transparent",px:1}},sx:{mb:2}}),x.selType===1&&e.jsxs(t.Box,{sx:{mb:2},children:[e.jsxs(t.FormControl,{variant:"standard",sx:{mb:2,minWidth:120},children:[e.jsx(t.InputLabel,{children:this.getText("qr_wlan_type")}),e.jsxs(t.Select,{value:x.wlantype??"WPA2",onChange:f=>{const v=f.target.value,g=a.map(m=>m.uniqueName===d?{...m,wlantype:v}:m);this.setState({entries:g}),this.onChange(this.props.attr,g)},children:[e.jsx(t.MenuItem,{value:"nopass",children:"No Password"}),e.jsx(t.MenuItem,{value:"WPA",children:"WPA"}),e.jsx(t.MenuItem,{value:"WPA2",children:"WPA2"}),e.jsx(t.MenuItem,{value:"WPA3",children:"WPA3"}),e.jsx(t.MenuItem,{value:"WEP",children:"WEP"})]})]}),x.wlantype!=="nopass"&&e.jsx(t.TextField,{fullWidth:!0,variant:"standard",type:i.showPassword?"text":"password",label:this.getText("qr_password"),value:x.qrPass??"",onChange:f=>{const v=f.target.value,g=a.map(m=>m.uniqueName===d?{...m,qrPass:v}:m);this.setState({entries:g}),this.onChange(this.props.attr,g)},InputProps:{sx:{backgroundColor:"transparent",px:1},endAdornment:e.jsx(t.InputAdornment,{position:"end",children:e.jsx(t.IconButton,{"aria-label":"toggle password visibility",onClick:()=>{i.showPassword=!i.showPassword,this.setState({})},edge:"end",children:i.showPassword?e.jsx(R.VisibilityOff,{}):e.jsx(R.Visibility,{})})})},sx:{mb:2}}),e.jsxs(t.Box,{sx:{display:"flex",gap:2},children:[e.jsx(t.FormControlLabel,{control:e.jsx(t.Checkbox,{checked:!!x.wlanhidden,onChange:(f,v)=>{const g=a.map(m=>m.uniqueName===d?{...m,wlanhidden:v}:m);this.setState({entries:g}),this.onChange(this.props.attr,g)}}),label:this.getText("qr_wlan_hidden")}),e.jsx(t.FormControlLabel,{control:e.jsx(t.Checkbox,{checked:!!x.pwdhidden,onChange:(f,v)=>{const g=a.map(m=>m.uniqueName===d?{...m,pwdhidden:v}:m);this.setState({entries:g}),this.onChange(this.props.attr,g)}}),label:this.getText("qr_pwd_hidden")})]}),e.jsxs(t.Box,{sx:{mb:2},children:[e.jsx(t.Typography,{variant:"body2",sx:{mb:1,color:"text.secondary"},children:this.getText("qr_set_state")}),e.jsx(U,{value:x.setState??"",onChange:f=>{const v=a.map(g=>g.uniqueName===d?{...g,setState:f}:g);this.setState({entries:v}),this.onChange(this.props.attr,v)},socket:this.props.oContext.socket,themeName:this.props.themeName,themeType:((h=(T=this.props.theme)==null?void 0:T.palette)==null?void 0:h.mode)||"light",theme:this.props.theme,adapterName:"nspanel-lovelace-ui",instance:((N=this.props.oContext)==null?void 0:N.instance)||0,objectIdConfig:{types:"state",filterFunc:"return !!(obj && obj.type === 'state' && obj.common && obj.common.type === 'boolean' && obj.common.write && obj.common.read);"}})]})]}),e.jsxs(t.Box,{sx:{mt:2},children:[e.jsx(t.FormControlLabel,{control:e.jsx(t.Checkbox,{checked:!!x.hidden,onChange:(f,v)=>{const g=a.map(m=>m.uniqueName===d?{...m,hidden:v}:m);this.setState({entries:g}),this.onChange(this.props.attr,g)}}),label:this.getText("hidden")}),e.jsx(t.Box,{sx:{mt:2},children:e.jsxs(t.FormControl,{component:"fieldset",children:[e.jsx(t.Typography,{variant:"subtitle2",sx:{mb:1},children:this.getText("alwaysOn")}),e.jsxs(t.RadioGroup,{row:!0,value:(x==null?void 0:x.alwaysOn)||"none",onChange:(f,v)=>{const g=a.map(m=>m.uniqueName===d?{...m,alwaysOn:v}:m);this.setState({entries:g}),this.onChange(this.props.attr,g)},children:[e.jsx(t.FormControlLabel,{value:"none",control:e.jsx(t.Radio,{}),label:this.getText("alwaysOn_none")}),e.jsx(t.FormControlLabel,{value:"always",control:e.jsx(t.Radio,{}),label:this.getText("alwaysOn_always")}),e.jsx(t.FormControlLabel,{value:"ignore",control:e.jsx(t.Radio,{}),label:this.getText("alwaysOn_ignore")})]})]})})]})]}):null})()}):e.jsxs(t.Box,{children:[e.jsx(t.Typography,{variant:"h6",children:this.getText("select_item")}),e.jsx(t.Box,{sx:{mt:2},children:e.jsx(t.Typography,{variant:"body2",color:"text.secondary",children:this.getText("select_description")})})]})})}),e.jsx(M,{...this.props,widthPercent:30,uniqueName:i.selected,currentAssignments:((S=a.find(d=>d.uniqueName===i.selected))==null?void 0:S.navigationAssignment)||[],oContext:this.props.oContext,onAssign:(d,x)=>{const T=a.map(h=>h.uniqueName===d?{...h,navigationAssignment:x}:h);this.setState({entries:T}),this.onChange(this.props.attr,T)}})]})]})}}const ne=B(ae),be={NavigationView:G,IconSelect:V,IconOverview:z,PageConfigManager:ee,ScreensaverPage:se,pageQR:ne};export{be as default};
