import{A as C,b as A,c as j,S as _,w as I,d as B,C as L,a as R,I as D,W as $}from"./NavigationView-BDzsQ2SK.js";import{j as e}from"./createSvgIcon-BAyG150Y.js";import{A as t}from"./AdminComponentEasyAccessSet__loadShare___mf_0_mui_mf_1_material__loadShare__-DP1_LQ8a.js";import{D as w,V as F,a as q}from"./VisibilityOff-BA5BfaUG.js";import{R as S}from"./AdminComponentEasyAccessSet__loadShare__react__loadShare__-BWvOyvAg.js";import{A as T}from"./AdminComponentEasyAccessSet__loadShare___mf_0_iobroker_mf_1_adapter_mf_2_react_mf_2_v5__loadShare__-ChLGBbzW.js";import{T as N}from"./Tooltip-QmnnkgNQ.js";import"./index-BCpyQc2W.js";import"./_commonjsHelpers-CE1G-McA.js";import"./AdminComponentEasyAccessSet__mf_v__runtimeInit__mf_v__-DmMtQNcK.js";import"./Clear-jM7oAHDI.js";import"./useTheme-Cq43vfiC.js";import"./defaultTheme-BKgYrozm.js";import"./Grow-DxyKUkMA.js";class M extends C.ConfigGeneric{static defaultProps={widthPercent:30};constructor(s){super(s),this.state={...this.state,available:[],selectedTopic:"",added:[],assignments:s.currentAssignments||[],pagesMap:{},alive:!1,isCollapsed:!1,isLoading:{},lastLoadTime:{},focusReceived:{},retryCount:{}}}componentWillUnmount(){if(this.props.oContext&&this.props.oContext.socket){const s=this.props.oContext.instance??"0";this.props.oContext.socket.unsubscribeState(`system.adapter.${A}.${s}.alive`,this.onAliveChanged)}}async componentDidMount(){if(super.componentDidMount(),this.props.oContext&&this.props.oContext.socket){const s=this.props.oContext.instance??"0",l=`system.adapter.${A}.${s}.alive`;try{const o=await this.props.oContext.socket.getState(l),a=!!(o!=null&&o.val);this.setState({alive:a}),await this.props.oContext.socket.subscribeState(l,this.onAliveChanged)}catch(o){console.error("[NavigationAssignmentPanel] Failed to get alive state or subscribe:",o),this.setState({alive:!1})}}await this.loadPanels(!1),await this.applyAssignmentsFromProps(this.props.currentAssignments||[])}onAliveChanged=(s,l)=>{const o=this.state.alive,a=l?!!l.val:!1;o!==a&&(this.setState({alive:a}),!o&&a&&this.state.assignments.length>0&&this.retryLoadingPagesForAssignments())};async applyAssignmentsFromProps(s){var i;const l=(s||[]).map(h=>this.state.available.find(g=>g.panelTopic===h.topic)||{panelTopic:h.topic,friendlyName:h.topic}).sort((h,v)=>h.friendlyName.localeCompare(v.friendlyName));console.log(`[NavigationAssignmentPanel] applyAssignmentsFromProps: available=${JSON.stringify(this.state.available)}, added=${JSON.stringify(l)}`);const o=this.state.selectedAddedTopic,u=l.find(h=>h.panelTopic===o)?o:(i=l[0])==null?void 0:i.panelTopic;this.setState({assignments:s,added:l,selectedAddedTopic:u,selectedTopic:""});const d=l.map(h=>this.loadPagesForPanel(h.panelTopic,!0));await Promise.all(d)}componentDidUpdate(s){if(s.uniqueName!==this.props.uniqueName){const l=this.props.currentAssignments||[];this.props.uniqueName&&this.setState(o=>({focusReceived:{...o.focusReceived,[this.props.uniqueName]:!0}})),this.loadPanels(!1).then(()=>{this.applyAssignmentsFromProps(l)})}else if(s.currentAssignments!==this.props.currentAssignments&&this.props.currentAssignments){const l=this.props.currentAssignments||[];this.applyAssignmentsFromProps(l)}}async loadPanels(s=!0){var l;try{let o=[];this.props.fetchPanels?o=await this.props.fetchPanels():(l=this.props.data)!=null&&l.panels&&(o=(this.props.data.panels||[]).map(a=>({panelTopic:a.topic,friendlyName:a.name||a.topic}))),await new Promise(a=>this.setState({available:o,selectedTopic:""},()=>a()))}catch{this.setState({available:[],selectedTopic:""})}}doAddSelected=()=>{const{selectedTopic:s,available:l,added:o}=this.state;if(!s)return;let a=l.find(i=>i.panelTopic===s);if(!a&&s===j&&(a={panelTopic:j,friendlyName:`(${T.I18n.t("all")||"All"})`}),!a||o.find(i=>i.panelTopic===a.panelTopic))return;const u=[...o,a],d=[...this.state.assignments,{topic:a.panelTopic}];this.setState({added:u,assignments:d,selectedTopic:""}),this.loadPagesForPanel(a.panelTopic),this.props.onAssign&&this.props.uniqueName&&this.props.onAssign(this.props.uniqueName,d)};doRemoveSelected=()=>{const{added:s,selectedAddedTopic:l}=this.state;if(s.length)if(l){const o=s.filter(i=>i.panelTopic!==l),a=this.state.assignments.filter(i=>i.topic!==l),u=s.findIndex(i=>i.panelTopic===l);let d;if(o.length>0){const i=o[u]??o[u-1]??o[0];d=i==null?void 0:i.panelTopic}else d=void 0;this.setState({added:o,assignments:a,selectedAddedTopic:d}),this.props.onAssign&&this.props.uniqueName&&this.props.onAssign(this.props.uniqueName,a)}else{const o=s.slice(0,-1),a=this.state.assignments.slice(0,-1),u=o.length?o[o.length-1].panelTopic:void 0;this.setState({added:o,assignments:a,selectedAddedTopic:u}),this.props.onAssign&&this.props.uniqueName&&this.props.onAssign(this.props.uniqueName,a)}};selectAdded=s=>{this.setState({selectedAddedTopic:s}),this.loadPagesForPanel(s,!0)};retryLoadingPagesForAssignments(){const s=this.state.assignments.map(l=>l.topic);for(const l of s)this.loadPagesForPanel(l,!0)}async loadPagesForPanel(s,l=!1){var h,v;if(!s)return;if(!this.state.alive){console.log(`[NavigationAssignmentPanel] Adapter not alive, skipping pages load for ${s}`);return}const o=Date.now(),a=this.state.lastLoadTime[s]||0,u=this.state.isLoading[s],d=!!this.state.pagesMap[s],i=l||!d||o-a>6e4;if(!(u||!i&&d)){this.setState(g=>({isLoading:{...g.isLoading,[s]:!0},lastLoadTime:{...g.lastLoadTime,[s]:o}}));try{let g=[],r=!1;if((h=this.props.oContext)!=null&&h.socket){const n=this.props.oContext.instance??"0",c=`${A}.${n}`,m={panelTopic:s};try{const p=new Promise((f,b)=>{setTimeout(()=>b(new Error("sendTo timeout after 2 seconds")),2e3)}),x=this.props.oContext.socket.sendTo(c,_,m),y=await Promise.race([x,p]);Array.isArray(y)?(g=y,r=!0):y&&Array.isArray(y.result)&&(g=y.result,r=!0),console.log("[NavigationAssignmentPanel] sendTo successful",{topic:s,pages:g})}catch(p){console.warn("[NavigationAssignmentPanel] sendTo failed or timed out",{target:c,cmd:_,payload:m,error:p})}}if(r&&g.length===0){const n=this.state.retryCount[s]||0,c=3,m=2e3;if(n<c){console.log(`[NavigationAssignmentPanel] Got empty array for ${s}, retrying in ${m}ms (attempt ${n+1}/${c})`),this.setState(p=>({retryCount:{...p.retryCount,[s]:n+1}})),setTimeout(()=>{this.setState(p=>({isLoading:{...p.isLoading,[s]:!1}})),this.loadPagesForPanel(s,!0)},m);return}console.log(`[NavigationAssignmentPanel] Max retries reached for ${s}, accepting empty result`),this.setState(p=>({retryCount:{...p.retryCount,[s]:0}}))}else r&&g.length>0&&this.setState(n=>({retryCount:{...n.retryCount,[s]:0}}));if(!r&&!((v=this.props.oContext)!=null&&v.socket)&&(await new Promise(n=>setTimeout(n,1e3)),this.setState(n=>({isLoading:{...n.isLoading,[s]:!1}})),!this.state.focusReceived[s]))return this.setState(n=>({focusReceived:{...n.focusReceived,[s]:!0}})),this.loadPagesForPanel(s,!0);this.setState(n=>({pagesMap:{...n.pagesMap,[s]:g},isLoading:{...n.isLoading,[s]:!1}}))}catch(g){console.error("[NavigationAssignmentPanel] loadPagesForPanel error",{topic:s,error:g}),this.setState(r=>({isLoading:{...r.isLoading,[s]:!1}}))}}}setNavigationForSelected=s=>{const{selectedAddedTopic:l,assignments:o}=this.state;if(!l)return;const a=o.findIndex(h=>h.topic===l),u=[...o],d=o[a],i={topic:l,navigation:{...d==null?void 0:d.navigation,...s}};a>=0?u[a]=i:u.push(i),this.setState({assignments:u}),this.props.onAssign&&this.props.uniqueName&&this.props.onAssign(this.props.uniqueName,u)};getNavValue=(s,l)=>{var u;if(!s)return"";const o=this.state.assignments.find(d=>d.topic===s);return((u=o==null?void 0:o.navigation)==null?void 0:u[l])||""};togglePanel=()=>{const s=this.state.isCollapsed;this.setState(l=>({isCollapsed:!l.isCollapsed})),s&&this.applyAssignmentsFromProps(this.props.currentAssignments||[])};renderItem(s,l,o){const{widthPercent:a}=this.props,{isCollapsed:u}=this.state,d=this.state.selectedAddedTopic?this.state.pagesMap[this.state.selectedAddedTopic]??[]:[];return e.jsxs(t.Box,{sx:{position:{xs:"static",md:"absolute"},right:{xs:"auto",md:0},top:{xs:"auto",md:0},height:{xs:"auto",md:"100%"},width:{xs:"100%",md:u?"10px":`${a}%`},minHeight:{xs:u?"50px":"auto",md:"auto"},transition:"width 240ms ease, min-height 240ms ease",backgroundColor:"background.default",border:{xs:"2px solid",md:"none"},borderLeft:{xs:"none",md:"2px solid"},borderTop:{xs:"none",md:"2px solid"},borderColor:"secondary.main",borderRadius:{xs:1,md:0},overflow:{xs:"hidden",md:"visible"},display:"flex",flexDirection:"column",zIndex:20,mt:{xs:2,md:0}},children:[e.jsx(t.Box,{sx:{display:{xs:"none",md:"flex"},position:"absolute",left:"-20px",top:"50%",transform:"translateY(-50%)",width:"20px",height:"60px",backgroundColor:"secondary.main",borderRadius:"4px 0 0 4px",alignItems:"center",justifyContent:"center",cursor:"pointer",zIndex:21,"&:hover":{backgroundColor:"secondary.dark"}},onClick:this.togglePanel,children:e.jsx(t.Typography,{sx:{color:"secondary.contrastText",fontSize:"14px",fontWeight:"bold",transform:"rotate(-90deg)",whiteSpace:"nowrap"},children:u?"⏶":"⏷"})}),e.jsx(t.Box,{sx:{display:{xs:"flex",md:"none"},alignItems:"center",justifyContent:"center",p:1,backgroundColor:"secondary.main",color:"secondary.contrastText",borderRadius:"4px 4px 0 0"},children:e.jsx(t.Typography,{variant:"subtitle2",sx:{fontWeight:600},children:T.I18n.t("navigation_panel")})}),e.jsxs(t.Box,{sx:{p:1,height:"100%",display:{xs:"flex",md:u?"none":"flex"},flexDirection:"column",width:{xs:"100%",md:u?"0%":"100%"},overflow:"hidden",transition:{xs:"none",md:"width 240ms ease"}},children:[e.jsx(t.Typography,{variant:"h6",sx:{mb:1,fontWeight:600,color:"primary.main",fontSize:"1rem",display:{xs:"none",md:"block"}},children:T.I18n.t("navigation_panel")}),e.jsxs(t.Box,{sx:{display:"flex",gap:1,alignItems:"center",mb:1},children:[e.jsxs(t.Select,{size:"small",variant:"standard",value:this.state.selectedTopic,onOpen:()=>{this.loadPanels()},onChange:i=>this.setState({selectedTopic:String(i.target.value)}),disabled:!this.state.alive,sx:{flex:1,backgroundColor:"transparent",minHeight:40,"& .MuiSelect-select":{backgroundColor:"transparent",display:"flex",alignItems:"center",height:40}},displayEmpty:!0,children:[e.jsx(t.MenuItem,{value:"",children:e.jsx("em",{children:"—"})}),!this.state.added.some(i=>i.panelTopic===j)&&e.jsx(t.MenuItem,{value:j,children:`(${T.I18n.t("all")||"All"})`}),this.state.available.filter(i=>!this.state.added.some(h=>h.panelTopic===i.panelTopic)).map(i=>e.jsx(t.MenuItem,{value:i.panelTopic,children:i.friendlyName},i.panelTopic))]}),e.jsx(t.Button,{size:"small",variant:"contained",sx:{minWidth:32,padding:"4px 8px"},onClick:this.doAddSelected,disabled:!this.state.selectedTopic||!this.state.alive,children:"+"})]}),e.jsx(t.Box,{children:this.state.added.length===0?e.jsx(t.Typography,{variant:"body2",color:"text.secondary",children:T.I18n.t("No panels added")}):e.jsx("div",{style:{overflow:"auto"},children:e.jsx(t.List,{dense:!0,children:this.state.added.map(i=>{const h=i.panelTopic,v=this.state.pendingDelete===h;return e.jsx(S.Fragment,{children:e.jsx(t.ListItem,{component:"div",disablePadding:!0,sx:{"&:hover .delete-icon":{opacity:1}},secondaryAction:e.jsx(t.IconButton,{className:"delete-icon",edge:"end","aria-label":"delete",size:"small",onClick:g=>{var r;if(g.stopPropagation(),!v)this.setState({pendingDelete:h}),setTimeout(()=>{this.state.pendingDelete===h&&this.setState({pendingDelete:void 0})},3e3);else{const n=this.state.added.filter(p=>p.panelTopic!==h),c=this.state.assignments.filter(p=>p.topic!==h),m=n.length>0?(r=n[0])==null?void 0:r.panelTopic:void 0;this.setState({added:n,assignments:c,selectedAddedTopic:m,pendingDelete:void 0}),this.props.onAssign&&this.props.uniqueName&&this.props.onAssign(this.props.uniqueName,c)}},sx:{color:v?"error.dark":"error.main",opacity:{xs:1,md:0},transition:"opacity 0.2s",backgroundColor:v?"error.main":"transparent","&:hover":{backgroundColor:v?"error.dark":"action.hover"}},children:e.jsx(w,{fontSize:"small"})}),children:e.jsx(t.ListItemButton,{selected:this.state.selectedAddedTopic===h,onClick:()=>{this.selectAdded(h),this.setState({pendingDelete:void 0})},sx:{pr:6},children:e.jsx(t.ListItemText,{primary:h===j?`(${T.I18n.t("all")||"All"})`:i.friendlyName,sx:{flex:1,overflow:"hidden",textOverflow:"ellipsis"}})})})},h)})})})}),e.jsx(t.Divider,{sx:{my:1}}),e.jsxs(t.Box,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:1,mt:1},children:[e.jsxs(t.Box,{children:[e.jsx(t.Box,{sx:{display:"flex",alignItems:"center",mb:.5},children:e.jsx(N,{title:T.I18n.t("nav_prev_tooltip"),children:e.jsx(t.Typography,{variant:"caption",color:"text.secondary",sx:{mr:.5},children:"prev"})})}),e.jsxs(t.Select,{size:"small",displayEmpty:!0,"aria-label":"prev",value:this.getNavValue(this.state.selectedAddedTopic,"prev")||"",onOpen:()=>{this.state.selectedAddedTopic&&this.loadPagesForPanel(this.state.selectedAddedTopic,!0)},onChange:i=>this.setNavigationForSelected({prev:String(i.target.value)||void 0}),sx:{width:"100%"},disabled:!this.state.alive||this.state.selectedAddedTopic&&this.state.isLoading[this.state.selectedAddedTopic]||!1,endAdornment:this.state.selectedAddedTopic&&this.state.isLoading[this.state.selectedAddedTopic]?e.jsx(t.Box,{sx:{display:"flex",alignItems:"center",pr:1},children:e.jsx(t.CircularProgress,{size:16})}):null,children:[e.jsx(t.MenuItem,{value:"",children:this.state.selectedAddedTopic?e.jsx("em",{children:"—"}):e.jsx("em",{children:T.I18n.t("select_panel_first")})}),d.filter(i=>i!==this.props.uniqueName).map(i=>e.jsx(t.MenuItem,{value:i,children:i},`prev-${i}`))]})]}),e.jsxs(t.Box,{children:[e.jsx(t.Box,{sx:{display:"flex",alignItems:"center",mb:.5},children:e.jsx(N,{title:T.I18n.t("nav_next_tooltip"),children:e.jsx(t.Typography,{variant:"caption",color:"text.secondary",sx:{mr:.5},children:"next"})})}),e.jsxs(t.Select,{size:"small",displayEmpty:!0,"aria-label":"next",value:this.getNavValue(this.state.selectedAddedTopic,"next")||"",onOpen:()=>{this.state.selectedAddedTopic&&this.loadPagesForPanel(this.state.selectedAddedTopic,!0)},onChange:i=>this.setNavigationForSelected({next:String(i.target.value)||void 0}),sx:{width:"100%"},disabled:!this.state.alive||this.state.selectedAddedTopic&&this.state.isLoading[this.state.selectedAddedTopic]||!1,endAdornment:this.state.selectedAddedTopic&&this.state.isLoading[this.state.selectedAddedTopic]?e.jsx(t.Box,{sx:{display:"flex",alignItems:"center",pr:1},children:e.jsx(t.CircularProgress,{size:16})}):null,children:[e.jsx(t.MenuItem,{value:"",children:this.state.selectedAddedTopic?e.jsx("em",{children:"—"}):e.jsx("em",{children:T.I18n.t("select_panel_first")})}),d.filter(i=>i!==this.props.uniqueName&&!i.startsWith("///")).map(i=>e.jsx(t.MenuItem,{value:i,children:i},`next-${i}`))]})]}),e.jsxs(t.Box,{children:[e.jsx(t.Typography,{variant:"caption",color:"text.secondary",sx:{mb:.5,display:"block"},children:"home"}),e.jsxs(t.Select,{size:"small",displayEmpty:!0,"aria-label":"home",value:this.getNavValue(this.state.selectedAddedTopic,"home")||"",onOpen:()=>{this.state.selectedAddedTopic&&this.loadPagesForPanel(this.state.selectedAddedTopic,!0)},onChange:i=>this.setNavigationForSelected({home:String(i.target.value)||void 0}),sx:{width:"100%"},disabled:!this.state.alive||this.state.selectedAddedTopic&&this.state.isLoading[this.state.selectedAddedTopic]||!1,endAdornment:this.state.selectedAddedTopic&&this.state.isLoading[this.state.selectedAddedTopic]?e.jsx(t.Box,{sx:{display:"flex",alignItems:"center",pr:1},children:e.jsx(t.CircularProgress,{size:16})}):null,children:[e.jsx(t.MenuItem,{value:"",children:e.jsx("em",{children:"—"})}),d.filter(i=>i!==this.props.uniqueName).map(i=>e.jsx(t.MenuItem,{value:i,children:i},`home-${i}`))]})]}),e.jsxs(t.Box,{children:[e.jsx(t.Typography,{variant:"caption",color:"text.secondary",sx:{mb:.5,display:"block"},children:"parent"}),e.jsxs(t.Select,{size:"small",displayEmpty:!0,"aria-label":"parent",value:this.getNavValue(this.state.selectedAddedTopic,"parent")||"",onOpen:()=>{this.state.selectedAddedTopic&&this.loadPagesForPanel(this.state.selectedAddedTopic,!0)},onChange:i=>this.setNavigationForSelected({parent:String(i.target.value)||void 0}),sx:{width:"100%"},disabled:!this.state.alive||this.state.selectedAddedTopic&&this.state.isLoading[this.state.selectedAddedTopic]||!1,endAdornment:this.state.selectedAddedTopic&&this.state.isLoading[this.state.selectedAddedTopic]?e.jsx(t.Box,{sx:{display:"flex",alignItems:"center",pr:1},children:e.jsx(t.CircularProgress,{size:16})}):null,children:[e.jsx(t.MenuItem,{value:"",children:e.jsx("em",{children:"—"})}),d.filter(i=>i!==this.props.uniqueName).map(i=>e.jsx(t.MenuItem,{value:i,children:i},`parent-${i}`))]})]}),e.jsx(t.Divider,{sx:{my:1}})]}),this.state.added.length>0?this.state.added.map(i=>{const h=i.panelTopic,v=this.state.added.some(f=>f.panelTopic===j),g=this.getNavValue(h,"next"),r=this.getNavValue(h,"prev"),n=this.getNavValue(h,"home"),c=this.getNavValue(h,"parent"),m=!!(g||r||n||c),p=h===j,x=!g&&!r,y=p?"nav_all_requires_prev_next":v?"nav_remove_from_all_notice":"nav_target_only_notice";return e.jsxs(t.Box,{"data-has-all":v,sx:{mt:2,mb:1},children:[e.jsxs(t.Box,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:[e.jsx(t.Box,{sx:{width:10,height:10,borderRadius:"50%",bgcolor:m?"success.main":"error.main"}}),e.jsx(t.Typography,{variant:"subtitle2",sx:{fontWeight:600},children:h===j?`(${T.I18n.t("all")||"All"})`:i.friendlyName||h})]}),e.jsx(t.Box,{sx:{display:"flex",alignItems:"center",gap:1,flexWrap:"wrap"},children:["next","prev","parent","home"].map((f,b)=>{const k=this.getNavValue(h,f);return e.jsxs(S.Fragment,{children:[e.jsxs(t.Box,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(t.Typography,{variant:"caption",color:"text.secondary",children:T.I18n.t(f)||f}),e.jsx(t.Typography,{variant:"body2",children:k||e.jsx("em",{children:"—"})})]}),b<3&&e.jsx(t.Divider,{orientation:"vertical",flexItem:!0,sx:{height:18,mx:1}})]},`${h}-${f}`)})}),x?e.jsx(t.Box,{sx:{mt:1},children:e.jsx(t.Typography,{variant:"caption",color:"text.secondary",sx:{fontStyle:"italic"},children:T.I18n.t(y)})}):null]},`panel-summary-${h}`)}):null]})]})}}class O extends C.ConfigGeneric{_local=null;pagesRetryTimeout;constructor(s){super(s);const l=C.ConfigGeneric.getValue(s.data,s.attr);this.state={...this.state,entries:Array.isArray(l)?l:[],confirmDeleteOpen:!1,confirmDeleteName:null,alive:!1,pagesRetryCount:0}}componentWillUnmount(){this.pagesRetryTimeout&&clearTimeout(this.pagesRetryTimeout);const s=this.props.oContext.instance??"0";this.props.oContext.socket.unsubscribeState(`system.adapter.${A}.${s}.alive`,this.onAliveChanged)}async componentDidMount(){super.componentDidMount();const s=this.props.oContext.instance??"0",l=`system.adapter.${A}.${s}.alive`;try{const o=await this.props.oContext.socket.getState(l),a=!!(o!=null&&o.val);this.setState({alive:a}),await this.props.oContext.socket.subscribeState(l,this.onAliveChanged),a&&await this.loadPagesList()}catch(o){console.error("[UnlockPage] Failed to get alive state or subscribe:",o),this.setState({alive:!1})}}onAliveChanged=(s,l)=>{const o=this.state.alive,a=l?!!l.val:!1;o!==a&&(this.setState({alive:a}),!o&&a&&(!this.state.pagesList||this.state.pagesList.length===0)&&this.loadPagesList(),o&&!a&&this.pagesRetryTimeout&&(clearTimeout(this.pagesRetryTimeout),this.pagesRetryTimeout=void 0))};async loadPagesList(){if(!this.state.alive){console.log("[UnlockPage] Adapter not alive, skipping pages load");return}const s=[];if(this.props.oContext&&this.props.oContext.socket){const l=this.props.oContext.instance??"0",o=`${A}.${l}`;try{const a=await this.props.oContext.socket.sendTo(o,B,null);let u=[];Array.isArray(a)?u=a:a&&Array.isArray(a.result)&&(u=a.result);for(const d of u)s.push(d);if(u.length===0){const d=this.state.pagesRetryCount||0,i=3e3;console.log(`[UnlockPage] Got empty pages array, retrying in ${i}ms (attempt ${d+1})`),this.setState({pagesRetryCount:d+1}),this.pagesRetryTimeout&&clearTimeout(this.pagesRetryTimeout),this.pagesRetryTimeout=setTimeout(()=>{this.state.alive?this.loadPagesList():console.log("[UnlockPage] Adapter went offline, cancelling pages retry")},i);return}else u.length>0&&(console.log(`[UnlockPage] Successfully loaded ${u.length} pages after ${this.state.pagesRetryCount||0} retries`),this.setState({pagesRetryCount:0}),this.pagesRetryTimeout&&(clearTimeout(this.pagesRetryTimeout),this.pagesRetryTimeout=void 0))}catch(a){const u=this.state.pagesRetryCount||0,d=3e3;console.log(`[UnlockPage] Error loading pages, retrying in ${d}ms (attempt ${u+1}): ${String(a)}`),this.setState({pagesRetryCount:u+1}),this.pagesRetryTimeout&&clearTimeout(this.pagesRetryTimeout),this.pagesRetryTimeout=setTimeout(()=>{this.state.alive?this.loadPagesList():console.log("[UnlockPage] Adapter went offline, cancelling pages retry after error")},d);return}}else{console.log("[UnlockPage] No socket available for sendTo");return}this.setState({pagesList:Array.from(new Set(s))})}renderItem(s,l,o){var g;const a=this.state.entries||[],u=Array.from(new Set(a.map(r=>r.uniqueName))).filter(Boolean);this._local||(this._local={newName:"",selected:u[0]||"",showPin:!1});const d=this._local,i=()=>{const r=(d.newName||"").trim();if(!r)return;const n={card:"cardAlarm",uniqueName:r,headline:r,button1:"",button2:"",button3:"",button4:"",button5:"",button6:"",button7:"",button8:"",pin:0},c=[...a,n];this.setState({entries:c}),this.onChange(this.props.attr,c),d.newName="",d.selected=r},h=()=>{this.setState({confirmDeleteOpen:!1,confirmDeleteName:null})},v=()=>{const r=this.state.confirmDeleteName;if(!r){h();return}const n=a.filter(m=>m.uniqueName!==r);this.setState({entries:n,confirmDeleteOpen:!1,confirmDeleteName:null}),this.onChange(this.props.attr,n);const c=Array.from(new Set(n.map(m=>m.uniqueName))).filter(Boolean);d.selected=c[0]||"",this.setState({})};return e.jsxs(t.Box,{sx:{height:"calc(100vh - 64px)",display:"flex",flexDirection:{xs:"column",md:"row"},p:1},children:[e.jsxs(t.Box,{sx:{width:{xs:"100%",md:"20%"},pr:{xs:0,md:1},display:"flex",flexDirection:"column",gap:1},children:[e.jsx(t.Typography,{variant:"h6",sx:{mb:1,fontWeight:600,color:"primary.main",fontSize:"1rem"},children:this.getText("pages")}),e.jsx(t.Paper,{sx:{p:1,backgroundColor:"transparent"},elevation:0,children:e.jsxs(t.Box,{sx:{display:"flex",gap:1},children:[e.jsx(t.TextField,{"aria-label":"new-name",label:this.getText("new_page"),value:d.newName,onChange:r=>{d.newName=r.target.value,this.setState({})},variant:"standard",placeholder:this.getText("New item"),InputProps:{sx:{backgroundColor:"transparent",px:1}},sx:{flex:1,"& .MuiInput-underline:before":{borderBottomColor:"primary.main"},"& .MuiInput-underline:hover:before":{borderBottomColor:"primary.main"},"& .MuiInput-underline:after":{borderBottomColor:"primary.main"},"& .MuiInputLabel-root":{color:"primary.main"},"& .MuiInputLabel-root.Mui-focused":{color:"primary.main"}}}),e.jsx(t.Button,{size:"small",variant:"contained",onClick:i,disabled:(()=>{const r=(d.newName||"").trim();return!r||u.includes(r)})(),children:"+"})]})}),e.jsx(t.Paper,{sx:{overflow:"auto",p:1,backgroundColor:"transparent"},elevation:0,children:u.length===0?e.jsx(t.Typography,{variant:"body2",color:"text.secondary",children:this.getText("No items")}):u.map(r=>e.jsxs(t.Box,{onClick:()=>{d.selected=r,this.setState({})},sx:{p:1,borderRadius:1,cursor:"pointer",backgroundColor:d.selected===r?"action.selected":"transparent",mb:.5,display:"flex",justifyContent:"space-between",alignItems:"center","&:hover .delete-icon":{opacity:1}},children:[e.jsx(t.Typography,{variant:"body2",sx:{flex:1,overflow:"hidden",textOverflow:"ellipsis"},children:r}),e.jsx(t.IconButton,{className:"delete-icon",edge:"end","aria-label":"delete",size:"small",onClick:n=>{n.stopPropagation(),d.selected=r,this.setState({confirmDeleteOpen:!0,confirmDeleteName:r})},sx:{color:"error.main",opacity:{xs:1,md:0},transition:"opacity 0.2s"},children:e.jsx(w,{fontSize:"small"})})]},r))}),e.jsx(t.Divider,{sx:{my:1}}),e.jsx(t.Box,{sx:{mb:2},children:e.jsx("a",{href:"https://github.com/ticaki/ioBroker.nspanel-lovelace-ui/wiki/pageUnlock",target:"_blank",rel:"noopener noreferrer",style:{textDecoration:"none",color:"inherit",fontSize:"0.875rem"},children:e.jsx(t.Typography,{variant:"body2",sx:{color:"primary.main",textDecoration:"underline",cursor:"pointer","&:hover":{opacity:.8}},children:this.getText("documentation")})})})]}),e.jsx(L,{open:!!this.state.confirmDeleteOpen,onClose:h,onConfirm:v,title:this.getText("unlock_delete_confirm_title"),description:this.getText("unlock_delete_confirm_text")+(this.state.confirmDeleteName?`: ${this.state.confirmDeleteName}`:""),cancelText:this.getText("Cancel"),confirmText:this.getText("Delete"),ariaTitleId:"unlock-delete-confirm-title",ariaDescId:"unlock-delete-confirm-description"}),e.jsxs(t.Box,{sx:{width:{xs:"100%",md:"90%"},pl:{xs:0,md:2},mt:{xs:2,md:0},display:"flex",flexDirection:{xs:"column",md:"row"},gap:1,position:"relative"},children:[e.jsx(t.Box,{sx:{width:{xs:"100%",md:"95%"},borderLeft:{xs:"none",md:"1px solid"},borderColor:"divider"},children:e.jsx(t.Paper,{sx:{height:"100%",p:2},elevation:1,children:d.selected?e.jsx(t.Box,{children:(()=>{const r=d.selected,n=a.find(c=>c.uniqueName===r);return n?e.jsxs(e.Fragment,{children:[e.jsx(t.Box,{sx:{mb:1,p:1,borderRadius:1,backgroundColor:"action.hover"},children:e.jsx(t.TextField,{fullWidth:!0,variant:"standard",type:"text",label:this.getText("unlock_unique_label"),value:r,onChange:c=>{const m=c.target.value;if(!m.trim())return;const p=a.map(x=>x.uniqueName===r?{...x,uniqueName:m}:x);this.setState({entries:p}),this.onChange(this.props.attr,p),d.selected=m},InputProps:{sx:{backgroundColor:"transparent",px:1,fontWeight:600,width:"50%"}}})}),e.jsx(t.Box,{sx:{mb:1},children:e.jsxs(t.FormControl,{component:"fieldset",children:[e.jsx(t.Typography,{variant:"subtitle2",sx:{mb:1},children:this.getText("unlock_type")}),e.jsxs(t.RadioGroup,{row:!0,value:(n==null?void 0:n.alarmType)||"",onChange:(c,m)=>{const p=a.map(x=>x.uniqueName===r?{...x,alarmType:m}:x);this.setState({entries:p}),this.onChange(this.props.attr,p)},children:[e.jsx(t.FormControlLabel,{value:"alarm",control:e.jsx(t.Radio,{}),label:this.getText("unlock_alarm")}),e.jsx(t.FormControlLabel,{value:"unlock",control:e.jsx(t.Radio,{}),label:this.getText("unlock_unlock")})]})]})}),e.jsx(t.TextField,{fullWidth:!0,variant:"standard",type:"text",autoComplete:"off",label:this.getText("unlock_headline"),value:n.headline??"",onChange:c=>{const m=c.target.value,p=a.map(x=>x.uniqueName===r?{...x,headline:m}:x);this.setState({entries:p}),this.onChange(this.props.attr,p)},InputProps:{sx:{backgroundColor:"transparent",px:1,width:"50%"}},sx:{mb:2}}),e.jsx(t.Box,{sx:{mt:2},children:e.jsx(t.TextField,{variant:"standard",label:this.getText("unlock_pin"),type:d.showPin?"text":"password",value:n.pin!==void 0&&n.pin!==null?String(n.pin):"",onChange:c=>{const p=c.target.value.replace(/[^0-9]/g,""),x=p?parseInt(p,10):0,y=a.map(f=>f.uniqueName===r?{...f,pin:x}:f);this.setState({entries:y}),this.onChange(this.props.attr,y)},InputProps:{sx:{backgroundColor:"transparent",px:1},endAdornment:e.jsx(t.InputAdornment,{position:"end",children:e.jsx(t.IconButton,{"aria-label":d.showPin?"hide-pin":"show-pin",onClick:()=>{d.showPin=!d.showPin,this.setState({})},edge:"end",size:"small",children:d.showPin?e.jsx(F,{fontSize:"small"}):e.jsx(q,{fontSize:"small"})})})}})}),e.jsxs(t.Box,{sx:{mt:2},children:[e.jsx(t.FormControlLabel,{control:e.jsx(t.Checkbox,{checked:!!n.hidden,onChange:(c,m)=>{const p=a.map(x=>x.uniqueName===r?{...x,hidden:m}:x);this.setState({entries:p}),this.onChange(this.props.attr,p)}}),label:this.getText("unlock_hidden")}),e.jsx(t.Box,{sx:{mt:2},children:e.jsxs(t.FormControl,{component:"fieldset",children:[e.jsx(t.Typography,{variant:"subtitle2",sx:{mb:1},children:this.getText("unlock_alwaysOn")}),e.jsxs(t.RadioGroup,{row:!0,value:(n==null?void 0:n.alwaysOn)||"none",onChange:(c,m)=>{const p=a.map(x=>x.uniqueName===r?{...x,alwaysOn:m}:x);this.setState({entries:p}),this.onChange(this.props.attr,p)},children:[e.jsx(t.FormControlLabel,{value:"none",control:e.jsx(t.Radio,{}),label:this.getText("unlock_alwaysOn_none")}),e.jsx(t.FormControlLabel,{value:"always",control:e.jsx(t.Radio,{}),label:this.getText("unlock_alwaysOn_always")}),e.jsx(t.FormControlLabel,{value:"ignore",control:e.jsx(t.Radio,{}),label:this.getText("unlock_alwaysOn_ignore")})]})]})})]}),n.alarmType==="alarm"&&e.jsxs(t.Box,{sx:{mt:2},children:[e.jsxs(t.Box,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"1fr 1fr"},gap:2},children:[e.jsxs(t.Box,{children:[e.jsx(t.Typography,{variant:"subtitle2",sx:{mb:1},children:this.getText("unlock_armed_header")}),e.jsx(t.Box,{sx:{display:"grid",gap:2},children:[1,2,3,4].map(c=>{const m=`button${c}`,p=(c-1)%4+1;return e.jsxs(t.Box,{children:[e.jsx(t.Typography,{variant:"caption",color:"text.secondary",sx:{mb:.5},children:this.getText(`unlock_button${p}_label`)}),e.jsx(t.TextField,{fullWidth:!0,variant:"standard",placeholder:this.getText(`unlock_button${p}_placeholder`),value:n[m]??"",onChange:x=>{const y=x.target.value,f=a.map(b=>b.uniqueName===r?{...b,[m]:y}:b);this.setState({entries:f}),this.onChange(this.props.attr,f)},InputProps:{disableUnderline:!0,sx:{backgroundColor:"transparent",px:1,"& input::placeholder":{color:"text.disabled"}}}})]},c)})})]}),e.jsxs(t.Box,{children:[e.jsx(t.Typography,{variant:"subtitle2",sx:{mb:1},children:this.getText("unlock_disarmed_header")}),e.jsx(t.Box,{sx:{display:"grid",gap:2},children:[5,6,7,8].map(c=>{const m=`button${c}`,p=(c-1)%4+1;return e.jsxs(t.Box,{children:[e.jsx(t.Typography,{variant:"caption",color:"text.secondary",sx:{mb:.5},children:this.getText(`unlock_button${p}_label`)}),e.jsx(t.TextField,{fullWidth:!0,variant:"standard",placeholder:this.getText(`unlock_button${p}_placeholder`),value:n[m]??"",onChange:x=>{const y=x.target.value,f=a.map(b=>b.uniqueName===r?{...b,[m]:y}:b);this.setState({entries:f}),this.onChange(this.props.attr,f)},InputProps:{disableUnderline:!0,sx:{backgroundColor:"transparent",px:1,"& input::placeholder":{color:"text.disabled"}}}})]},c)})})]})]}),e.jsx(t.Box,{sx:{mt:1},children:e.jsx(t.FormControlLabel,{control:e.jsx(t.Checkbox,{checked:!!n.approved,onChange:(c,m)=>{const p=a.map(x=>x.uniqueName===r?{...x,approved:m}:x);this.setState({entries:p}),this.onChange(this.props.attr,p)}}),label:this.getText("unlock_approved")})})]}),n.alarmType==="unlock"&&e.jsxs(t.Box,{sx:{mt:2},children:[e.jsx(t.Typography,{variant:"caption",color:"text.secondary",sx:{mb:.5},children:this.getText("unlock_setnavi_hint")}),e.jsxs(t.Select,{variant:"standard",displayEmpty:!0,value:n.setNavi??"",onChange:c=>{const m=String(c.target.value),p=a.map(x=>x.uniqueName===r?{...x,setNavi:m}:x);this.setState({entries:p}),this.onChange(this.props.attr,p)},sx:{backgroundColor:"transparent",px:1,width:"60%"},children:[e.jsx(t.MenuItem,{value:"",children:e.jsx("em",{children:this.getText("unlock_setnavi_placeholder")})}),(this.state.pagesList||[]).filter(c=>typeof c=="string"&&!c.startsWith("///")&&c!==r).map(c=>e.jsx(t.MenuItem,{value:c,children:c},c)),n.setNavi&&n.setNavi!==r&&!(this.state.pagesList||[]).includes(n.setNavi)&&e.jsx(t.MenuItem,{value:n.setNavi,children:n.setNavi},`custom-${n.setNavi}`)]})]})]}):null})()}):e.jsxs(t.Box,{children:[e.jsx(t.Typography,{variant:"h6",children:this.getText("unlock_select_item")}),e.jsx(t.Box,{sx:{mt:2},children:e.jsx(t.Typography,{variant:"body2",color:"text.secondary",children:this.getText("unlock_select_description")})})]})})}),e.jsx(M,{...this.props,widthPercent:30,uniqueName:d.selected,currentAssignments:((g=a.find(r=>r.uniqueName===d.selected))==null?void 0:g.navigationAssignment)||[],oContext:this.props.oContext,onAssign:(r,n)=>{const c=a.map(m=>m.uniqueName===r?{...m,navigationAssignment:n}:m);this.setState({entries:c}),this.onChange(this.props.attr,c)}})]})]})}}const E=I(O),se={NavigationView:$,IconSelect:D,IconOverview:R,UnlockPage:E};export{se as default};
